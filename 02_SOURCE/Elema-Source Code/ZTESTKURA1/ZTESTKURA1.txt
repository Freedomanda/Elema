REPORT ZTESTKURA1 .

parameters:
p_from type tcurr-fcurr,
p_to   type tcurr-fcurr.
TYPES: BETRAG(8) TYPE P DECIMALS 2.

TABLES TCURR.
data:
IGNORE_MESSAGES,
QUELL_WAERS LIKE TCURR-FCURR,
ZIEL_WAERS  LIKE QUELL_WAERS,
IT_BETRAEGE-QUELL_BETRAG TYPE BETRAG,
IT_BETRAEGE-ZIEL_BETRAG TYPE BETRAG,
KURS        LIKE TCURR-UKURS,
FFACT       LIKE TCURR-FFACT,
TFACT       LIKE TCURR-TFACT,
KURST       LIKE TCURR-KURST,
FIX_KURS    LIKE KURS,
EX_KURS     LIKE KURS.


start-of-selection.

QUELL_WAERS = P_FROM.
ZIEL_WAERS  = P_TO.
TCURR-KURST = 'M'.

PERFORM CURRENCY-CONVERSION USING IGNORE_MESSAGES
QUELL_WAERS  IT_BETRAEGE-QUELL_BETRAG
ZIEL_WAERS   IT_BETRAEGE-ZIEL_BETRAG.

WRITE EX_KURS.

FORM CURRENCY-CONVERSION USING VALUE(MSG_HANDLING)
Q_WAE Q_BTR Z_WAE Z_BTR.

CALL FUNCTION 'CONVERT_TO_LOCAL_CURRENCY'
EXPORTING
DATE              = SY-DATUM
FOREIGN_AMOUNT    = Q_BTR
FOREIGN_CURRENCY  = Q_WAE
LOCAL_CURRENCY    = Z_WAE
*                  RATE              = KURS
TYPE_OF_RATE      = TCURR-KURST
IMPORTING
*                  FOREIGN_FACTOR    = FFACT
*                  LOCAL_FACTOR      = TFACT
EXCHANGE_RATE     = EX_KURS
*                  DERIVED_RATE_TYPE = KURST
*                  LOCAL_AMOUNT      = Z_BTR
*                  FIXED_RATE        = FIX_KURS
EXCEPTIONS
NO_RATE_FOUND = 1
OVERFLOW = 2
NO_FACTORS_FOUND = 3
NO_SPREAD_FOUND = 4
DERIVED_2_TIMES    = 5
OTHERS            = 6.

IF SY-SUBRC <> 0.
MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.

*        CALL FUNCTION 'CONVERT_TO_LOCAL_CURRENCY'
*             EXPORTING
*                  DATE              = SY-DATUM
*                  FOREIGN_CURRENCY  = Z_WAE
*                  LOCAL_AMOUNT      = Q_BTR
*                  LOCAL_CURRENCY    = Q_WAE
*                  RATE              = KURS
*                  TYPE_OF_RATE      = TCURR-KURST
*             IMPORTING
*                  FOREIGN_FACTOR    = FFACT
*                  LOCAL_FACTOR      = TFACT
*                  EXCHANGE_RATE     = EX_KURS
*                  DERIVED_RATE_TYPE = KURST
*                  FOREIGN_AMOUNT    = Z_BTR
*                  FIXED_RATE        = FIX_KURS
*             EXCEPTIONS
*                  NO_RATE_FOUND     = 1
*                  OVERFLOW          = 2
*                  NO_FACTORS_FOUND  = 3
*                  NO_SPREAD_FOUND   = 4
*                  DERIVED_2_TIMES   = 5
*                  OTHERS            = 6.
ENDFORM.

REPORT YKSPACEC.

TABLES: T000, DD02L.                                    "27th.March.2003

PARAMETER: CLIENT  LIKE T000-MANDT DEFAULT SY-MANDT.
PARAMETER: TABLE   LIKE DD02L-TABNAME.
PARAMETER: NOCLASSL DEFAULT 'X'.
PARAMETER: NOCLASSA.

DATA: BEGIN OF SIZETAB,
TABNAME LIKE DD02L-TABNAME,
ENTRIES LIKE JCTAB-COUNTER,
WIDTH   LIKE JCTAB-TABLEN,
END OF SIZETAB.
DATA: DD02L_TAB   LIKE DD02L OCCURS 0 WITH HEADER LINE.
DATA: T000_TAB    LIKE T000 OCCURS 0 WITH HEADER LINE.
DATA: VRS_TAB     LIKE VRSTABC OCCURS 0 WITH HEADER LINE.
DATA: SELTAB      LIKE JCTAB OCCURS 0 WITH HEADER LINE.
DATA: X_DBSPACE   LIKE CCDBSPACE OCCURS 0 WITH HEADER LINE.
DATA: COUNT       TYPE I.
DATA: CLIENT_ORI  LIKE T000-MANDT.
DATA: TABLE_ORI   LIKE DD02L-TABNAME.

CLIENT_ORI = CLIENT.
TABLE_ORI  = TABLE.

AUTHORITY-CHECK OBJECT 'S_TABU_CLI'
ID 'CLIIDMAINT' FIELD 'X'.
IF SY-SUBRC <> 0.
WRITE: 'You are not permitted to use this program'(001).
STOP.
ENDIF.

REPLACE '*' WITH '%' INTO CLIENT.
REPLACE '*' WITH '%' INTO TABLE.
SELECT * FROM DD02L INTO TABLE DD02L_TAB WHERE TABNAME LIKE TABLE
AND   AS4LOCAL = 'A'
AND   CLIDEP   = 'X'
AND ( TABCLASS EQ 'TRANSP'
OR    TABCLASS EQ 'POOL'
OR    TABCLASS EQ 'CLUSTER' ).

SELECT * FROM T000 INTO TABLE T000_TAB
WHERE MANDT LIKE CLIENT.
SELECT * FROM VRSTABC INTO TABLE VRS_TAB
WHERE TABMODE    = 'X'
AND MAXRELEASE >= SY-SAPRL. "#EC PORTABLE
SORT VRS_TAB.
SORT DD02L_TAB.
DELETE ADJACENT DUPLICATES FROM DD02L_TAB COMPARING TABNAME.

LOOP AT DD02L_TAB.
IF DD02L_TAB-CONTFLAG <> 'L' OR NOCLASSL = ' '.
IF DD02L_TAB-CONTFLAG <> 'A' OR NOCLASSA = ' '.

READ TABLE VRS_TAB WITH KEY TABNAME = DD02L_TAB-TABNAME
BINARY SEARCH.
IF SY-SUBRC <> 0.
CLEAR SIZETAB.
SIZETAB-TABNAME = DD02L_TAB-TABNAME.
PERFORM GET_TABLE_SIZE USING SIZETAB.
SELTAB-SQLTAB  = DD02L_TAB-SQLTAB.
SELTAB-TABNAME = SIZETAB-TABNAME.
SELTAB-NBRINS  = SIZETAB-ENTRIES.
SELTAB-TABLEN  = SIZETAB-WIDTH.
APPEND SELTAB.
COUNT = COUNT + 1.
IF COUNT = 100.
CLEAR COUNT.
COMMIT WORK.
ENDIF.
ENDIF.
ENDIF.
ENDIF.
ENDLOOP.

CALL FUNCTION 'SCCR_CHECK_TABLESPACE'
TABLES
SELTAB    = SELTAB
DB_SPACES = X_DBSPACE.

READ TABLE X_DBSPACE INDEX 1.
IF SY-TFILL > 0.
WRITE :/ 'Data base area analysis Stand:'(700).
WRITE : SY-DATUM, SY-UZEIT.
ULINE /1(60).
WRITE:/ 'TABLE :', TABLE_ORI.
WRITE:/ 'CLIENT:', CLIENT_ORI.
WRITE:/5 'No delivery class L (local tables)      :', NOCLASSL.
WRITE:/5 'No delivery class A (application tables):', NOCLASSA.
ULINE /1(60).

WRITE: /1 SY-VLINE,
2(30) 'Database Area           '(D01) COLOR COL_HEADING,
32 SY-VLINE,
33(13) 'Free (KB)    '(D02) COLOR COL_HEADING,
46 SY-VLINE,
47(13) 'Used (KB)'(D03) COLOR COL_HEADING,
60 SY-VLINE.
ULINE /1(60).
LOOP AT X_DBSPACE.
WRITE: /1 SY-VLINE,
2(30) X_DBSPACE-DBSPACE COLOR COL_NORMAL,
32 SY-VLINE,
33(13) X_DBSPACE-FREE_MEM COLOR COL_NORMAL,
46 SY-VLINE,
47(13) X_DBSPACE-NEW_MEM COLOR COL_NORMAL,
60 SY-VLINE.
ENDLOOP.
ULINE /1(60).
ENDIF.

*&---------------------------------------------------------------------*
*&      Form  GET_TABLE_SIZE
*&---------------------------------------------------------------------*
FORM GET_TABLE_SIZE USING P_SIZETAB STRUCTURE SIZETAB.

DATA: BEGIN  OF NTAB OCCURS 20.
INCLUDE STRUCTURE DNTAB.
DATA: END OF NTAB.
DATA: BEGIN  OF CTAB OCCURS 20,
LINE(72).
DATA: END OF CTAB.
DATA: TEXT(80).
DATA: GEL_TABLEN(6)  TYPE N.
DATA: X030L          LIKE X030L.
DATA: NT_SUBRC       LIKE SY-SUBRC.
DATA: SUBRC          LIKE SY-SUBRC.
DATA: ENTRIES        TYPE I.

CALL FUNCTION 'NAMETAB_GET'
EXPORTING
LANGU               = SY-LANGU
ONLY                = ' '
TABNAME             = P_SIZETAB-TABNAME
IMPORTING
HEADER              = X030L
RC                  = NT_SUBRC
TABLES
NAMETAB             = NTAB
EXCEPTIONS
INTERNAL_ERROR      = 1
TABLE_HAS_NO_FIELDS = 2
TABLE_NOT_ACTIV     = 3
NO_TEXTS_FOUND      = 4
OTHERS              = 5.
IF SY-SUBRC = 0.
IF X030L-TABFORM = 'P' OR X030L-TABFORM = 'C'.
CALL FUNCTION 'DB_EXISTS_TABLE'
EXPORTING
TABNAME = X030L-REFNAME
IMPORTING
SUBRC   = SUBRC.
ELSE.
CALL FUNCTION 'DB_EXISTS_TABLE'
EXPORTING
TABNAME = P_SIZETAB-TABNAME
IMPORTING
SUBRC   = SUBRC.
ENDIF.
IF SUBRC = 0.
GEL_TABLEN      = X030L-TABLEN.
P_SIZETAB-WIDTH = GEL_TABLEN.
READ TABLE NTAB INDEX 1.
LOOP AT T000_TAB.
REFRESH CTAB.
TEXT = '& = ''&'' '.
REPLACE '&' WITH NTAB-FIELDNAME INTO TEXT.
REPLACE '&' WITH T000_TAB-MANDT INTO TEXT.
CTAB-LINE = TEXT.
APPEND CTAB.
SELECT COUNT(*) INTO ENTRIES FROM (P_SIZETAB-TABNAME)
CLIENT SPECIFIED WHERE (CTAB).
P_SIZETAB-ENTRIES = P_SIZETAB-ENTRIES + ENTRIES.
ENDLOOP.
ENDIF.
ENDIF.
ENDFORM.                               " GET_TABLE_SIZE

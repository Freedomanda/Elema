REPORT YSTABSIZ.

TYPE-POOLS: KKBLO.                     "27th.Mar.2003
TABLES: T000, DD02L.
PARAMETER: CLIENT   LIKE T000-MANDT DEFAULT SY-MANDT,
TABLE    LIKE DD02L-TABNAME,
NOCLASSL DEFAULT 'X',
NOCLASSA.
DATA: BEGIN OF SIZETAB OCCURS 0,
TABNAME LIKE DD02L-TABNAME,
MANDT   LIKE CCCFLOW-MANDT,
ENTRIES LIKE JCTAB-COUNTER,
WIDTH   LIKE JCTAB-TABLEN,
SIZE    LIKE TSTRA01-FLTP,
END OF SIZETAB.
*<<<< Start of insertion
DATA: BEGIN OF SUMTAB OCCURS 0,
MANDT   LIKE CCCFLOW-MANDT,
SIZE    LIKE TSTRA01-FLTP,
END OF SUMTAB.
*<<<< End of insertion
DATA FIELDTAB     TYPE SLIS_T_FIELDCAT_ALV.
DATA DD02L_TAB    LIKE DD02L OCCURS 0 WITH HEADER LINE.
DATA T000_TAB     LIKE T000 OCCURS 0 WITH HEADER LINE.
DATA VRS_TAB      LIKE VRSTABC OCCURS 0 WITH HEADER LINE.
DATA REPNAME      LIKE SY-REPID.
DATA COUNT        TYPE I.
DATA TABLE_ORI    LIKE DD02L-TABNAME.

TABLE_ORI  = TABLE.

REPNAME = SY-REPID.
AUTHORITY-CHECK OBJECT 'S_TABU_CLI'
ID 'CLIIDMAINT' FIELD 'X'.
IF SY-SUBRC <> 0.
WRITE: 'You are not permitted to use this program'(001).
STOP.
ENDIF.

REPLACE '*' WITH '%' INTO CLIENT.
REPLACE '*' WITH '%' INTO TABLE.
SELECT * FROM DD02L INTO TABLE DD02L_TAB WHERE TABNAME LIKE TABLE
AND   AS4LOCAL = 'A'
AND   CLIDEP   = 'X'
AND ( TABCLASS EQ 'TRANSP'
OR    TABCLASS EQ 'POOL'
OR    TABCLASS EQ 'CLUSTER' ).

SELECT * FROM T000 INTO TABLE T000_TAB
WHERE MANDT LIKE CLIENT.
SELECT * FROM VRSTABC INTO TABLE VRS_TAB
WHERE TABMODE    = 'X'
AND MAXRELEASE >= SY-SAPRL. "#EC PORTABLE
SORT VRS_TAB.
SORT DD02L_TAB.
DELETE ADJACENT DUPLICATES FROM DD02L_TAB COMPARING TABNAME.

LOOP AT DD02L_TAB.
IF DD02L_TAB-CONTFLAG <> 'L' OR NOCLASSL = ' '.
IF DD02L_TAB-CONTFLAG <> 'A' OR NOCLASSA = ' '.
READ TABLE VRS_TAB WITH KEY TABNAME = DD02L_TAB-TABNAME
BINARY SEARCH.
IF SY-SUBRC <> 0.
LOOP AT T000_TAB.
CLEAR SIZETAB.
SIZETAB-TABNAME = DD02L_TAB-TABNAME.
SIZETAB-MANDT   = T000_TAB-MANDT.
PERFORM GET_TABLE_SIZE USING SIZETAB-TABNAME
SIZETAB-MANDT
SIZETAB-WIDTH
SIZETAB-ENTRIES
SIZETAB-SIZE.
APPEND SIZETAB.
COUNT = COUNT + 1.
IF COUNT = 200.
CLEAR COUNT.
COMMIT WORK.
ENDIF.
ENDLOOP.
ENDIF.
ENDIF.
ENDIF.
ENDLOOP.
SORT SIZETAB BY TABNAME ASCENDING MANDT ASCENDING.
CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
EXPORTING
I_PROGRAM_NAME         = REPNAME
I_INTERNAL_TABNAME     = 'SIZETAB'
I_INCLNAME             = REPNAME
CHANGING
CT_FIELDCAT            = FIELDTAB
EXCEPTIONS
INCONSISTENT_INTERFACE = 1
PROGRAM_ERROR          = 2
OTHERS                 = 3.
IF SY-SUBRC <> 0.
WRITE: 'SY-SUBRC: ', SY-SUBRC, 'REUSE_ALV_FIELDCATALOG_MERGE'.
ENDIF.
CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
EXPORTING
IT_FIELDCAT   = FIELDTAB
I_DEFAULT     = 'A'
TABLES
T_OUTTAB      = SIZETAB
EXCEPTIONS
PROGRAM_ERROR = 1
OTHERS        = 2.
IF SY-SUBRC <> 0.
WRITE: 'SY-SUBRC: ', SY-SUBRC, 'REUSE_ALV_LIST_DISPLAY'.
ENDIF.
*<<<< Start of insertion
WRITE: 'TABLE:', TABLE_ORI.
WRITE:/5 'No delivery class L (local tables)      :', NOCLASSL.
WRITE:/5 'No delivery class A (application tables):', NOCLASSA.

LOOP AT SIZETAB.
MOVE SIZETAB-MANDT TO SUMTAB-MANDT.
MOVE SIZETAB-SIZE  TO SUMTAB-SIZE.
COLLECT SUMTAB.
ENDLOOP.
SORT SUMTAB BY SIZE DESCENDING.
ULINE.
LOOP AT SUMTAB.
WRITE: / 'Client', SUMTAB-MANDT, AT 53 SUMTAB-SIZE, 'Byte'.
ENDLOOP.
*<<<< End of insertion

*&---------------------------------------------------------------------*
*&      Form  GET_TABLE_SIZE
*&---------------------------------------------------------------------*
FORM GET_TABLE_SIZE USING    TABNAME   LIKE DD02L-TABNAME
MANDT     LIKE CCCFLOW-MANDT
WIDTH     LIKE JCTAB-TABLEN
ENTRIES   LIKE JCTAB-COUNTER
SIZE      LIKE TSTRA01-FLTP.
DATA: BEGIN  OF NTAB OCCURS 20.
INCLUDE STRUCTURE DNTAB.
DATA: END OF NTAB.
DATA: BEGIN  OF CTAB OCCURS 20,
LINE(72).
DATA: END OF CTAB.
DATA: TEXT(80).
DATA: GEL_TABLEN(6) TYPE N.
DATA: X030L         LIKE X030L.
DATA: NT_SUBRC      LIKE SY-SUBRC.
DATA: SUBRC         LIKE SY-SUBRC.

CALL FUNCTION 'NAMETAB_GET'
EXPORTING
LANGU               = SY-LANGU
ONLY                = ' '
TABNAME             = TABNAME
IMPORTING
HEADER              = X030L
RC                  = NT_SUBRC
TABLES
NAMETAB             = NTAB
EXCEPTIONS
INTERNAL_ERROR      = 1
TABLE_HAS_NO_FIELDS = 2
TABLE_NOT_ACTIV     = 3
NO_TEXTS_FOUND      = 4
OTHERS              = 5.
IF SY-SUBRC = 0.
IF X030L-TABFORM = 'P' OR X030L-TABFORM = 'C'.
CALL FUNCTION 'DB_EXISTS_TABLE'
EXPORTING
TABNAME = X030L-REFNAME
IMPORTING
SUBRC   = SUBRC.
ELSE.
CALL FUNCTION 'DB_EXISTS_TABLE'
EXPORTING
TABNAME = TABNAME
IMPORTING
SUBRC   = SUBRC.
ENDIF.
IF SUBRC = 0.
GEL_TABLEN = X030L-TABLEN.
WIDTH      = GEL_TABLEN.
READ TABLE NTAB INDEX 1.
TEXT = '& = ''&'' '.
REPLACE '&' WITH NTAB-FIELDNAME INTO TEXT.
REPLACE '&' WITH MANDT INTO TEXT.
CTAB-LINE = TEXT.
APPEND CTAB.
SELECT COUNT(*) INTO ENTRIES FROM (TABNAME)
CLIENT SPECIFIED WHERE (CTAB).
SIZE = ENTRIES * WIDTH.
COMMIT WORK.
ENDIF.
ENDIF.
ENDFORM.                               " GET_TABLE_SIZE


REPORT ZZMIKAMI_014 .

TABLES: BSIK, BSAK.

SELECT-OPTIONS: S_ZFBDT FOR BSIK-ZFBDT.
SELECT-OPTIONS: S_LIFNR FOR BSIK-LIFNR.
SELECT-OPTIONS: S_HKONT FOR BSIK-HKONT.


TYPES:BEGIN OF TYP_YK410,
LIFNR    TYPE YK410-LIFNR,      "仕入先
ZFBDT    TYPE YK410-ZFBDT,      "〆日
GJAHR    TYPE YK410-GJAHR,      "年度
BELNR    TYPE YK410-BELNR,      "伝票No.
FIFLG    TYPE YK410-FIFLG,      "会計連絡
END   OF TYP_YK410.

DATA: GT_YK410  TYPE TABLE OF TYP_YK410.
DATA: GT_CHECK  TYPE TABLE OF TYP_YK410.

DATA: GW_YK410  TYPE TYP_YK410.
DATA: GW_CHECK  TYPE TYP_YK410.
DATA: GW_PREV   TYPE TYP_YK410.


SELECT LIFNR      "仕入先
ZFBDT      "〆日
GJAHR      "年度
BELNR      "伝票No.
FIFLG      "会計連絡
FROM YK410 INTO TABLE GT_YK410
WHERE BUKRS =  'C001'
AND LIFNR IN S_LIFNR
AND ZFBDT IN S_ZFBDT
AND FIFLG =  'X'.

SELECT LIFNR      "仕入先
ZFBDT      "〆日
GJAHR      "年度
BELNR      "伝票No.
FIFLG      "会計連絡
FROM YK410 INTO TABLE GT_CHECK.

SORT GT_YK410 BY GJAHR BELNR.
SORT GT_CHECK BY GJAHR BELNR ZFBDT.

* 前提チェック(複数〆日に跨る伝票No.が存在しないこと)
LOOP AT GT_CHECK INTO GW_CHECK.
IF  NOT GW_CHECK-GJAHR IS INITIAL
AND NOT GW_CHECK-BELNR IS INITIAL.
IF  GW_CHECK-GJAHR = GW_PREV-GJAHR
AND GW_CHECK-BELNR = GW_PREV-BELNR
AND GW_CHECK-ZFBDT <> GW_PREV-ZFBDT.
WRITE: / GW_CHECK.
ENDIF.
ENDIF.
GW_PREV = GW_CHECK.
ENDLOOP.

WRITE: / '完了'.


*LOOP AT GT_YK410 INTO GW_YK410.
*
*  IF GW_YK410-GJAHR IS INITIAL
*  OR GW_YK410-BELNR IS INITIAL.
*    CONTINUE.
*  ENDIF.
*
*  LOOP AT GT_CHECK INTO GW_CHECK
*                  WHERE ZFBDT <> GW_YK410-ZFBDT
*                    AND GJAHR  = GW_YK410-GJAHR
*                    AND BELNR  = GW_YK410-BELNR.
*    WRITE: / GW_CHECK.
*  ENDLOOP.
*ENDLOOP.
*
*write: / '処理終了'.

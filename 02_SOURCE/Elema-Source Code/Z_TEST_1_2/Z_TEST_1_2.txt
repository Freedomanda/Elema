REPORT Z_TEST_1_2 .

TYPES:
BEGIN OF TYP_ZNEN002,
MATNR      TYPE ZNEN002-MATNR,
WERKS      TYPE ZNEN002-WERKS,
ZZNO       TYPE ZNEN002-ZZNO,
MENGE      TYPE ZNEN002-MENGE,
MEINS      TYPE MARA-MEINS,
MENGE_SG   TYPE MSEG-MENGE,
MEINS_SG   TYPE MSEG-MEINS,
ERFMG_SG   TYPE MSEG-ERFMG,
ERFME_SG   TYPE MSEG-ERFME,
END   OF TYP_ZNEN002.

TYPES:
BEGIN OF TYP_MSEG,
EBELN      TYPE MSEG-EBELN,
MENGE      TYPE MSEG-MENGE,
MEINS      TYPE MSEG-MEINS,
ERFMG      TYPE MSEG-ERFMG,
ERFME      TYPE MSEG-ERFME,
END   OF TYP_MSEG.

DATA:
TD_ZNEN002    TYPE STANDARD TABLE OF TYP_ZNEN002,
TH_ZNEN002    LIKE          LINE  OF TD_ZNEN002.

DATA:
TD_MSEG       TYPE STANDARD TABLE OF TYP_MSEG,
TH_MSEG       LIKE          LINE  OF TD_MSEG.

DATA:
CTR_MSEG       TYPE I,
CTR_ZNEN002    TYPE I.

CONSTANTS:
CNS_PONO(5)    TYPE N  VALUE '00010'.


START-OF-SELECTION.

* 在庫情報(入庫)を抽出
SELECT ZNEN002~MATNR
ZNEN002~WERKS
ZNEN002~ZZNO
ZNEN002~MENGE
MARA~MEINS
INTO CORRESPONDING FIELDS OF TABLE TD_ZNEN002
FROM ZNEN002
INNER JOIN MARA
ON ZNEN002~MATNR = MARA~MATNR
WHERE ZNEN002~ZZNO <> SPACE
AND ZNEN002~ZZPOS = CNS_PONO
.
* 紐づく入庫情報を抽出
SELECT EBELN
MENGE
MEINS
ERFMG
ERFME
FROM MSEG
INTO CORRESPONDING FIELDS OF TABLE TD_MSEG
FOR ALL ENTRIES IN TD_ZNEN002
WHERE MATNR = TD_ZNEN002-MATNR
AND WERKS = TD_ZNEN002-WERKS
AND EBELN = TD_ZNEN002-ZZNO
AND SHKZG = 'S'
.
* 在庫情報に入庫時の数量単位を付加
LOOP AT TD_ZNEN002 INTO TH_ZNEN002.
READ TABLE TD_MSEG INTO TH_MSEG
WITH KEY EBELN = TH_ZNEN002-ZZNO.

TH_ZNEN002-MENGE_SG = TH_MSEG-MENGE.
TH_ZNEN002-MEINS_SG = TH_MSEG-MEINS.
TH_ZNEN002-ERFMG_SG = TH_MSEG-ERFMG.
TH_ZNEN002-ERFME_SG = TH_MSEG-ERFME.

MODIFY TD_ZNEN002 FROM TH_ZNEN002.
ENDLOOP.

* 一覧出力
SORT TD_ZNEN002 BY MATNR.
LOOP AT TD_ZNEN002 INTO TH_ZNEN002.
IF TH_ZNEN002-MEINS    = TH_ZNEN002-MEINS_SG AND
TH_ZNEN002-MEINS_SG = TH_ZNEN002-ERFME_SG.
CONTINUE.
ENDIF.
WRITE:/ TH_ZNEN002-MATNR,
TH_ZNEN002-WERKS,
TH_ZNEN002-ZZNO,
TH_ZNEN002-MENGE,
TH_ZNEN002-MEINS,
TH_ZNEN002-ERFMG_SG,
TH_ZNEN002-ERFME_SG.
ENDLOOP.

TOP-OF-PAGE.
* ヘッダ出力
WRITE: /0(10) '品目コード',
16(8) 'プラント',
25(6) '発注NO',
46(4) '数量',
55(4) '単位',
68(6) '入数量',
76(6) '入単位'.

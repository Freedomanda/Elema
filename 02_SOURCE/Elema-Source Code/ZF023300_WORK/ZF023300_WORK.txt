*&---------------------------------------------------------------------*
*&  REPORT ZF023300                                                    *
*&         取引先情報（閾値マスタ）                                    *
*&---------------------------------------------------------------------*
*&  機能       規定外マスタ(閾値マスタ)照会機能
*&  作成日   : 2012/03/29
*&  作成者   : C.MARUTA(solfis)
*&---------------------------------------------------------------------*
*&  変更履歴 :
*&  変更内容 :
*&---------------------------------------------------------------------*
REPORT ZF023300  MESSAGE-ID Y1
NO STANDARD PAGE HEADING.
*&---------------------------------------------------------------------*
*&   テーブル定義　
*&---------------------------------------------------------------------*
TABLES :
KNA1,   "得意先
LFA1.   "仕入先

*&---------------------------------------------------------------------*
*& 構造定義                                                            *
*&---------------------------------------------------------------------*
TYPE-POOLS SLIS.
TYPES:
* 画面出力
BEGIN OF T_S_OUT,
CLIENT(10)    TYPE C,           "取引先コード
TNAME         TYPE INTAD,       "取引先名称
KUBUN(6)      TYPE C,           "区分
CORD(10)      TYPE C,           "得意先/仕入先コード
NAME1         TYPE NAME1_GP,    "名称
WAERS         TYPE WAERS,       "通貨コード
LOWAMT        TYPE ZNELOWAMT,   "閾値下限
BASE_ZT       TYPE ZNEBASE_ZT,  "基本取引条件
ZLSCH_Z       TYPE ZNEZLSCH_Z,  "残額-方法
ZNAME_Z       TYPE TEXT1_042Z,  "残額-方法テキスト
ZTERM_PZ      TYPE ZNEZTERM_PZ, "残額-条件（支払日）
ZNAME_PZ      TYPE TEXT1_052,   "残額-条件（支払日）TEXT
ZTERM_SZ      TYPE ZNEZTERM_SZ, "残額-条件（サイト）
ZNAME_SZ      TYPE TEXT1_052,   "残額-条件（サイト）TEXT
PER1          TYPE ZNEPER1,     "1-分割（％）
PAY1          TYPE ZNEPAY1,     "1-分割（金額）
ZLSCH_1       TYPE ZNEZLSCH_1,                          "1-方法
ZNAME_1       TYPE TEXT1_042Z,  "1-方法テキスト
ZTERM_P1      TYPE ZNEZTERM_P1, "1-条件（支払日）
ZNAME_P1      TYPE TEXT1_052,   "1-条件（支払日）TEXT
ZTERM_S1      TYPE ZNEZTERM_S1, "1-条件（サイト）
ZNAME_S1      TYPE TEXT1_052,   "1-条件（サイト）TEXT
PER2          TYPE ZNEPER2,     "2-分割（％）
PAY2          TYPE ZNEPAY2,     "2-分割（金額）
ZLSCH_2       TYPE ZNEZLSCH_2,                          "2-方法
ZNAME_2       TYPE TEXT1_042Z,  "2-方法テキスト
ZTERM_P2      TYPE ZNEZTERM_P2, "2-条件（支払日）
ZNAME_P2      TYPE TEXT1_052,   "2-条件（支払日）TEXT
ZTERM_S2      TYPE ZNEZTERM_S2, "2-条件（サイト）
ZNAME_S2      TYPE TEXT1_052,   "2-条件（サイト）TEXT
PER3          TYPE ZNEPER3,     "3-分割（％）
PAY3          TYPE ZNEPAY3,     "3-分割（金額）
ZLSCH_3       TYPE ZNEZLSCH_3,                          "3-方法
ZNAME_3       TYPE TEXT1_042Z,  "3-方法テキスト
ZTERM_P3      TYPE ZNEZTERM_P3, "3-条件（支払日）
ZNAME_P3      TYPE TEXT1_052,   "3-条件（支払日）TEXT
ZTERM_S3      TYPE ZNEZTERM_S3, "3-条件（サイト）
ZNAME_S3      TYPE TEXT1_052,   "3-条件（サイト）TEXT
PER4          TYPE ZNEPER4,     "4-分割（％）
PAY4          TYPE ZNEPAY4,     "4-分割（金額）
ZLSCH_4       TYPE ZNEZLSCH_4,                          "4-方法
ZNAME_4       TYPE TEXT1_042Z,  "4-方法テキスト
ZTERM_P4      TYPE ZNEZTERM_P4, "4-条件（支払日）
ZNAME_P4      TYPE TEXT1_052,   "4-条件（支払日）TEXT
ZTERM_S4      TYPE ZNEZTERM_S4, "4-条件（サイト）
ZNAME_S4      TYPE TEXT1_052,   "4-条件（サイト）TEXT
ZNTCH         TYPE ZNENTCH,     "手形通信費
MEMO          TYPE ZNEMEMO,     "備考
SEQ           TYPE ZNESEQ,      "SEQ
BASE(8)       TYPE C,           "基本取引条件
C_LOEVM       TYPE LOEVM_X,     "削除フラグ(共通)
B_LOEVM       TYPE LOEVM_X,     "削除フラグ(会社)
M_LOEVM       TYPE LOEVM_X,     "削除フラグ(組織)
C_SPERR       TYPE SPERB_X,     "転記ブロック(共通)
B_SPERR       TYPE SPERB_X,     "転記ブロック(会社)
M_SPERR       TYPE SPERB_X,     "転記ブロック(組織)
C_SPERM       TYPE SPERM_X,     "購買ブロック(共通)
B_SPERM       TYPE SPERM_X,     "購買ブロック(会社)
M_SPERM       TYPE SPERM_X,     "購買ブロック(組織)
* 非出力項目
SORT          TYPE I,           "SORT順
END   OF T_S_OUT,
T_I_OUT         TYPE TABLE OF T_S_OUT,    "内部テーブル定義

*仕入先マスタ
BEGIN OF T_S_LFM1,
LIFNR         TYPE LIFNR,         "仕入先コード
WAERS         TYPE BSTWA,         "購買発注通貨
LOEVM         TYPE LOEVM_X,       "削除フラグ
SPERM         TYPE SPERM_X,       "購買ブロック
END   OF T_S_LFM1,
T_I_LFM1        TYPE TABLE OF T_S_LFM1,   "内部テーブル定義

* 得意先(販売組織)
BEGIN OF T_S_KNVV,
KUNNR         TYPE KUNNR,         "得意先コード
WAERS         TYPE WAERS_V02D,    "通貨コード
END   OF T_S_KNVV,
T_I_KNVV        TYPE TABLE OF T_S_KNVV,  "内部テーブル定義

* 仕入先(一般)取得用
BEGIN OF T_S_LFA1,
LIFNR         TYPE LIFNR,         "仕入先コード
NAME1         TYPE NAME1_GP,      "名称１
*
LOEVM         TYPE LOEVM_X,       "削除フラグ
SPERR         TYPE SPERB_X,       "転記ブロック
SPERM         TYPE SPERM_X,       "購買ブロック
*
END   OF T_S_LFA1,
T_I_LFA1        TYPE TABLE OF T_S_LFA1,   "内部テーブル定義

* 得意先(一般)取得用
BEGIN OF T_S_KNA1,
KUNNR         TYPE KUNNR,         "得意先コード
NAME1         TYPE NAME1_GP,      "名称1
*
LOEVM         TYPE LOEVM_X,       "削除フラグ
SPERR         TYPE SPERB_X,       "転記ブロック
SPERM         TYPE SPERM_X,       "購買ブロック
*
END   OF T_S_KNA1,
T_I_KNA1        TYPE TABLE OF T_S_KNA1,   "内部テーブル定義

* 仕入先(会社)取得用
BEGIN OF T_S_LFB1,
LIFNR         TYPE LIFNR,         "仕入先コード
INTAD         TYPE INTAD,         "関係会社担当者のｲﾝﾀｰﾈｯﾄｱﾄﾞﾚｽ
END   OF T_S_LFB1,
T_I_LFB1        TYPE TABLE OF T_S_LFB1,   "内部テーブル定義

* 仕入先(取引先機能)取得用
BEGIN OF T_S_WYT3,
LIFNR         TYPE LIFNR,         "仕入先コード
PARVW         TYPE PARVW,         "取引先機能
LIFN2         TYPE LIFN2,         "取引先コード
END   OF T_S_WYT3,
T_I_WYT3        TYPE TABLE OF T_S_WYT3,   "内部テーブル定義

* 得意先(取引先機能)取得用
BEGIN OF T_S_KNVP,
KUNNR         TYPE KUNNR,         "得意先コード
PARVW         TYPE PARVW,         "取引先機能
KUNN2         TYPE KUNN2,         "参照得意先コード
LIFNR         TYPE LIFNR,         "仕入先コード
END   OF T_S_KNVP,
T_I_KNVP        TYPE TABLE OF T_S_KNVP,   "内部テーブル定義

* 取引先コード格納用(退避用)
BEGIN OF T_S_CUST,
CORD(10)      TYPE C,             "取引先に紐づく仕入先/得意先
LIFNR         TYPE LIFNR,         "取引先コード
END   OF T_S_CUST,
T_I_CUST        TYPE TABLE OF T_S_CUST,   "内部テーブル定義

* 仕入先検索用
BEGIN OF T_S_LIFNR,
LIFNR         TYPE LIFNR,         "仕入先コード
END OF T_S_LIFNR,
T_I_LIFNR       TYPE TABLE OF T_S_LIFNR,  "内部テーブル定義

* 得意先検索用
BEGIN OF T_S_KUNNR,
KUNNR         TYPE KUNNR,         "得意先コード
END OF T_S_KUNNR,
T_I_KUNNR       TYPE TABLE OF T_S_KUNNR,  "内部テーブル定義

* 規定外マスタテーブル(仕入)
T_S_ZN007      TYPE ZN007,
T_I_ZN007      TYPE TABLE OF T_S_ZN007,  "内部テーブル定義

* 規定外マスタテーブル(売上)
T_S_ZN008      TYPE ZN008,
T_I_ZN008      TYPE TABLE OF T_S_ZN008,  "内部テーブル定義

* 支払方法テキスト
BEGIN OF T_S_T042Z,
ZLSCH         TYPE DZLSCH,        "支払方法
TEXT1         TYPE TEXT1_042Z,    "テキスト
END   OF T_S_T042Z,
T_I_T042Z       TYPE TABLE OF T_S_T042Z,  "内部テーブル定義

* 支払条件テキスト
BEGIN OF T_S_T052U,
ZTERM         TYPE DZTERM,        "支払条件
TEXT1         TYPE TEXT1_052,     "テキスト
END   OF T_S_T052U,
T_I_T052U       TYPE TABLE OF T_S_T052U,   "内部テーブル定義

* 支払方法検索用
BEGIN OF T_S_ZLSCH,
ZLSCH         TYPE DZLSCH,        "支払方法
END   OF T_S_ZLSCH,
T_I_ZLSCH       TYPE TABLE OF T_S_ZLSCH,  "内部テーブル定義

* 支払条件検索用
BEGIN OF T_S_ZTERM,
ZTERM         TYPE DZTERM,        "支払条件
END   OF T_S_ZTERM,
T_I_ZTERM       TYPE TABLE OF T_S_ZTERM,   "内部テーブル定義

* 仕入(取引先機能)一時取得用
BEGIN OF T_S_WYT3_WK,
LIFNR         TYPE LIFNR,         "仕入先コード
LIFN2         TYPE LIFN2,         "取引先コード
END   OF T_S_WYT3_WK,
T_I_WYT3_WK     TYPE TABLE OF T_S_WYT3_WK,   "内部テーブル定義

* 得意先(取引先機能)一時取得用
BEGIN OF T_S_KNVP_WK,
KUNNR         TYPE KUNNR,         "得意先コード
LIFNR         TYPE LIFNR,         "仕入先コード
END   OF T_S_KNVP_WK,
T_I_KNVP_WK     TYPE TABLE OF T_S_KNVP_WK.   "内部テーブル定義

*&---------------------------------------------------------------------*
*& 内部テーブル定義                                                    *
*&---------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*& データ定義：グローバルデータ型
*&---------------------------------------------------------------------*



*----------------------------------------------------------------------*
* CONSTANTS定義
*----------------------------------------------------------------------*
CONSTANTS:
* 取引先機能
BEGIN OF CNS_PARVW,
CLIENT        TYPE PARVW VALUE 'Z3',    "取引先
AGGREG        TYPE PARVW VALUE 'RS',    "名寄先
OFFSET        TYPE PARVW VALUE 'Z2',    "相殺対象
DEPOSI        TYPE PARVW VALUE 'Y3',    "入金先
END   OF CNS_PARVW,

* 処理フラグ
BEGIN OF CNS_FLG,
ON(1)         TYPE C     VALUE 'X',     "フラグON
OFF(1)        TYPE C     VALUE ' ',     "フラグOFF
END   OF CNS_FLG,

CNS_EKORG_1     TYPE EKORG VALUE '1000',  "購買組織
CNS_VKORG_1     TYPE VKORG VALUE '1000',  "販売組織
CNS_VTWEG_1     TYPE VTWEG VALUE '10',    "流通チャネル
CNS_SPART_1     TYPE SPART VALUE '10',    "製品部門
CNS_BUKRS_1     TYPE BUKRS VALUE 'C001',  "会社コード
CNS_LAND_JP     TYPE LAND1 VALUE 'JP'.    "国コード

*&---------------------------------------------------------------------*
*& 選択画面定義                                                        *
*&---------------------------------------------------------------------*

* 仕入先
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_VEND RADIOBUTTON GROUP RAD1 DEFAULT 'X'.
SELECTION-SCREEN COMMENT (28) TEXT-002  FOR FIELD P_VEND.
SELECTION-SCREEN END   OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
SELECT-OPTIONS S_LIFNR FOR LFA1-LIFNR.
SELECTION-SCREEN END   OF LINE.

SELECTION-SCREEN SKIP.

* 得意先
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_CUST RADIOBUTTON GROUP RAD1.
SELECTION-SCREEN COMMENT (15) TEXT-001 FOR FIELD P_CUST.
SELECTION-SCREEN END   OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
SELECT-OPTIONS S_KUNNR FOR KNA1-KUNNR.
SELECTION-SCREEN END   OF LINE.
SELECTION-SCREEN SKIP.


SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_TORI AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT (26) TEXT-003  FOR FIELD P_TORI.
SELECTION-SCREEN END   OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_NYU  AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT (26) TEXT-004  FOR FIELD P_NYU.
SELECTION-SCREEN END   OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_NAYO AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT (26) TEXT-005  FOR FIELD P_NAYO.
SELECTION-SCREEN END   OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 10.
PARAMETERS P_SOU  AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT (28) TEXT-006  FOR FIELD P_SOU.
SELECTION-SCREEN END   OF LINE.

*&---------------------------------------------------------------------*
*& AT SELECTION-SCREEN                                                 *
*&---------------------------------------------------------------------*
AT SELECTION-SCREEN.

* 入力チェック
PERFORM CHECK_INPUT.

*&---------------------------------------------------------------------*
*& START-OF-SELECTION                                                  *
*&---------------------------------------------------------------------*
START-OF-SELECTION.

PERFORM MAIN.

*&---------------------------------------------------------------------*
*&      Form  CHECK_INPUT
*&---------------------------------------------------------------------*
*       text  入力チェック
*----------------------------------------------------------------------*
FORM CHECK_INPUT .

* 条件必須チェック
PERFORM OBLIGATORY_CHECK.

ENDFORM.                    " CHECK_INPUT
*&---------------------------------------------------------------------*
*&      Form  MAIN
*&---------------------------------------------------------------------*
*       text   主処理
*----------------------------------------------------------------------*
FORM MAIN.

DATA:
LIT_OUTPUT   TYPE T_I_OUT,      "内部TBL:ALV出力用
LIT_ZN007    TYPE T_I_ZN007,    "内部TBL:規定外MST(仕入)
LIT_ZN008    TYPE T_I_ZN008,    "内部TBL:規定外MST(売上)
LIT_LFM1     TYPE T_I_LFM1,     "内部TBL:仕入先(購買)取得用
LIT_KNVV     TYPE T_I_KNVV,     "内部TBL:得意先(販売)取得用
LIT_LFA1     TYPE T_I_LFA1,     "内部TBL:仕入先(一般)取得用
LIT_KNA1     TYPE T_I_KNA1,     "内部TBL:得意先(一般)取得用
LIT_LFB1     TYPE T_I_LFB1,     "内部TBL:仕入先(会社)取得用
LIT_CUST     TYPE T_I_CUST,     "内部TBL:取引先情報退避用
LIT_T052U    TYPE T_I_T052U,    "内部TBL:支払条件テキスト
LIT_T042Z    TYPE T_I_T042Z.    "内部TBL:支払方法テキスト

*- 取得処理
PERFORM GET_DATA
CHANGING LIT_ZN007    "内部TBL:規定外MST(仕入)
LIT_ZN008    "内部TBL:規定外MST(売上)
LIT_LFM1     "内部TBL:仕入先(購買)取得用
LIT_KNVV     "内部TBL:得意先(販売)取得用
LIT_LFA1     "内部TBL:仕入先(一般)取得用
LIT_KNA1     "内部TBL:得意先(一般)取得用
LIT_LFB1     "内部TBL:仕入先(会社)取得用
LIT_CUST     "内部TBL:取引先情報退避用
LIT_T052U    "内部TBL:支払条件テキスト
LIT_T042Z.   "内部TBL:支払方法テキスト

*- 編集処理
PERFORM EDIT_DATA
USING LIT_ZN007    "内部TBL:規定外MST(仕入)
LIT_ZN008    "内部TBL:規定外MST(売上)
LIT_LFA1     "内部TBL:仕入先(一般)取得用
LIT_KNA1     "内部TBL:得意先(一般)取得用
LIT_LFB1     "内部TBL:仕入先(会社)取得用
LIT_CUST     "内部TBL:取引先情報退避用
LIT_T052U    "内部TBL:支払条件テキスト
LIT_T042Z    "内部TBL:支払方法テキスト
CHANGING LIT_OUTPUT.  "内部TBL:ALV一覧

*- 出力処理
PERFORM OUTPUT_DATA
USING LIT_OUTPUT.    "内部TBL:ALV一覧

ENDFORM.                    " MAIN
*&---------------------------------------------------------------------*
*&      Form  OUTPUT_DATA
*&---------------------------------------------------------------------*
*       text ALV出力
*----------------------------------------------------------------------*
FORM OUTPUT_DATA USING PIT_OUTPUT  TYPE T_I_OUT.

* ローカル定義
DATA:
LW_LAYOUT      TYPE SLIS_LAYOUT_ALV,     "ALV出力レイアウト
LIT_FIELDCAT   TYPE SLIS_T_FIELDCAT_ALV, "ALV出力項目設定
LIT_EVENT      TYPE SLIS_T_EVENT,        "イベント
LW_REPID       TYPE SY-REPID,            "ALV出力用：プログラムID
LW_PRINT       TYPE SLIS_PRINT_ALV.

* フィールドカタログ
PERFORM SET_FLELDCAT
CHANGING LIT_FIELDCAT.

* その他編集
PERFORM ALV_LAYOUT
CHANGING LW_LAYOUT
LW_REPID
LIT_EVENT
LW_PRINT.
* ALV一覧出力
PERFORM ALV_CALL
USING PIT_OUTPUT
LIT_FIELDCAT
LW_LAYOUT
LW_REPID
LIT_EVENT
LW_PRINT.

ENDFORM.                    " OUTPUT_DATA
*&---------------------------------------------------------------------*
*&      Form  SET_FLELDCAT
*&---------------------------------------------------------------------*
*       text  フィールドカタログの設定
*----------------------------------------------------------------------*
FORM SET_FLELDCAT CHANGING PIT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV.

DATA:
LW_COL      TYPE I.               "カラム位置

PERFORM SET_VALUE:
* 備考
USING 'MEMO'           "項目ID
TEXT-F46         "項目テキスト(短)
TEXT-F46         "項目テキスト(中)
TEXT-F46         "項目テキスト(長)
10               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
40               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 基本取引条件
USING 'BASE'           "項目ID
TEXT-F47         "項目テキスト(短)
TEXT-F47         "項目テキスト(中)
TEXT-F47         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 取引先
USING 'CLIENT'         "項目ID
TEXT-F01         "項目テキスト(短)
TEXT-F01         "項目テキスト(中)
TEXT-F01         "項目テキスト(長)
10               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
10               "数値データ長
SPACE            "通貨参照項目
CNS_FLG-ON       "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 取引先名称
USING 'TNAME'          "項目ID
TEXT-F02         "項目テキスト(短)
TEXT-F02         "項目テキスト(中)
TEXT-F02         "項目テキスト(長)
130              "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
130              "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 区分
USING 'KUBUN'          "項目ID
TEXT-F03         "項目テキスト(短)
TEXT-F03         "項目テキスト(中)
TEXT-F03         "項目テキスト(長)
6                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
6                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 得意先/仕入先コード
USING 'CORD'           "項目ID
TEXT-F04         "項目テキスト(短)
TEXT-F04         "項目テキスト(中)
TEXT-F04         "項目テキスト(長)
10               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
10               "数値データ長
SPACE            "通貨参照項目
CNS_FLG-ON       "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 名称
USING 'NAME1'          "項目ID
TEXT-F05         "項目テキスト(短)
TEXT-F05         "項目テキスト(中)
TEXT-F05         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 通貨
USING 'WAERS'          "項目ID
TEXT-F06         "項目テキスト(短)
TEXT-F06         "項目テキスト(中)
TEXT-F06         "項目テキスト(長)
5                "出力データ長
'CUKY'           "データ型
SPACE            "数値データ型
5                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 閾値
USING 'LOWAMT'          "項目ID
TEXT-F07         "項目テキスト(短)
TEXT-F07         "項目テキスト(中)
TEXT-F07         "項目テキスト(長)
16               "出力データ長
'CURR'           "データ型
'P'              "数値データ型
13               "数値データ長
'WAERS'          "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 残額-方法
USING 'ZLSCH_Z'        "項目ID
TEXT-F08         "項目テキスト(短)
TEXT-F08         "項目テキスト(中)
TEXT-F08         "項目テキスト(長)
1                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
1                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 残額-方法テキスト
USING 'ZNAME_Z'        "項目ID
TEXT-F09         "項目テキスト(短)
TEXT-F09         "項目テキスト(中)
TEXT-F09         "項目テキスト(長)
30               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
30               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 残額-条件（支払日）
USING 'ZTERM_PZ'       "項目ID
TEXT-F10         "項目テキスト(短)
TEXT-F10         "項目テキスト(中)
TEXT-F10         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 残額-条件（支払日）TEXT
USING 'ZNAME_PZ'       "項目ID
TEXT-F11         "項目テキスト(短)
TEXT-F11         "項目テキスト(中)
TEXT-F11         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 残額-条件（サイト）
USING 'ZTERM_SZ'       "項目ID
TEXT-F12         "項目テキスト(短)
TEXT-F12         "項目テキスト(中)
TEXT-F12         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 残額-条件（サイト）TEXT
USING 'ZNAME_SZ'       "項目ID
TEXT-F13         "項目テキスト(短)
TEXT-F13         "項目テキスト(中)
TEXT-F13         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-分割（金額）
USING 'PAY1'           "項目ID
TEXT-F14         "項目テキスト(短)
TEXT-F14         "項目テキスト(中)
TEXT-F14         "項目テキスト(長)
16               "出力データ長
'CURR'           "データ型
'P'              "数値データ型
13               "数値データ長
'WAERS'          "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-分割（％）
USING 'PER1'           "項目ID
TEXT-F15         "項目テキスト(短)
TEXT-F15         "項目テキスト(中)
TEXT-F15         "項目テキスト(長)
5                "出力データ長
'DEC'            "データ型
SPACE            "数値データ型
5                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-方法
USING 'ZLSCH_1'        "項目ID
TEXT-F16         "項目テキスト(短)
TEXT-F16         "項目テキスト(中)
TEXT-F16         "項目テキスト(長)
1                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
1                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-方法テキスト
USING 'ZNAME_1'        "項目ID
TEXT-F17         "項目テキスト(短)
TEXT-F17         "項目テキスト(中)
TEXT-F17         "項目テキスト(長)
30               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
30               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-条件（支払日）
USING 'ZTERM_P1'       "項目ID
TEXT-F18         "項目テキスト(短)
TEXT-F18         "項目テキスト(中)
TEXT-F18         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-条件（支払日）TEXT
USING 'ZNAME_P1'       "項目ID
TEXT-F19         "項目テキスト(短)
TEXT-F19         "項目テキスト(中)
TEXT-F19         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-条件（サイト）
USING 'ZTERM_S1'       "項目ID
TEXT-F20         "項目テキスト(短)
TEXT-F20         "項目テキスト(中)
TEXT-F20         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 1-条件（サイト）TEXT
USING 'ZNAME_S1'       "項目ID
TEXT-F21         "項目テキスト(短)
TEXT-F21         "項目テキスト(中)
TEXT-F21         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-分割（金額）
USING 'PAY2'           "項目ID
TEXT-F22         "項目テキスト(短)
TEXT-F22         "項目テキスト(中)
TEXT-F22         "項目テキスト(長)
16               "出力データ長
'CURR'           "データ型
'P'              "数値データ型
13               "数値データ長
'WAERS'          "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-分割（％）
USING 'PER2'           "項目ID
TEXT-F23         "項目テキスト(短)
TEXT-F23         "項目テキスト(中)
TEXT-F23         "項目テキスト(長)
5                "出力データ長
'DEC'            "データ型
SPACE            "数値データ型
5                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-方法
USING 'ZLSCH_2'        "項目ID
TEXT-F24         "項目テキスト(短)
TEXT-F24         "項目テキスト(中)
TEXT-F24         "項目テキスト(長)
1                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
1                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-方法テキスト
USING 'ZNAME_2'        "項目ID
TEXT-F25         "項目テキスト(短)
TEXT-F25         "項目テキスト(中)
TEXT-F25         "項目テキスト(長)
30               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
30               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-条件（支払日）
USING 'ZTERM_P2'       "項目ID
TEXT-F26         "項目テキスト(短)
TEXT-F26         "項目テキスト(中)
TEXT-F26         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-条件（支払日）TEXT
USING 'ZNAME_P2'       "項目ID
TEXT-F27         "項目テキスト(短)
TEXT-F27         "項目テキスト(中)
TEXT-F27         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-条件（サイト）
USING 'ZTERM_S2'       "項目ID
TEXT-F28         "項目テキスト(短)
TEXT-F28         "項目テキスト(中)
TEXT-F28         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 2-条件（サイト） TEXT
USING 'ZNAME_S2'       "項目ID
TEXT-F29         "項目テキスト(短)
TEXT-F29         "項目テキスト(中)
TEXT-F29         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 3-分割（金額）
USING 'PAY3'           "項目ID
TEXT-F30         "項目テキスト(短)
TEXT-F30         "項目テキスト(中)
TEXT-F30         "項目テキスト(長)
16               "出力データ長
'CURR'           "データ型
'P'              "数値データ型
13               "数値データ長
'WAERS'          "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 3-分割（％）
USING 'PER3'           "項目ID
TEXT-F31         "項目テキスト(短)
TEXT-F31         "項目テキスト(中)
TEXT-F31         "項目テキスト(長)
5                "出力データ長
'DEC'            "データ型
SPACE            "数値データ型
5                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 3-方法
USING 'ZLSCH_3'        "項目ID
TEXT-F32         "項目テキスト(短)
TEXT-F32         "項目テキスト(中)
TEXT-F32         "項目テキスト(長)
1                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
1                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 3-方法テキスト
USING 'ZNAME_3'        "項目ID
TEXT-F33         "項目テキスト(短)
TEXT-F33        "項目テキスト(中)
TEXT-F33         "項目テキスト(長)
30               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
30               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 3-条件（支払日）
USING 'ZTERM_P3'       "項目ID
TEXT-F34         "項目テキスト(短)
TEXT-F34         "項目テキスト(中)
TEXT-F34         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 3-条件（支払日）TEXT
USING 'ZNAME_P3'       "項目ID
TEXT-F35         "項目テキスト(短)
TEXT-F35         "項目テキスト(中)
TEXT-F35         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 3-条件（サイト）
USING 'ZTERM_S3'       "項目ID
TEXT-F36         "項目テキスト(短)
TEXT-F36         "項目テキスト(中)
TEXT-F36         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 3-条件（サイト）TEXT
USING 'ZNAME_S3'       "項目ID
TEXT-F37         "項目テキスト(短)
TEXT-F37         "項目テキスト(中)
TEXT-F37         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 4-分割（金額）
USING 'PAY4'           "項目ID
TEXT-F38         "項目テキスト(短)
TEXT-F38         "項目テキスト(中)
TEXT-F38         "項目テキスト(長)
16               "出力データ長
'CURR'           "データ型
'P'              "数値データ型
13               "数値データ長
'WAERS'          "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 4-分割（％）
USING 'PER4'           "項目ID
TEXT-F39         "項目テキスト(短)
TEXT-F39         "項目テキスト(中)
TEXT-F39         "項目テキスト(長)
5                "出力データ長
'DEC'            "データ型
SPACE            "数値データ型
5                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,
* 4-方法
USING 'ZLSCH_4'        "項目ID
TEXT-F40         "項目テキスト(短)
TEXT-F40         "項目テキスト(中)
TEXT-F40         "項目テキスト(長)
1                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
1                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 4-方法テキスト
USING 'ZNAME_4'        "項目ID
TEXT-F41         "項目テキスト(短)
TEXT-F41        "項目テキスト(中)
TEXT-F41         "項目テキスト(長)
30               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
30               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 4-条件（支払日）
USING 'ZTERM_P4'       "項目ID
TEXT-F42         "項目テキスト(短)
TEXT-F42         "項目テキスト(中)
TEXT-F42         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 4-条件（支払日）TEXT
USING 'ZNAME_P4'       "項目ID
TEXT-F43         "項目テキスト(短)
TEXT-F43         "項目テキスト(中)
TEXT-F43         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 4-条件（サイト）
USING 'ZTERM_S4'       "項目ID
TEXT-F44         "項目テキスト(短)
TEXT-F44         "項目テキスト(中)
TEXT-F44         "項目テキスト(長)
4                "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
4                "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL,

* 4-条件（サイト）TEXT
USING 'ZNAME_S4'       "項目ID
TEXT-F45         "項目テキスト(短)
TEXT-F45         "項目テキスト(中)
TEXT-F45         "項目テキスト(長)
50               "出力データ長
'CHAR'           "データ型
SPACE            "数値データ型
50               "数値データ長
SPACE            "通貨参照項目
SPACE            "前0
CHANGING PIT_FIELDCAT
LW_COL.

ENDFORM.                    " SET_FLELDCAT
*&---------------------------------------------------------------------*
*&      Form  SET_VALUE
*&---------------------------------------------------------------------*
*       フィールドカタログ用の内部テーブルセット
*----------------------------------------------------------------------*
FORM SET_VALUE  USING P_FIELDNAME   TYPE SLIS_FIELDCAT_ALV-FIELDNAME
P_SELTEXT_S   TYPE ANY
P_SELTEXT_M   TYPE ANY
P_SELTEXT_L   TYPE ANY
P_OUTPUTLEN   TYPE SLIS_FIELDCAT_ALV-OUTPUTLEN
P_DATATYPE    TYPE SLIS_FIELDCAT_ALV-DATATYPE
P_INTTYPE     TYPE SLIS_FIELDCAT_ALV-INTTYPE
P_INTLEN      TYPE SLIS_FIELDCAT_ALV-INTLEN
P_CFIELDNAME  TYPE SLIS_FIELDCAT_ALV-CFIELDNAME
P_NO_ZERO     TYPE SLIS_FIELDCAT_ALV-NO_ZERO
CHANGING PIT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV
PW_COL.

DATA:
LW_FIELDCAT    TYPE SLIS_FIELDCAT_ALV.   "ALV出力項目設定

* カラム位置設定
PW_COL = PW_COL + 1.

LW_FIELDCAT-COL_POS    = PW_COL.            "カラム位置
LW_FIELDCAT-FIELDNAME  = P_FIELDNAME.       "項目ID
LW_FIELDCAT-SELTEXT_S  = P_SELTEXT_S.       "項目テキスト(短)
LW_FIELDCAT-SELTEXT_M  = P_SELTEXT_M.       "項目テキスト(中)
LW_FIELDCAT-SELTEXT_L  = P_SELTEXT_L.       "項目テキスト(長)
LW_FIELDCAT-OUTPUTLEN  = P_OUTPUTLEN.       "出力データ長
LW_FIELDCAT-DATATYPE   = P_DATATYPE.        "データ型
LW_FIELDCAT-INTTYPE    = P_INTTYPE.         "数値のデータ型
LW_FIELDCAT-INTLEN     = P_INTLEN.          "データ長
LW_FIELDCAT-CFIELDNAME = P_CFIELDNAME.      "参照通貨
LW_FIELDCAT-NO_ZERO    = P_NO_ZERO.         "前ゼロ

APPEND LW_FIELDCAT TO PIT_FIELDCAT.

ENDFORM.                    " SET_VALUE
*&---------------------------------------------------------------------*
*&      Form  ALV_LAYOUT
*&---------------------------------------------------------------------*
*       text  その他編集
*----------------------------------------------------------------------*
FORM ALV_LAYOUT CHANGING PW_LAYOUT  TYPE SLIS_LAYOUT_ALV
PW_REPID   TYPE SY-REPID
PIT_EVENT  TYPE SLIS_T_EVENT
PW_PRINT   TYPE SLIS_PRINT_ALV.

* プログラムID取得
PW_REPID = SY-REPID.
* レイアウト設定
PW_LAYOUT-COLWIDTH_OPTIMIZE    = 'X'.  "ALV コントロール: 列幅の最適化
PW_LAYOUT-DETAIL_INITIAL_LINES = 'X'.
PW_LAYOUT-ZEBRA                = 'X'.

PW_LAYOUT-GROUP_CHANGE_EDIT = 'X'.

* ALV印刷時用 設定項目
PW_PRINT-NO_PRINT_LISTINFOS = 'X'.

* 処理イベントの取得
CALL FUNCTION 'REUSE_ALV_EVENTS_GET'
EXPORTING
I_LIST_TYPE = 0
IMPORTING
ET_EVENTS   = PIT_EVENT.

ENDFORM.                    " ALV_LAYOUT
*&---------------------------------------------------------------------*
*&      Form  ALV_CALL
*&---------------------------------------------------------------------*
*       text  ALV一覧出力
*----------------------------------------------------------------------*
FORM ALV_CALL USING  PIT_OUTPUT   TYPE T_I_OUT
PIT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV
PW_LAYOUT    TYPE SLIS_LAYOUT_ALV
PW_REPID     TYPE SY-REPID
PIT_EVENT    TYPE SLIS_T_EVENT
PW_PRINT     TYPE SLIS_PRINT_ALV.

* 汎用モジュールCALL: ALV
CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
EXPORTING
I_CALLBACK_PROGRAM = PW_REPID
IS_LAYOUT          = PW_LAYOUT
IS_PRINT           = PW_PRINT
IT_FIELDCAT        = PIT_FIELDCAT
I_DEFAULT          = 'X'
I_SAVE             = 'A'
IT_EVENTS          = PIT_EVENT
TABLES
T_OUTTAB           = PIT_OUTPUT
EXCEPTIONS
PROGRAM_ERROR      = 1
OTHERS             = 2.

IF SY-SUBRC <> 0.
MESSAGE S400 WITH 'ALV出力にてエラーが発生しました'.
LEAVE LIST-PROCESSING.
ENDIF.

ENDFORM.                    " ALV_CALL
*&---------------------------------------------------------------------*
*&      Form  GET_DATA
*&---------------------------------------------------------------------*
*       text  取得処理
*----------------------------------------------------------------------*
FORM GET_DATA CHANGING PIT_ZN007   TYPE T_I_ZN007
PIT_ZN008   TYPE T_I_ZN008
PIT_LFM1    TYPE T_I_LFM1
PIT_KNVV    TYPE T_I_KNVV
PIT_LFA1    TYPE T_I_LFA1
PIT_KNA1    TYPE T_I_KNA1
PIT_LFB1    TYPE T_I_LFB1
PIT_CUST    TYPE T_I_CUST
PIT_T052U   TYPE T_I_T052U
PIT_T042Z   TYPE T_I_T042Z.

DATA:
LIT_LIFNR    TYPE T_I_LIFNR,    "内部TBL:仕入先検索用
LIT_KUNNR    TYPE T_I_KUNNR.    "内部TBL:得意先検索用

*- 処理対象の取引先コード取得
PERFORM GET_TARGET_CLIENT
CHANGING LIT_LIFNR   "内部TBL:仕入先検索用
LIT_KUNNR.  "内部TBL:得意先検索用

*- 取引先コード加工処理
PERFORM MAKE_CUSTDATA
USING LIT_LIFNR       "内部TBL:仕入先検索用
LIT_KUNNR       "内部TBL:得意先検索用
CHANGING PIT_CUST        "内部TBL:取引先情報退避用
PIT_LFB1.       "内部TBL:仕入先(会社)取得用

*- 仕入先情報の取得
PERFORM GET_VEND
USING LIT_LIFNR            "内部TBL:仕入先検索用
CHANGING PIT_ZN007            "内部TBL:規定外MST(仕入)
PIT_LFM1             "内部TBL:仕入先(購買)取得用
PIT_LFA1.            "内部TBL:仕入先(一般)取得用

*- 得意先情報の取得
PERFORM GET_CUST
USING LIT_KUNNR            "内部TBL:得意先コード検索用
CHANGING PIT_ZN008            "内部TBL:規定外MST(売上)
PIT_KNVV             "内部TBL:得意先(販売組織)
PIT_KNA1.            "内部TBL:得意先(一般)

*- その他処理
PERFORM GET_OTHER
USING PIT_LFM1             "内部TBL:仕入先(購買)取得用
PIT_KNVV             "内部TBL:得意先(販売組織)
CHANGING PIT_ZN007            "内部TBL:規定外MST(仕入)
PIT_ZN008            "内部TBL:規定外MST(売上)
PIT_T052U            "内部TBL:支払条件テキスト
PIT_T042Z.           "内部TBL:支払方法テキスト

ENDFORM.                    " GET_DATA
*&---------------------------------------------------------------------*
*&      Form  GET_TARGET_CLIENT
*&---------------------------------------------------------------------*
*       text  処理対象の取引先コード取得
*----------------------------------------------------------------------*
FORM GET_TARGET_CLIENT CHANGING PIT_LIFNR TYPE T_I_LIFNR
PIT_KUNNR TYPE T_I_KUNNR.

*- ラジオボタンによる分岐
CASE CNS_FLG-ON.
*   得意先選択時
WHEN P_CUST.
PERFORM GET_BASE_KUNNR
CHANGING PIT_LIFNR
PIT_KUNNR.
*   仕入先選択時
WHEN P_VEND.
PERFORM GET_BASE_LIFNR
CHANGING PIT_LIFNR
PIT_KUNNR.
ENDCASE.

*- 重複削除処理
SORT:
PIT_LIFNR BY LIFNR,
PIT_KUNNR BY KUNNR.

DELETE ADJACENT DUPLICATES FROM PIT_LIFNR.
DELETE ADJACENT DUPLICATES FROM PIT_KUNNR.

ENDFORM.                    " GET_TARGET_CLIENT
*&---------------------------------------------------------------------*
*&      Form  GET_BASE_KUNNR
*&---------------------------------------------------------------------*
*       text  得意先コードを基に取得
*----------------------------------------------------------------------*
FORM GET_BASE_KUNNR CHANGING PIT_LINFR  TYPE T_I_LIFNR
PIT_KUNNR  TYPE T_I_KUNNR.

DATA:
LIT_TORI     TYPE T_I_LIFNR,    "内部TBL:取引先
LIT_NYU      TYPE T_I_KUNNR,    "内部TBL:入金先
LIT_SOU      TYPE T_I_LIFNR.    "内部TBL:相殺対象

*- 規定外マスタの得意先取得
PERFORM GET_ZN008
CHANGING PIT_KUNNR.

*- 標準マスタの得意先取得
PERFORM GET_KNA1
CHANGING PIT_KUNNR.


*- 処理毎の必要コードの抽出
PERFORM CAE_KUNNR
CHANGING LIT_TORI
LIT_NYU
LIT_SOU.
* 入金先情報
IF P_NYU = CNS_FLG-ON.

*   得意先:取引先機能の抽出
PERFORM GET_KNVP_KN
USING CNS_PARVW-DEPOSI  "入金先
LIT_NYU           "内部TBL:入金先
CHANGING PIT_KUNNR.
ENDIF.

* 相殺対象情報
IF P_SOU  = CNS_FLG-ON.

*   得意先:取引先機能の抽出
PERFORM GET_KNVP_LF
USING CNS_PARVW-OFFSET  "相殺対象
LIT_SOU           "内部TBL:相殺対象
CHANGING PIT_KUNNR.

*   仕入先コードを処理対象に追加
APPEND LINES OF LIT_SOU TO PIT_LINFR.

ENDIF.

* 取引先情報
IF P_TORI = CNS_FLG-ON.

*   得意先:取引先機能の抽出
PERFORM GET_KNVP_LF
USING CNS_PARVW-CLIENT  "取引先
LIT_TORI          "内部TBL:取引先
CHANGING PIT_KUNNR.

*   仕入先:取引先機能の抽出
PERFORM GET_WYT3_GENE
USING CNS_PARVW-CLIENT  "取引先
LIT_TORI          "内部TBL:取引先
CHANGING PIT_LINFR.

ENDIF.

ENDFORM.                    " GET_BASE_KUNNR
*&---------------------------------------------------------------------*
*&      Form  GET_BASE_LIFNR
*&---------------------------------------------------------------------*
*       text  仕入先コードを基に取得
*----------------------------------------------------------------------*
FORM GET_BASE_LIFNR CHANGING PIT_LIFNR  TYPE T_I_LIFNR
PIT_KUNNR  TYPE T_I_KUNNR.

DATA:
LIT_TORI     TYPE T_I_LIFNR,    "内部TBL:取引先
LIT_NAYO     TYPE T_I_LIFNR.    "内部TBL:名寄先

*- 規定外マスタの仕入先取得
PERFORM GET_ZN007
CHANGING PIT_LIFNR.

*- 標準マスタの仕入先取得
PERFORM GET_LFA1
CHANGING PIT_LIFNR.

*- CHECKBOX毎に必要コードの抽出
PERFORM CAE_LIFNR
CHANGING LIT_TORI     "取引先
LIT_NAYO.    "名寄先

*- 名寄先情報
IF P_NAYO = CNS_FLG-ON.

*   仕入先:取引先機能の抽出
PERFORM GET_WYT3_GENE
USING CNS_PARVW-AGGREG   "名寄先
LIT_NAYO           "内部TBL:名寄先
CHANGING PIT_LIFNR.
ENDIF.

*- 相殺対象情報
IF P_SOU  = CNS_FLG-ON.

*   仕入先:取引先機能の抽出
PERFORM GET_KNVP_LIFNR
USING CNS_PARVW-OFFSET  "相殺対象
CHANGING PIT_KUNNR.
ENDIF.

*- 取引先情報
IF P_TORI = CNS_FLG-ON.

*   得意先:取引先機能の抽出
PERFORM GET_KNVP_LF
USING CNS_PARVW-CLIENT  "取引先
LIT_TORI          "内部TBL:取引先
CHANGING PIT_KUNNR.

*   仕入先:取引先機能の抽出
PERFORM GET_WYT3_GENE
USING CNS_PARVW-CLIENT  "取引先
LIT_TORI          "内部TBL:取引先
CHANGING PIT_LIFNR.
ENDIF.

ENDFORM.                    " GET_BASE_LIFNR
*&---------------------------------------------------------------------*
*&      Form  GET_KNVP_KN
*&---------------------------------------------------------------------*
*       text  得意先：取引先機能の取得(汎用)
*----------------------------------------------------------------------*
FORM GET_KNVP_KN    USING   PW_PARVW
PIT_WK_KN  TYPE T_I_KUNNR
CHANGING PIT_KUNNR  TYPE T_I_KUNNR.

CHECK NOT PIT_WK_KN IS INITIAL.

* 得意先コードを取得
SELECT KUNNR
APPENDING TABLE PIT_KUNNR
FROM KNVP
FOR ALL ENTRIES IN PIT_WK_KN
WHERE KUNN2 = PIT_WK_KN-KUNNR
AND VKORG = CNS_VKORG_1
AND PARVW = PW_PARVW.

ENDFORM.                    " GET_KNVP_KN
*&---------------------------------------------------------------------*
*&      Form  GET_WYT3_GENE
*&---------------------------------------------------------------------*
*       text  仕入先：取引先機能の取得(汎用)
*----------------------------------------------------------------------*
FORM GET_WYT3_GENE  USING   PW_PARVW
PIT_WK_LF  TYPE T_I_LIFNR
CHANGING PIT_LIFNR  TYPE T_I_LIFNR.

CHECK NOT PIT_WK_LF IS INITIAL.

* 仕入先コードを取得
SELECT LIFNR
APPENDING TABLE PIT_LIFNR
FROM WYT3
FOR ALL ENTRIES IN PIT_WK_LF
WHERE LIFN2 = PIT_WK_LF-LIFNR
AND EKORG = CNS_EKORG_1
AND PARVW = PW_PARVW.

ENDFORM.                    " GET_WYT3_GENE
*&---------------------------------------------------------------------*
*&      Form  GET_KNVP_LIFNR
*&---------------------------------------------------------------------*
*       text  得意先：取引先機能の取得(仕入先を基に)
*----------------------------------------------------------------------*
FORM GET_KNVP_LIFNR USING    PW_PARVW
CHANGING PIT_KUNNR  TYPE T_I_KUNNR.

* 得意先コードを取得
SELECT KUNNR   "他の仕入先への参照
APPENDING TABLE PIT_KUNNR
FROM KNVP
WHERE LIFNR IN S_LIFNR
AND VKORG = CNS_VKORG_1
AND PARVW = PW_PARVW.

ENDFORM.                    " GET_KNVP_LIFNR
*&---------------------------------------------------------------------*
*&      Form  GET_KNVP_LF
*&---------------------------------------------------------------------*
*       text  得意先：取引先機能の取得(仕入先を基に)
*----------------------------------------------------------------------*
FORM GET_KNVP_LF   USING PW_PARVW
PIT_WK     TYPE T_I_LIFNR
CHANGING PIT_KUNNR  TYPE T_I_KUNNR.

CHECK NOT PIT_WK IS INITIAL.

* 得意先コードを取得
SELECT KUNNR   "他の仕入先への参照
APPENDING TABLE PIT_KUNNR
FROM KNVP
FOR ALL ENTRIES IN PIT_WK
WHERE LIFNR = PIT_WK-LIFNR
AND VKORG = CNS_VKORG_1
AND PARVW = PW_PARVW.


ENDFORM.                    " GET_KNVP_LF
*&---------------------------------------------------------------------*
*&      Form  GET_VEND
*&---------------------------------------------------------------------*
*       text 仕入先情報の取得
*----------------------------------------------------------------------*
FORM GET_VEND  USING    PIT_LIFNR    TYPE T_I_LIFNR
CHANGING PIT_ZN007    TYPE T_I_ZN007
PIT_LFM1     TYPE T_I_LFM1
PIT_LFA1     TYPE T_I_LFA1.

CHECK NOT PIT_LIFNR IS INITIAL.

* 仕入先情報(購買組織)
SELECT LIFNR   "仕入先コード
WAERS   "購買発注通貨
LOEVM   "削除フラグ
SPERM   "購買ブロック
INTO TABLE PIT_LFM1
FROM LFM1
FOR ALL ENTRIES IN PIT_LIFNR
WHERE LIFNR = PIT_LIFNR-LIFNR
AND EKORG = CNS_EKORG_1.

* 仕入先情報(一般)
SELECT LIFNR   "仕入先コード
NAME1   "名称１
LOEVM   "削除フラグ
SPERR   "転記ブロック
SPERM   "購買ブロック
INTO TABLE PIT_LFA1
FROM LFA1
FOR ALL ENTRIES IN PIT_LIFNR
WHERE LIFNR = PIT_LIFNR-LIFNR.

* 規定外マスタ
SELECT *
INTO TABLE PIT_ZN007
FROM ZN007
FOR ALL ENTRIES IN PIT_LIFNR
WHERE LIFNR = PIT_LIFNR-LIFNR.

* ソート処理
SORT:
PIT_LFM1   BY LIFNR,
PIT_LFA1   BY LIFNR,
PIT_ZN007  BY LIFNR
WAERS
SEQ.

ENDFORM.                    " GET_VEND
*&---------------------------------------------------------------------*
*&      Form  GET_CUST
*&---------------------------------------------------------------------*
*       text  得意先情報の取得
*----------------------------------------------------------------------*
FORM GET_CUST USING    PIT_KUNNR     TYPE T_I_KUNNR
CHANGING PIT_ZN008     TYPE T_I_ZN008
PIT_KNVV      TYPE T_I_KNVV
PIT_KNA1      TYPE T_I_KNA1.

CHECK NOT PIT_KUNNR IS INITIAL.

SELECT KUNNR     "得意先コード
WAERS     "通貨
INTO TABLE PIT_KNVV
FROM KNVV
FOR ALL ENTRIES IN PIT_KUNNR
WHERE KUNNR = PIT_KUNNR-KUNNR
AND VKORG = CNS_VKORG_1.

SELECT KUNNR     "得意先コード
NAME1     "名称１
INTO TABLE PIT_KNA1
FROM KNA1
FOR ALL ENTRIES IN PIT_KUNNR
WHERE KUNNR = PIT_KUNNR-KUNNR.

SELECT *
INTO TABLE PIT_ZN008
FROM ZN008
FOR ALL ENTRIES IN PIT_KUNNR
WHERE KUNNR = PIT_KUNNR-KUNNR.

SORT:
PIT_KNVV   BY KUNNR,
PIT_KNA1   BY KUNNR,
PIT_ZN008  BY KUNNR
WAERS
SEQ.
ENDFORM.                    " GET_CUST
*&---------------------------------------------------------------------*
*&      Form  GET_OTHER
*&---------------------------------------------------------------------*
*       text  テキスト情報の取得
*----------------------------------------------------------------------*
FORM GET_OTHER USING   PIT_LFM1     TYPE T_I_LFM1
PIT_KNVV     TYPE T_I_KNVV
CHANGING PIT_ZN007    TYPE T_I_ZN007
PIT_ZN008    TYPE T_I_ZN008
PIT_T052U    TYPE T_I_T052U
PIT_T042Z    TYPE T_I_T042Z.

DATA:
LIT_ZTERM   TYPE T_I_ZTERM,    "内部TBL:支払条件検索用
LIT_ZLSCH   TYPE T_I_ZLSCH.    "内部TBL:支払方法検索用

*- 取得前準備
PERFORM ADVANCE
USING PIT_LFM1     "内部TBL:仕入先(購買)取得用
PIT_KNVV     "内部TBL:得意先(販売組織)
CHANGING PIT_ZN007    "内部TBL:規定外MST(仕入)
PIT_ZN008    "内部TBL:規定外MST(売上)
LIT_ZTERM    "内部TBL:支払条件検索用
LIT_ZLSCH.   "内部TBL:支払方法検索用

*- テキスト情報の取得
PERFORM GET_TEXT
USING LIT_ZTERM    "内部TBL:支払条件検索用
LIT_ZLSCH    "内部TBL:支払方法検索用
CHANGING PIT_T052U    "内部TBL:支払条件テキスト
PIT_T042Z.   "内部TBL:支払方法テキスト

ENDFORM.                    " GET_OTHER
*&---------------------------------------------------------------------*
*&      Form  ADVANCE
*&---------------------------------------------------------------------*
*       text  取得前準備：検索データの作成
*----------------------------------------------------------------------*
FORM ADVANCE  USING    PIT_LFM1     TYPE T_I_LFM1
PIT_KNVV     TYPE T_I_KNVV
CHANGING PIT_ZN007    TYPE T_I_ZN007
PIT_ZN008    TYPE T_I_ZN008
PIT_ZTERM    TYPE T_I_ZTERM
PIT_ZLSCH    TYPE T_I_ZLSCH.

*-  取得前準備：検索データの作成
PERFORM SET_ZNDATA
USING PIT_ZN007    "内部TBL:規定外MST(仕入)
PIT_ZN008    "内部TBL:規定外MST(売上)
CHANGING PIT_ZTERM    "内部TBL:支払条件検索用
PIT_ZLSCH.   "内部TBL:支払方法検索用

*- 規定外マスタと取引先マスタのマージ
PERFORM MARG_MSTDATA
USING PIT_LFM1     "内部TBL:仕入先(購買)取得用
PIT_KNVV     "内部TBL:得意先(販売組織)
CHANGING PIT_ZN007    "内部TBL:規定外MST(仕入)
PIT_ZN008.   "内部TBL:規定外MST(売上)


ENDFORM.                    " ADVANCE
*&---------------------------------------------------------------------*
*&      Form  SET_ZNDATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM SET_ZNDATA USING    PIT_ZN007    TYPE T_I_ZN007
PIT_ZN008    TYPE T_I_ZN008
CHANGING PIT_ZTERM    TYPE T_I_ZTERM
PIT_ZLSCH    TYPE T_I_ZLSCH.

* ローカル定義
FIELD-SYMBOLS:
<LFS_ZN007>     TYPE T_S_ZN007,
<LFS_ZN008>     TYPE T_S_ZN008.

* 仕入
LOOP AT PIT_ZN007 ASSIGNING <LFS_ZN007>.

*-- 支払条件
PERFORM SET_ZTERM :
CHANGING <LFS_ZN007>-ZTERM_PZ
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_SZ
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_P1
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_S1
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_P2
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_S2
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_P3
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_S3
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_P4
PIT_ZTERM,

CHANGING <LFS_ZN007>-ZTERM_S4
PIT_ZTERM.

*-- 支払方法
PERFORM SET_ZLSCH :
USING <LFS_ZN007>-ZLSCH_Z
CHANGING PIT_ZLSCH,

USING <LFS_ZN007>-ZLSCH_1
CHANGING PIT_ZLSCH,

USING <LFS_ZN007>-ZLSCH_2
CHANGING PIT_ZLSCH,

USING <LFS_ZN007>-ZLSCH_3
CHANGING PIT_ZLSCH,

USING <LFS_ZN007>-ZLSCH_4
CHANGING PIT_ZLSCH.

ENDLOOP.

* 売上
LOOP AT PIT_ZN008 ASSIGNING <LFS_ZN008>.

*-- 支払条件
PERFORM SET_ZTERM :
CHANGING <LFS_ZN008>-ZTERM_PZ
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_SZ
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_P1
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_S1
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_P2
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_S2
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_P3
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_S3
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_P4
PIT_ZTERM,

CHANGING <LFS_ZN008>-ZTERM_S4
PIT_ZTERM.

*-- 支払方法
PERFORM SET_ZLSCH :
USING <LFS_ZN008>-ZLSCH_Z
CHANGING PIT_ZLSCH,

USING <LFS_ZN008>-ZLSCH_1
CHANGING PIT_ZLSCH,

USING <LFS_ZN008>-ZLSCH_2
CHANGING PIT_ZLSCH,

USING <LFS_ZN008>-ZLSCH_3
CHANGING PIT_ZLSCH,

USING <LFS_ZN008>-ZLSCH_4
CHANGING PIT_ZLSCH.

ENDLOOP.

ENDFORM.                    " SET_ZNDATA
*&---------------------------------------------------------------------*
*&      Form  SET_ZTERM
*&---------------------------------------------------------------------*
*       text  支払条件を内部TBLにSET
*----------------------------------------------------------------------*
FORM SET_ZTERM CHANGING PW_ZTERM
PIT_ZTERM  TYPE T_I_ZTERM.

DATA:
LS_ZTERM    TYPE T_S_ZTERM.

* 初期値でない
CHECK NOT PW_ZTERM IS INITIAL.

LS_ZTERM-ZTERM = PW_ZTERM.
COLLECT LS_ZTERM INTO PIT_ZTERM.

ENDFORM.                    " SET_ZTERM
*&---------------------------------------------------------------------*
*&      Form  SET_ZLSCH
*&---------------------------------------------------------------------*
*       text  支払方法を内部TBLにSET
*----------------------------------------------------------------------*
FORM SET_ZLSCH USING    PW_ZLSCH
CHANGING PIT_ZLSCH  TYPE T_I_ZLSCH.

DATA:
LS_ZLSCH    TYPE T_S_ZLSCH.

* 初期値でない
CHECK NOT PW_ZLSCH IS INITIAL.
LS_ZLSCH-ZLSCH = PW_ZLSCH.
COLLECT LS_ZLSCH INTO PIT_ZLSCH.

ENDFORM.                    " SET_ZLSCH
*&---------------------------------------------------------------------*
*&      Form  MARG_MSTDATA
*&---------------------------------------------------------------------*
*       text  データのマージ処理
*----------------------------------------------------------------------*
FORM MARG_MSTDATA USING    PIT_LFM1     TYPE T_I_LFM1
PIT_KNVV     TYPE T_I_KNVV
CHANGING PIT_ZN007    TYPE T_I_ZN007
PIT_ZN008    TYPE T_I_ZN008.
* ローカル定義
FIELD-SYMBOLS:
<LFS_LFM1>  TYPE T_S_LFM1,
<LFS_KNVV>  TYPE T_S_KNVV.

DATA:
LS_ZN007    TYPE T_S_ZN007,
LS_ZN008    TYPE T_S_ZN008.

* 仕入先マスタ(購買)
LOOP AT PIT_LFM1 ASSIGNING <LFS_LFM1>.

READ TABLE PIT_ZN007
TRANSPORTING NO FIELDS
WITH KEY LIFNR = <LFS_LFM1>-LIFNR.

*   規定外マスタに存在しない場合
CHECK SY-SUBRC <> 0.
CLEAR:LS_ZN007.
LS_ZN007-LIFNR = <LFS_LFM1>-LIFNR.
APPEND LS_ZN007 TO PIT_ZN007.

ENDLOOP.

* 得意先マスタ(販売)
LOOP AT PIT_KNVV ASSIGNING <LFS_KNVV>.

READ TABLE PIT_ZN008
TRANSPORTING NO FIELDS
WITH KEY KUNNR = <LFS_KNVV>-KUNNR.

*   規定外マスタに存在しない場合
CHECK SY-SUBRC <> 0.
CLEAR:LS_ZN008.
LS_ZN008-KUNNR = <LFS_KNVV>-KUNNR.
APPEND LS_ZN008 TO PIT_ZN008.

ENDLOOP.

ENDFORM.                    " MARG_MSTDATA
*&---------------------------------------------------------------------*
*&      Form  GET_TEXT
*&---------------------------------------------------------------------*
*       text  テキスト情報の取得
*----------------------------------------------------------------------*
FORM GET_TEXT USING    PIT_ZTERM    TYPE T_I_ZTERM
PIT_ZLSCH    TYPE T_I_ZLSCH
CHANGING PIT_T052U    TYPE T_I_T052U
PIT_T042Z    TYPE T_I_T042Z.
* 支払条件
IF NOT PIT_ZTERM IS INITIAL.

SELECT ZTERM     "支払条件
TEXT1
INTO TABLE PIT_T052U
FROM T052U
FOR ALL ENTRIES IN PIT_ZTERM
WHERE ZTERM = PIT_ZTERM-ZTERM.

SORT PIT_T052U BY ZTERM.
ENDIF.

* 支払方法
IF NOT PIT_ZLSCH IS INITIAL.

SELECT ZLSCH     "支払方法
TEXT1
INTO TABLE PIT_T042Z
FROM T042Z
FOR ALL ENTRIES IN PIT_ZLSCH
WHERE LAND1 = CNS_LAND_JP
AND ZLSCH = PIT_ZLSCH-ZLSCH.

SORT PIT_T042Z BY ZLSCH .

ENDIF.

ENDFORM.                    " GET_TEXT
*&---------------------------------------------------------------------*
*&      Form  EDIT_DATA
*&---------------------------------------------------------------------*
*       text  編集処理
*----------------------------------------------------------------------*
FORM EDIT_DATA USING    PIT_ZN007   TYPE T_I_ZN007
PIT_ZN008   TYPE T_I_ZN008
PIT_LFA1    TYPE T_I_LFA1
PIT_KNA1    TYPE T_I_KNA1
PIT_LFB1    TYPE T_I_LFB1
PIT_CUST    TYPE T_I_CUST
PIT_T052U   TYPE T_I_T052U
PIT_T042Z   TYPE T_I_T042Z
CHANGING PIT_OUTPUT  TYPE T_I_OUT.

*- 仕入先情報の編集
PERFORM EDIT_VEND
USING PIT_ZN007    "内部TBL:規定外MST(仕入)
PIT_LFA1     "内部TBL:仕入先(一般)取得用
PIT_LFB1     "内部TBL:仕入先(会社)取得用
PIT_CUST     "内部TBL:取引先情報退避用
PIT_T052U    "内部TBL:支払条件テキスト
PIT_T042Z    "内部TBL:支払方法テキスト
CHANGING PIT_OUTPUT.  "内部TBL:ALV一覧

*- 得意先情報の編集
PERFORM EDIT_CUST
USING PIT_ZN008    "内部TBL:規定外MST(売上)
PIT_KNA1     "内部TBL:得意先(一般)取得用
PIT_LFB1     "内部TBL:仕入先(会社)取得用
PIT_CUST     "内部TBL:取引先情報退避用
PIT_T052U    "内部TBL:支払条件テキスト
PIT_T042Z    "内部TBL:支払方法テキスト
CHANGING PIT_OUTPUT.  "内部TBL:ALV一覧

*- SORT処理
SORT PIT_OUTPUT BY CLIENT
SORT
CORD
LOWAMT.

*- 出力データの存在チェック
CHECK PIT_OUTPUT IS INITIAL.

MESSAGE S400 WITH '対象データが存在しません'.
LEAVE LIST-PROCESSING.

ENDFORM.                    " EDIT_DATA
*&---------------------------------------------------------------------*
*&      Form  EDIT_VEND
*&---------------------------------------------------------------------*
*       text  仕入先情報の編集
*----------------------------------------------------------------------*
FORM EDIT_VEND USING    PIT_ZN007   TYPE T_I_ZN007
PIT_LFA1    TYPE T_I_LFA1
PIT_LFB1    TYPE T_I_LFB1
PIT_CUST    TYPE T_I_CUST
PIT_T052U   TYPE T_I_T052U
PIT_T042Z   TYPE T_I_T042Z
CHANGING PIT_OUTPUT  TYPE T_I_OUT.

* ローカル定義
FIELD-SYMBOLS:
<LFS_ZN007>   TYPE T_S_ZN007.

DATA:
LS_OUTPUT     TYPE T_S_OUT.

LOOP AT PIT_ZN007 ASSIGNING <LFS_ZN007>.

CLEAR LS_OUTPUT.

*-- 出力構造へ
MOVE-CORRESPONDING <LFS_ZN007> TO LS_OUTPUT.
LS_OUTPUT-CORD  = <LFS_ZN007>-LIFNR.
LS_OUTPUT-KUBUN = TEXT-T02.
LS_OUTPUT-SORT  = 2.
IF <LFS_ZN007>-BASE_ZT = '1'.
LS_OUTPUT-BASE = TEXT-T04.
ENDIF.

*-- 取引先情報の取得
PERFORM READ_CUST
USING  <LFS_ZN007>-LIFNR
PIT_LFB1
PIT_CUST
CHANGING LS_OUTPUT-CLIENT
LS_OUTPUT-TNAME
LS_OUTPUT-KUBUN
LS_OUTPUT-SORT.

*-- 仕入先名称
PERFORM READ_LFA1
USING  <LFS_ZN007>-LIFNR
PIT_LFA1
CHANGING LS_OUTPUT-NAME1.
*-- 支払条件
PERFORM READ_ZTERM :
USING  <LFS_ZN007>-ZTERM_PZ
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_PZ,

USING  <LFS_ZN007>-ZTERM_SZ
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_SZ,

USING  <LFS_ZN007>-ZTERM_P1
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P1,

USING  <LFS_ZN007>-ZTERM_S1
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S1,

USING  <LFS_ZN007>-ZTERM_P2
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P2,

USING  <LFS_ZN007>-ZTERM_S2
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S2,

USING  <LFS_ZN007>-ZTERM_P3
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P3,

USING  <LFS_ZN007>-ZTERM_S3
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S3,

USING  <LFS_ZN007>-ZTERM_P4
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P4,

USING  <LFS_ZN007>-ZTERM_S4
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S4.

*-- 支払方法
PERFORM READ_ZLSCH :
USING <LFS_ZN007>-ZLSCH_Z
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_Z,

USING <LFS_ZN007>-ZLSCH_1
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_1,

USING <LFS_ZN007>-ZLSCH_2
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_2,

USING <LFS_ZN007>-ZLSCH_3
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_3,

USING <LFS_ZN007>-ZLSCH_4
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_4.
APPEND LS_OUTPUT TO PIT_OUTPUT.
ENDLOOP.
ENDFORM.                    " EDIT_VEND
*&---------------------------------------------------------------------*
*&      Form  EDIT_CUST
*&---------------------------------------------------------------------*
*       text  得意先情報の編集
*----------------------------------------------------------------------*
FORM EDIT_CUST USING    PIT_ZN008   TYPE T_I_ZN008
PIT_KNA1    TYPE T_I_KNA1
PIT_LFB1    TYPE T_I_LFB1
PIT_CUST    TYPE T_I_CUST
PIT_T052U   TYPE T_I_T052U
PIT_T042Z   TYPE T_I_T042Z
CHANGING PIT_OUTPUT  TYPE T_I_OUT.

* ローカル定義
FIELD-SYMBOLS:
<LFS_ZN008>  TYPE T_S_ZN008.

DATA:
LS_OUTPUT    TYPE T_S_OUT.

LOOP AT PIT_ZN008 ASSIGNING <LFS_ZN008>.

CLEAR LS_OUTPUT.

*-- 出力構造へ
MOVE-CORRESPONDING <LFS_ZN008> TO LS_OUTPUT.
LS_OUTPUT-CORD  = <LFS_ZN008>-KUNNR.
LS_OUTPUT-KUBUN = TEXT-T03.
LS_OUTPUT-SORT  = 3.
IF <LFS_ZN008>-BASE_ZT = '1'.
LS_OUTPUT-BASE = TEXT-T04.
ENDIF.

*-- 取引先情報の取得
PERFORM READ_CUST
USING  <LFS_ZN008>-KUNNR
PIT_LFB1
PIT_CUST
CHANGING LS_OUTPUT-CLIENT
LS_OUTPUT-TNAME
LS_OUTPUT-KUBUN
LS_OUTPUT-SORT.
*-- 得意先名称
PERFORM READ_KNA1
USING  <LFS_ZN008>-KUNNR
PIT_KNA1
CHANGING LS_OUTPUT-NAME1.
*-- 支払条件
PERFORM READ_ZTERM :
USING  <LFS_ZN008>-ZTERM_PZ
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_PZ,

USING  <LFS_ZN008>-ZTERM_SZ
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_SZ,

USING  <LFS_ZN008>-ZTERM_P1
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P1,

USING  <LFS_ZN008>-ZTERM_S1
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S1,

USING  <LFS_ZN008>-ZTERM_P2
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P2,

USING  <LFS_ZN008>-ZTERM_S2
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S2,

USING  <LFS_ZN008>-ZTERM_P3
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P3,

USING  <LFS_ZN008>-ZTERM_S3
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S3,

USING  <LFS_ZN008>-ZTERM_P4
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_P4,

USING  <LFS_ZN008>-ZTERM_S4
PIT_T052U
CHANGING LS_OUTPUT-ZNAME_S4.

*-- 支払方法
PERFORM READ_ZLSCH :
USING <LFS_ZN008>-ZLSCH_Z
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_Z,

USING <LFS_ZN008>-ZLSCH_1
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_1,

USING <LFS_ZN008>-ZLSCH_2
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_2,

USING <LFS_ZN008>-ZLSCH_3
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_3,

USING <LFS_ZN008>-ZLSCH_4
PIT_T042Z
CHANGING LS_OUTPUT-ZNAME_4.

APPEND LS_OUTPUT TO PIT_OUTPUT.
ENDLOOP.
ENDFORM.                    " EDIT_CUST
*&---------------------------------------------------------------------*
*&      Form  READ_ZTERM
*&---------------------------------------------------------------------*
*       text 支払条件のテキスト読込
*----------------------------------------------------------------------*
FORM READ_ZTERM USING    PW_ZTERM
PIT_T052U    TYPE T_I_T052U
CHANGING PW_NAME.

DATA:
LW_T052U   TYPE T_S_T052U.

CHECK NOT PW_ZTERM IS INITIAL.

READ TABLE PIT_T052U
INTO LW_T052U
WITH KEY ZTERM = PW_ZTERM
BINARY SEARCH.

CHECK SY-SUBRC = 0.
PW_NAME = LW_T052U-TEXT1.

ENDFORM.                    " READ_ZTERM
*&---------------------------------------------------------------------*
*&      Form  READ_ZLSCH
*&---------------------------------------------------------------------*
*       text 支払条件のテキスト読込
*----------------------------------------------------------------------*
FORM READ_ZLSCH USING    PW_ZLSCH
PIT_T042Z  TYPE T_I_T042Z
CHANGING PW_NAME.

DATA:
LW_T042Z   TYPE T_S_T042Z.

CHECK NOT PW_ZLSCH IS INITIAL.

READ TABLE PIT_T042Z
INTO LW_T042Z
WITH KEY ZLSCH = PW_ZLSCH
BINARY SEARCH.

CHECK SY-SUBRC = 0.
PW_NAME = LW_T042Z-TEXT1.

ENDFORM.                    " READ_ZLSCH
*&---------------------------------------------------------------------*
*&      Form  READ_CUST
*&---------------------------------------------------------------------*
*       text  取引コード情報の読込
*----------------------------------------------------------------------*
FORM READ_CUST USING    PW_CORD
PIT_LFB1   TYPE T_I_LFB1
PIT_CUST   TYPE T_I_CUST
CHANGING PW_CLIENT
PW_TNAME
PW_KUBUN
PW_SORT.

DATA:
LS_LFB1    TYPE T_S_LFB1,
LS_CUST    TYPE T_S_CUST.

* 退避した取引先情報の読込
READ TABLE PIT_CUST
INTO LS_CUST
WITH KEY CORD = PW_CORD.

CHECK SY-SUBRC = 0.

* 取引先コードから取得
READ TABLE PIT_LFB1
INTO LS_LFB1
WITH KEY LIFNR = LS_CUST-LIFNR
BINARY SEARCH.

CHECK SY-SUBRC = 0.
PW_CLIENT = LS_CUST-LIFNR.
PW_TNAME  = LS_LFB1-INTAD.

* 仕入先コード = 取引先コードの場合
CHECK LS_CUST-CORD = LS_CUST-LIFNR.
PW_KUBUN  = TEXT-T01.
PW_SORT   = 1.

ENDFORM.                    " READ_CUST
*&---------------------------------------------------------------------*
*&      Form  READ_LFA1
*&---------------------------------------------------------------------*
*       text  マスタテキストの読込
*----------------------------------------------------------------------*
FORM READ_LFA1 USING    PW_LIFNR
PIT_LFA1   TYPE T_I_LFA1
CHANGING PW_NAME.

DATA:
LS_LFA1    TYPE T_S_LFA1.

READ TABLE PIT_LFA1
INTO LS_LFA1
WITH KEY LIFNR = PW_LIFNR
BINARY SEARCH.

CHECK SY-SUBRC = 0.
PW_NAME = LS_LFA1-NAME1.

ENDFORM.                                                    " READ_LFA1
*&---------------------------------------------------------------------*
*&      Form  READ_LFA1
*&---------------------------------------------------------------------*
*       text  マスタテキストの読込
*----------------------------------------------------------------------*
FORM READ_KNA1 USING    PW_KUNNR
PIT_KNA1   TYPE T_I_KNA1
CHANGING PW_NAME.

DATA:
LS_KNA1    TYPE T_S_KNA1.

READ TABLE PIT_KNA1
INTO LS_KNA1
WITH KEY KUNNR = PW_KUNNR
BINARY SEARCH.

CHECK SY-SUBRC = 0.
PW_NAME = LS_KNA1-NAME1.

ENDFORM.                                                    " READ_LFA1
*&---------------------------------------------------------------------*
*&      Form  OBLIGATORY_CHECK
*&---------------------------------------------------------------------*
*       text  条件必須チェック
*----------------------------------------------------------------------*
FORM OBLIGATORY_CHECK.

* 処理分岐
CASE CNS_FLG-ON.
*   ローカル選択
WHEN P_VEND.
CHECK S_LIFNR IS INITIAL.
SET CURSOR FIELD 'S_LIFNR'.
MESSAGE E401
WITH '仕入先が未入力です'.

*   サーバ選択
WHEN P_CUST.
CHECK S_KUNNR IS INITIAL.
SET CURSOR FIELD 'S_KUNNR'.
MESSAGE E401
WITH '得意先が未入力です'.
ENDCASE.

ENDFORM.                    " OBLIGATORY_CHECK
*&---------------------------------------------------------------------*
*&      Form  GET_CASE_CUSTD
*&---------------------------------------------------------------------*
*       text  取引先の場合の取得(得意先)
*----------------------------------------------------------------------*
FORM GET_CASE_CUSTD  USING    PW_PARVW
PIT_KUNNR  TYPE T_I_KUNNR
CHANGING PIT_KNVP   TYPE T_I_KNVP_WK
PIT_WK_LF  TYPE T_I_LIFNR.

DATA:
LS_WK    TYPE T_S_LIFNR,
LS_KNVP  TYPE T_S_KNVP_WK.

CHECK NOT PIT_KUNNR IS INITIAL.

* 得意先コードを取得
SELECT KUNNR
LIFNR   "他の仕入先への参照
INTO TABLE PIT_KNVP
FROM KNVP
FOR ALL ENTRIES IN PIT_KUNNR
WHERE KUNNR = PIT_KUNNR-KUNNR
AND VKORG = CNS_VKORG_1
AND PARVW = PW_PARVW.

IF SY-SUBRC = 0.
*   重複削除
SORT:
PIT_KNVP  BY KUNNR
LIFNR.
DELETE ADJACENT DUPLICATES FROM PIT_KNVP.

*-  取得データから対象の取引先コード(仕入先)のみ抽出
LOOP AT PIT_KNVP INTO LS_KNVP.
LS_WK-LIFNR = LS_KNVP-LIFNR.
COLLECT LS_WK INTO PIT_WK_LF.
ENDLOOP.
ENDIF.
ENDFORM.                    " GET_CASE_CUST_D
*&---------------------------------------------------------------------*
*&      Form  GET_CASE_CUST_K
*&---------------------------------------------------------------------*
*       text  取引先の場合の取得(仕入先)
*----------------------------------------------------------------------*
FORM GET_CASE_CUST_K USING    PW_PARVW
PIT_WK_LF  TYPE T_I_LIFNR
CHANGING PIT_WYT3   TYPE T_I_WYT3_WK.

CHECK NOT PIT_WK_LF IS INITIAL.

* 仕入先コードを取得
SELECT LIFNR
LIFN2   "他の仕入先への参照
INTO TABLE PIT_WYT3
FROM WYT3
FOR ALL ENTRIES IN PIT_WK_LF
WHERE LIFNR = PIT_WK_LF-LIFNR
AND EKORG = CNS_EKORG_1
AND PARVW = PW_PARVW.

IF SY-SUBRC = 0.
*   重複削除
SORT:
PIT_WYT3  BY LIFNR
LIFN2.
DELETE ADJACENT DUPLICATES FROM PIT_WYT3.

ENDIF.


ENDFORM.                    " GET_CASE_CUST_K
*&---------------------------------------------------------------------*
*&      Form  MAKE_CUSTDATA
*&---------------------------------------------------------------------*
*       text  取引先コード加工処理
*----------------------------------------------------------------------*
FORM MAKE_CUSTDATA USING    PIT_LIFNR    TYPE T_I_LIFNR
PIT_KUNNR    TYPE T_I_KUNNR
CHANGING PIT_CUST     TYPE T_I_CUST
PIT_LFB1     TYPE T_I_LFB1.

DATA:
LIT_WK_LF    TYPE T_I_LIFNR,
LIT_WYT3     TYPE T_I_WYT3_WK,  "内部TBL:仕入先一時
LIT_KNVP     TYPE T_I_KNVP_WK,  "内部TBL:得意先一時
LS_WYT3      TYPE T_S_WYT3_WK,
LS_KNVP      TYPE T_S_KNVP_WK,
LS_CUST      TYPE T_S_CUST.

* 仕入先コードのコピー
APPEND LINES OF PIT_LIFNR TO LIT_WK_LF.

* 得意先:取引先機能の抽出
PERFORM GET_CASE_CUSTD
USING CNS_PARVW-CLIENT  "取引先
PIT_KUNNR         "内部TBL:得意先
CHANGING LIT_KNVP          "内部TBL:仕入先一時
LIT_WK_LF.

* 得意先:取引先機能の抽出
PERFORM GET_CASE_CUST_K
USING CNS_PARVW-CLIENT  "取引先
LIT_WK_LF         "内部TBL:仕入先
CHANGING LIT_WYT3.         "内部TBL:仕入先一時

* 取得した仕入先(取引先機能)
LOOP AT LIT_WYT3 INTO LS_WYT3.
LS_CUST-CORD  = LS_WYT3-LIFNR.  "取引に紐づく仕入先
LS_CUST-LIFNR = LS_WYT3-LIFN2.  "取引先コード
COLLECT LS_CUST INTO PIT_CUST.
ENDLOOP.

* 取得した得意先(取引先機能)
LOOP AT LIT_KNVP INTO LS_KNVP.
LS_CUST-CORD  = LS_KNVP-KUNNR.  "取引に紐づく得意先
LS_CUST-LIFNR = LS_KNVP-LIFNR.  "取引先コード
COLLECT LS_CUST INTO PIT_CUST.
ENDLOOP.

CHECK NOT PIT_CUST IS INITIAL.

* 仕入先情報(会社)
SELECT LIFNR   "仕入先コード
INTAD   "関係会社担当者のｲﾝﾀｰﾈｯﾄｱﾄﾞﾚｽ
INTO TABLE PIT_LFB1
FROM LFB1
FOR ALL ENTRIES IN PIT_CUST
WHERE LIFNR = PIT_CUST-LIFNR
AND BUKRS = CNS_BUKRS_1.

ENDFORM.                    " MAKE_CUSTDATA
*&---------------------------------------------------------------------*
*&      Form  GET_WYT3
*&---------------------------------------------------------------------*
*       text  仕入先の取引先機能の取得
*----------------------------------------------------------------------*
FORM GET_WYT3 CHANGING PIT_WYT3   TYPE T_I_WYT3.

* 仕入先コードを取得
SELECT LIFNR
PARVW
LIFN2
APPENDING TABLE PIT_WYT3
FROM WYT3
WHERE LIFNR IN S_LIFNR
AND EKORG = CNS_EKORG_1
AND ( PARVW = CNS_PARVW-CLIENT
OR    PARVW = CNS_PARVW-AGGREG ).

ENDFORM.                                                    " GET_WYT3
*&---------------------------------------------------------------------*
*&      Form  GET_KNVP
*&---------------------------------------------------------------------*
*       text　得意先コードを取得
*----------------------------------------------------------------------*
FORM GET_KNVP CHANGING PIT_KNVP TYPE T_I_KNVP.

* 得意先コードを取得
SELECT KUNNR
PARVW
KUNN2
LIFNR   "他の仕入先への参照
INTO TABLE PIT_KNVP
FROM KNVP
WHERE KUNNR IN S_KUNNR
AND VKORG = CNS_VKORG_1
AND ( PARVW = CNS_PARVW-CLIENT
OR   PARVW = CNS_PARVW-DEPOSI
OR   PARVW = CNS_PARVW-OFFSET ).

ENDFORM.                    " GET_KNVP
*&---------------------------------------------------------------------*
*&      Form  SPOT_KUNNR
*&---------------------------------------------------------------------*
*       text  対象仕入先/得意先コードの抽出
*----------------------------------------------------------------------*
FORM SPOT_KUNNR USING    PIT_KNVP     TYPE T_I_KNVP
CHANGING PIT_TORI     TYPE T_I_LIFNR
PIT_NYU      TYPE T_I_KUNNR
PIT_SOU      TYPE T_I_LIFNR.

DATA:
LS_KNVP     TYPE T_S_KNVP,
LS_LIFNR    TYPE T_S_LIFNR,
LS_KUNNR    TYPE T_S_KUNNR.

LOOP AT   PIT_KNVP  INTO LS_KNVP.

*   入金先情報
IF P_NYU = CNS_FLG-ON
AND CNS_PARVW-DEPOSI = LS_KNVP-PARVW.

CLEAR LS_KUNNR.
LS_KUNNR-KUNNR = LS_KNVP-KUNN2.
COLLECT LS_KUNNR INTO PIT_NYU.

ENDIF.

*   相殺対象情報
IF P_SOU  = CNS_FLG-ON
AND CNS_PARVW-OFFSET = LS_KNVP-PARVW.

CLEAR LS_LIFNR.
LS_LIFNR-LIFNR = LS_KNVP-LIFNR.
COLLECT LS_LIFNR INTO PIT_SOU.

ENDIF.

*   取引先情報
IF P_TORI = CNS_FLG-ON
AND CNS_PARVW-CLIENT = LS_KNVP-PARVW.

CLEAR LS_LIFNR.
LS_LIFNR-LIFNR = LS_KNVP-LIFNR.
COLLECT LS_LIFNR INTO PIT_TORI.
ENDIF.

ENDLOOP.

ENDFORM.                    " SPOT_KUNNR
*&---------------------------------------------------------------------*
*&      Form  SPOT_LIFNR
*&---------------------------------------------------------------------*
*       text  対象仕入先/得意先コードの抽出
*----------------------------------------------------------------------*
FORM SPOT_LIFNR USING    PIT_WYT3     TYPE T_I_WYT3
CHANGING PIT_TORI     TYPE T_I_LIFNR
PIT_NAYO     TYPE T_I_LIFNR.

DATA:
LS_WYT3     TYPE T_S_WYT3,
LS_LIFNR    TYPE T_S_LIFNR.

LOOP AT PIT_WYT3 INTO LS_WYT3.

*   名寄先情報
IF P_NAYO = CNS_FLG-ON
AND CNS_PARVW-AGGREG = LS_WYT3-PARVW.

CLEAR LS_LIFNR.
LS_LIFNR-LIFNR = LS_WYT3-LIFN2.
COLLECT LS_LIFNR INTO PIT_NAYO.

ENDIF.

*   取引先情報
IF P_TORI = CNS_FLG-ON
AND CNS_PARVW-CLIENT = LS_WYT3-PARVW.

CLEAR LS_LIFNR.
LS_LIFNR-LIFNR = LS_WYT3-LIFN2.
COLLECT LS_LIFNR INTO PIT_TORI.
ENDIF.
ENDLOOP.

ENDFORM.                    " SPOT_LIFNR
*&---------------------------------------------------------------------*
*&      Form  CAE_KUNNR
*&---------------------------------------------------------------------*
*       text  得意先コードの場合
*----------------------------------------------------------------------*
FORM CAE_KUNNR CHANGING  PIT_TORI     TYPE T_I_LIFNR
PIT_NYU      TYPE T_I_KUNNR
PIT_SOU      TYPE T_I_LIFNR.

DATA:
LIT_KNVP     TYPE T_I_KNVP.     "内部TBL:得意先(取引先)

* 得意先コードを取得(初回)
PERFORM GET_KNVP
CHANGING LIT_KNVP.

* 抽出：選択画面のチェックボックスによる
PERFORM SPOT_KUNNR
USING LIT_KNVP
CHANGING PIT_TORI
PIT_NYU
PIT_SOU.

ENDFORM.                    " CAE_KUNNR
*&---------------------------------------------------------------------*
*&      Form  CAE_LIFNR
*&---------------------------------------------------------------------*
*       text  仕入先コードの場合
*----------------------------------------------------------------------*
FORM CAE_LIFNR CHANGING  PIT_TORI     TYPE T_I_LIFNR
PIT_NAYO     TYPE T_I_LIFNR.

DATA:
LIT_WYT3     TYPE T_I_WYT3.     "内部TBL:仕入先(取引先)

* 仕入先コードを取得
PERFORM GET_WYT3
CHANGING LIT_WYT3.

* 抽出：選択画面のチェックボックスによる
PERFORM SPOT_LIFNR
USING LIT_WYT3
CHANGING PIT_TORI
PIT_NAYO.

ENDFORM.                    " CAE_LIFNR
*&---------------------------------------------------------------------*
*&      Form  GET_ZN008
*&---------------------------------------------------------------------*
*       text  規定外マスタ（売上）の得意先取得
*----------------------------------------------------------------------*
FORM GET_ZN008 CHANGING PIT_KUNNR TYPE T_I_KUNNR.

SELECT KUNNR
INTO TABLE PIT_KUNNR
FROM ZN008
WHERE KUNNR IN S_KUNNR.

ENDFORM.                                                    " GET_ZN008
*&---------------------------------------------------------------------*
*&      Form  GET_KNA1
*&---------------------------------------------------------------------*
*       text 標準マスタの得意先取得
*----------------------------------------------------------------------*
FORM GET_KNA1 CHANGING PIT_KUNNR TYPE T_I_KUNNR.

SELECT KUNNR
APPENDING TABLE PIT_KUNNR
FROM KNA1
WHERE KUNNR IN S_KUNNR.

ENDFORM.                                                    " GET_KNA1
*&---------------------------------------------------------------------*
*&      Form  GET_LFA1
*&---------------------------------------------------------------------*
*       text 標準マスタの仕入先取得
*----------------------------------------------------------------------*
FORM GET_LFA1 CHANGING PIT_LIFNR TYPE T_I_LIFNR.

SELECT LIFNR
APPENDING TABLE PIT_LIFNR
FROM LFA1
WHERE LIFNR IN S_LIFNR.

ENDFORM.                                                    " GET_LFA1
*&---------------------------------------------------------------------*
*&      Form  GET_ZN007
*&---------------------------------------------------------------------*
*       text  規定外マスタ（仕入)の得意先取得
*----------------------------------------------------------------------*
FORM GET_ZN007 CHANGING PIT_LIFNR TYPE T_I_LIFNR.

SELECT LIFNR
INTO TABLE PIT_LIFNR
FROM ZN007
WHERE LIFNR IN S_LIFNR.

ENDFORM.                                                    " GET_ZN007

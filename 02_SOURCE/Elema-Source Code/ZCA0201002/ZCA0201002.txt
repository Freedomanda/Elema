*----------------------------------------------------------------------*
*  プログラムＩＤ：  ZCA0201002
*  プログラム名称：  仕入先マスタアップロード
*                    選択画面で指定されたファイルからデータを読み込み、
*                    仕入先マスタの登録/変更を行う。登録/変更の制御は、
*                    制御コードにより行う
*  作    成    者：  IMGジャパン　末永
*  作    成    日：  2010/01/15
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№1
*  変　　更　　者：  IMGジャパン　末永
*  変　　更　　日：  2010/01/15
*  変　更　内　容：　流用元PGM … ZRLFIR9020(Fusion)
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№2
*  変　　更　　者：  IMGジャパン　末永
*  変　　更　　日：  2010/03/31
*  変　更　内　容：　入力ファイルヘッダ行判断ロジック変更
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№3
*  変　　更　　者：  IMGジャパン　末永
*  変　　更　　日：  2010/04/02
*  変　更　内　容：　会社コードデータの勘定コード管理(金利計算)データ削除
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№4
*  変　　更　　者：  IMGジャパン　末永
*  変　　更　　日：  2010/04/02
*  変　更　内　容：　会社コードデータの連絡文書データ項目追加
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№5
*  変　　更　　者：  アグニコンサルティング　吉崎
*  変　　更　　日：  2010/06/22
*  変　更　内　容：　項目削除
*----------------------------------------------------------------------*
*  変　更　番　号：  変更管理№6  (#006)
*  変　　更　　者：  SISCO 朝生（ISID114）
*  変　　更　　日：  2011/02/07
*  変　更　内　容：　権限チェック追加、多言語対応
*&---------------------------------------------------------------------*
*  変　更　番　号：  変更管理№7  (#007)
*  変　　更　　者：  SISCO 朝生（ISID114）
*  変　　更　　日：  2011/02/17
*  変　更　内　容：　購買組織データ更新判定追加
*&---------------------------------------------------------------------*
*  変　更　番　号：  変更管理№8  (#008)
*  変　　更　　者：  SISCO 朝生（ISID114）
*  変　　更　　日：  2011/02/22
*  変　更　内　容：　源泉徴収税追加
*&---------------------------------------------------------------------*
*  変　更　番　号：  変更管理№9  (#009)
*  変　　更　　者：  吉崎 (ISID111）
*  変　　更　　日：  2011/03/30
*  変　更　内　容：　源泉徴収税をカスタマイズにより判定
*&---------------------------------------------------------------------*
*  変　更　番　号：  変更管理№10  (#010)
*  変　　更　　者：  吉崎 (ISID156）
*  変　　更　　日：  2014/09/09
*  変　更　内　容：　権限チェック不具合対応
*&---------------------------------------------------------------------*
*  変　更　番　号：  変更管理№11  (#011)
*  変　　更　　者：  ISID18
*  変　　更　　日：  2014/09/30
*  変　更　内　容：　BDC変更
*&---------------------------------------------------------------------*
REPORT ZCA0201002 NO STANDARD PAGE HEADING
LINE-SIZE  65
LINE-COUNT 80
MESSAGE-ID 00.

*&---------------------------------------------------------------------*
*&  内部テーブル定義
*&---------------------------------------------------------------------*
*-構造(TYPES)
TYPES:
BEGIN OF GTT_BDCDATA,      " バッチインプット用
PROGRAM   TYPE BDCDATA-PROGRAM,    " BDC モジュールプール
DYNPRO    TYPE BDCDATA-DYNPRO,     " BDC Dynpro 番号
DYNBEGIN  TYPE BDCDATA-DYNBEGIN,   " BDC Dynpro 開始
FNAM      TYPE BDCDATA-FNAM,       " 項目名
FVAL      TYPE BDCDATA-FVAL,       " BDC 項目値
END OF GTT_BDCDATA,
BEGIN OF GTT_REC,          " タブ区切りファイルからのデータを格納
FLAG(01)  TYPE C,                  " 制御コード
LIFNR     TYPE RF02K-LIFNR,        " 仕入先コード*
BUKRS     TYPE RF02K-BUKRS,        " 会社コード
EKORG     TYPE RF02K-EKORG,        " 購買組織
KTOKK     TYPE RF02K-KTOKK,        " 勘定グループ
SORTL     TYPE LFA1-SORTL,         " 検索条件
SORTL2    TYPE KNA1-SORTL,         " 検索条件2             "2010/01/21 INSERT
ANRED     TYPE LFA1-ANRED,         " タイトル
NAME1     TYPE LFA1-NAME1,         " 名称１
NAME2     TYPE LFA1-NAME2,         " 名称２
*--------------------------------------------- 2010/01/21 DELETE START
*    NAME3     TYPE LFA1-NAME3,         " 名称３
*    NAME4     TYPE LFA1-NAME4,         " 名称４
*--------------------------------------------- 2010/01/21 DELETE END
STRAS     TYPE LFA1-STRAS,         " 都道府県名 ⇒ 地名/番地-号
*--------------------------------------------- 2010/01/20 INSERT START
HOUSE_NUM1 TYPE ADRC-HOUSE_NUM1,   " 番地・号
HOUSE_NUM2 TYPE ADRC-HOUSE_NUM2,   " 補足
*--------------------------------------------- 2010/01/20 INSERT END
*    PFACH     TYPE LFA1-PFACH,         " 私書箱         "2010/01/15 DELETE
ORT01     TYPE LFA1-ORT01,         " 市区町村名
PSTLZ     TYPE LFA1-PSTLZ,         " 郵便番号
*--------------------------------------------- 2010/01/15 DELETE START
*    ORT02     TYPE LFA1-ORT02,         " 所在地
*    PFORT     TYPE LFA1-PFORT,         " 私書箱所在地
*    PSTL2     TYPE LFA1-PSTL2,         " 私書箱番号
*--------------------------------------------- 2010/01/15 DELETE END
LAND1     TYPE LFA1-LAND1,         " 国コード
REGIO     TYPE LFA1-REGIO,         " 地域 ⇒ 地域コード
*--------------------------------------------- 2010/01/21 INSERT START
TIME_ZONE  TYPE ADRC-TIME_ZONE,    " タイムゾーン
*--------------------------------------------- 2010/06/22 DELETE START
*    TRANSPZONE TYPE ADRC-TRANSPZONE,   " 納入区域
*--------------------------------------------- 2010/06/22 DELETE END
*--------------------------------------------- 2010/01/21 INSERT END
SPRAS     TYPE LFA1-SPRAS,         " 言語選択**
TELF1     TYPE LFA1-TELF1,         " 電話番号１
*--------------------------------------------- 2010/01/21 INSERT START
TEL_EXTENS  TYPE ADRC-TEL_EXTENS,          " 内線(電話)
TMOB_NUMBER TYPE SZA1_D0100-MOB_NUMBER,   " 携帯電話
*--------------------------------------------- 2010/01/21 INSERT END
TELFX     TYPE LFA1-TELFX,         " ファックス番号
FAX_EXTENS  TYPE ADRC-FAX_EXTENS,  " 内線(電話)          "2010/01/21 INSERT
SMTP(241) TYPE C,                  " 電子メール
KUNNR     TYPE LFA1-KUNNR,         " 得意先コード*
VBUND     TYPE LFA1-VBUND,         " 取引先*
KONZS     TYPE LFA1-KONZS,         " グループキー
STCEG     TYPE LFA1-STCEG,         " 消費税登録No    "2010/01/15 INSERT
KTOCK     TYPE LFA1-KTOCK,         " 参照勘定グループ
BANKS     TYPE LFBK-BANKS,         " 銀行国コード
BANKL     TYPE LFBK-BANKL,         " 銀行コード
BANKN     TYPE LFBK-BANKN,         " 銀行口座
KOINH     TYPE LFBK-KOINH,         " 口座名義人
BANKA     TYPE BNKA-BANKA,         " 銀行名
PROVZ     TYPE BNKA-PROVZ,         " 地域
STRAS2    TYPE BNKA-STRAS,         " 都道府県名
ORT012    TYPE BNKA-ORT01,         " 市区町村
BRNCH     TYPE BNKA-BRNCH,         " 支店
BKONT     TYPE LFBK-BKONT,         " 銀行管理キー
*--------------------------------------------- 2010/01/20 INSERT START
LNRZA     TYPE LFA1-LNRZA,         " 代理受取人
DTAMS     TYPE LFA1-DTAMS,         " DME コード
*--------------------------------------------- 2010/01/20 INSERT END
DTAWS     TYPE LFA1-DTAWS,         " 指示キー
AKONT     TYPE LFB1-AKONT,         " 統制勘定コード*
FDGRV     TYPE LFB1-FDGRV,         " 資金管理グループ*
*--------------------------------------------- 2010/06/22 DELETE START
*    LNRZE     TYPE LFB1-LNRZE,         " 本店勘定コード*
*--------------------------------------------- 2010/06/22 DELETE END
ZUAWA     TYPE LFB1-ZUAWA,         " ソートキー
*--------------------------------------------- 2010/01/20 INSERT START
*--------------------------------------------- 2010/04/02 DELETE START
*    VZSKZ     TYPE LFB1-VZSKZ,         " 金利フラグ
*    ZINDT     TYPE LFB1-ZINDT,         " 最終基準日
*    ZINRT     TYPE LFB1-ZINRT,         " 利払頻度
*    DATLZ     TYPE LFB1-DATLZ,         " 最終金利実行
*--------------------------------------------- 2010/04/02 DELETE END
ALTKN     TYPE LFB1-ALTKN,         " 旧勘定コード
*--------------------------------------------- 2010/01/20 INSERT END
*--------------------------------------------- 2010/01/15 DELETE START
*    WITHT     TYPE LFBW-WITHT,         " （拡張源泉）源泉徴収税タイプ
*    WITHCD    TYPE LFBW-WT_WITHCD,     " （拡張源泉）源泉徴収税Cd
*--------------------------------------------- 2010/01/15 DELETE END
ZTERM     TYPE LFB1-ZTERM,         " 支払条件
TOGRU     TYPE LFB1-TOGRU,         " 許容グループ
*    REPRF     TYPE LFB1-REPRF,         " 二重請求確認    "2010/01/15 DELETE
*--------------------------------------------- 2010/01/21 INSERT START
GUZTE     TYPE LFB1-GUZTE,         " Credit Memo条件
KULTG(3)  TYPE C,                  " 現金化期間
*--------------------------------------------- 2010/01/21 INSERT END
ZWELS     TYPE LFB1-ZWELS,         " 支払方法
XVERR     TYPE LFB1-XVERR,         " 得意先との決済
ZAHLS     TYPE LFB1-ZAHLS,         " 支払保留キー
LNRZB     TYPE LFB1-LNRZB,         " 代理受取人勘定*
HBKID     TYPE LFB1-HBKID,         " 取引銀行ID
*--------------------------------------------- 2010/01/21 INSERT START
XPORE     TYPE LFB1-XPORE,         " 個別支払
ZGRUP     TYPE LFB1-ZGRUP,         " グループキー
*--------------------------------------------- 2010/01/21 INSERT END
XEDIP     TYPE LFB1-XEDIP,         " EDI支払明細書     "2010/01/15 INSERT
*--------------------------------------------- 2010/04/02 UPDATE START
*--------------------------------------------- 2010/01/15 DELETE START
BUSAB     TYPE LFB1-BUSAB,         " 記帳担当者
EIKTO     TYPE LFB1-EIKTO,         " 自社コード
*--------------------------------------------- 2010/01/15 DELETE END
*--------------------------------------------- 2010/04/02 UPDATE END
ZSABE     TYPE LFB1-ZSABE,         " 仕入先担当者
TLFNS     TYPE LFB1-TLFNS,         " 記帳担当電話No.  "2010/01/15 INSERT
TLFXS     TYPE LFB1-TLFXS,         " 経理担当者Fax
INTAD     TYPE LFB1-INTAD,         " 担当者インターネット
KVERM     TYPE LFB1-KVERM,         " コメント
WAERS     TYPE LFM1-WAERS,         " 購買発注通貨
ZTERM2    TYPE LFM1-ZTERM,         " 支払条件
*--------------------------------------------- 2010/01/15 INSERT START
INCO1       TYPE LFM1-INCO1,       " インコタームズ１
INCO2       TYPE LFM1-INCO2,       " インコタームズ２
MINBW(16)   TYPE C,                " 最低発注金額
KALSK       TYPE LFM1-KALSK,       " 決定表Group(仕入先)
MEPRF       TYPE LFM1-MEPRF,       " 価格設定日制御
*--------------------------------------------- 2010/01/15 INSERT END
WEBRE     TYPE LFM1-WEBRE,         " 入庫基準の請求書照合
LFABC     TYPE LFM1-LFABC,         " ABC 区分         "2010/01/15 INSERT
XERSY     TYPE LFM1-XERSY,         " ERS  入庫
*--------------------------------------------- 2010/01/15 INSERT START
XERSR     TYPE LFM1-XERSR,         " ERS　返品
KZABS     TYPE LFM1-KZABS,         " 購買発注請書依頼
*--------------------------------------------- 2010/01/15 INSERT END
KZAUT     TYPE LFM1-KZAUT,         " 自動購買発注
*--------------------------------------------- 2010/01/15 INSERT START
*--------------------------------------------- 2010/06/22 DELETE START
*    PAPRF     TYPE LFM1-PAPRF,         " PROACT 管理 Prof.
*    XNBWY     TYPE LFM1-XNBWY,         " 再評価可能
*--------------------------------------------- 2010/06/22 DELETE END
NRGEW     TYPE LFM1-NRGEW,         " 無償納入許可
*--------------------------------------------- 2010/06/22 DELETE START
*    LEBRE     TYPE LFM1-LEBRE,         " Serv. 基準請求書照合
*--------------------------------------------- 2010/06/22 DELETE END
VSBED     TYPE LFM1-VSBED,         " 出荷条件
*--------------------------------------------- 2010/01/15 INSERT END
* #008 ADD 20110222 ISID144 START
QLAND     TYPE LFB1-QLAND,         "源泉徴収税国
WITHT     TYPE LFBW-WITHT,         "源泉徴収税タイプコード
WITHCD    TYPE LFBW-WT_WITHCD,     "源泉徴収税コード
SUBJCT    TYPE LFBW-WT_SUBJCT,     "フラグ: 源泉税課税対象
QSREC     TYPE LFBW-QSREC,         "受領タイプ
WTSTCD    TYPE LFBW-WT_WTSTCD,     "源泉徴収税 ID 番号
EXNR      TYPE LFBW-WT_EXNR,       "免除証明番号
EXRT(6)   TYPE C,                  "免除レート
WTEXRS    TYPE LFBW-WT_WTEXRS,     "免除理由
EXDF      TYPE LFBW-WT_EXDF,       "免除開始日
EXDT      TYPE LFBW-WT_EXDT,       "免除終了日
* #008 ADD 20110222 ISID144 END

END OF GTT_REC,
*--------------------------------------------- 2010/01/20 INSERT START
BEGIN OF GTT_ZCAT_MA001,
NAME      TYPE ZCAT_MA001-NAME,    " アドオン変数名
KEY01     TYPE ZCAT_MA001-KEY01,   " 検索キー１
LOW       TYPE ZCAT_MA001-LOW,     " ABAP: 選択値 (LOW)
END OF GTT_ZCAT_MA001.
*--------------------------------------------- 2010/01/20 INSERT END

DATA:
*-内部テーブル
* バッチインプット用内部テーブル
GDT_BDC    TYPE STANDARD TABLE OF GTT_BDCDATA,
* タブ区切りファイルからのデータを格納する内部テーブル
GDT_REC    TYPE STANDARD TABLE OF GTT_REC,
*-ヘッダ行
GDS_BDC    LIKE LINE OF GDT_BDC,
GDS_REC    LIKE LINE OF GDT_REC,
*--------------------------------------------- 2010/01/20 INSERT START
*-アドオン変数管理テーブル情報格納用
GDT_ZCAT_MA001 TYPE STANDARD TABLE OF GTT_ZCAT_MA001,
GDS_ZCAT_MA001 TYPE GTT_ZCAT_MA001.
*--------------------------------------------- 2010/01/20 INSERT END

*&---------------------------------------------------------------------*
*&  項目定義
*&---------------------------------------------------------------------*
DATA:
*-変数
WA_TCODE         TYPE SY-TCODE,               " トランザクションコード
WA_LIFNR         TYPE LFA1-LIFNR,             " 判断用仕入先コード
WA_LIFNRC(10)    TYPE C,                      " 変換後の仕入先コード
WA_BANKS         TYPE BDCDATA-FNAM,           " 銀行国コード
WA_BANKL         TYPE BDCDATA-FNAM,           " 銀行コード
WA_BANKN         TYPE BDCDATA-FNAM,           " 銀行口座
WA_KOINH         TYPE BDCDATA-FNAM,           " 口座名義人
WA_BKONT         TYPE BDCDATA-FNAM,           " 銀行管理キー
WA_SPLIT         TYPE C,                      " 区切りコード
*--------------------------------------------- 2010/01/20 INSERT START
WA_KTOKD_CR      TYPE KNA1-KTOKD,            " 運送業者勘定グループ
WA_KTOKD_FI      TYPE KNA1-KTOKD,            " FI用勘定グループ
*--------------------------------------------- 2010/01/20 INSERT END
*-フラグ
FLG_DATA(01)     TYPE C,                      " データがあるなしのフラグ
FLG_ERR(01)      TYPE C,                      " エラーフラグ
*-カウンタ
CNT_BANK(02)     TYPE N,                      " 銀行情報行数
CNT_INDEX        TYPE I.                      " 処理件数
*  CNT_LINE         TYPE I VALUE '3'.            " ヘッダ2行スキップ用     "2010/03/31 DELETE
*-定数
CONSTANTS:
GCF_CHK(01)      TYPE C VALUE 'X',             " チェック
GCF_SPC(01)      TYPE C VALUE ' ',             " スペース
GCF_TYPE(10)     TYPE C VALUE 'ASC',           " タブ区切りFILE
GCF_CTRU(01)     TYPE C VALUE 'U',             " 制御コード(Ｕ=変更)
GCF_CTRN(01)     TYPE C VALUE 'N',             " 制御コード(Ｎ=登録)
GCF_XK01(04)     TYPE C VALUE 'XK01',          " 仕入先コード登録
GCF_XK02(04)     TYPE C VALUE 'XK02',          " 仕入先コード変更
GCF_LVL1(01)     TYPE C VALUE '1',             " 登録レベル(登録済)
GCF_LVL2(01)     TYPE C VALUE '2',             " 登録レベル(未登録)
*  GCF_JP(02)       TYPE C VALUE 'JP',            " 国コード         "2010/01/15 DELETE
GCF_BANKS(11)    TYPE C VALUE 'LFBK-BANKS(',   " 銀行国コード
GCF_BANKL(11)    TYPE C VALUE 'LFBK-BANKL(',   " 銀行コード
GCF_BANKN(11)    TYPE C VALUE 'LFBK-BANKN(',   " 銀行口座
GCF_KOINH(11)    TYPE C VALUE 'LFBK-KOINH(',   " 口座名義人
GCF_BKONT(11)    TYPE C VALUE 'LFBK-BKONT(',   " 銀行管理キー
GCF_END(01)      TYPE C VALUE ')',             " 終了カッコ
GCF_PGM(08)      TYPE C VALUE 'SAPMF02K',      " プログラムID
GCF_BPGM(08)     TYPE C VALUE 'SAPLBANK',      " プログラムID
GCF_0100(04)     TYPE C VALUE '0100',          " 画面番号(第一画面/登録)
GCF_0101(04)     TYPE C VALUE '0101',          " 画面番号(第一画面/変更)
GCF_0111(04)     TYPE C VALUE '0111',          " 画面番号(住所)
GCF_0120(04)     TYPE C VALUE '0120',          " 画面番号(管理)
GCF_0130(04)     TYPE C VALUE '0130',          " 画面番号(支払処理)
GCF_0210(04)     TYPE C VALUE '0210',          " 画面番号(会計情報)
GCF_0215(04)     TYPE C VALUE '0215',          " 画面番号(支払処理)
GCF_0220(04)     TYPE C VALUE '0220',          " 画面番号(連絡文書)
*--------------------------------------------- 2010/01/15 DELETE START
*  GCF_0380(04)     TYPE C VALUE '0380',          " 画面番号(問合せ先)
*  GCF_0610(04)     TYPE C VALUE '0610',          " 画面番号(拡張源泉)
*--------------------------------------------- 2010/01/15 DELETE END
GCF_0310(04)     TYPE C VALUE '0310',          " 画面番号(購買データ)    "2010/01/15 INSERT
**** START ADD 2014/09/30 ISID18 ****
GCF_0320(04)     TYPE C VALUE '0320',          " 画面番号(取引先機能)
**** END ADD 2014/09/30 ISID18 ****
GCF_ENTR(04)     TYPE C VALUE 'ENTR',          " OKコード(ENTER)
GCF_10C(04)      TYPE C VALUE '$1OC',          " 名称枠の拡張
GCF_20C(04)      TYPE C VALUE '$2OC',          " 住所枠の拡張
GCF_30C(04)      TYPE C VALUE '$3OC',          " 私書箱アドレス枠の拡張
GCF_VW(02)       TYPE C VALUE 'VW',            " OKコード(次画面)
GCF_BANK(04)     TYPE C VALUE 'BANK',          " OKコード(銀行)
GCF_UPDA(05)     TYPE C VALUE '=UPDA',         " OKコード(保存)
* #008 ADD 20110222 ISID144 START
GCF_0610(04)     TYPE C VALUE '0610',          " 画面番号(拡張源泉)
GCF_QLAND(10)    TYPE C VALUE 'LFB1-QLAND',
GCF_WITHT(14)    TYPE C VALUE 'LFBW-WITHT(01)',
GCF_WITHCD(18)   TYPE C VALUE 'LFBW-WT_WITHCD(01)',
GCF_SUBJCT(18)   TYPE C VALUE 'LFBW-WT_SUBJCT(01)',
GCF_QSREC(14)    TYPE C VALUE 'LFBW-QSREC(01)',
GCF_WTSTCD(18)   TYPE C VALUE 'LFBW-WT_WTSTCD(01)',
GCF_EXNR(16)     TYPE C VALUE 'LFBW-WT_EXNR(01)',
GCF_EXRT(16)     TYPE C VALUE 'LFBW-WT_EXRT(01)',
GCF_WTEXRS(18)   TYPE C VALUE 'LFBW-WT_WTEXRS(01)',
GCF_EXDF(16)     TYPE C VALUE 'LFBW-WT_EXDF(01)',
GCF_EXDT(16)     TYPE C VALUE 'LFBW-WT_EXDT(01)',
* #008 ADD 20110222 ISID144 END
* #006 DEL 20110207 ISID144 START
*  GCF_LA_J(01)     TYPE C VALUE 'J',             " 言語キー(日本語)
*  GCF_LA_1(01)     TYPE C VALUE '1',             " 言語キー(中国語)
*  GCF_LA_E(01)     TYPE C VALUE 'E',             " 言語キー(英語)
*  GCF_TITLE_1      TYPE SYTITLE                  " タイトル(中国語)
*                   VALUE '供#商住数据上#',
*  GCF_TITLE_E      TYPE SYTITLE                  " タイトル(英語)
*                   VALUE 'Upload the vender master records', "#EC NOTEXT
*  GCF_JTXT         TYPE STRING
*                   VALUE 'ファイルの保存場所を選択してください',
*  GCF_CTXT(20)     TYPE C VALUE '###文件所在的位置',
*  GCF_ETXT(28)     TYPE C VALUE 'Select the location for file', "#EC NOTEXT
*  GCF_TXT1J(10)    TYPE C VALUE 'ファイル名',
*  GCF_TXT1C(06)    TYPE C VALUE '文件名',
*  GCF_TXT1E(09)    TYPE C VALUE 'File Name',                "#EC NOTEXT
*  GCF_TXT2J(6)     TYPE C VALUE 'サーバ',
*  GCF_TXT2C(6)     TYPE C VALUE '服#器',
*  GCF_TXT2E(6)     TYPE C VALUE 'Server',                   "#EC NOTEXT
*  GCF_TXT3J(8)     TYPE C VALUE 'ローカル',
*  GCF_TXT3C(4)     TYPE C VALUE '本地',
*  GCF_TXT3E(5)     TYPE C VALUE 'Local',                    "#EC NOTEXT
*  GCF_TXT4J(24)    TYPE C VALUE 'ファイルが存在しません。',
*  GCF_TXT4C(10)    TYPE C VALUE '文件不存在',
*  GCF_TXT4E(20)    TYPE C VALUE 'File does not exist.',     "#EC NOTEXT
*  GCF_TXT5J(28)    TYPE C VALUE 'FILE OPEN 異常終了    例外：',
*  GCF_TXT5C(28)    TYPE C VALUE 'FILE OPEN #生##    代#：',
*  GCF_TXT5E(45)    TYPE C
*          VALUE 'Error during file open processing. Exception:', "#EC NOTEXT
*  GCF_TXT6J(40)    TYPE C VALUE 'タブ区切りファイルにデータが存在しません',
*  GCF_TXT6C(25)    TYPE C VALUE 'TAB#隔文本文件中没有数据',
*  GCF_TXT6E(18)    TYPE C VALUE 'TAB file is empty.',       "#EC NOTEXT
*  GCF_TXT7J(25)    TYPE C VALUE 'UPLOAD 異常終了    例外：',
*  GCF_TXT7C(25)    TYPE C VALUE 'UPLOAD #生##    代#：',
*  GCF_TXT7E(42)    TYPE C
*          VALUE 'Error during upload processing. Exception:', "#EC NOTEXT
*  GCF_TXT8J(25)    TYPE C VALUE 'BDC_OPEN 異常終了　例外：',
*  GCF_TXT8C(25)    TYPE C VALUE 'BDC_OPEN #生##  代#：',
*  GCF_TXT8E(44)    TYPE C
*          VALUE 'Error during BDC_OPEN processing. Exception:', "#EC NOTEXT
*  GCF_TXT9J(27)    TYPE C VALUE 'BDC_INSERT 異常終了　例外：',
*  GCF_TXT9C(27)    TYPE C VALUE 'BDC_INSERT #生##　代#：',
*  GCF_TXT9E(46)    TYPE C
*          VALUE 'Error during BDC_INSERT processing. Exception:', "#EC NOTEXT
*  GCF_TXT10J(26)   TYPE C VALUE 'BDC_CLOSE 異常終了　例外：',
*  GCF_TXT10C(26)   TYPE C VALUE 'BDC_CLOSE #生##　代#：',
*  GCF_TXT10E(45)   TYPE C
*          VALUE 'Error during BDC_CLOSE processing. Exception:', "#EC NOTEXT
*  GCF_TXT11J(32)   TYPE C VALUE 'セッションログを確認してください',
*  GCF_TXT11C(24)   TYPE C VALUE '###批#入会##理##',
*  GCF_TXT11E(26)   TYPE C VALUE 'Check the logs of session.', "#EC NOTEXT
* #006 DEL 20110207 ISID144 END
*--------------------------------------------- 2010/01/20 INSERT START
GCF_KTOKK(5)      TYPE C VALUE 'KTOKK',
GCF_CR(2)         TYPE C VALUE 'CR',
GCF_FI(2)         TYPE C VALUE 'FI'.
*--------------------------------------------- 2010/01/20 INSERT END

*----------------------------------------------------------------------*
*&  入力パラメータ
*&---------------------------------------------------------------------*
* ファイル名
SELECTION-SCREEN BEGIN OF LINE.
* #006 MOD 20110207 ISID144 START
*SELECTION-SCREEN COMMENT 1(20) NAME_F FOR FIELD P_FILENM.
SELECTION-SCREEN COMMENT 1(20) TEXT-002 FOR FIELD P_FILENM.
* #006 MOD 20110207 ISID144 END
PARAMETERS:
P_FILENM TYPE RLGRAP-FILENAME OBLIGATORY.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN SKIP 1.
* ファイルの保存場所を選択
* #006 MOD 20110207 ISID144 START
*SELECTION-SCREEN BEGIN OF BLOCK SAVE WITH FRAME TITLE TEXT_1.
SELECTION-SCREEN BEGIN OF BLOCK SAVE WITH FRAME TITLE TEXT-001.
* #006 MOD 20110207 ISID144 END
* サーバ
SELECTION-SCREEN BEGIN OF LINE.
* #002 MOD 20110202 ISID144 START
*SELECTION-SCREEN COMMENT 1(10) NAME_S FOR FIELD P_SERVER.
SELECTION-SCREEN COMMENT 1(10) TEXT-003 FOR FIELD P_SERVER.
* #002 MOD 20110202 ISID144 END
SELECTION-SCREEN POSITION 20.
PARAMETERS:
P_SERVER RADIOBUTTON GROUP SAVE.
SELECTION-SCREEN END OF LINE.
* ローカル
SELECTION-SCREEN BEGIN OF LINE.
* #002 MOD 20110202 ISID144 START
*SELECTION-SCREEN COMMENT 1(10) NAME_L FOR FIELD P_LOCAL.
SELECTION-SCREEN COMMENT 1(10) TEXT-004 FOR FIELD P_LOCAL.
* #002 MOD 20110202 ISID144 END
SELECTION-SCREEN POSITION 20.
PARAMETERS:
P_LOCAL RADIOBUTTON GROUP SAVE DEFAULT 'X'.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN END OF BLOCK SAVE.

*&---------------------------------------------------------------------*
*&  初期処理
*&---------------------------------------------------------------------*
INITIALIZATION.

* #006 DEL 20110207 ISID144 START
** プログラム表題の設定
*  PERFORM FRM_SET_TITLE.
*
** 選択テキストの設定
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.                     " 日本語
*      TEXT_1 = GCF_JTXT.               "'ファイルの保存場所を選択してください'
*      NAME_F = GCF_TXT1J.              "'ファイル名'
*      NAME_S = GCF_TXT2J.              "'サーバ'
*      NAME_L = GCF_TXT3J.              "'ローカル'
*    WHEN GCF_LA_1.                     " 中国語
*      TEXT_1 = GCF_CTXT.               "'###文件所在的位置'
*      NAME_F = GCF_TXT1C.              "'文件名'
*      NAME_S = GCF_TXT2C.              "'服#器'
*      NAME_L = GCF_TXT3C.              "'本地'
*    WHEN GCF_LA_E.                     " 英語
*      TEXT_1 = GCF_ETXT.               "'Select the location for file'
*      NAME_F = GCF_TXT1E.              "'File Name'
*      NAME_S = GCF_TXT2E.              "'Server'
*      NAME_L = GCF_TXT3E.              "'Local'
*  ENDCASE.
* #006 DEL 20110207 ISID144 END
*&---------------------------------------------------------------------*
*&  入力チェック処理
*&---------------------------------------------------------------------*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR P_FILENM.  " ファイル名の取得
PERFORM FRM_FILENAME_GET CHANGING P_FILENM.

AT SELECTION-SCREEN.                   " ファイルの存在をチェック
PERFORM FRM_PATGDS_CHK USING P_FILENM.

*&---------------------------------------------------------------------*
*&  メイン処理
*&---------------------------------------------------------------------*
START-OF-SELECTION.
PERFORM: FRM_INIT_ALL,                      " 作業領域初期化
FRM_UPLOAD_DATA,                   " ファイルアップロード
FRM_CHECK_DATA,                    " 件数チェック
* #006 ADD 20110207 ISID144 START
FRM_INPUT_CHECK,                   " 入力チェック
* #006 ADD 20110207 ISID144 END
*--------------------------------------------- 2010/01/20 INSERT START
FRM_SELECT_ZCAT_MA001,             " アドオン変数管理テーブル検索
*--------------------------------------------- 2010/01/20 INSERT END
FRM_BDC_OPEN.                      " BDCセッションを開く

CLEAR:CNT_INDEX.
*--------------------------------------------- 2010/03/31 UPDATE START
*  LOOP AT GDT_REC INTO GDS_REC FROM CNT_LINE.
LOOP AT GDT_REC INTO GDS_REC
WHERE FLAG = GCF_CTRN   " N
OR FLAG = GCF_CTRU . " U
*--------------------------------------------- 2010/03/31 UPDATE END
CLEAR:GDT_BDC,FLG_DATA,FLG_ERR,WA_TCODE, WA_KTOKD_CR, WA_KTOKD_FI. "2010/01/20 MODIFY
PERFORM:
FRM_SET_BDCDATA,                 " BDCデータのセット
FRM_BDC_INSERT.                  " データをBDCセッションに挿入
WA_LIFNR = GDS_REC-LIFNR.
ENDLOOP.
PERFORM:
FRM_BDC_CLOSE,                     " セッションを閉じる
FRM_CALL_RSBDCSUB.                 " セッションの自動処理

*&---------------------------------------------------------------------*
*&  終了処理
*&---------------------------------------------------------------------*
END-OF-SELECTION.

* #006 MOD 20110207 ISID144 START
** プログラム表題の設定
*  PERFORM FRM_SET_TITLE.
*
***--処理件数出力
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.        " 日本語
*      WRITE:
*        / '**************** < 仕入先マスタ取り込み > ****************',
*        / '*  処理件数                     ＝ ' ,  CNT_INDEX,
*        / '**********************************************************'.
*
*    WHEN GCF_LA_1.        " 中国語
*      WRITE:
*        / '****************** < 供#商住数据#取 > ******************',
*        / '*  #理件数                     ＝ ' ,  CNT_INDEX,
*        / '**********************************************************'.
*
*    WHEN GCF_LA_E.        " 英語
*      WRITE:
*        / '************* < Take the vender in master > **************',
*        / '*  The number of processes      ＝ ' ,  CNT_INDEX,
*        / '**********************************************************'.
*  ENDCASE.

* プログラム処理件数表示
PERFORM FRM_WRITE_RESULT.

* #006 MOD 20110207 ISID144 END

*&---------------------------------------------------------------------*
*&      Form  FRM_PATGDS_CHK
*&---------------------------------------------------------------------*
*       ファイルの存在をチェック
*----------------------------------------------------------------------*
*      -->P_IPATH   入力ファイル名
*----------------------------------------------------------------------*
FORM FRM_PATGDS_CHK USING    P_IPATH.

CHECK P_LOCAL = GCF_CHK.        " ローカルファイルのときのみ実行する
DATA:LDF_FILE      TYPE STRING,         " ファイル名
LDF_RESULT    TYPE C.              " 結果
*       LDF_MSGV1(50) TYPE C.              " メッセージ変数１ "#006 DEL

LDF_FILE = P_IPATH.
CALL METHOD CL_GUI_FRONTEND_SERVICES=>FILE_EXIST
EXPORTING
FILE                 = LDF_FILE
RECEIVING
RESULT               = LDF_RESULT
EXCEPTIONS
CNTL_ERROR           = 1
ERROR_NO_GUI         = 2
WRONG_PARAMETER      = 3
NOT_SUPPORTED_BY_GUI = 4
OTHERS               = 5.
CASE SY-SUBRC.
WHEN 0.
* ファイルが存在する＝X／存在しない＝スペース
IF LDF_RESULT = GCF_SPC.
* #006 MOD 20110207 ISID144 START
**       メッセージ変数のセット
*        CASE SY-LANGU.
*          WHEN GCF_LA_J.                     " 日本語
*            LDF_MSGV1 = GCF_TXT4J.           "'ファイルが存在しません。'
*          WHEN GCF_LA_1.                     " 中国語
*            LDF_MSGV1 = GCF_TXT4C.           "'文件不存在'
*          WHEN GCF_LA_E.                     " 英語
*            LDF_MSGV1 = GCF_TXT4E.           "'File does not exist.'
*        ENDCASE.
*        MESSAGE E398 WITH LDF_MSGV1 SPACE SPACE SPACE.
MESSAGE E014(ZFI001).
* #006 MOD 20110207 ISID144 END
ENDIF.
WHEN OTHERS.
ENDCASE.

ENDFORM.                    " FRM_PATGDS_CHK

*&---------------------------------------------------------------------*
*&      Form  FRM_FILENAME_GET
*&---------------------------------------------------------------------*
*       ファイル名の取得
*----------------------------------------------------------------------*
*      <--P_IOPATH  ファイル名
*----------------------------------------------------------------------*
FORM FRM_FILENAME_GET  CHANGING P_IOPATH.

DATA:LDF_FILE  TYPE FILETABLE,       " ファイル名一覧格納
LDF_HFILE LIKE LINE OF LDF_FILE," ヘッダ
LDF_RC    TYPE I,               " 結果
LDF_TITLE TYPE STRING.          " WINDOW TITLE

* WINDOW_TITLEの設定
* #006 MOD 20110207 ISID144 START
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.                     " 日本語
*      LDF_TITLE = GCF_TXT1J.           "'ファイル名'
*    WHEN GCF_LA_1.                     " 中国語
*      LDF_TITLE = GCF_TXT1C.           "'文件名'
*    WHEN GCF_LA_E.                     " 英語
*      LDF_TITLE = GCF_TXT1E.           "'File Name'
*  ENDCASE.
LDF_TITLE = TEXT-002.
* #006 MOD 20110207 ISID144 END
CALL METHOD CL_GUI_FRONTEND_SERVICES=>FILE_OPEN_DIALOG
EXPORTING
WINDOW_TITLE            = LDF_TITLE
CHANGING
FILE_TABLE              = LDF_FILE
RC                      = LDF_RC
EXCEPTIONS
FILE_OPEN_DIALOG_FAILED = 1
CNTL_ERROR              = 2
ERROR_NO_GUI            = 3
NOT_SUPPORTED_BY_GUI    = 4
OTHERS                  = 5.
CASE SY-SUBRC.
WHEN 0.
IF LDF_RC < 0.
ELSE.
READ TABLE LDF_FILE INTO LDF_HFILE INDEX 1.
P_IOPATH = LDF_HFILE-FILENAME.
ENDIF.
WHEN OTHERS.
ENDCASE.

ENDFORM.                    " FRM_FILENAME_GET

*&---------------------------------------------------------------------*
*&      Form  FRM_INIT_ALL
*&---------------------------------------------------------------------*
*       作業領域初期化
*----------------------------------------------------------------------*
FORM FRM_INIT_ALL .
CLEAR:
GDT_BDC,GDS_BDC,
GDT_REC,GDS_REC,
WA_TCODE,WA_LIFNR,FLG_ERR,CNT_INDEX.
ENDFORM.                    " FRM_INIT_ALL

*&---------------------------------------------------------------------*
*&      Form  FRM_UPLOAD_DATA
*&---------------------------------------------------------------------*
*       ファイルのアップロード
*----------------------------------------------------------------------*
FORM FRM_UPLOAD_DATA.
* ファイルの保存場所によってアップロード方法を変える
IF P_SERVER = GCF_CHK.
PERFORM:
FRM_UPLOAD_SERVER_DATA.          " サーバからデータをUL
ELSEIF P_LOCAL = GCF_CHK.
PERFORM:
FRM_UPLOAD_LOCAL_DATA.           " ローカルからデータをUL
ENDIF.
ENDFORM.                    " FRM_UPLOAD_DATA

*&---------------------------------------------------------------------*
*&      Form  FRM_UPLOAD_SERVER_DATA
*&---------------------------------------------------------------------*
*       入力ファイルデータをアップロードする(サーバ)
*----------------------------------------------------------------------*
FORM FRM_UPLOAD_SERVER_DATA .
DATA:LDF_CNT        TYPE I,                  " データ件数
LDF_DATA(5000) TYPE C.
*       LDF_MSGV1(50)  TYPE C.                  " メッセージ変数１

* 区切りコードにTABを設定
WA_SPLIT = CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB.

* ファイルオープン(UNIX FILE)
OPEN DATASET P_FILENM FOR INPUT IN TEXT MODE ENCODING DEFAULT.  " ENT
CASE SY-SUBRC.
WHEN 0.
WHEN 8.
* #006 MOD 20110207 ISID144 START
**     メッセージ変数のセット
*      CASE SY-LANGU.
*        WHEN GCF_LA_J.                     " 日本語
*          LDF_MSGV1 = GCF_TXT5J.           "'FILE OPEN 異常終了    例外：'
*        WHEN GCF_LA_1.                     " 中国語
*          LDF_MSGV1 = GCF_TXT5C.           "'FILE OPEN #生##    代#：'
*        WHEN GCF_LA_E.                     " 英語
*          LDF_MSGV1 = GCF_TXT5E.
*          "'Error during file open processing. Exception:'
*      ENDCASE.
*      MESSAGE E398 WITH LDF_MSGV1 SY-SUBRC SPACE SPACE.
MESSAGE S052(ZFI001)
WITH SY-SUBRC
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDCASE.
* 入力ファイル読込
DO.
CLEAR:GDS_REC,LDF_DATA.
READ DATASET P_FILENM INTO LDF_DATA.
IF SY-SUBRC <> 0.
EXIT.
ENDIF.
SPLIT LDF_DATA AT WA_SPLIT INTO
GDS_REC-FLAG
GDS_REC-LIFNR
GDS_REC-BUKRS
GDS_REC-EKORG
GDS_REC-KTOKK
GDS_REC-SORTL
GDS_REC-SORTL2                      "2010/01/21 INSERT
GDS_REC-ANRED
GDS_REC-NAME1
GDS_REC-NAME2
*--------------------------------------------- 2010/01/21 DELETE START
*          GDS_REC-NAME3
*          GDS_REC-NAME4
*--------------------------------------------- 2010/01/21 DELETE END
GDS_REC-STRAS
*--------------------------------------------- 2010/01/21 INSERT START
GDS_REC-HOUSE_NUM1
GDS_REC-HOUSE_NUM2
*--------------------------------------------- 2010/01/21 INSERT END
*          GDS_REC-PFACH                      "2010/01/15 DELETE
GDS_REC-ORT01
GDS_REC-PSTLZ
*--------------------------------------------- 2010/01/15 DELETE START
*          GDS_REC-ORT02
*          GDS_REC-PFORT
*          GDS_REC-PSTL2
*--------------------------------------------- 2010/01/15 DELETE END
GDS_REC-LAND1
GDS_REC-REGIO
*--------------------------------------------- 2010/01/21 INSERT START
GDS_REC-TIME_ZONE
*--------------------------------------------- 2010/06/22 DELETE START
*          GDS_REC-TRANSPZONE
*--------------------------------------------- 2010/06/22 DELETE END
*--------------------------------------------- 2010/01/21 INSERT END
GDS_REC-SPRAS
GDS_REC-TELF1
*--------------------------------------------- 2010/01/21 INSERT START
GDS_REC-TEL_EXTENS
GDS_REC-TMOB_NUMBER
*--------------------------------------------- 2010/01/21 INSERT END
GDS_REC-TELFX
GDS_REC-FAX_EXTENS                  "2010/01/21 INSERT
GDS_REC-SMTP
GDS_REC-KUNNR
GDS_REC-VBUND
GDS_REC-KONZS
GDS_REC-STCEG                       "2010/01/15 INSERT
GDS_REC-KTOCK
GDS_REC-BANKS
GDS_REC-BANKL
GDS_REC-BANKN
GDS_REC-KOINH
GDS_REC-BANKA
GDS_REC-PROVZ
GDS_REC-STRAS2
GDS_REC-ORT012
GDS_REC-BRNCH
GDS_REC-BKONT
*--------------------------------------------- 2010/01/20 INSERT START
GDS_REC-LNRZA
GDS_REC-DTAMS
*--------------------------------------------- 2010/01/20 INSERT END
GDS_REC-DTAWS
GDS_REC-AKONT
GDS_REC-FDGRV
*--------------------------------------------- 2010/06/22 DELETE START
*          GDS_REC-LNRZE
*--------------------------------------------- 2010/06/22 DELETE END
GDS_REC-ZUAWA
*--------------------------------------------- 2010/01/20 INSERT START
*--------------------------------------------- 2010/04/02 DELETE START
*          GDS_REC-VZSKZ
*          GDS_REC-ZINDT
*          GDS_REC-ZINRT
*          GDS_REC-DATLZ
*--------------------------------------------- 2010/04/02 DELETE END
GDS_REC-ALTKN
*--------------------------------------------- 2010/01/20 INSERT END
*--------------------------------------------- 2010/01/15 DELETE START
*          GDS_REC-WITHT
*          GDS_REC-WITHCD
*--------------------------------------------- 2010/01/15 DELETE END
GDS_REC-ZTERM
GDS_REC-TOGRU
GDS_REC-GUZTE                       "2010/01/21 INSERT
*          GDS_REC-REPRF                      "2010/01/15 DELETE
GDS_REC-KULTG                       "2010/01/15 INSERT
GDS_REC-ZWELS
GDS_REC-XVERR
GDS_REC-ZAHLS
GDS_REC-LNRZB
GDS_REC-HBKID
*--------------------------------------------- 2010/01/21 INSERT START
GDS_REC-XPORE
GDS_REC-ZGRUP
GDS_REC-XEDIP
*--------------------------------------------- 2010/01/21 INSERT END
*--------------------------------------------- 2010/04/02 UPDATE START
*--------------------------------------------- 2010/01/15 DELETE START
GDS_REC-BUSAB
GDS_REC-EIKTO
*--------------------------------------------- 2010/01/15 DELETE END
*--------------------------------------------- 2010/04/02 UPDATE END
GDS_REC-ZSABE
GDS_REC-TLFNS                       "2010/01/15 INSERT
GDS_REC-TLFXS
GDS_REC-INTAD
GDS_REC-KVERM
GDS_REC-WAERS
GDS_REC-ZTERM2
*--------------------------------------------- 2010/01/15 INSERT START
GDS_REC-INCO1
GDS_REC-INCO2
GDS_REC-MINBW
GDS_REC-KALSK
GDS_REC-MEPRF
*--------------------------------------------- 2010/01/15 INSERT END
GDS_REC-WEBRE
GDS_REC-LFABC                       "2010/01/15 INSERT
GDS_REC-XERSY
*--------------------------------------------- 2010/01/15 INSERT START
GDS_REC-XERSR
GDS_REC-KZABS
*--------------------------------------------- 2010/01/15 INSERT END
GDS_REC-KZAUT
*--------------------------------------------- 2010/01/15 INSERT START
*--------------------------------------------- 2010/06/22 DELETE START
*          GDS_REC-PAPRF
*          GDS_REC-XNBWY
*--------------------------------------------- 2010/06/22 DELETE END
GDS_REC-NRGEW
*--------------------------------------------- 2010/06/22 DELETE START
*          GDS_REC-LEBRE
*--------------------------------------------- 2010/06/22 DELETE END
GDS_REC-VSBED.
*--------------------------------------------- 2010/01/15 INSERT END
APPEND GDS_REC TO GDT_REC.
ENDDO.
* データ件数チェック
DESCRIBE TABLE GDT_REC LINES LDF_CNT.
IF LDF_CNT = 0  .
* #006 MOD 20110207 ISID144 START
**   メッセージ変数のセット
*    CASE SY-LANGU.
*      WHEN GCF_LA_J.                     " 日本語
*        LDF_MSGV1 = GCF_TXT6J.           "'タブ区切りファイルにデータが存在しません'
*      WHEN GCF_LA_1.                     " 中国語
*        LDF_MSGV1 = GCF_TXT6C.           "'TAB#隔文本文件中没有数据'
*      WHEN GCF_LA_E.                     " 英語
*        LDF_MSGV1 = GCF_TXT6E.           "'TAB file is empty.'
*    ENDCASE.
*    MESSAGE E398 WITH LDF_MSGV1 SPACE SPACE SPACE.
MESSAGE S015(ZFI001) DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDIF.
*   ファイルクローズ(UNIX FILE)
CLOSE DATASET P_FILENM.
ENDFORM.                    " FRM_UPLOAD_SERVER_DATA

*&---------------------------------------------------------------------*
*&      Form  FRM_UPLOAD_LOCAL_DATA
*&---------------------------------------------------------------------*
*       入力ファイルデータをアップロードする(ローカル)
*----------------------------------------------------------------------*
FORM FRM_UPLOAD_LOCAL_DATA.
DATA:LDF_LENGTH TYPE I.                   " ファイルの長

DATA:LDF_FNAME     TYPE STRING.           " ファイル名
*       LDF_MSGV1(50) TYPE C.                " メッセージ変数１

LDF_FNAME = P_FILENM.
CALL FUNCTION 'GUI_UPLOAD'
EXPORTING
FILENAME                = LDF_FNAME
FILETYPE                = GCF_TYPE
HAS_FIELD_SEPARATOR     = GCF_CHK
IMPORTING
FILELENGTH              = LDF_LENGTH
TABLES
DATA_TAB                = GDT_REC
EXCEPTIONS
FILE_OPEN_ERROR         = 1
FILE_READ_ERROR         = 2
NO_BATCH                = 3
GUI_REFUSE_FILETRANSFER = 4
INVALID_TYPE            = 5
NO_AUTHORITY            = 6
UNKNOWN_ERROR           = 7
BAD_DATA_FORMAT         = 8
HEADER_NOT_ALLOWED      = 9
SEPARATOR_NOT_ALLOWED   = 10
HEADER_TOO_LONG         = 11
UNKNOWN_DP_ERROR        = 12
ACCESS_DENIED           = 13
DP_OUT_OF_MEMORY        = 14
DISK_FULL               = 15
DP_TIMEOUT              = 16
OTHERS                  = 17.
CASE SY-SUBRC.
WHEN 0.
IF LDF_LENGTH <= 0.
* #006 MOD 20110207 ISID144 START
*       メッセージ変数のセット
*        CASE SY-LANGU.
*          WHEN GCF_LA_J.                     " 日本語
*            LDF_MSGV1 = GCF_TXT6J.           "'タブ区切りファイルにデータが存在しません'
*          WHEN GCF_LA_1.                     " 中国語
*            LDF_MSGV1 = GCF_TXT6C.           "'TAB#隔文本文件中没有数据'
*          WHEN GCF_LA_E.                     " 英語
*            LDF_MSGV1 = GCF_TXT6E.           "'TAB file is empty.'
*        ENDCASE.
*        MESSAGE E398 WITH LDF_MSGV1 SPACE SPACE SPACE.
MESSAGE S015(ZFI001) DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDIF.
WHEN OTHERS.
* #006 MOD 20110207 ISID144 START
**     メッセージ変数のセット
*      CASE SY-LANGU.
*        WHEN GCF_LA_J.                       " 日本語
*          LDF_MSGV1 = GCF_TXT7J.             "'UPLOAD 異常終了    例外：'
*        WHEN GCF_LA_1.                       " 中国語
*          LDF_MSGV1 = GCF_TXT7C.             "'UPLOAD #生##    代#：'
*        WHEN GCF_LA_E.                       " 英語
*          LDF_MSGV1 = GCF_TXT7E.
*          "'Error during upload processing. Exception:'
*      ENDCASE.
*      MESSAGE E398 WITH LDF_MSGV1 SY-SUBRC SPACE SPACE.
MESSAGE S052(ZFI001)
WITH SY-SUBRC
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDCASE.

ENDFORM.                    " FRM_UPLOAD_LOCAL_DATA

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_BDCDATA
*&---------------------------------------------------------------------*
*       BDCデータのセット
*----------------------------------------------------------------------*
FORM FRM_SET_BDCDATA .

* 項目のアルファ変換
PERFORM:
FRM_ALPHA_INSERT USING    GDS_REC-LIFNR   " 仕入先コードの変換
CHANGING WA_LIFNRC.

* 制御コード項目が登録(N)/変更(U)以外の場合、制御コード設定
IF NOT ( GDS_REC-FLAG = GCF_CTRN OR GDS_REC-FLAG = GCF_CTRU ).
PERFORM:
FRM_N_U_SET.          " 制御コード項目の登録(N)/変更(U)設定
ENDIF.
*--------------------------------------------- 2010/01/20 INSERT START
* 勘定グループ取得
*->出荷先勘定グループ
PERFORM FRM_READ_ZCAT_MA001 USING    GCF_CR        " 取引先機能
CHANGING WA_KTOKD_CR.  " 勘定グループ
*->FI用勘定グループ
PERFORM FRM_READ_ZCAT_MA001 USING    GCF_FI        " 取引先機能
CHANGING WA_KTOKD_FI.  " 勘定グループ
*--------------------------------------------- 2010/01/20 INSERT END
* 処理件数のカウント
CNT_INDEX = CNT_INDEX + 1.
CASE GDS_REC-FLAG.
WHEN GCF_CTRN.                     " 制御コードがN(新規登録)のとき
WA_TCODE = GCF_XK01.             " T-CD設定(登録)
PERFORM:
FRM_LFA1_CHECK,                " データの存在チェック
FRM_SET_XK01.                  " 登録用BDCデータセット
WHEN GCF_CTRU.                     " 制御コードがU(更新)のとき
WA_TCODE = GCF_XK02.             " T-CD設定(変更)
PERFORM:
FRM_SET_XK02.                  " 変更用BDCデータセット
ENDCASE.
ENDFORM.                    " FRM_SET_BDCDATA

*&---------------------------------------------------------------------*
*&      Form  FRM_LFA1_CHECK
*&---------------------------------------------------------------------*
*       データの存在チェック
*----------------------------------------------------------------------*
FORM FRM_LFA1_CHECK.
DATA:LDF_LIFNR TYPE LFA1-LIFNR.
CLEAR:FLG_DATA.
* 仕入先コードの存在チェック
SELECT SINGLE LIFNR                  " 仕入先コード
INTO LDF_LIFNR
FROM LFA1                          " 仕入先マスタ：一般データ
WHERE LIFNR = GDS_REC-LIFNR.        " 仕入先コード
CASE SY-SUBRC.
WHEN 0.
FLG_DATA = GCF_LVL1.             " 登録済(会社CDデータのみ登録)
WHEN OTHERS.
FLG_DATA = GCF_LVL2.             " 未登録
ENDCASE.
ENDFORM.                    "FRM_LFA1_CHECK

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_XK01
*&---------------------------------------------------------------------*
*       登録用BDCデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_XK01 .
DATA: L_WT_NEWWT  TYPE WT_NEWWT.   "2011/03/30 ADD

PERFORM:
FRM_SET_0100.                      " 第一画面
IF FLG_DATA = GCF_LVL2.              " 仕入先コードが存在しないデータ
PERFORM:                           " 一般データ
FRM_SET_0111,                    " 住所
FRM_SET_0120,                    " 管理
FRM_SET_0130.                    " 支払処理
*      FRM_SET_0380.                    " 問合せ先            "2010/01/15 DELETE
ENDIF.
*--------------------------------------------- 2010/01/20 INSERT START
*-▼ 勘定グループが運送業者以外の場合、会社コードデータセット
IF WA_KTOKD_CR IS INITIAL.
*--------------------------------------------- 2010/01/20 INSERT END
PERFORM:                             " 会社コードデータ
FRM_SET_0210,                      " 会計情報
FRM_SET_0215,                      " 支払処理
FRM_SET_0220.                      " 連絡文書
*    FRM_SET_0610.                      " 拡張源泉徴収税      "2010/01/15 DELETE
* #009 MOD 20110330 ISID111 START
** #008 ADD 20110222 ISID144 START
*      FRM_SET_0610.                      " 拡張源泉徴収税      "2010/01/15 DELETE
** #008 ADD 20110222 ISID144 END
PERFORM FRM_SELECT_T001 USING    GDS_REC-BUKRS
CHANGING L_WT_NEWWT.
*  拡張源泉徴収税の有効化されている場合のみ、ＢＤＣデータを作成する
IF L_WT_NEWWT IS NOT INITIAL.
PERFORM:
FRM_SET_0610.                      " 拡張源泉徴収税
ENDIF.
* #009 ADD 20110330 ISID111 END
ENDIF.                                                       "2010/01/20 INSERT
*--------------------------------------------- 2010/01/20 INSERT START
*-▼ 勘定グループが運送業者とFI用以外の場合、購買組織データセット
IF WA_KTOKD_CR IS INITIAL AND WA_KTOKD_FI IS INITIAL.
PERFORM:                             " 購買組織データ
FRM_SET_0310.                      " 購買データ
ENDIF.
*--------------------------------------------- 2010/01/20 INSERT END
ENDFORM.                    " FRM_SET_XK01

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0100
*&---------------------------------------------------------------------*
*       第一画面にデータセット(登録)
*----------------------------------------------------------------------*
FORM FRM_SET_0100 .
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM       GCF_0100,       " 画面設定
GCF_SPC 'BDC_OKCODE'  GCF_ENTR,       " OKコード(ENTER)
GCF_SPC 'RF02K-LIFNR' WA_LIFNRC,      " 仕入先コード
GCF_SPC 'RF02K-BUKRS' GDS_REC-BUKRS,  " 会社コード
GCF_SPC 'RF02K-EKORG' GDS_REC-EKORG,  " 購買組織        "2010/01/15 INSERT
GCF_SPC 'RF02K-KTOKK' GDS_REC-KTOKK,  " 勘定グループ
GCF_SPC 'USE_ZAV'     GCF_CHK.        " 共通アドレス管理使用
ENDFORM.                    " FRM_SET_0100

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0111
*&---------------------------------------------------------------------*
*       住所画面(一般データ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0111 .
**** START DEL 2014/09/30 ISID18 ****
*  IF GDS_REC-TELF1 IS INITIAL.
*    GDS_REC-TELF1 = '00-0000-0000'.      " 電話番号１
*  ENDIF.
*  IF GDS_REC-TELFX IS INITIAL.
*    GDS_REC-TELFX = '00-0000-0000'.      " ファックス番号
*  ENDIF.
*  IF GDS_REC-SMTP IS INITIAL.
*    GDS_REC-SMTP = 'XXX@XXX.XXX'.        " 電子メール
*  ENDIF.
**** END DEL 2014/09/30 ISID18 ****
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM       GCF_0111,                   " 画面設定
*      GCF_SPC 'BDC_OKCODE'  GCF_10C,                    " OKコード(名称枠の拡張)   "2010/01/22 DELETE
**** START UPD 2014/09/30 ISID18 ****
*      GCF_SPC 'ADDR1_DATA-SORT1'      GDS_REC-SORTL,    " 検索条件
*      GCF_SPC 'SZA1_D0100-TITLE_MEDI' GDS_REC-ANRED,    " タイトル
GCF_SPC 'ADDR1_DATA-SORT1'      GDS_REC-SORTL.    " 検索条件
IF GDS_REC-ANRED IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-TITLE_MEDI' GDS_REC-ANRED.    " タイトル
ENDIF.
PERFORM
FRM_BDCDATA_SET USING:
**** END UPD 2014/09/30 ISID18 ****
GCF_SPC 'ADDR1_DATA-NAME1'      GDS_REC-NAME1,    " 名称１
GCF_SPC 'ADDR1_DATA-NAME2'      GDS_REC-NAME2,    " 名称２
GCF_SPC 'ADDR1_DATA-SORT2'      GDS_REC-SORTL2,   " 検索条件2                 "2010/01/22 INSERT
GCF_SPC 'ADDR1_DATA-CITY1'      GDS_REC-ORT01,    " 市区町村名
GCF_SPC 'ADDR1_DATA-COUNTRY'    GDS_REC-LAND1,    " 国コード
*--------------------------------------------- 2010/01/22 DELETE START
*      GCF_CHK GCF_PGM       GCF_0111,                   " 画面設定
*      GCF_SPC 'BDC_OKCODE'  GCF_20C,                    " OKコード(住所枠の拡張)
*      GCF_CHK GCF_PGM       GCF_0111,                   " 画面設定
*      GCF_SPC 'BDC_OKCODE'  GCF_30C,                    " OKコード(私書箱枠の拡張)
*      GCF_CHK GCF_PGM       GCF_0111,                   " 画面設定
*      GCF_SPC 'BDC_OKCODE'  GCF_VW,                     " OKコード(次画面)
*      GCF_SPC 'ADDR1_DATA-NAME3'      GDS_REC-NAME3,    " 名称３
*      GCF_SPC 'ADDR1_DATA-NAME4'      GDS_REC-NAME4,    " 名称４
*--------------------------------------------- 2010/01/22 DELETE END
GCF_SPC 'ADDR1_DATA-STREET'     GDS_REC-STRAS,    " 地名/番地-号
*--------------------------------------------- 2010/01/21 DELETE START
*      GCF_SPC 'ADDR1_DATA-PO_BOX'     GDS_REC-PFACH,    " 私書箱
*      GCF_SPC 'ADDR1_DATA-CITY2'      GDS_REC-ORT02,    " 所在地
*--------------------------------------------- 2010/01/21 DELETE END
GCF_SPC 'ADDR1_DATA-REGION'     GDS_REC-REGIO,    " 地域コード
*--------------------------------------------- 2010/01/22 INSERT START
**** START UPD 2014/09/30 ISID18 ****
*      GCF_SPC 'ADDR1_DATA-POST_CODE1' GDS_REC-PSTLZ,    " 郵便番号
*      GCF_SPC 'ADDR1_DATA-HOUSE_NUM1' GDS_REC-HOUSE_NUM1, " 番地・号
*      GCF_SPC 'ADDR1_DATA-HOUSE_NUM2' GDS_REC-HOUSE_NUM2, " 補足
*      GCF_SPC 'ADDR1_DATA-TIME_ZONE'  GDS_REC-TIME_ZONE, " タイムゾーン
**--------------------------------------------- 2010/06/22 DELETE START
**      GCF_SPC 'ADDR1_DATA-TRANSPZONE' GDS_REC-TRANSPZONE," 納入区域
**--------------------------------------------- 2010/06/22 DELETE END
**--------------------------------------------- 2010/01/22 INSERT END
*      GCF_SPC 'ADDR1_DATA-LANGU'      GDS_REC-SPRAS,    " 言語選択
*      GCF_SPC 'SZA1_D0100-TEL_NUMBER' GDS_REC-TELF1,    " 電話番号１
**--------------------------------------------- 2010/01/22 INSERT START
*      GCF_SPC 'SZA1_D0100-TEL_EXTENS' GDS_REC-TEL_EXTENS, " 内線(電話)
*      GCF_SPC 'SZA1_D0100-MOB_NUMBER' GDS_REC-TMOB_NUMBER," 携帯電話
**--------------------------------------------- 2010/01/22 INSERT END
*      GCF_SPC 'SZA1_D0100-FAX_NUMBER' GDS_REC-TELFX,    " ファックス番号
*      GCF_SPC 'SZA1_D0100-FAX_EXTENS' GDS_REC-FAX_EXTENS, " 内線(FAX)       "2010/01/22 INSERT
*      GCF_SPC 'SZA1_D0100-SMTP_ADDR'  GDS_REC-SMTP.     " 電子メール
GCF_SPC 'ADDR1_DATA-POST_CODE1' GDS_REC-PSTLZ.    " 郵便番号
IF GDS_REC-HOUSE_NUM1 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'ADDR1_DATA-HOUSE_NUM1' GDS_REC-HOUSE_NUM1. " 番地・号
ENDIF.
IF GDS_REC-HOUSE_NUM2 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'ADDR1_DATA-HOUSE_NUM2' GDS_REC-HOUSE_NUM2. " 補足
ENDIF.
IF GDS_REC-TIME_ZONE IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'ADDR1_DATA-TIME_ZONE'  GDS_REC-TIME_ZONE. " タイムゾーン
ENDIF.
IF GDS_REC-SPRAS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'ADDR1_DATA-LANGU'      GDS_REC-SPRAS.    " 言語選択
ENDIF.
IF GDS_REC-TELF1 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-TEL_NUMBER' GDS_REC-TELF1.    " 電話番号１
ENDIF.
IF GDS_REC-TEL_EXTENS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-TEL_EXTENS' GDS_REC-TEL_EXTENS. " 内線(電話)
ENDIF.
IF GDS_REC-TMOB_NUMBER IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-MOB_NUMBER' GDS_REC-TMOB_NUMBER." 携帯電話
ENDIF.
IF GDS_REC-TELFX IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-FAX_NUMBER' GDS_REC-TELFX.    " ファックス番号
ENDIF.
IF GDS_REC-FAX_EXTENS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-FAX_EXTENS' GDS_REC-FAX_EXTENS. " 内線(FAX)       "2010/01/22 INSERT
ENDIF.
IF GDS_REC-SMTP IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'SZA1_D0100-SMTP_ADDR'  GDS_REC-SMTP.     " 電子メール
ENDIF.
**** END UPD 2014/09/30 ISID18 ****
*--------------------------------------------- 2010/01/15 DELETE START
*      GCF_SPC 'ADDR1_DATA-PO_BOX_LOC' GDS_REC-PFORT,    " 私書箱所在地
*      GCF_SPC 'SZA1_D0100-POSTCODE2C' GDS_REC-PSTL2.    " 私書箱番号
*--------------------------------------------- 2010/01/15 DELETE END

*--------------------------------------------- 2010/01/22 INSERT START
*-▼ 勘定グループが運送業者以外の場合、次画面遷移
IF WA_KTOKD_CR IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE'  GCF_VW.               " OKコード(次画面)
*-▼ 勘定グループが運送業者の場合、保存
ELSE.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE'  GCF_UPDA.             " OKコード(保存)
ENDIF.
*--------------------------------------------- 2010/01/22 INSERT END

ENDFORM.                    " FRM_SET_0111

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0120
*&---------------------------------------------------------------------*
*       管理画面(一般データ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0120 .
*--------------------------------------------- 2010/01/22 INSERT START
*-▼ 勘定グループが運送業者以外の場合、データセット
CHECK WA_KTOKD_CR IS INITIAL.
*--------------------------------------------- 2010/01/22 INSERT END

PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0120,          " 画面設定
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC 'BDC_OKCODE' GCF_VW.            " OKコード(次画面)
IF GDS_REC-KUNNR IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-KUNNR' GDS_REC-KUNNR.     " 得意先コード
ENDIF.
IF GDS_REC-KONZS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-KONZS' GDS_REC-KONZS.     " グループキー
ENDIF.
IF GDS_REC-VBUND IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-VBUND' GDS_REC-VBUND.     " 取引先
ENDIF.
IF GDS_REC-STCEG IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-STCEG' GDS_REC-STCEG.     " 消費税登録No       "2010/01/15 INSERT
ENDIF.
*      GCF_SPC 'BDC_OKCODE' GCF_VW,            " OKコード(次画面)
*      GCF_SPC 'LFA1-KUNNR' GDS_REC-KUNNR,     " 得意先コード
*      GCF_SPC 'LFA1-KONZS' GDS_REC-KONZS,     " グループキー
*      GCF_SPC 'LFA1-VBUND' GDS_REC-VBUND,     " 取引先
*      GCF_SPC 'LFA1-STCEG' GDS_REC-STCEG.     " 消費税登録No       "2010/01/15 INSERT
**** END UPD 2014/09/30 ISID18 ****
*参照グループ
IF GDS_REC-KTOKK = 'cpd' OR GDS_REC-KTOKK = 'cpdl'.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-KTOCK' GDS_REC-KTOCK.   " 参照勘定グループ
ENDIF.
ENDFORM.                    " FRM_SET_0120

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0130
*&---------------------------------------------------------------------*
*       支払処理画面(一般データ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0130 .
*--------------------------------------------- 2010/01/22 INSERT START
*-▼ 勘定グループが運送業者以外の場合、データセット
CHECK WA_KTOKD_CR IS INITIAL.
*--------------------------------------------- 2010/01/22 INSERT END

PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0130,        " 画面設定
GCF_SPC 'BDC_OKCODE' GCF_VW.          " OKコード(次画面)
IF GDS_REC-BANKS <> SPACE.   " 銀行情報が入力されているときのみ実施
PERFORM:
FRM_SET_BANK.    " 銀行情報行数設定
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC WA_BANKS     GDS_REC-BANKS,   " 銀行国コード
GCF_SPC WA_BANKL     GDS_REC-BANKL,   " 銀行コード
GCF_SPC WA_BANKN     GDS_REC-BANKN,   " 銀行口座
GCF_SPC WA_KOINH     GDS_REC-KOINH,   " 口座名義人
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC WA_BKONT     GDS_REC-BKONT.   " 銀行管理キー
IF GDS_REC-LNRZA IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-LNRZA' GDS_REC-LNRZA.   " 代理受取人
ENDIF.
IF GDS_REC-DTAMS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-DTAMS' GDS_REC-DTAMS.   " DME コード
ENDIF.
IF GDS_REC-DTAWS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFA1-DTAWS' GDS_REC-DTAWS.   " 指示キー
ENDIF.
*        GCF_SPC WA_BKONT     GDS_REC-BKONT,   " 銀行管理キー
**--------------------------------------------- 2010/01/20 INSERT START
*        GCF_SPC 'LFA1-LNRZA' GDS_REC-LNRZA,   " 代理受取人
*        GCF_SPC 'LFA1-DTAMS' GDS_REC-DTAMS,   " DME コード
**--------------------------------------------- 2010/01/20 INSERT END
*        GCF_SPC 'LFA1-DTAWS' GDS_REC-DTAWS.   " 指示キー
**** END UPD 2014/09/30 ISID18 ****
IF NOT GDS_REC-BANKA  IS INITIAL OR       " 銀行詳細情報があるときのみ
NOT GDS_REC-BRNCH  IS INITIAL OR       " B/Iを行う
NOT GDS_REC-PROVZ  IS INITIAL OR
NOT GDS_REC-STRAS2 IS INITIAL OR
NOT GDS_REC-ORT012 IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_CURSOR' WA_BANKS,     " 現在行にカーソルセット
GCF_SPC 'BDC_OKCODE' GCF_BANK,     " OKコード(銀行詳細)
GCF_CHK GCF_BPGM     GCF_0100.     " 画面設定
IF NOT GDS_REC-BANKA IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BNKA-BANKA' GDS_REC-BANKA.     " 銀行名
ENDIF.
IF NOT GDS_REC-BRNCH IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BNKA-BRNCH' GDS_REC-BRNCH.     " 支店
ENDIF.
IF NOT GDS_REC-PROVZ IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BNKA-PROVZ' GDS_REC-PROVZ.     " 地域
ENDIF.
IF NOT GDS_REC-STRAS IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BNKA-STRAS' GDS_REC-STRAS2.    " 都道府県名
ENDIF.
IF NOT GDS_REC-ORT01 IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BNKA-ORT01' GDS_REC-ORT012.    " 市区町村
ENDIF.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE' GCF_ENTR,     " OKコード(ENTER)
GCF_CHK GCF_PGM      GCF_0130,     " 画面設定
GCF_SPC 'BDC_OKCODE' GCF_VW.       " OKコード(次画面)
ENDIF.
ENDIF.
ENDFORM.                    " FRM_SET_0130

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_BANK
*&---------------------------------------------------------------------*
*       銀行情報行数設定
*----------------------------------------------------------------------*
FORM FRM_SET_BANK .
IF WA_LIFNR = GDS_REC-LIFNR.
CNT_BANK = CNT_BANK + 1.
ELSE.
CNT_BANK = 1.
ENDIF.
CONCATENATE GCF_BANKS CNT_BANK GCF_END INTO WA_BANKS .
CONCATENATE GCF_BANKL CNT_BANK GCF_END INTO WA_BANKL .
CONCATENATE GCF_BANKN CNT_BANK GCF_END INTO WA_BANKN .
CONCATENATE GCF_KOINH CNT_BANK GCF_END INTO WA_KOINH .
CONCATENATE GCF_BKONT CNT_BANK GCF_END INTO WA_BKONT .
ENDFORM.                    " FRM_SET_BANK
*--------------------------------------------- 2010/01/15 DELETE START
**&---------------------------------------------------------------------*
**&      Form  FRM_SET_0380
**&---------------------------------------------------------------------*
**       問合せ先画面にデータセット
**----------------------------------------------------------------------*
*FORM FRM_SET_0380 .
*  PERFORM
*    FRM_BDCDATA_SET USING:
*      GCF_CHK GCF_PGM      GCF_0380,       " 画面設定
*      GCF_SPC 'BDC_OKCODE' GCF_ENTR.       " OKコード(次画面)
*ENDFORM.                    " FRM_SET_0380
*--------------------------------------------- 2010/01/15 DELETE END
*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0210
*&---------------------------------------------------------------------*
*       会計情報画面(会社コードデータ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0210.

* 制御コードによって処理を分ける
CASE  GDS_REC-FLAG.
WHEN  GCF_CTRN.
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0210,          " 画面設定
GCF_SPC 'BDC_OKCODE' GCF_VW,            " OKコード(次画面)
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC 'LFB1-AKONT' GDS_REC-AKONT.     " 統制勘定コード
IF GDS_REC-FDGRV IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-FDGRV' GDS_REC-FDGRV.     " 資金管理グループ
ENDIF.
IF GDS_REC-ZUAWA IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZUAWA' GDS_REC-ZUAWA.     " ソートキー
ENDIF.
*          GCF_SPC 'LFB1-AKONT' GDS_REC-AKONT,     " 統制勘定コード
*          GCF_SPC 'LFB1-FDGRV' GDS_REC-FDGRV,     " 資金管理グループ
*          GCF_SPC 'LFB1-ZUAWA' GDS_REC-ZUAWA.     " ソートキー
**** END UPD 2014/09/30 ISID18 ****
*--------------------------------------------- 2010/06/22 DELETE START
*          GCF_SPC 'LFB1-LNRZE' GDS_REC-LNRZE.     " 本店勘定コード
*--------------------------------------------- 2010/06/22 DELETE END
*--------------------------------------------- 2010/04/02 DELETE START
**--------------------------------------------- 2010/01/15 INSERT START
*          GCF_SPC 'LFB1-VZSKZ' GDS_REC-VZSKZ.     " 金利フラグ
**--------------------------------------------- 2010/03/17 INSERT START
**-----▼ 最終基準日が初期値以外の場合
*      IF GDS_REC-ZINDT IS NOT INITIAL.
*        PERFORM
*          FRM_BDCDATA_SET USING:
**--------------------------------------------- 2010/03/17 INSERT END
*            GCF_SPC 'LFB1-ZINDT' GDS_REC-ZINDT.     " 最終基準日
**--------------------------------------------- 2010/03/17 INSERT START
*      ENDIF.
**-----▼ 利払頻度が初期値以外の場合
*      IF GDS_REC-ZINRT IS NOT INITIAL.
*        PERFORM
*          FRM_BDCDATA_SET USING:
**--------------------------------------------- 2010/03/17 INSERT END
*            GCF_SPC 'LFB1-ZINRT' GDS_REC-ZINRT.     " 利払頻度
**--------------------------------------------- 2010/03/17 INSERT START
*      ENDIF.
**-----▼ 最終金利実行が初期値以外の場合
*      IF GDS_REC-DATLZ IS NOT INITIAL.
*        PERFORM
*          FRM_BDCDATA_SET USING:
**--------------------------------------------- 2010/03/17 INSERT END
*            GCF_SPC 'LFB1-DATLZ' GDS_REC-DATLZ.     " 最終金利実行
**--------------------------------------------- 2010/03/17 INSERT START
*      ENDIF.
*--------------------------------------------- 2010/04/02 DELETE END

**** START ADD 2014/09/30 ISID18 ****
IF GDS_REC-ALTKN IS NOT INITIAL.
**** END ADD 2014/09/30 ISID18 ****
PERFORM
FRM_BDCDATA_SET USING:
*--------------------------------------------- 2010/03/17 INSERT END
GCF_SPC 'LFB1-ALTKN' GDS_REC-ALTKN.     " 旧勘定コード
**** START ADD 2014/09/30 ISID18 ****
ENDIF.
**** END ADD 2014/09/30 ISID18 ****
*--------------------------------------------- 2010/01/15 INSERT END
WHEN  GCF_CTRU.
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0210,          " 画面設定
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC 'BDC_OKCODE' GCF_VW.
IF GDS_REC-FDGRV IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-FDGRV' GDS_REC-FDGRV.     " 資金管理グループ
ENDIF.
IF GDS_REC-ZUAWA IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZUAWA' GDS_REC-ZUAWA.     " ソートキー
ENDIF.
IF GDS_REC-ALTKN IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ALTKN' GDS_REC-ALTKN.     " 旧勘定コード
ENDIF.
*          GCF_SPC 'BDC_OKCODE' GCF_VW,            " OKコード(次画面)
*          GCF_SPC 'LFB1-FDGRV' GDS_REC-FDGRV,     " 資金管理グループ
*          GCF_SPC 'LFB1-ZUAWA' GDS_REC-ZUAWA,     " ソートキー
**--------------------------------------------- 2010/06/22 DELETE START
**          GCF_SPC 'LFB1-LNRZE' GDS_REC-LNRZE,     " 本店勘定コード
**--------------------------------------------- 2010/06/22 DELETE END
**--------------------------------------------- 2010/01/15 INSERT START
**--------------------------------------------- 2010/04/02 DELETE START
**          GCF_SPC 'LFB1-VZSKZ' GDS_REC-VZSKZ,     " 金利フラグ
**          GCF_SPC 'LFB1-ZINDT' GDS_REC-ZINDT,     " 最終基準日
**          GCF_SPC 'LFB1-ZINRT' GDS_REC-ZINRT,     " 利払頻度
**          GCF_SPC 'LFB1-DATLZ' GDS_REC-DATLZ,     " 最終金利実行
**--------------------------------------------- 2010/04/02 DELETE END
*          GCF_SPC 'LFB1-ALTKN' GDS_REC-ALTKN.     " 旧勘定コード
**** END UPD 2014/09/30 ISID18 ****
*--------------------------------------------- 2010/01/15 INSERT END
ENDCASE.

ENDFORM.                    " FRM_SET_0210

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0215
*&---------------------------------------------------------------------*
*       支払処理画面(会社コードデータ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0215.
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0215,          " 画面設定
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC 'BDC_OKCODE' GCF_VW.
IF GDS_REC-ZTERM IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZTERM' GDS_REC-ZTERM.     " 支払条件
ENDIF.
IF GDS_REC-GUZTE IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-GUZTE' GDS_REC-GUZTE.     " Credit Memo条件
ENDIF.
IF GDS_REC-KULTG IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-KULTG' GDS_REC-KULTG.     " 現金化期間
ENDIF.
IF GDS_REC-ZWELS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZWELS' GDS_REC-ZWELS.     " 支払方法
ENDIF.
IF GDS_REC-ZAHLS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZAHLS' GDS_REC-ZAHLS.     " 支払保留キー
ENDIF.
IF GDS_REC-LNRZB IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-LNRZB' GDS_REC-LNRZB.     " 代理受取人勘定
ENDIF.
IF GDS_REC-HBKID IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-HBKID' GDS_REC-HBKID.     " 取引銀行ID
ENDIF.
IF GDS_REC-TOGRU IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-TOGRU' GDS_REC-TOGRU.     " 許容グループ
ENDIF.
IF GDS_REC-XPORE IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-XPORE' GDS_REC-XPORE.     " 個別支払
ENDIF.
IF GDS_REC-ZGRUP IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZGRUP' GDS_REC-ZGRUP.     " グループキー
ENDIF.
IF GDS_REC-XEDIP IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-XEDIP' GDS_REC-XEDIP.     " EDI支払明細書
ENDIF.
*      GCF_SPC 'BDC_OKCODE' GCF_VW,            " OKコード(次画面)
*      GCF_SPC 'LFB1-ZTERM' GDS_REC-ZTERM,     " 支払条件
**      GCF_SPC 'LFB1-REPRF' GDS_REC-REPRF,     " 二重請求確認     "2010/01/15 DELETE
**--------------------------------------------- 2010/01/22 INSERT START
*      GCF_SPC 'LFB1-GUZTE' GDS_REC-GUZTE,     " Credit Memo条件
*      GCF_SPC 'LFB1-KULTG' GDS_REC-KULTG,     " 現金化期間
**--------------------------------------------- 2010/01/22 INSERT END
*      GCF_SPC 'LFB1-ZWELS' GDS_REC-ZWELS,     " 支払方法
*      GCF_SPC 'LFB1-ZAHLS' GDS_REC-ZAHLS,     " 支払保留キー
*      GCF_SPC 'LFB1-LNRZB' GDS_REC-LNRZB,     " 代理受取人勘定
*      GCF_SPC 'LFB1-HBKID' GDS_REC-HBKID,     " 取引銀行ID
*      GCF_SPC 'LFB1-TOGRU' GDS_REC-TOGRU,     " 許容グループ
**--------------------------------------------- 2010/01/22 INSERT START
*      GCF_SPC 'LFB1-XPORE' GDS_REC-XPORE,     " 個別支払
*      GCF_SPC 'LFB1-ZGRUP' GDS_REC-ZGRUP,     " グループキー
*      GCF_SPC 'LFB1-XEDIP' GDS_REC-XEDIP.     " EDI支払明細書
**** END UPD 2014/09/30 ISID18 ****
*--------------------------------------------- 2010/01/22 INSERT END
IF NOT GDS_REC-KUNNR IS INITIAL AND
NOT GDS_REC-XVERR IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-XVERR' GDS_REC-XVERR.   " 得意先との決済
ENDIF.
ENDFORM.                    " FRM_SET_0215

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0220
*&---------------------------------------------------------------------*
*       連絡文書画面(会社コードデータ)にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0220.
PERFORM
FRM_BDCDATA_SET USING:
**** START UPD 2014/09/30 ISID18 ****
GCF_CHK GCF_PGM      GCF_0220.          " 画面設定
IF GDS_REC-BUSAB IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-BUSAB' GDS_REC-BUSAB.     " 記帳担当者
ENDIF.
IF GDS_REC-EIKTO IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-EIKTO' GDS_REC-EIKTO.     " 自社コード
ENDIF.
IF GDS_REC-ZSABE IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-ZSABE' GDS_REC-ZSABE.     " 仕入先担当者
ENDIF.
IF GDS_REC-TLFNS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-TLFNS' GDS_REC-TLFNS.     " 記帳担当電話No.     "2010/01/15 INSERT
ENDIF.
IF GDS_REC-TLFXS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-TLFXS' GDS_REC-TLFXS.     " 経理担当者Fax
ENDIF.
IF GDS_REC-INTAD IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-INTAD' GDS_REC-INTAD.     " 担当者インターネット
ENDIF.
IF GDS_REC-KVERM IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFB1-KVERM' GDS_REC-KVERM.     " コメント
ENDIF.
*      GCF_CHK GCF_PGM      GCF_0220,          " 画面設定
**--------------------------------------------- 2010/01/15 DELETE START
**      GCF_SPC 'BDC_OKCODE' GCF_VW,            " OKコード(保存)
**--------------------------------------------- 2010/04/02 UPDATE START
*      GCF_SPC 'LFB1-BUSAB' GDS_REC-BUSAB,     " 記帳担当者
*      GCF_SPC 'LFB1-EIKTO' GDS_REC-EIKTO,     " 自社コード
**--------------------------------------------- 2010/04/02 UPDATE END
**--------------------------------------------- 2010/01/15 DELETE END
*      GCF_SPC 'LFB1-ZSABE' GDS_REC-ZSABE,     " 仕入先担当者
*      GCF_SPC 'LFB1-TLFNS' GDS_REC-TLFNS,     " 記帳担当電話No.     "2010/01/15 INSERT
*      GCF_SPC 'LFB1-TLFXS' GDS_REC-TLFXS,     " 経理担当者Fax
*      GCF_SPC 'LFB1-INTAD' GDS_REC-INTAD,     " 担当者インターネット
*      GCF_SPC 'LFB1-KVERM' GDS_REC-KVERM.     " コメント
**** END UPD 2014/09/30 ISID18 ****

*--------------------------------------------- 2010/01/22 INSERT START
*-▼ 勘定グループがFI用以外の場合、次画面遷移
*  IF WA_KTOKD_FI IS INITIAL.                 #008 20110222 DEL
**** START UPD 2014/09/30 ISID18 ****
*  PERFORM
*    FRM_BDCDATA_SET USING:
*      GCF_SPC 'BDC_OKCODE' GCF_VW.            " OKコード(保存)
IF WA_KTOKD_FI IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE' GCF_VW.            " OKコード(保存)
ELSE.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE' GCF_UPDA.            " OKコード(保存)
ENDIF.
**** END UPD 2014/09/30 ISID18 ****
* #008 ADD 20110222 ISID144 START
**-▼ 勘定グループがFI用の場合、保存
*  ELSE.
*    PERFORM
*      FRM_BDCDATA_SET USING:
*        GCF_SPC 'BDC_OKCODE' GCF_UPDA.          " OKコード(保存)
*  ENDIF.
*--------------------------------------------- 2010/01/22 INSERT END
* #008 ADD 20110222 ISID144 END

ENDFORM.                    " FRM_SET_0220

*--------------------------------------------- 2010/01/15 DELETE START
**&---------------------------------------------------------------------*
**&      Form  FRM_SET_0610
**&---------------------------------------------------------------------*
**       拡張源泉徴収税画面(会社コードデータ)にデータセット
**----------------------------------------------------------------------*
*FORM FRM_SET_0610.
*  PERFORM
*    FRM_BDCDATA_SET USING:
*      GCF_CHK GCF_PGM      GCF_0610,                  " 画面設定
*      GCF_SPC 'BDC_OKCODE' GCF_UPDA,                  " OKコード(保存)
*      GCF_SPC 'LFBW-WITHT(1)' GDS_REC-WITHT,          " 源泉徴収税タイプ
*      GCF_SPC 'LFBW-WT_WITHCD(1)' GDS_REC-WITHCD,     " 源泉徴収税コード
*      GCF_SPC 'LFBW-WT_SUBJCT(1)' GCF_CHK.            " 源泉課税対象
*ENDFORM.                    " FRM_SET_0610
*--------------------------------------------- 2010/01/15 DELETE END

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_XK02
*&---------------------------------------------------------------------*
*       変更用BDCデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_XK02.
DATA: L_WT_NEWWT  TYPE WT_NEWWT.   "2011/03/30 ADD

PERFORM:
FRM_SET_0101,                      " 第一画面
FRM_SET_0111,                      " 住所
FRM_SET_0120,                      " 管理
FRM_SET_0130.                      " 支払処理
*    FRM_SET_0380,                      " 問合せ先            "2010/01/15 DELETE
*--------------------------------------------- 2010/01/20 INSERT START
*-▼ 勘定グループが運送業者以外の場合、会社コードデータセット
IF WA_KTOKD_CR IS INITIAL.
PERFORM:                             " 会社コードデータ
*--------------------------------------------- 2010/01/20 INSERT END
FRM_SET_0210,                      " 会計情報
FRM_SET_0215,                      " 支払処理
FRM_SET_0220.                      " 連絡文書
*    FRM_SET_0610.                      " 拡張源泉徴収税      "2010/01/15 DELETE
* #009 MOD 20110330 ISID111 START
** #008 ADD 20110222 ISID144 START
*      FRM_SET_0610.                      " 拡張源泉徴収税      "2010/01/15 DELETE
** #008 ADD 20110222 ISID144 END
PERFORM FRM_SELECT_T001 USING    GDS_REC-BUKRS
CHANGING L_WT_NEWWT.
*  拡張源泉徴収税の有効化されている場合のみ、ＢＤＣデータを作成する
IF L_WT_NEWWT IS NOT INITIAL.
PERFORM:
FRM_SET_0610.                      " 拡張源泉徴収税
ENDIF.
* #009 ADD 20110330 ISID111 END
ENDIF.                                                  "2010/01/20 INSERT
*--------------------------------------------- 2010/01/20 INSERT START
*-▼ 勘定グループが運送業者とFI用以外の場合、購買組織データセット
IF WA_KTOKD_CR IS INITIAL AND WA_KTOKD_FI IS INITIAL.
PERFORM:                             " 購買組織データ
FRM_SET_0310.                      " 購買データ
ENDIF.
*--------------------------------------------- 2010/01/20 INSERT END
ENDFORM.                    " FRM_SET_XK02

*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0101
*&---------------------------------------------------------------------*
*       第一画面にデータセット(変更)
*----------------------------------------------------------------------*
FORM FRM_SET_0101.
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM       GCF_0101,       " 画面設定
GCF_SPC 'BDC_OKCODE'  GCF_ENTR,       " OKコード(ENTER)
GCF_SPC 'RF02K-LIFNR' GDS_REC-LIFNR,  " 仕入先コード
GCF_SPC 'RF02K-BUKRS' GDS_REC-BUKRS,  " 会社コード
GCF_SPC 'RF02K-EKORG' GDS_REC-EKORG,  " 購買組織           "2010/01/15 INSERT
GCF_SPC 'USE_ZAV'     GCF_CHK,        " 共通アドレス管理使用
GCF_SPC 'RF02K-D0110' GCF_CHK,        " 住所
GCF_SPC 'RF02K-D0120' GCF_CHK,        " 管理
GCF_SPC 'RF02K-D0130' GCF_CHK,        " 支払処理
*      GCF_SPC 'WRF02K-D0380' GCF_CHK,       " 取引先担当者      "2010/01/22 DELETE
GCF_SPC 'RF02K-D0210' GCF_CHK,        " 会計情報
GCF_SPC 'RF02K-D0215' GCF_CHK,        " 支払処理
GCF_SPC 'RF02K-D0220' GCF_CHK,        " 連絡文書
*      GCF_SPC 'RF02K-D0610' GCF_CHK.        " 拡張源泉徴収税    "2010/01/15 DELETE
GCF_SPC 'RF02K-D0610' GCF_CHK.        " 拡張源泉徴収税     "#008 20110222 ADD

* #007 MOD 20110217 ISID144 START
*      GCF_SPC 'RF02K-D0310' GCF_CHK.        " 購買データ     "2010/01/15 INSERT
*- 勘定グループが運送業者とFI用以外の場合、購買組織データセット
IF WA_KTOKD_CR IS INITIAL AND WA_KTOKD_FI IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'RF02K-D0310' GCF_CHK.        " 購買データ
**** START ADD 2014/09/30 ISID18 ****
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'RF02K-D0320' GCF_CHK.        " 購買データ
**** END ADD 2014/09/30 ISID18 ****
ENDIF.
* #007 MOD 20110217 ISID144 END

ENDFORM.                    " FRM_SET_0101

*&---------------------------------------------------------------------*
*&      Form  FRM_ALPHA_INSERT
*&---------------------------------------------------------------------*
*       アルファ変換
*----------------------------------------------------------------------*
*      -->P_IDATA   変換前文字列
*      <--P_ODATA   変換後文字列
*----------------------------------------------------------------------*
FORM FRM_ALPHA_INSERT USING     P_IDATA
CHANGING  P_ODATA.
CLEAR P_ODATA.
CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
EXPORTING
INPUT  = P_IDATA          " 変換前文字列
IMPORTING
OUTPUT = P_ODATA.         " 変換後文字列
ENDFORM.                    " FRM_ALPHA_INSERT

*&---------------------------------------------------------------------*
*&      Form  FRM_BDCDATA_SET
*&---------------------------------------------------------------------*
*       BDCテーブルにデータをセット
*----------------------------------------------------------------------*
*      -->P_IDYNBGN  フラグ
*      -->P_INAME    プログラム名　or　項目名
*      -->P_IVALUE   DYNPRO番号　or　項目値
*----------------------------------------------------------------------*
FORM FRM_BDCDATA_SET USING    VALUE(P_IDYNBGN)
VALUE(P_INAME)
VALUE(P_IVALUE).
CLEAR GDS_BDC.
IF P_IDYNBGN = GCF_CHK.
GDS_BDC-PROGRAM  = P_INAME.          " プログラム番号
GDS_BDC-DYNPRO   = P_IVALUE.         " DYNPRO番号
GDS_BDC-DYNBEGIN = GCF_CHK.          " DYNPRO開始区分
ELSE.
GDS_BDC-FNAM = P_INAME.              " 項目名
GDS_BDC-FVAL = P_IVALUE.             " 項目値
ENDIF.
APPEND GDS_BDC TO GDT_BDC.
ENDFORM.                    " FRM_BDCDATA_SET

*&---------------------------------------------------------------------*
*&      Form  FRM_BDC_OPEN
*&---------------------------------------------------------------------*
*       バッチインプットセッションのオープン処理
*----------------------------------------------------------------------*
FORM FRM_BDC_OPEN.

* #006 DEL 20110207 ISID144 START
*  DATA:
*    LDF_MSGV1(50) TYPE C.             " メッセージ変数１
* #006 DEL 20110207 ISID144 END

* セッションを開く
CALL FUNCTION 'BDC_OPEN_GROUP'
EXPORTING
CLIENT              = SY-MANDT  " クライアント
GROUP               = SY-UNAME  " セッション名称
KEEP                = GCF_CHK   " 保存
USER                = SY-UNAME  " 実行ユーザ名
EXCEPTIONS
CLIENT_INVALID      = 1
DESTINATION_INVALID = 2
GROUP_INVALID       = 3
GROUP_IS_LOCKED     = 4
HOLDDATE_INVALID    = 5
INTERNAL_ERROR      = 6
QUEUE_ERROR         = 7
RUNNING             = 8
SYSTEM_LOCK_ERROR   = 9
USER_INVALID        = 10
OTHERS              = 11.
CASE SY-SUBRC.
WHEN 0.
WHEN OTHERS.
* #006 MOD 20110207 ISID144 START
**     メッセージ変数のセット
*      CASE SY-LANGU.
*        WHEN GCF_LA_J.                     " 日本語
*          LDF_MSGV1 = GCF_TXT8J.           "'BDC_OPEN 異常終了　例外：'
*        WHEN GCF_LA_1.                     " 中国語
*          LDF_MSGV1 = GCF_TXT8C.           "'BDC_OPEN #生##  代#：'
*        WHEN GCF_LA_E.                     " 英語
*          LDF_MSGV1 = GCF_TXT8E.
*          "'Error during BDC_OPEN processing. Exception:'
*      ENDCASE.
*      MESSAGE E398 WITH LDF_MSGV1 SY-SUBRC SPACE SPACE.
MESSAGE S018(ZFI001)
WITH SY-SUBRC
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDCASE.
ENDFORM.                    " FRM_BDC_OPEN

*&---------------------------------------------------------------------*
*&      Form  FRM_BDC_INSERT
*&---------------------------------------------------------------------*
*       バッチインプットセッションへのトランザクション用データ挿入処理
*----------------------------------------------------------------------*
FORM FRM_BDC_INSERT.
* #006 DEL 20110207 ISID144 START
*  DATA:
*    LDF_MSGV1(50) TYPE C.             " メッセージ変数１
* #006 DEL 20110207 ISID144 END
CHECK FLG_ERR = SPACE.

* BDCテーブルのデータをセッションにセット
CALL FUNCTION 'BDC_INSERT'
EXPORTING
TCODE            = WA_TCODE     " トランザクションコード
TABLES
DYNPROTAB        = GDT_BDC     " BDCテーブル
EXCEPTIONS
INTERNAL_ERROR   = 1
NOT_OPEN         = 2
QUEUE_ERROR      = 3
TCODE_INVALID    = 4
PRINTING_INVALID = 5
POSTING_INVALID  = 6
OTHERS           = 7.
CASE SY-SUBRC.
WHEN 0.
WHEN OTHERS.
* #006 MOD 20110207 ISID144 START
**     メッセージ変数のセット
*      CASE SY-LANGU.
*        WHEN GCF_LA_J.                     " 日本語
*          LDF_MSGV1 = GCF_TXT9J.           "'BDC_INSERT 異常終了　例外：'
*        WHEN GCF_LA_1.                     " 中国語
*          LDF_MSGV1 = GCF_TXT9C.           "'BDC_INSERT #生##  代#：'
*        WHEN GCF_LA_E.                     " 英語
*          LDF_MSGV1 = GCF_TXT9E.
*          "'Error during BDC_INSERT processing. Exception:'
*      ENDCASE.
*      MESSAGE E398 WITH LDF_MSGV1 SY-SUBRC SPACE SPACE.
MESSAGE S039(ZFI001)
WITH SY-SUBRC
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDCASE.
ENDFORM.                    " FRM_BDC_INSERT

*&---------------------------------------------------------------------*
*&      Form  FRM_BDC_CLOSE
*&---------------------------------------------------------------------*
*       バッチインプットセッションのクローズ処理
*----------------------------------------------------------------------*
FORM FRM_BDC_CLOSE.

* #006 DEL 20110207 ISID144 START
*  DATA:
*    LDF_MSGV1(50) TYPE C.                  " メッセージ変数１
* #006 DEL 20110207 ISID144 END

* セッションを閉じる
CALL FUNCTION 'BDC_CLOSE_GROUP'
EXCEPTIONS
NOT_OPEN    = 1
QUEUE_ERROR = 2
OTHERS      = 3.
CASE SY-SUBRC.
WHEN 0.
WHEN OTHERS.
* #006 MOD 20110207 ISID144 START
**     メッセージ変数のセット
*      CASE SY-LANGU.
*        WHEN GCF_LA_J.                     " 日本語
*          LDF_MSGV1 = GCF_TXT10J.          "'BDC_CLOSE 異常終了　例外：'
*        WHEN GCF_LA_1.                     " 中国語
*          LDF_MSGV1 = GCF_TXT10C.          "'BDC_CLOSE #生##  代#：'
*        WHEN GCF_LA_E.                     " 英語
*          LDF_MSGV1 = GCF_TXT10E.
*          "'Error during BDC_CLOSE processing. Exception:'
*      ENDCASE.
*      MESSAGE E398 WITH LDF_MSGV1 SY-SUBRC SPACE SPACE.
MESSAGE S040(ZFI001)
WITH SY-SUBRC
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDCASE.
ENDFORM.                    " FRM_BDC_CLOSE

*&---------------------------------------------------------------------*
*&      Form  FRM_CALL_RSBDCSUB
*&---------------------------------------------------------------------*
*       セッションの自動処理
*----------------------------------------------------------------------*
FORM FRM_CALL_RSBDCSUB.

* #006 DEL 20110207 ISID144 START
*  DATA:
*    LDF_MSGV1(50) TYPE C.         " メッセージ変数１
* #006 DEL 20110207 ISID144 END

* セッションを処理
SUBMIT RSBDCSUB                 " バッチインプット: 全セッション処理
WITH MAPPE    = SY-UNAME           " セッション
WITH Z_VERARB = GCF_CHK            " 新規
WITH FEHLER   = ' '                " エラー
AND RETURN.
* #006 MOD 20110207 ISID144 START
** メッセージ変数のセット
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.                     " 日本語
*      LDF_MSGV1 = GCF_TXT11J.          "'セッションログを確認してください'
*    WHEN GCF_LA_1.                     " 中国語
*      LDF_MSGV1 = GCF_TXT11C.          "'###批#入会##理##'
*    WHEN GCF_LA_E.                     " 英語
*      LDF_MSGV1 = GCF_TXT11E.          "'Check the logs of session.'
*  ENDCASE.
*  MESSAGE I398 WITH SY-UNAME LDF_MSGV1 SPACE SPACE.
MESSAGE I083(ZFI001) WITH SY-UNAME.
* #006 MOD 20110207 ISID144 END
ENDFORM.                    " FRM_CALL_RSBDCSUB
* #006 DEL 20110207 ISID144 START
**&---------------------------------------------------------------------*
**&      Form  FRM_SET_TITLE
**&---------------------------------------------------------------------*
**       プログラム表題の設定
**----------------------------------------------------------------------*
*FORM FRM_SET_TITLE .
*
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.                     " 日本語
**    初期値のまま
*    WHEN GCF_LA_1.                     " 中国語
*      SY-TITLE = GCF_TITLE_1.          "'供#商住数据上#'
*    WHEN GCF_LA_E.                     " 英語
*      SY-TITLE = GCF_TITLE_E.          "'Upload the vender master records'
*  ENDCASE.
*
*ENDFORM.                    " FRM_SET_TITLE
* #006 DEL 20110207 ISID144 END
*&---------------------------------------------------------------------*
*&      Form  FRM_N_U_SET
*&---------------------------------------------------------------------*
*       制御コード項目の登録(N)/変更(U)設定
*----------------------------------------------------------------------*
FORM FRM_N_U_SET .
DATA:LDF_LIFNR TYPE LFA1-LIFNR.
* 仕入先マスタ（一般）の存在チェック
SELECT SINGLE LIFNR                  " 仕入先コード
INTO LDF_LIFNR
FROM LFA1                          " 仕入先マスタ：一般データ
WHERE LIFNR = WA_LIFNRC.            " 仕入先コード
CASE SY-SUBRC.
WHEN 0.
* 仕入先マスタ（会社）の存在チェック
SELECT SINGLE LIFNR                  " 仕入先コード
INTO LDF_LIFNR
FROM LFB1                          " 仕入先マスタ：一般データ
WHERE LIFNR = WA_LIFNRC AND        " 仕入先コード
BUKRS = GDS_REC-BUKRS.         " 会社コード
CASE SY-SUBRC.
WHEN 0.
GDS_REC-FLAG = GCF_CTRU.           " 変更(U)設定
WHEN OTHERS.
GDS_REC-FLAG = GCF_CTRN.           " 登録(N)設定
ENDCASE.
WHEN OTHERS.
GDS_REC-FLAG = GCF_CTRN.           " 登録(N)設定
ENDCASE.
ENDFORM.                    " FRM_N_U_SET

*&---------------------------------------------------------------------*
*&      Form  FRM_CHECK_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FRM_CHECK_DATA .

*  DATA:LDF_MSGV1(50) TYPE C.           " メッセージ変数１ "#006 DEL

* ファイルのループ処理（対象は、N:新規 U:更新フラグを持つもののみ)
LOOP AT GDT_REC INTO GDS_REC WHERE FLAG = GCF_CTRN   " N
OR    FLAG = GCF_CTRU . " U
EXIT.

ENDLOOP.

* 処理件数のカウント
CHECK SY-SUBRC <> 0.
* #006 MOD 20110207 ISID144 START
**   メッセージ変数のセット
*  CASE SY-LANGU.
*    WHEN GCF_LA_J.                                     " 日本語
*      LDF_MSGV1 = GCF_TXT6J.                           " 'タブ区切りファイルにデータが存在しません'
*    WHEN GCF_LA_1.                                     " 中国語
*      LDF_MSGV1 = GCF_TXT6C.                           " 'TAB#隔文本文件中没有数据'
*    WHEN GCF_LA_E.                                     " 英語
*      LDF_MSGV1 = GCF_TXT6E.                           " 'TAB file is empty.'
*  ENDCASE.
*  MESSAGE E398 WITH LDF_MSGV1 SPACE SPACE SPACE.
MESSAGE S015(ZFI001) DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
* #006 MOD 20110207 ISID144 END
ENDFORM.                    " FRM_CHECK_DATA
*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0310
*&---------------------------------------------------------------------*
*       購買組織データ（購買データ）にデータセット
*----------------------------------------------------------------------*
FORM FRM_SET_0310 .

PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0310,          " 画面設定
**** START UPD 2014/09/30 ISID18 ****
GCF_SPC 'BDC_OKCODE' GCF_VW.          " OKコード(保存)
IF GDS_REC-WAERS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-WAERS' GDS_REC-WAERS.     " 購買発注通貨
ENDIF.
IF GDS_REC-ZTERM2 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-ZTERM' GDS_REC-ZTERM2.    " 支払条件
ENDIF.
IF GDS_REC-INCO1 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-INCO1' GDS_REC-INCO1.     " インコタームズ１
ENDIF.
IF GDS_REC-INCO2 IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-INCO2' GDS_REC-INCO2.     " インコタームズ２
ENDIF.
IF GDS_REC-MINBW IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-MINBW' GDS_REC-MINBW.     " 最低発注金額
ENDIF.
IF GDS_REC-KALSK IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-KALSK' GDS_REC-KALSK.     " 決定表Group(仕入先)
ENDIF.
IF GDS_REC-MEPRF IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-MEPRF' GDS_REC-MEPRF.     " 価格設定日制御
ENDIF.
IF GDS_REC-WEBRE IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-WEBRE' GDS_REC-WEBRE.     " 入庫基準の請求書照合
ENDIF.
IF GDS_REC-LFABC IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-LFABC' GDS_REC-LFABC.     " ABC 区分
ENDIF.
IF GDS_REC-XERSY IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-XERSY' GDS_REC-XERSY.     " ERS　入庫
ENDIF.
IF GDS_REC-XERSR IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-XERSR' GDS_REC-XERSR.     " ERS　返品
ENDIF.
IF GDS_REC-KZABS IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-KZABS' GDS_REC-KZABS.     " 購買発注請書依頼
ENDIF.
IF GDS_REC-KZAUT IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-KZAUT' GDS_REC-KZAUT.     " 自動購買発注
ENDIF.
IF GDS_REC-VSBED IS NOT INITIAL.
PERFORM FRM_BDCDATA_SET USING:
GCF_SPC 'LFM1-VSBED' GDS_REC-VSBED.     " 出荷条件
ENDIF.
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM      GCF_0320,         " 画面設定(取引先機能)
GCF_SPC 'BDC_OKCODE' GCF_UPDA.          " OKコード(保存
*      GCF_SPC 'BDC_OKCODE' GCF_UPDA,          " OKコード(保存)
*      GCF_SPC 'LFM1-WAERS' GDS_REC-WAERS,     " 購買発注通貨
*      GCF_SPC 'LFM1-ZTERM' GDS_REC-ZTERM2,    " 支払条件
*      GCF_SPC 'LFM1-INCO1' GDS_REC-INCO1,     " インコタームズ１
*      GCF_SPC 'LFM1-INCO2' GDS_REC-INCO2,     " インコタームズ２
*      GCF_SPC 'LFM1-MINBW' GDS_REC-MINBW,     " 最低発注金額
*      GCF_SPC 'LFM1-KALSK' GDS_REC-KALSK,     " 決定表Group(仕入先)
*      GCF_SPC 'LFM1-MEPRF' GDS_REC-MEPRF,     " 価格設定日制御
*      GCF_SPC 'LFM1-WEBRE' GDS_REC-WEBRE,     " 入庫基準の請求書照合
*      GCF_SPC 'LFM1-LFABC' GDS_REC-LFABC,     " ABC 区分
*      GCF_SPC 'LFM1-XERSY' GDS_REC-XERSY,     " ERS　入庫
*      GCF_SPC 'LFM1-XERSR' GDS_REC-XERSR,     " ERS　返品
*      GCF_SPC 'LFM1-KZABS' GDS_REC-KZABS,     " 購買発注請書依頼
*      GCF_SPC 'LFM1-KZAUT' GDS_REC-KZAUT,     " 自動購買発注
**--------------------------------------------- 2010/06/22 DELETE START
**      GCF_SPC 'LFM1-PAPRF' GDS_REC-PAPRF,     " PROACT 管理 Prof.
**      GCF_SPC 'LFM1-XNBWY' GDS_REC-XNBWY,     " 再評価可能
**--------------------------------------------- 2010/06/22 DELETE END
*      GCF_SPC 'LFM1-NRGEW' GDS_REC-NRGEW,     " 無償納入許可
**--------------------------------------------- 2010/06/22 DELETE START
**      GCF_SPC 'LFM1-LEBRE' GDS_REC-LEBRE,     " Serv. 基準請求書照合
**--------------------------------------------- 2010/06/22 DELETE END
*      GCF_SPC 'LFM1-VSBED' GDS_REC-VSBED.     " 出荷条件
**** END UPD 2014/09/30 ISID18 ****

ENDFORM.                    " FRM_SET_0310
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_ZCAT_MA001
*&---------------------------------------------------------------------*
*       アドオン変数管理テーブル検索
*----------------------------------------------------------------------*
FORM FRM_SELECT_ZCAT_MA001 .

SELECT NAME KEY01 LOW
INTO CORRESPONDING FIELDS OF TABLE GDT_ZCAT_MA001
FROM ZCAT_MA001
WHERE NAME  = GCF_KTOKK        " アドオン変数名
AND PRGNM = SY-CPROG.        " プログラムID

ENDFORM.                    " FRM_SELECT_ZCAT_MA001
*&---------------------------------------------------------------------*
*&      Form  FRM_READ_ZCAT_MA001
*&---------------------------------------------------------------------*
*       勘定グループ取得
*----------------------------------------------------------------------*
*      -->PU_PARVW      取引先機能
*      <--PU_KTOKD      勘定グループ
*----------------------------------------------------------------------*
FORM FRM_READ_ZCAT_MA001 USING    PU_PARVW
CHANGING PU_KTOKD.

CLEAR : GDS_ZCAT_MA001.
READ TABLE GDT_ZCAT_MA001 INTO GDS_ZCAT_MA001
WITH KEY NAME  = GCF_KTOKK      " アドオン変数名
KEY01 = PU_PARVW       " 検索キー1
LOW   = GDS_REC-KTOKK. " 勘定グループ

*-▼ 取得できた場合、勘定グループセット
CHECK SY-SUBRC = 0.
PU_KTOKD = GDS_ZCAT_MA001-LOW.

ENDFORM.                    " FRM_READ_ZCAT_MA001
*&---------------------------------------------------------------------*
*&      Form  FRM_WRITE_RESULT
*&---------------------------------------------------------------------*
*       プログラム処理件数表示                                 "#006 ADD
*----------------------------------------------------------------------*
FORM FRM_WRITE_RESULT .

DATA:
LDF_LINE01(100)  TYPE C,
LDF_LINE02(50)   TYPE C,
LDF_INDEX(5)     TYPE C.

LDF_INDEX = CNT_INDEX.

CONCATENATE '**************<' SY-TITLE '>**************' INTO LDF_LINE01 SEPARATED BY SPACE.
CONCATENATE '*   ' TEXT-005 '      ='  LDF_INDEX       INTO LDF_LINE02 SEPARATED BY SPACE.
WRITE:
/ LDF_LINE01,
/ LDF_LINE02.

ENDFORM.                    " FRM_WRITE_RESULT
*&---------------------------------------------------------------------*
*&      Form  FRM_INPUT_CHECK
*&---------------------------------------------------------------------*
*       入力チェック                                           "#006 ADD
*----------------------------------------------------------------------*
FORM FRM_INPUT_CHECK .

DATA:
LDT_REC    TYPE STANDARD TABLE OF GTT_REC.

* 会社コードの権限チェック
LDT_REC[] = GDT_REC[].
* #010 ADD 20140909 ISID156 START
DELETE LDT_REC WHERE FLAG <> GCF_CTRN   " N
AND FLAG <> GCF_CTRU . " U
* #010 ADD 20140909 ISID156 END
SORT LDT_REC BY BUKRS.
DELETE ADJACENT DUPLICATES FROM LDT_REC
COMPARING BUKRS.
LOOP AT LDT_REC INTO GDS_REC.

AUTHORITY-CHECK OBJECT 'F_BKPF_BUK'
ID 'BUKRS' FIELD GDS_REC-BUKRS
ID 'ACTVT'  FIELD '01'.

IF SY-SUBRC <> 0.
MESSAGE S012(ZFI001)
WITH GDS_REC-BUKRS
DISPLAY LIKE 'E'.
LEAVE LIST-PROCESSING.
ENDIF.
ENDLOOP.

ENDFORM.                    " FRM_INPUT_CHECK
*&---------------------------------------------------------------------*
*&      Form  FRM_SET_0610
*&---------------------------------------------------------------------*
*       拡張源泉徴収税
*----------------------------------------------------------------------*
FORM FRM_SET_0610 .

* 日付項目が初期値の場合、スペースをセット
IF GDS_REC-EXDF = SPACE
OR GDS_REC-EXDF IS INITIAL.
GDS_REC-EXDF = SPACE.
ENDIF.
IF GDS_REC-EXDT = SPACE
OR GDS_REC-EXDT IS INITIAL.
GDS_REC-EXDT = SPACE.
ENDIF.

* バッチインプット編集
PERFORM
FRM_BDCDATA_SET USING:
GCF_CHK GCF_PGM GCF_0610,                  " 画面設定
GCF_SPC GCF_QLAND GDS_REC-QLAND,           "源泉徴収税国
GCF_SPC GCF_WITHT GDS_REC-WITHT,           "源泉徴収税タイプコード
GCF_SPC GCF_WITHCD GDS_REC-WITHCD,         "源泉徴収税コード
GCF_SPC GCF_SUBJCT GDS_REC-SUBJCT,         "フラグ: 源泉税課税対象
GCF_SPC GCF_QSREC GDS_REC-QSREC,           "受領タイプ
GCF_SPC GCF_WTSTCD GDS_REC-WTSTCD,         "源泉徴収税 ID 番号
GCF_SPC GCF_EXNR GDS_REC-EXNR,             "免除証明番号
GCF_SPC GCF_EXRT GDS_REC-EXRT,             "免除レート
GCF_SPC GCF_WTEXRS GDS_REC-WTEXRS,         "免除理由
GCF_SPC GCF_EXDF GDS_REC-EXDF,             "免除開始日
GCF_SPC GCF_EXDT GDS_REC-EXDT.             "免除終了日

*-▼ 勘定グループがFI用以外の場合、次画面遷移
IF WA_KTOKD_FI IS INITIAL.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE' GCF_VW.            " OKコード(次画面)
**-▼ 勘定グループがFI用の場合、保存
ELSE.
PERFORM
FRM_BDCDATA_SET USING:
GCF_SPC 'BDC_OKCODE' GCF_UPDA.      " OKコード(保存)
ENDIF.

ENDFORM.                    " FRM_SET_0610
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_T001
*&---------------------------------------------------------------------*
*       拡張源泉徴収税の有効化チェック
*----------------------------------------------------------------------*
FORM FRM_SELECT_T001 USING    PU_BUKRS
CHANGING PU_WT_NEWWT.
CLEAR PU_WT_NEWWT.
SELECT SINGLE WT_NEWWT
INTO PU_WT_NEWWT
FROM T001
WHERE BUKRS = PU_BUKRS.

ENDFORM.                    " FRM_SELECT_T001
*Text symbol text・
*001:Select the location for file
*002:File name
*003:Server
*004:Local
*005:The number of processes

REPORT ZHATATEST012 .

Tables :KNVH .


Types : Begin Of TYP_LIST ,
KUNNR Type KNA1-KUNNR ,
HKUNNR1 Type KNVH-HKUNNR ,
HKUNNR2 Type KNVH-HKUNNR ,
EFLAG1 Type C ,
EFLAG2 Type C ,
End Of TYP_LIST .


Data : TBL_LIST Type Table Of TYP_LIST ,
TBL_FLAG Type Table Of TYP_LIST ,
WK_LIST Type TYP_LIST ,
BK_LIST Type TYP_LIST .


Select-Options : S_KUNNR For KNVH-KUNNR .

Select KUNNR
HKUNNR As HKUNNR1
From KNVH
Into Table TBL_LIST
Where  KUNNR IN S_KUNNR
And   DATAB LE SY-DATUM
And   DATBI GE SY-DATUM .

Sort TBL_LIST By HKUNNR2 HKUNNR1 KUNNR .
Loop At TBL_LIST Into WK_LIST .
At First .
Move : WK_LIST To BK_LIST .
EndAt .
Select HKUNNR
From KNVH
Into WK_LIST-HKUNNR2
Where  KUNNR EQ WK_LIST-HKUNNR1
And   DATAB LE SY-DATUM
And   DATBI GE SY-DATUM .
Exit .
EndSelect .
If WK_LIST-HKUNNR2 Is Initial .
If WK_LIST-HKUNNR1 Is Initial .
Move : WK_LIST-KUNNR   To WK_LIST-HKUNNR2 .
Clear : WK_LIST-KUNNR .
Else .
Move : WK_LIST-HKUNNR1 To WK_LIST-HKUNNR2 ,
WK_LIST-KUNNR   To WK_LIST-HKUNNR1 .
Clear : WK_LIST-KUNNR .
EndIf .
EndIf .
If Not WK_LIST-KUNNR Is Initial .
If WK_LIST-HKUNNR1 NE BK_LIST-HKUNNR1 .
MOVE  'X' To  BK_LIST-EFLAG1 .
If WK_LIST-HKUNNR2 NE BK_LIST-HKUNNR2 .
MOVE  'X' To  BK_LIST-EFLAG2 .
EndIf .
Append BK_LIST To TBL_FLAG .
Clear : BK_LIST .
EndIf .
EndIf .
Modify TBL_LIST From WK_LIST .
Move : WK_LIST To BK_LIST .
At Last .
MOVE  'X' To : WK_LIST-EFLAG1 , WK_LIST-EFLAG2 .
Append WK_LIST To TBL_FLAG .
EndAt .
EndLoop .

Sort TBL_LIST By HKUNNR2 HKUNNR1 KUNNR .
Loop At TBL_LIST Into WK_LIST .

Write :/ WK_LIST-HKUNNR2 , WK_LIST-HKUNNR1 ,WK_LIST-KUNNR .
Clear : WK_LIST .
EndLoop .

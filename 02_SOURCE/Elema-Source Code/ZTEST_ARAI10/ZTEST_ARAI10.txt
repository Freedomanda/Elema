REPORT ZTEST_ARAI8 .

DATA : ZNEN002T LIKE TABLE OF ZNEN002.
DATA : ZNEN002W LIKE ZNEN002.
DATA : MONEY(16) TYPE P DECIMALS 2.
DATA : MONEY2(16) TYPE P DECIMALS 2.
DATA : MBEWT LIKE TABLE OF MBEW.
DATA : MBEWW LIKE MBEW.
DATA : MBEWHW LIKE MBEWH.


SELECT * FROM ZNEN002
INTO TABLE ZNEN002T
WHERE ZANDT = '20100131'.

SELECT * FROM MBEW
INTO TABLE MBEWT
WHERE LBKUM > 0.

SORT ZNEN002T BY MATNR WERKS.

LOOP AT MBEWT INTO MBEWW.

* 2月入庫が行われていたらMBEWHテーブルから1月末残情報を取得
IF MBEWW-LFGJA = '2009'
AND MBEWW-LFMON = '11'.
SELECT * FROM MBEWH
INTO MBEWHW
UP TO 1 ROWS
WHERE MATNR = MBEWW-MATNR
AND BWKEY = MBEWW-BWKEY
ORDER BY LFGJA DESCENDING LFMON DESCENDING.
ENDSELECT.

MOVE-CORRESPONDING MBEWHW TO MBEWW.

ENDIF.

MONEY = MBEWW-SALK3 * 100.

LOOP AT ZNEN002T INTO ZNEN002W
WHERE WERKS = MBEWW-BWKEY
AND MATNR = MBEWW-MATNR.
MONEY2 = ZNEN002W-ZKINGAKU.

MONEY = MONEY - MONEY2.
ENDLOOP.

IF MONEY NE 0.
WRITE : / MBEWW-MATNR,MBEWW-BWKEY, MONEY.
ENDIF.

*  READ TABLE ZNEN002T INTO ZNEN002W
*       WITH KEY MATNR = MBEWW-MATNR
*                WERKS = MBEWW-BWKEY
*                BINARY SEARCH.

*  SELECT SINGLE * FROM ZNEN002
*    INTO ZNEN002W
*   WHERE MATNR = MBEWW-MATNR
*     AND WERKS = MBEWW-BWTAR.





ENDLOOP.

WRITE / MONEY.

REPORT ZZSVF03 NO STANDARD PAGE HEADING MESSAGE-ID Z1.
*----------------------------------------------------------------------
DATA:BEGIN OF I_TAB,
TIME TYPE T,
END OF I_TAB.
DATA:D_TAB LIKE TABLE OF I_TAB WITH HEADER LINE.
TYPE-POOLS SABC.
DATA:MSG(100).
*----------------------------------------------------------------------
PARAMETERS P_LOCAL RADIOBUTTON GROUP GRP1.
PARAMETERS P_SERVE RADIOBUTTON GROUP GRP1 DEFAULT 'X'.
SELECTION-SCREEN SKIP 1.
PARAMETERS P_FNAME LIKE RLGRAP-FILENAME.
PARAMETERS P_FNAME2 LIKE AUTHB-FILENAME NO-DISPLAY.
*----------------------------------------------------------------------
START-OF-SELECTION.
IF P_LOCAL = 'X'.
PERFORM FRM_DOWNLOAD_PC.
ELSE.
PERFORM FRM_DOWNLOAD_SERVE.
ENDIF.
*----------------------------------------------------------------------
FORM FRM_DOWNLOAD_PC.
D_TAB-TIME = SY-UZEIT.
APPEND D_TAB.
CALL FUNCTION 'WS_DOWNLOAD'
EXPORTING
FILENAME                = P_FNAME
FILETYPE                = 'ASC'
TABLES
DATA_TAB                = D_TAB
EXCEPTIONS
FILE_OPEN_ERROR         = 1
FILE_WRITE_ERROR        = 2
INVALID_FILESIZE        = 3
INVALID_TYPE            = 4
NO_BATCH                = 5
UNKNOWN_ERROR           = 6
INVALID_TABLE_WIDTH     = 7
GUI_REFUSE_FILETRANSFER = 8
CUSTOMER_ERROR          = 9
OTHERS                  = 10.
IF SY-SUBRC <> 0.
WRITE:/ 'ファイル作成エラーです'.
WRITE:/ 'SY-SUBRC    ',SY-SUBRC.
WRITE:/ 'SYSTEM MESSAGE  ',MSG.
STOP.
ELSE.
MESSAGE I400 WITH 'ファイルを作成しました'.
ENDIF.
ENDFORM.
*----------------------------------------------------------------------
FORM FRM_DOWNLOAD_SERVE.
P_FNAME2 = P_FNAME.
CALL FUNCTION 'AUTHORITY_CHECK_DATASET'
EXPORTING
PROGRAM          = 'ZZSVF03'
ACTIVITY         = SABC_ACT_READ
FILENAME         = P_FNAME2
EXCEPTIONS
NO_AUTHORITY     = 1
ACTIVITY_UNKNOWN = 2.
IF SY-SUBRC <> 0.
WRITE:/ '権限チェックエラーです'.
WRITE:/ 'SY-SUBRC    ',SY-SUBRC.
WRITE:/ 'SYSTEM MESSAGE  ',MSG.
STOP.
ENDIF.
OPEN DATASET P_FNAME FOR OUTPUT IN TEXT MODE MESSAGE MSG.
IF SY-SUBRC <> 0.
WRITE:/ 'ファイルオープンエラーです'.
WRITE:/ 'SY-SUBRC    ',SY-SUBRC.
WRITE:/ 'SYSTEM MESSAGE  ',MSG.
STOP.
ENDIF.
TRANSFER SY-UZEIT TO P_FNAME.
IF SY-SUBRC <> 0.
WRITE:/ 'ファイルトランスファーエラーです'.
WRITE:/ 'SY-SUBRC    ',SY-SUBRC.
WRITE:/ 'SYSTEM MESSAGE  ',MSG.
STOP.
ENDIF.
CLOSE DATASET P_FNAME.
IF SY-SUBRC <> 0.
MESSAGE S400 WITH 'ファイルクローズエラーです'.
WRITE:/ 'ファイルクローズエラーです'.
WRITE:/ 'SY-SUBRC    ',SY-SUBRC.
WRITE:/ 'SYSTEM MESSAGE  ',MSG.
STOP.
ELSE.
MESSAGE I400 WITH 'ファイルを作成しました'.
ENDIF.
ENDFORM.
*----------------------------------------------------------------------

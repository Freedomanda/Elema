REPORT ZHATATEST018 .
*&---------------------------------------------------------------------*
*& Report  ACC_BAPI_TEST_DOCUMENT                                      *
*&                                                                     *
*&---------------------------------------------------------------------*
*& Test report, calls BAPI AcctngDocument                              *
*&                                                                     *
*&---------------------------------------------------------------------*

SELECTION-SCREEN BEGIN OF BLOCK BL01 .

PARAMETERS:
CHECK_L             RADIOBUTTON GROUP RB1,
CHECK_A RADIOBUTTON GROUP RB1,
POST  DEFAULT 'X' RADIOBUTTON GROUP RB1.
SELECTION-SCREEN ULINE.
PARAMETERS:
REF_KEY LIKE BAPIACHE01-OBJ_KEY DEFAULT 'TEST000001BAPICALL',
DEST    LIKE BDI_LOGSYS-LOGSYS  DEFAULT '          '.

SELECTION-SCREEN END   OF BLOCK BL01 .

DATA:
GD_DOCUMENTHEADER    LIKE BAPIACHE09,
GD_CUSTOMERCPD       LIKE BAPIACPA09,
GD_FICA_HD           LIKE BAPIACCAHD,
IT_ACCOUNTRECEIVABLE LIKE TABLE OF BAPIACAR09 WITH HEADER LINE,
IT_ACCOUNTGL         LIKE TABLE OF BAPIACGL09 WITH HEADER LINE,
IT_ACCOUNTTAX        LIKE TABLE OF BAPIACTX09 WITH HEADER LINE,
IT_CRITERIA          LIKE TABLE OF BAPIACKEC9 WITH HEADER LINE,
IT_VALUEFIELD        LIKE TABLE OF BAPIACKEV9 WITH HEADER LINE,
IT_CURRENCYAMOUNT    LIKE TABLE OF BAPIACCR09 WITH HEADER LINE,
IT_RETURN            LIKE TABLE OF BAPIRET2   WITH HEADER LINE,
IT_RECEIVERS         LIKE TABLE OF BDI_LOGSYS WITH HEADER LINE,
IT_FICA_IT           LIKE TABLE OF BAPIACCAIT WITH HEADER LINE,
IT_ACCOUNTPAYABLE    LIKE TABLE OF BAPIACAP09 WITH HEADER LINE,
IT_PAYMENTCARD       LIKE TABLE OF BAPIACPC09 WITH HEADER LINE,
IT_EXT               LIKE TABLE OF BAPIACEXTC WITH HEADER LINE,
IT_EXT2              LIKE TABLE OF BAPIPAREX  WITH HEADER LINE.

PERFORM FILL_INTERNAL_TABLES.

IF POST = 'X'.

DATA: L_TYPE LIKE GD_DOCUMENTHEADER-OBJ_TYPE,
L_KEY  LIKE GD_DOCUMENTHEADER-OBJ_KEY,
L_SYS  LIKE GD_DOCUMENTHEADER-OBJ_SYS.

IF DEST = SPACE OR
DEST = GD_DOCUMENTHEADER-OBJ_SYS.

CALL FUNCTION 'BAPI_ACC_DOCUMENT_POST'
EXPORTING
DOCUMENTHEADER    = GD_DOCUMENTHEADER
IMPORTING
OBJ_TYPE          = L_TYPE
OBJ_KEY           = L_KEY
OBJ_SYS           = L_SYS
TABLES
ACCOUNTGL         = IT_ACCOUNTGL
ACCOUNTPAYABLE    = IT_ACCOUNTPAYABLE
CURRENCYAMOUNT    = IT_CURRENCYAMOUNT
RETURN            = IT_RETURN
.
WRITE: / 'Result of post:'.                             "#EC NOTEXT
PERFORM SHOW_MESSAGES.

ELSE.

IT_RECEIVERS-LOGSYS = DEST.
APPEND IT_RECEIVERS.

CALL FUNCTION 'ALE_ACC_DOCUMENT_POST'
EXPORTING
DOCUMENTHEADER    = GD_DOCUMENTHEADER
TABLES
ACCOUNTGL         = IT_ACCOUNTGL
ACCOUNTPAYABLE    = IT_ACCOUNTPAYABLE
CURRENCYAMOUNT    = IT_CURRENCYAMOUNT
EXCEPTIONS
ERROR_CREATING_IDOCS    = 1
OTHERS                  = 2  .

IF SY-SUBRC = 0.
WRITE: / 'IDoc created'.                              "#EC NOTEXT
ELSE.
WRITE: SY-MSGID.
ENDIF.

ENDIF.
ENDIF.

COMMIT WORK .
*---------------------------------------------------------------------*
*      Form  fill_internal_tables
*---------------------------------------------------------------------*
FORM FILL_INTERNAL_TABLES.

PERFORM FILL_HEADER.
PERFORM FILL_ACCOUNTGL.
PERFORM FILL_CURRENCYAMOUNT.
ENDFORM.                               " fill_internal_tables

*---------------------------------------------------------------------*
*      Form  Show_messages
*---------------------------------------------------------------------*
FORM SHOW_MESSAGES.

IF IT_RETURN[] IS INITIAL.
WRITE: / 'no messages'.
ELSE.
SKIP 1.
LOOP AT IT_RETURN.
WRITE: /    IT_RETURN-TYPE,
(2)  IT_RETURN-ID,
IT_RETURN-NUMBER,
(80) IT_RETURN-MESSAGE,
(20) IT_RETURN-PARAMETER,
(3)  IT_RETURN-ROW,
IT_RETURN-FIELD.
ENDLOOP.
ENDIF.

ULINE.

ENDFORM.                               " Show_messages


*---------------------------------------------------------------------*
*       FORM fill_accountgl                                           *
*---------------------------------------------------------------------*
FORM FILL_ACCOUNTGL.
DATA : W_CNT TYPE I .
CLEAR : W_CNT .
DO 11 TIMES .
ADD 1 TO W_CNT .
CLEAR IT_ACCOUNTGL.

IF W_CNT NE 9 .
IT_ACCOUNTGL-ITEMNO_ACC     = W_CNT .
ELSE.
IT_ACCOUNTPAYABLE-ITEMNO_ACC = W_CNT .
ENDIF.

CASE W_CNT .
WHEN 1 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006120001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '55Statio' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　インドビザ申請用の写真代　0825'.
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 2 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '日の丸交通' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　三田―品川　ノーリツ　0903'.
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 3 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '株式会社　川崎タ' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　西明石-魚住　ノーリツ　0903' .
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 4 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '小菅タクシー' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　品川―三田　ノーリツ　0906' .
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 5 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '大和自動車' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　赤坂-芝　デュポン帝人　0907' .
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 6 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '夢交通' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　東京-芝　東芝深谷　0908' .
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 7 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '大東京自動車' .
IT_ACCOUNTGL-ITEM_TEXT   = '権藤　品川-三田　ソニーエリクソン　0909'.
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 8 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0006126001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '日本交通' .
IT_ACCOUNTGL-ITEM_TEXT      = '権藤　品川-三田　品川プリンス　0910' .
IT_ACCOUNTGL-FIS_PERIOD     = '00'.
WHEN 11 .
IT_ACCOUNTGL-GL_ACCOUNT     = '0001119001'.
*  IT_ACCOUNTGL-ALLOC_NMBR     = 'TEST' .
*  IT_ACCOUNTGL-ITEM_TEXT      = 'TEST' .

WHEN 9 .
IT_ACCOUNTPAYABLE-VENDOR_NO   = '0005500001'.
IT_ACCOUNTPAYABLE-GL_ACCOUNT = '0002105001'.
IT_ACCOUNTPAYABLE-ITEM_TEXT  = '権藤愼司　9/14'.
IT_ACCOUNTPAYABLE-ALLOC_NMBR  = '社員' .
WHEN 10.
IT_ACCOUNTGL-GL_ACCOUNT     = '0001117001'.
IT_ACCOUNTGL-ALLOC_NMBR     = '仮払金' .
IT_ACCOUNTGL-ITEM_TEXT      = '仮払金' .
ENDCASE.


IF W_CNT NE 9 AND W_CNT NE 10.
IT_ACCOUNTGL-TAX_CODE       = 'V1'.
ENDIF .

IF W_CNT EQ 1 OR
W_CNT EQ 2 OR
W_CNT EQ 3 OR
W_CNT EQ 4 OR
W_CNT EQ 5 OR
W_CNT EQ 6 OR
W_CNT EQ 7 OR
W_CNT EQ 8.
IT_ACCOUNTGL-COSTCENTER     = 'GY02' .
IT_ACCOUNTGL-PROFIT_CTR     = 'RY02' .
ENDIF .

IF W_CNT NE 9.
APPEND IT_ACCOUNTGL.
ELSE.
APPEND IT_ACCOUNTPAYABLE.
ENDIF.
ENDDO .
ENDFORM.                    "fill_accountgl

*---------------------------------------------------------------------*
*       FORM fill_header                                              *
*---------------------------------------------------------------------*
FORM FILL_HEADER.

*  CALL FUNCTION 'OWN_LOGICAL_SYSTEM_GET'
*    IMPORTING
*      OWN_LOGICAL_SYSTEM = GD_DOCUMENTHEADER-OBJ_SYS.
*
*  GD_DOCUMENTHEADER-OBJ_TYPE   = 'IDOC'.
*  GD_DOCUMENTHEADER-OBJ_KEY    = REF_KEY.
GD_DOCUMENTHEADER-USERNAME   = 'tec1494'.
GD_DOCUMENTHEADER-HEADER_TXT = 'Etec0735_0054'.
GD_DOCUMENTHEADER-COMP_CODE  = 'C001'.
GD_DOCUMENTHEADER-FISC_YEAR  = '2010'.
GD_DOCUMENTHEADER-DOC_DATE   = '20101014'.
GD_DOCUMENTHEADER-DOC_TYPE   = 'KR'.
GD_DOCUMENTHEADER-PSTNG_DATE = '20101014'.
GD_DOCUMENTHEADER-BUS_ACT    = 'RFBU'.
GD_DOCUMENTHEADER-FIS_PERIOD    = '00'.

ENDFORM.                    "fill_header

*---------------------------------------------------------------------*
*       FORM fill_currencyamount                                      *
*---------------------------------------------------------------------*
FORM FILL_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 1.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '1400'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 2.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '676'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 3.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '1905'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 4.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '676'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 5.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '1448'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 6.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '1876'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 7.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '762'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 8.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '848'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 9.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '10070'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 10.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '20140-'.
APPEND IT_CURRENCYAMOUNT.

CLEAR IT_CURRENCYAMOUNT.
IT_CURRENCYAMOUNT-ITEMNO_ACC   = 11.
IT_CURRENCYAMOUNT-CURRENCY     = 'JPY'.
IT_CURRENCYAMOUNT-AMT_DOCCUR   = '479'.
APPEND IT_CURRENCYAMOUNT.

ENDFORM.                    "fill_currencyamount

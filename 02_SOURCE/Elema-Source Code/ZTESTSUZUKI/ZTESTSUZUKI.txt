REPORT ZTESTSUZUKI.
TABLES:MKPF,
MSEG.

TYPES:BEGIN OF T_TABLE,
MBLNR TYPE MKPF-MBLNR,
MJAHR TYPE MKPF-MJAHR,
BUDAT TYPE MKPF-BUDAT,
BWART TYPE MSEG-BWART,
MATNR TYPE MSEG-MATNR,
WERKS TYPE MSEG-WERKS,
MEINS TYPE MSEG-MEINS,
ERFME TYPE MSEG-ERFME,
SOBKZ TYPE MSEG-SOBKZ,
SHKZG TYPE MSEG-SHKZG,
MENGE TYPE MSEG-MENGE,
KZBEW TYPE MSEG-KZBEW,
KZVBR TYPE MSEG-KZVBR,
KZZUG TYPE MSEG-KZZUG,
PSTYV TYPE VBAP-PSTYV,
END OF T_TABLE.

TYPES: BEGIN OF V_TABLE,
MBNLR TYPE MKPF-MBLNR,
BUDAT TYPE MKPF-BUDAT,
MATNR TYPE MSEG-MATNR,
WERKS TYPE MSEG-MATNR,
SHKZG TYPE MSEG-SHKZG,
KDAUF TYPE MSEG-KDAUF,
KDPOS TYPE MSEG-KDPOS,
VBELN TYPE VBAK-VBELN,
POSNR TYPE VBAP-POSNR,
BSTNK TYPE VBAK-BSTNK,
KUNNR TYPE VBAK-KUNNR,
VKBUR TYPE VBAK-VKBUR,
VKGPR TYPE VBAK-VKGRP,
PSTYV TYPE VBAP-PSTYV,
BANFN TYPE VBEP-BANFN,
EBELN TYPE EBAN-EBELN,
END OF V_TABLE.

DATA:
IT_TABLE TYPE TABLE OF T_TABLE,
IST_TABLE TYPE T_TABLE.

DATA:
IT_VTABLE TYPE TABLE OF V_TABLE,
IST_VTABLE TYPE V_TABLE.

DATA:W_LINES TYPE I.

START-OF-SELECTION.


SELECT MKPF~MBLNR
MKPF~BUDAT
MSEG~MATNR
MSEG~WERKS
MSEG~SHKZG
MSEG~KDAUF
MSEG~KDPOS
VBAK~VBELN
VBAP~POSNR
VBAK~BSTNK
VBAK~KUNNR
VBAK~VKBUR
VBAK~VKGRP
VBAP~PSTYV
VBEP~BANFN
EBAN~EBELN
INTO CORRESPONDING FIELDS OF TABLE IT_VTABLE
FROM MKPF
INNER JOIN MSEG
ON MKPF~MBLNR = MSEG~MBLNR
INNER JOIN VBAK
ON VBAK~VBELN = MSEG~KDAUF
INNER JOIN VBAP
ON VBAP~VBELN = VBAK~VBELN AND
VBAP~POSNR = MSEG~KDPOS
INNER JOIN VBEP
ON VBEP~VBELN = VBAK~VBELN AND
VBEP~POSNR = VBAP~POSNR
INNER JOIN EBAN
ON EBAN~BANFN = VBEP~BANFN
WHERE BUDAT <= '2009/04/30'
AND BUDAT >= '2009/02/01'
AND MSEG~SHKZG = 'S'
*           AND MSEG~KDAUF <> SPACE
*           AND MSEG~EBELN = SPACE
*           AND MSEG~MENGE >= 1
*           AND VBAP~PSTYV = 'TAB'
*           AND EBAN~EBELN <> SPACE
.


*
*  SELECT MKPF~MBLNR
*         MKPF~MJAHR
*         MKPF~BUDAT
*         MSEG~BWART
*         MSEG~MATNR
*         MSEG~WERKS
*         MSEG~MEINS
*         MSEG~ERFME
*         MSEG~SOBKZ
*         MSEG~SHKZG
*         MSEG~MENGE
*         MSEG~KZBEW
*         MSEG~KZVBR
*         MSEG~KZZUG
*         VBAP~PSTYV
*         INTO CORRESPONDING FIELDS OF TABLE IT_TABLE
*         FROM MKPF
*         INNER JOIN MSEG
*         ON MKPF~MBLNR = MSEG~MBLNR
*         INNER JOIN VBAP
*         ON VBAP~VBELN = MSEG~KDAUF
*         WHERE MKPF~BUDAT <= '2009/03/31'
*           AND MKPF~BUDAT >= '2009/03/01'
*           AND MSEG~SHKZG = 'S'
**           AND ( MSEG~BWART = '654'
**            OR MSEG~BWART = '653'
**            OR MSEG~BWART = '964'
**            OR MSEG~BWART = '963' )
**           and MSEG~EBELN = space
*           AND MSEG~MENGE >= 1
**           AND PSTYV = 'TAB'.
*  .
*  LOOP AT IT_TABLE INTO IST_TABLE.
*    IF IST_TABLE-MEINS = IST_TABLE-ERFME.
*      DELETE IT_TABLE.
*    ENDIF.
*  ENDLOOP.
*
*  SORT IT_TABLE BY BUDAT
*                   MATNR
*                   WERKS
*                   SHKZG
*                   BWART.
*  DESCRIBE TABLE IT_TABLE LINES W_LINES.
SORT IT_VTABLE BY BUDAT
MATNR
WERKS
SHKZG.


DESCRIBE TABLE IT_VTABLE LINES W_LINES.
IF W_LINES = 0.
MESSAGE ID '00'
TYPE 'S'
NUMBER '208'
WITH '対象データなし'.
ENDIF.

WRITE:/1 '入出庫伝票',
15 '転記日付',
28 '品目コード',
50 'プラント',
55 '貸借',
60 '受注伝票番号',
75 '受注明細番号',
90 '明カ',
95 '購買依頼番号',
110 '購買伝票番号'.

*  LOOP AT IT_VTABLE INTO IST_VTABLE.
*    WRITE:/1   IST_VTABLE-MBNLR,
*           15  IST_VTABLE-BUDAT,
*           28 IST_VTABLE-MATNR,
*           50 IST_VTABLE-WERKS,
*           55 IST_VTABLE-SHKZG,
*           60 IST_VTABLE-KDAUF,
*           75 IST_VTABLE-KDPOS,
*           90 IST_VTABLE-PSTYV,
*           95 IST_VTABLE-BANFN,
*           110 IST_VTABLE-EBELN.
*
*  ENDLOOP.
*  WRITE:/ '入出庫伝票番号',
*        12 '転記日付',
*        30 '品目コード',
*        50 'プラント',
*        60 '数量',
*        75 '基単',
*        80 '入単',
*        85 '貸借',
*        90 '移タ',
*        95 '移区',
*        100 '消区',
*        105 '入区'.
*
*  LOOP AT IT_TABLE INTO IST_TABLE.
*    WRITE:/ IST_TABLE-MBLNR,
*            12 IST_TABLE-BUDAT,
*            30 IST_TABLE-MATNR,
*            50 IST_TABLE-WERKS,
*            60 IST_TABLE-MENGE,
*            75 IST_TABLE-MEINS,
*            80 IST_TABLE-ERFME,
*            85 IST_TABLE-SHKZG,
*            90 IST_TABLE-BWART,
*            95 IST_TABLE-KZBEW,
*            100 IST_TABLE-KZVBR,
*            105 IST_TABLE-KZZUG.
*  ENDLOOP.
** 対象除外条件
*
*SELECTION-SCREEN BEGIN OF BLOCK BLK03 NO INTERVALS.
**SELECTION-SCREEN BEGIN OF BLOCK BLK03 WITH FRAME
**                                      TITLE TEXT-B03
**                                      NO INTERVALS.
*SELECTION-SCREEN COMMENT 1(12) TEXT-B03.
*SELECTION-SCREEN BEGIN OF LINE.
*SELECTION-SCREEN COMMENT 1(10) TEXT-B21 FOR FIELD S_INIT1.
*SELECTION-SCREEN POSITION 9.
*SELECT-OPTIONS S_INIT1 FOR MSEG-BWART NO-EXTENSION.
*
*SELECTION-SCREEN COMMENT 18(8) TEXT-B22 FOR FIELD S_INIK1.
*SELECTION-SCREEN POSITION 26.
*SELECT-OPTIONS S_INIK1 FOR MSEG-KZBEW NO-EXTENSION.
*
*SELECTION-SCREEN COMMENT 32(8) TEXT-B23 FOR FIELD S_INSK1.
*SELECTION-SCREEN POSITION 40.
*SELECT-OPTIONS S_INSK1 FOR MSEG-KZVBR NO-EXTENSION.
*
*SELECTION-SCREEN COMMENT 45(8) TEXT-B24 FOR FIELD S_INNK1.
*SELECTION-SCREEN POSITION 53.
*SELECT-PTIONS  S_INNK1 FOR MSEG-KZZUG NO-EXTENSION.
*
*SELECTION-SCREEN COMMENT 58(12) TEXT-B25 FOR FIELD S_INNK1.
*SELECTION-SCREEN POSITION 70.
*SELECT-OPTIONS S_INTK1 FOR MSEG-UMSOK NO-EXTENSION.
*SELECTION-SCREEN END OF LINE.
*SELECTION-SCREEN END OF BLOCK BLK03.

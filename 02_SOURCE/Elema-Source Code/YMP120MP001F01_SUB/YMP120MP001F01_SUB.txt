*----------------------------------------------------------------------*
*   INCLUDE YMP120MP001F01                                             *
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  A1F_SET_CURSOR_9000_001
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SET_CURSOR_9000_001.

SET CURSOR FIELD '/A1F/YMNS0001-YL_KUNNR'.

IF A1F_WG_KNMT-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_KUNNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KUNNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_KDMAT IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KDMAT'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_POSTX IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_POSTX'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_MARA-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_MATNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_HNMKTYP IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_HNMKTYP'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MAKTX IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MAKTX'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MEINS IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MEINS'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_MVKE-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_VRKME IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_VRKME'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_MARA-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_BSTME IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_BSTME'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MATKL IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATKL'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PRDHA IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PRDHA'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_MVKE-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_MVGR1 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR1'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MVGR2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR2'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MVGR3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR3'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_MARD-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_LGPBE IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_LGPBE'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_MARC-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_WEBAZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_WEBAZ'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_INFORECORD_GENERAL-MATERIAL IS INITIAL .
IF /A1F/YMNS0001-YM_LIFNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_LIFNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_INDLF IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_INDLF'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_APLFZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_APLFZ'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_KUBIJUHUTYUK IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KUBIJUHUTYUK'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_KUBUJUHUTEXT IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KUBUJUHUTEXT'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MWSKZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MWSKZ'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_KNMT-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_SDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATAB'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATBI'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SKBETR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKBETR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SKMEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKMEIN'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKPEIN'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_INFORECORD_GENERAL-MATERIAL IS INITIAL .
IF /A1F/YMNS0001-YM_PDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATAB'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATBI'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PKBETR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKBETR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PKMEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKMEIN'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKPEIN'.
EXIT .
ENDIF .
ENDIF .

ENDFORM.                    " A1F_SET_CURSOR_9000_001
*&---------------------------------------------------------------------*
*&      Form  A1F_CLEAR_SALESDATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_SALESDATA .

CLEAR :
/A1F/YMNS0001-YM_KUNNR ,
/A1F/YMNS0001-YM_TKISKNM ,
/A1F/YMNS0001-YM_KDMAT ,
/A1F/YMNS0001-YM_POSTX ,
/A1F/YMNS0001-YM_SDATAB ,
/A1F/YMNS0001-YM_SDATBI ,
/A1F/YMNS0001-YM_SKBETR ,
/A1F/YMNS0001-YM_SKMEIN ,
/A1F/YMNS0001-YM_SKPEIN ,
/A1F/YMNS0001-YM_SWAERS ,
/A1F/YMNS0001-YM_SSKSTBM1 ,
/A1F/YMNS0001-YM_SSKONMS1 ,
/A1F/YMNS0001-YM_SSKBETR1 ,
/A1F/YMNS0001-YM_SSKMEIN1 ,
/A1F/YMNS0001-YM_SSKPEIN1 ,
/A1F/YMNS0001-YM_SSKSTBM2 ,
/A1F/YMNS0001-YM_SSKONMS2 ,
/A1F/YMNS0001-YM_SSKBETR2 ,
/A1F/YMNS0001-YM_SSKMEIN2 ,
/A1F/YMNS0001-YM_SSKPEIN2 ,
/A1F/YMNS0001-YM_SSKSTBM3 ,
/A1F/YMNS0001-YM_SSKONMS3 ,
/A1F/YMNS0001-YM_SSKBETR3 ,
/A1F/YMNS0001-YM_SSKMEIN3 ,
/A1F/YMNS0001-YM_SSKPEIN3 ,
/A1F/YMNS0001-YM_SSKSTBM4 ,
/A1F/YMNS0001-YM_SSKONMS4 ,
/A1F/YMNS0001-YM_SSKBETR4 ,
/A1F/YMNS0001-YM_SSKMEIN4 ,
/A1F/YMNS0001-YM_SSKPEIN4 ,
/A1F/YMNS0001-YM_SSKSTBM5 ,
/A1F/YMNS0001-YM_SSKONMS5 ,
/A1F/YMNS0001-YM_SSKBETR5 ,
/A1F/YMNS0001-YM_SSKMEIN5 ,
/A1F/YMNS0001-YM_SSKPEIN5 .

ENDFORM.                    " A1F_CLEAR_SALESDATA
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_PURCHASE_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_PURCHASE_DATA .

CLEAR :
/A1F/YMNS0001-YM_LIFNR ,
/A1F/YMNS0001-YM_SIRSKNM ,
/A1F/YMNS0001-YM_SIRSKKBN1 ,
/A1F/YMNS0001-YM_SIRSKKBN2 ,
/A1F/YMNS0001-YM_INDLF ,
/A1F/YMNS0001-YM_APLFZ ,
/A1F/YMNS0001-YM_KUBIJUHUTYUK ,
/A1F/YMNS0001-YM_KUBIJUHUTYUK2 ,
/A1F/YMNS0001-YM_KUBUJUHUTEXT ,
/A1F/YMNS0001-YM_MWSKZ ,
/A1F/YMNS0001-YM_PDATAB ,
/A1F/YMNS0001-YM_PDATBI ,
/A1F/YMNS0001-YM_PKBETR ,
/A1F/YMNS0001-YM_PKMEIN ,
/A1F/YMNS0001-YM_PKPEIN ,
/A1F/YMNS0001-YM_PWAERS ,
/A1F/YMNS0001-YM_PSKSTBM1 ,
/A1F/YMNS0001-YM_PSKONMS1 ,
/A1F/YMNS0001-YM_PSKBETR1 ,
/A1F/YMNS0001-YM_PSKMEIN1 ,
/A1F/YMNS0001-YM_PSKPEIN1 ,
/A1F/YMNS0001-YM_PSKSTBM2 ,
/A1F/YMNS0001-YM_PSKONMS2 ,
/A1F/YMNS0001-YM_PSKBETR2 ,
/A1F/YMNS0001-YM_PSKMEIN2 ,
/A1F/YMNS0001-YM_PSKPEIN2 ,
/A1F/YMNS0001-YM_PSKSTBM3 ,
/A1F/YMNS0001-YM_PSKONMS3 ,
/A1F/YMNS0001-YM_PSKBETR3 ,
/A1F/YMNS0001-YM_PSKMEIN3 ,
/A1F/YMNS0001-YM_PSKPEIN3 ,
/A1F/YMNS0001-YM_PSKSTBM4 ,
/A1F/YMNS0001-YM_PSKONMS4 ,
/A1F/YMNS0001-YM_PSKBETR4 ,
/A1F/YMNS0001-YM_PSKMEIN4 ,
/A1F/YMNS0001-YM_PSKPEIN4 ,
/A1F/YMNS0001-YM_PSKSTBM5 ,
/A1F/YMNS0001-YM_PSKONMS5 ,
/A1F/YMNS0001-YM_PSKBETR5 ,
/A1F/YMNS0001-YM_PSKMEIN5 ,
/A1F/YMNS0001-YM_PSKPEIN5 .

ENDFORM.                    " a1f_clear_PURCHASE_DATA
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_base_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_BASE_DATA .

CLEAR :
/A1F/YMNS0001-YM_MATNR ,
/A1F/YMNS0001-YM_HNMKTYP ,
/A1F/YMNS0001-YM_TMPSRYHS ,
/A1F/YMNS0001-YM_MAKTX ,
/A1F/YMNS0001-YM_MEINS ,
/A1F/YMNS0001-YM_BSTME ,
/A1F/YMNS0001-YM_MATKL ,
/A1F/YMNS0001-YM_PRDHA ,
/A1F/YMNS0001-YM_LGPBE ,
/A1F/YMNS0001-YM_WEBAZ ,
/A1F/YMNS0001-YM_URKKK ,
/A1F/YMNS0001-YM_ARRRT ,
/A1F/YMNS0001-YM_SYUSUTNHYUJ .


ENDFORM.                    " a1f_clear_base_DATA
*&---------------------------------------------------------------------*
*&      Form  A1F_SET_CURSOR_9000_002
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SET_CURSOR_9000_002 .

IF A1F_WG_MARA-MATNR IS INITIAL .

IF /A1F/YMNS0001-YM_HNMKTYP IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_HNMKTYP'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MATNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MAKTX IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MAKTX'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MEINS IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MEINS'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MATKL IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATKL'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PRDHA IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PRDHA'.
EXIT .
ENDIF .
ENDIF .

IF A1F_WG_MVKE-MATNR IS INITIAL .

IF /A1F/YMNS0001-YM_MVGR1 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR1'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MVGR2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR2'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MVGR3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR3'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_MARD-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_LGPBE IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_LGPBE'.
EXIT .
ENDIF .
ENDIF .

IF A1F_TG_MARC-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_WEBAZ IS INITIAL .
IF /A1F/YMNS0001-YM_SIRSKKBN2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_WEBAZ'.
EXIT .
ENDIF .
ENDIF .
ENDIF .

IF A1F_TG_MBEW-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_VERPR_CH IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_VERPR_CH'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PEINH IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PEINH'.
EXIT .
ENDIF .

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 出荷指示備考、原産地、HSコード、危険物区分、該非判定、危険物コード
** 商品名、用途、重量、単位
IF /A1F/YMNS0001-YM_HERKL IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_HERKL'.
EXIT .
ENDIF .
** 2007/07/20 INSERT END

ENDIF .


ENDFORM.                    " A1F_SET_CURSOR_9000_002
*&---------------------------------------------------------------------*
*&      Form  A1F_SET_CURSOR_9000_003
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SET_CURSOR_9000_003 .

IF A1F_WG_KNMT-MATNR IS INITIAL .
IF /A1F/YMNS0001-YM_KUNNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KUNNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_KDMAT IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KDMAT'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SKBETR_CH IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKBETR_CH'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKPEIN'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATAB'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_SDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATBI'.
EXIT .
ENDIF .

ENDIF .


ENDFORM.                    " A1F_SET_CURSOR_9000_003
*&---------------------------------------------------------------------*
*&      Form  A1F_SET_CURSOR_9000_004
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SET_CURSOR_9000_004 .

IF A1F_TG_INFORECORD_GENERAL-MATERIAL IS INITIAL .
IF /A1F/YMNS0001-YM_LIFNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_LIFNR'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_MWSKZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MWSKZ'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PKBETR_CH IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKBETR_CH'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKPEIN'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATAB'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_PDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATBI'.
EXIT .
ENDIF .

IF /A1F/YMNS0001-YM_APLFZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_APLFZ'.
EXIT .
ENDIF .

ENDIF .


ENDFORM.                    " A1F_SET_CURSOR_9000_004
*&---------------------------------------------------------------------*
*&      Form  a1f_get_material_detail
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_GET_MATERIAL_DETAIL .

SELECT SINGLE * FROM  MARA
INTO A1F_WG_MARA
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR.
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MARA .
PERFORM A1F_CLEAR_MVKE .
PERFORM A1F_CLEAR_MARC .
PERFORM A1F_CLEAR_MARD .
PERFORM A1F_CLEAR_MBEW .
EXIT .
ELSE .
SELECT SINGLE MAKTX FROM  MAKT
INTO /A1F/YMNS0001-YM_MAKTX
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND    SPRAS  = SY-LANGU.
IF SY-SUBRC NE 0 .
CLEAR : /A1F/YMNS0001-YM_MAKTX.
ENDIF .
/A1F/YMNS0001-YM_MEINS = A1F_WG_MARA-MEINS .
/A1F/YMNS0001-YM_BSTME = A1F_WG_MARA-BSTME .
/A1F/YMNS0001-YM_MATKL = A1F_WG_MARA-MATKL .
/A1F/YMNS0001-YM_PRDHA = A1F_WG_MARA-PRDHA .
/A1F/YMNS0001-YM_HNMKTYP = A1F_WG_MARA-MTART .
ENDIF .

SELECT SINGLE * FROM  MVKE
INTO A1F_WG_MVKE
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND    VKORG  = /A1F/YMNS0001-VKORG
AND    VTWEG  = /A1F/YMNS0001-VTWEG.
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MARA .
PERFORM A1F_CLEAR_MVKE .
PERFORM A1F_CLEAR_MARC .
PERFORM A1F_CLEAR_MARD .
PERFORM A1F_CLEAR_MBEW .
EXIT .
ELSE .
/A1F/YMNS0001-YM_VRKME = A1F_WG_MVKE-VRKME .
/A1F/YMNS0001-YM_MVGR1 = A1F_WG_MVKE-MVGR1 .
/A1F/YMNS0001-YM_MVGR2 = A1F_WG_MVKE-MVGR2 .
/A1F/YMNS0001-YM_MVGR3 = A1F_WG_MVKE-MVGR3 .
*   PERFORM A1F_SET_YM_HNMKTYP .
ENDIF .

SELECT * FROM  MARC
INTO TABLE A1F_TG_MARC
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND  WERKS  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MARC .
MESSAGE E306(/A1F/YLMS0100) WITH /A1F/YMNS0001-YM_MATNR
/A1F/YMNS0001-WERKS.
ELSE .
READ TABLE A1F_TG_MARC INDEX 1 .
/A1F/YMNS0001-YM_WEBAZ = A1F_TG_MARC-WEBAZ .
ENDIF .

SELECT * FROM  MARD
INTO TABLE A1F_TG_MARD
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND  WERKS  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MARD .
ELSE .
READ TABLE A1F_TG_MARD INDEX 1 .
/A1F/YMNS0001-YM_LGPBE = A1F_TG_MARD-LGPBE .
ENDIF .

SELECT * FROM  MBEW
INTO TABLE A1F_TG_MBEW
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND  BWKEY  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MBEW .
ELSE .
READ TABLE A1F_TG_MBEW INDEX 1 .
/A1F/YMNS0001-YM_VERPR = A1F_TG_MBEW-VERPR .
/A1F/YMNS0001-YM_PEINH = A1F_TG_MBEW-PEINH .
ENDIF .

SELECT * FROM  MARM
INTO TABLE A1F_TG_MARM
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR .
IF SY-SUBRC NE 0 .
PERFORM A1F_CLEAR_MARM .
ELSE .
IF /A1F/YMNS0001-YM_VRKME IS INITIAL .
CLEAR : /A1F/YMNS0001-YM_UMRENS ,
/A1F/YMNS0001-YM_UMREZS .
ELSE .
READ TABLE A1F_TG_MARM WITH KEY
MATNR = /A1F/YMNS0001-YM_MATNR
MEINH = /A1F/YMNS0001-YM_VRKME.
IF SY-SUBRC = 0 .
/A1F/YMNS0001-YM_UMRENS = A1F_TG_MARM-UMREN .
/A1F/YMNS0001-YM_UMREZS = A1F_TG_MARM-UMREZ .
ELSE .
CLEAR : /A1F/YMNS0001-YM_UMRENS ,
/A1F/YMNS0001-YM_UMREZS .
ENDIF .
ENDIF .
IF /A1F/YMNS0001-YM_BSTME IS INITIAL .
CLEAR : /A1F/YMNS0001-YM_UMRENP ,
/A1F/YMNS0001-YM_UMREZP .
ELSE .
READ TABLE A1F_TG_MARM WITH KEY
MATNR = /A1F/YMNS0001-YM_MATNR
MEINH = /A1F/YMNS0001-YM_BSTME.
IF SY-SUBRC = 0 .
/A1F/YMNS0001-YM_UMRENP = A1F_TG_MARM-UMREN .
/A1F/YMNS0001-YM_UMREZP = A1F_TG_MARM-UMREZ .
ELSE .
CLEAR : /A1F/YMNS0001-YM_UMRENP ,
/A1F/YMNS0001-YM_UMREZP .
ENDIF .
ENDIF .
ENDIF .

ENDFORM.                    " a1f_get_material_detail
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_mara
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MARA .

CLEAR   : A1F_WG_MARA .
*            /A1F/YMNS0001-YM_HNMKTYP ,
*            /A1F/YMNS0001-YM_MAKTX ,
*            /A1F/YMNS0001-YM_MEINS ,
*            /A1F/YMNS0001-YM_BSTME ,
*            /A1F/YMNS0001-YM_MATKL ,
*            /A1F/YMNS0001-YM_PRDHA .

ENDFORM.                    " a1f_clear_mara
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_mvke
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MVKE .

CLEAR   : A1F_WG_MVKE .
*            /A1F/YMNS0001-YM_VRKME ,
*            /A1F/YMNS0001-YM_MVGR1 ,
*            /A1F/YMNS0001-YM_MVGR2 ,
*            /A1F/YMNS0001-YM_MVGR3 .

ENDFORM.                    " a1f_clear_mvke
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_marc
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MARC .

CLEAR   : A1F_TG_MARC .
*            /A1F/YMNS0001-YM_WEBAZ .
REFRESH : A1F_TG_MARC .

ENDFORM.                    " a1f_clear_marc
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_mard
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MARD .

CLEAR   : A1F_TG_MARD .
*            /A1F/YMNS0001-YM_LGPBE .
REFRESH : A1F_TG_MARD .

ENDFORM.                    " a1f_clear_mard
*&---------------------------------------------------------------------*
*&      Form  a1f_clear_mbew
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MBEW .

CLEAR   : A1F_TG_MBEW .
*            /A1F/YMNS0001-YM_LGPBE .
REFRESH : A1F_TG_MBEW .

ENDFORM.                    " a1f_clear_mbew
*&---------------------------------------------------------------------*
*&      Form  a1f_check_and_save
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_AND_SAVE .

IF NOT ( A1F_WG_SAVE_FLG IS INITIAL ) .
EXIT .
ENDIF .


DATA A1F_WL_SUBRC LIKE SY-SUBRC .

PERFORM A1F_CHECK_BEFORE_SAVE .

PERFORM A1F_SAVE_MATERIAL CHANGING A1F_WL_SUBRC .
IF A1F_WL_SUBRC IS INITIAL .
MESSAGE I295(/A1F/YLMS0100) .
ELSEIF A1F_WL_SUBRC NE 1 .
MESSAGE I296(/A1F/YLMS0100) .
EXIT .
ENDIF .
PERFORM A1F_SAVE_CUSTOMER_MATERIAL CHANGING A1F_WL_SUBRC .
IF A1F_WL_SUBRC IS INITIAL .
MESSAGE I299(/A1F/YLMS0100) .
ELSEIF A1F_WL_SUBRC NE 1 .
MESSAGE I300(/A1F/YLMS0100) .
ENDIF .
PERFORM A1F_SAVE_PURCHASE_INFO CHANGING A1F_WL_SUBRC .
IF A1F_WL_SUBRC IS INITIAL .
MESSAGE I297(/A1F/YLMS0100) .
ELSEIF A1F_WL_SUBRC NE 1 .
MESSAGE I298(/A1F/YLMS0100) .
ENDIF .
PERFORM A1F_SAVE_SOURCE_OF_SUPLY CHANGING A1F_WL_SUBRC .
IF A1F_WL_SUBRC IS INITIAL .
MESSAGE I308(/A1F/YLMS0100) .
ELSEIF A1F_WL_SUBRC NE 1 .
MESSAGE I309(/A1F/YLMS0100) .
ENDIF .
PERFORM A1F_SAVE_SALES_PRICE CHANGING A1F_WL_SUBRC .
IF A1F_WL_SUBRC IS INITIAL .
MESSAGE I301(/A1F/YLMS0100) .
ELSEIF A1F_WL_SUBRC NE 1 .
MESSAGE I302(/A1F/YLMS0100) .
ENDIF .

A1F_WG_SAVE_FLG = 'X' .

ENDFORM.                    " a1f_check_and_save
*&---------------------------------------------------------------------*
*&      Form  a1f_save_material
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SAVE_MATERIAL CHANGING P_SUBRC .

P_SUBRC =  9.

IF NOT ( A1F_WG_MARA-MATNR IS INITIAL ) .
P_SUBRC = 1 .
EXIT .
ENDIF .

DATA A1F_WL_ITEM_CAT LIKE BAPI_MARA-ITEM_CAT .

SELECT SINGLE VMTPO FROM  T134
INTO A1F_WL_ITEM_CAT
WHERE  MTART  = /A1F/YMNS0001-YM_HNMKTYP.
IF SY-SUBRC NE 0 .
CLEAR A1F_WL_ITEM_CAT .
ENDIF .

DATA : A1F_WL_HEADDATA LIKE BAPIMATHEAD .
DATA : A1F_WL_RETURN LIKE BAPIRET2 .
DATA : A1F_WL_CLIENTDATA LIKE BAPI_MARA .
DATA : A1F_WL_CLIENTDATAX LIKE BAPI_MARAX .
DATA : A1F_WL_PLANTDATA LIKE BAPI_MARC .
DATA : A1F_WL_PLANTDATAX LIKE BAPI_MARCX .
DATA : A1F_WL_STORAGELOCATIONDATA LIKE BAPI_MARD .
DATA : A1F_WL_STORAGELOCATIONDATAX LIKE BAPI_MARDX .
DATA : A1F_WL_VALUATIONDATA LIKE BAPI_MBEW .
DATA : A1F_WL_VALUATIONDATAX LIKE BAPI_MBEWX .
DATA : A1F_WL_SALESDATA LIKE BAPI_MVKE .
DATA : A1F_WL_SALESDATAX LIKE BAPI_MVKEX .

DATA : A1F_TL_MATERIALDESCRIPTION LIKE TABLE OF
BAPI_MAKT WITH HEADER LINE .
DATA : A1F_TL_UNITSOFMEASURE LIKE TABLE OF
BAPI_MARM WITH HEADER LINE .
DATA : A1F_TL_UNITSOFMEASUREX LIKE TABLE OF
BAPI_MARMX WITH HEADER LINE .
DATA : A1F_TL_TAXCLASSIFICATIONS LIKE TABLE OF
BAPI_MLAN WITH HEADER LINE .
DATA : A1F_TL_RETURNMESSAGES LIKE TABLE OF
BAPI_MATRETURN2 WITH HEADER LINE .

DATA : A1F_WL_TMP_VALUE LIKE BAPICURR-BAPICURR .
CLEAR : A1F_WL_TMP_VALUE .

A1F_WL_HEADDATA-MATERIAL = /A1F/YMNS0001-YM_MATNR .
A1F_WL_HEADDATA-IND_SECTOR = /A1F/YMNS0001-IND_SECTOR .
A1F_WL_HEADDATA-MATL_TYPE = /A1F/YMNS0001-YM_HNMKTYP .
A1F_WL_HEADDATA-BASIC_VIEW    = 'X' .
A1F_WL_HEADDATA-SALES_VIEW    = 'X' .
A1F_WL_HEADDATA-PURCHASE_VIEW = 'X' .
A1F_WL_HEADDATA-STORAGE_VIEW  = 'X' .
A1F_WL_HEADDATA-ACCOUNT_VIEW  = 'X' .

A1F_WL_CLIENTDATA-MATL_GROUP = /A1F/YMNS0001-YM_MATKL . "品目グループ
A1F_WL_CLIENTDATA-BASE_UOM = /A1F/YMNS0001-YM_MEINS .   "基本数量単位
A1F_WL_CLIENTDATA-PO_UNIT = /A1F/YMNS0001-YM_BSTME .    "発注単位
A1F_WL_CLIENTDATA-TRANS_GRP = /A1F/YMNS0001-TRANS_GRP . "輸送グループ
A1F_WL_CLIENTDATA-DIVISION = /A1F/YMNS0001-SPART .      "製品部門
A1F_WL_CLIENTDATA-PROD_HIER = /A1F/YMNS0001-YM_PRDHA .  "品目階層
A1F_WL_CLIENTDATA-ITEM_CAT = A1F_WL_ITEM_CAT .          "明細カテゴリG
* Append By Mis-Ohno
A1F_WL_CLIENTDATA-BASIC_MATL = /A1F/YMNS0001-YM_WRKST . "主構成物質
A1F_WL_CLIENTDATA-STD_DESCR  = /A1F/YMNS0001-YM_NORMT . "標準テキスト
* End Append

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 危険物コード、重量、単位

A1F_WL_CLIENTDATA-NET_WEIGHT = /A1F/YMNS0001-YM_NTGEW .
A1F_WL_CLIENTDATA-HAZ_MAT_NO = /A1F/YMNS0001-YM_STOFF .
** 2007/07/20 INSERT END

A1F_WL_CLIENTDATAX-MATL_GROUP = 'X' .
A1F_WL_CLIENTDATAX-BASE_UOM = 'X' .
A1F_WL_CLIENTDATAX-PO_UNIT =  'X' .
A1F_WL_CLIENTDATAX-TRANS_GRP = 'X' .
A1F_WL_CLIENTDATAX-DIVISION = 'X' .
A1F_WL_CLIENTDATAX-PROD_HIER = 'X' .
A1F_WL_CLIENTDATAX-ITEM_CAT = 'X' .

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 危険物コード、重量、単位
A1F_WL_CLIENTDATAX-NET_WEIGHT = 'X' .
A1F_WL_CLIENTDATAX-HAZ_MAT_NO = 'X' .
** 2007/07/20 INSERT END

* Append By Mis-Ohno
A1F_WL_CLIENTDATAX-BASIC_MATL = 'X' .
A1F_WL_CLIENTDATAX-STD_DESCR  = 'X' .
* End Append

A1F_WL_PLANTDATA-PLANT = /A1F/YMNS0001-WERKS .   "プラント
A1F_WL_PLANTDATA-PUR_GROUP = /A1F/YMNS0001-EKGRP .  "購買グループ
A1F_WL_PLANTDATA-PLND_DELRY = /A1F/YMNS0001-YM_APLFZ .
"予定納入時間 (単位: 日)
A1F_WL_PLANTDATA-GR_PR_TIME = /A1F/YMNS0001-YM_WEBAZ .
"入庫処理日数
A1F_WL_PLANTDATA-LOADINGGRP = /A1F/YMNS0001-LOADINGGRP .
"積載グループ
IF /A1F/YMNS0001-YM_HNMKTYP = 'NLAG' .
A1F_WL_PLANTDATA-AVAILCHECK = /A1F/YMNS0001-AVAILCHECK2 .
ELSE .
A1F_WL_PLANTDATA-AVAILCHECK = /A1F/YMNS0001-AVAILCHECK .
ENDIF .
"確認グループ（利用可能在庫）
A1F_WL_PLANTDATA-AUTO_P_ORD = 'X' .
"自動購買発注

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 原産地、危険物区分
A1F_WL_PLANTDATA-COUNTRYORI = /A1F/YMNS0001-YM_HERKL .
A1F_WL_PLANTDATA-COMM_CODE = /A1F/YMNS0001-YM_STAWN .
** 2007/07/20 INSERT END


A1F_WL_PLANTDATAX-PLANT = /A1F/YMNS0001-WERKS .
A1F_WL_PLANTDATAX-PUR_GROUP = 'X' .
A1F_WL_PLANTDATAX-PLND_DELRY = 'X' .
A1F_WL_PLANTDATAX-GR_PR_TIME = 'X' .
A1F_WL_PLANTDATAX-LOADINGGRP = 'X' .
A1F_WL_PLANTDATAX-AVAILCHECK = 'X' .
A1F_WL_PLANTDATAX-AUTO_P_ORD = 'X' .

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 原産地、危険物区分
A1F_WL_PLANTDATAX-COUNTRYORI = 'X' .
A1F_WL_PLANTDATAX-COMM_CODE = 'X' .
** 2007/07/20 INSERT END

A1F_WL_STORAGELOCATIONDATA-PLANT = /A1F/YMNS0001-WERKS .
"プラント
A1F_WL_STORAGELOCATIONDATA-STGE_LOC = /A1F/YMNS0001-LGORT .
"保管場所
A1F_WL_STORAGELOCATIONDATA-STGE_BIN = /A1F/YMNS0001-YM_LGPBE .
"棚番

A1F_WL_STORAGELOCATIONDATAX-PLANT = /A1F/YMNS0001-WERKS .
A1F_WL_STORAGELOCATIONDATAX-STGE_LOC = /A1F/YMNS0001-LGORT .
A1F_WL_STORAGELOCATIONDATAX-STGE_BIN = 'X' .

A1F_WL_VALUATIONDATA-VAL_AREA = /A1F/YMNS0001-WERKS .
"評価エリア
A1F_WL_VALUATIONDATA-PRICE_CTRL = /A1F/YMNS0001-PRICE_CTRL .
"原価管理区分

**** START ADD 2014/08/27 ISID･喩 ****
CLEAR A1F_WL_VALUATIONDATA-MOVING_PR .
**** END ADD 2014/08/27 ISID･喩 ****
CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_EXTERNAL'
EXPORTING
CURRENCY        = /A1F/YMNS0001-YM_WAERS
AMOUNT_INTERNAL = /A1F/YMNS0001-YM_VERPR
IMPORTING
AMOUNT_EXTERNAL = A1F_WL_TMP_VALUE.
**** START DEL 2014/08/27 ISID･喩 ****
*  IF SY-SUBRC = 0 .
**** END DEL 2014/08/27 ISID･喩 ****
A1F_WL_VALUATIONDATA-MOVING_PR = A1F_WL_TMP_VALUE .
**** START DEL 2014/08/27 ISID･喩 ****
*  ELSE .
*    CLEAR A1F_WL_VALUATIONDATA-MOVING_PR .
*  ENDIF .
**** END DEL 2014/08/27 ISID･喩 ****

"移動平均原価/期間単位価格
A1F_WL_VALUATIONDATA-VAL_CLASS = /A1F/YMNS0001-VAL_CLASS .
"評価クラス
A1F_WL_VALUATIONDATA-PRICE_UNIT = /A1F/YMNS0001-YM_PEINH .
" 移動平均原価　価格単位

A1F_WL_VALUATIONDATAX-VAL_AREA = /A1F/YMNS0001-WERKS .
A1F_WL_VALUATIONDATAX-PRICE_CTRL = 'X' .
A1F_WL_VALUATIONDATAX-MOVING_PR  = 'X' .
A1F_WL_VALUATIONDATAX-VAL_CLASS = 'X' .
A1F_WL_VALUATIONDATAX-PRICE_UNIT = 'X' .

A1F_WL_SALESDATA-SALES_ORG = /A1F/YMNS0001-VKORG . "販売組織
A1F_WL_SALESDATA-DISTR_CHAN = /A1F/YMNS0001-VTWEG .  "流通チャネル
A1F_WL_SALESDATA-MATL_STATS = /A1F/YMNS0001-MATL_STATS .
"品目統計グループ
A1F_WL_SALESDATA-SALES_UNIT = /A1F/YMNS0001-YM_VRKME .  "販売単位
A1F_WL_SALESDATA-DELYG_PLNT = /A1F/YMNS0001-WERKS .  "出荷プラント
A1F_WL_SALESDATA-PROD_HIER =  /A1F/YMNS0001-YM_PRDHA . "品目階層
A1F_WL_SALESDATA-MAT_PR_GRP = /A1F/YMNS0001-MAT_PR_GRP .
"品目価格設定グループ
A1F_WL_SALESDATA-ACCT_ASSGT = /A1F/YMNS0001-ACCT_ASSGT .
"品目の勘定設定グループ
A1F_WL_SALESDATA-ITEM_CAT = A1F_WL_CLIENTDATA-ITEM_CAT .
"明細カテゴリグループ
A1F_WL_SALESDATA-MATL_GRP_1 = /A1F/YMNS0001-YM_MVGR1 .
"品目グループ 1
A1F_WL_SALESDATA-MATL_GRP_2 = /A1F/YMNS0001-YM_MVGR2 .
"品目グループ 2
A1F_WL_SALESDATA-MATL_GRP_3 = /A1F/YMNS0001-YM_MVGR3 .
"品目グループ 3
A1F_WL_SALESDATA-MATL_GRP_4 = /A1F/YMNS0001-YM_KIHTBHBIJSK .
"品目グループ 4

* 2010/10/14 DMW2286品目グループ5 - start
A1F_WL_SALESDATA-MATL_GRP_5 = /A1F/YMNS0001-YM_INITIAL.
* 2010/10/14 DMW2286品目グループ5 - end

A1F_WL_SALESDATA-PROD_ATT_1 = /A1F/YMNS0001-PROD_ATT_1 .  "輸出規制
A1F_WL_SALESDATA-PROD_ATT_2 = /A1F/YMNS0001-PROD_ATT_2 .  "鉛（RoHS）
A1F_WL_SALESDATA-PROD_ATT_3 = /A1F/YMNS0001-PROD_ATT_3 .
"水銀（RoHS）
A1F_WL_SALESDATA-PROD_ATT_4 = /A1F/YMNS0001-PROD_ATT_4 .
"カドミウム（RoHS）
A1F_WL_SALESDATA-PROD_ATT_5 = /A1F/YMNS0001-PROD_ATT_5 .
"六価クロム（RoHS）
A1F_WL_SALESDATA-PROD_ATT_6 = /A1F/YMNS0001-PROD_ATT_6 . "PBB（RoHS）
A1F_WL_SALESDATA-PROD_ATT_7 = /A1F/YMNS0001-PROD_ATT_7 .
"PBDE（RoHS）

A1F_WL_SALESDATAX-SALES_ORG  = /A1F/YMNS0001-VKORG .
A1F_WL_SALESDATAX-DISTR_CHAN = /A1F/YMNS0001-VTWEG .
A1F_WL_SALESDATAX-MATL_STATS = 'X' .
A1F_WL_SALESDATAX-SALES_UNIT = 'X' .
A1F_WL_SALESDATAX-DELYG_PLNT = 'X' .
A1F_WL_SALESDATAX-PROD_HIER  = 'X' .
A1F_WL_SALESDATAX-MAT_PR_GRP = 'X' .
A1F_WL_SALESDATAX-ACCT_ASSGT = 'X' .
A1F_WL_SALESDATAX-ITEM_CAT   = 'X' .
A1F_WL_SALESDATAX-MATL_GRP_1 = 'X' .
A1F_WL_SALESDATAX-MATL_GRP_2 = 'X' .
A1F_WL_SALESDATAX-MATL_GRP_3 = 'X' .
A1F_WL_SALESDATAX-MATL_GRP_4 = 'X' .
* 2010/10/14 DMW2286品目グループ5 - start
A1F_WL_SALESDATAX-MATL_GRP_5 = 'X' .
* 2010/10/14 DMW2286品目グループ5 - end
A1F_WL_SALESDATAX-PROD_ATT_1 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_2 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_3 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_4 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_5 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_6 = 'X' .
A1F_WL_SALESDATAX-PROD_ATT_7 = 'X' .

A1F_TL_MATERIALDESCRIPTION-LANGU = SY-LANGU .
A1F_TL_MATERIALDESCRIPTION-MATL_DESC = /A1F/YMNS0001-YM_MAKTX .
APPEND A1F_TL_MATERIALDESCRIPTION .

A1F_TL_TAXCLASSIFICATIONS-TAX_TYPE_1 = /A1F/YMNS0001-TAX_TYPE_1 .
A1F_TL_TAXCLASSIFICATIONS-TAXCLASS_1 = /A1F/YMNS0001-TAXCLASS_1 .
A1F_TL_TAXCLASSIFICATIONS-DEPCOUNTRY = /A1F/YMNS0001-DEPCOUNTRY .
APPEND A1F_TL_TAXCLASSIFICATIONS .

IF NOT ( /A1F/YMNS0001-YM_UMRENS IS INITIAL ) .
A1F_TL_UNITSOFMEASURE-ALT_UNIT = /A1F/YMNS0001-YM_VRKME .
*    A1F_TL_UNITSOFMEASURE-ALT_UNIT_ISO = /A1F/YMNS0001-YM_VRKME .
A1F_TL_UNITSOFMEASURE-DENOMINATR = /A1F/YMNS0001-YM_UMRENS .
A1F_TL_UNITSOFMEASURE-NUMERATOR = /A1F/YMNS0001-YM_UMREZS .
APPEND A1F_TL_UNITSOFMEASURE .
A1F_TL_UNITSOFMEASUREX-ALT_UNIT = /A1F/YMNS0001-YM_VRKME .
*    A1F_TL_UNITSOFMEASUREX-ALT_UNIT_ISO = /A1F/YMNS0001-YM_VRKME .
A1F_TL_UNITSOFMEASUREX-DENOMINATR = 'X' .
A1F_TL_UNITSOFMEASUREX-NUMERATOR = 'X' .
APPEND A1F_TL_UNITSOFMEASUREX .
ENDIF .
IF NOT ( /A1F/YMNS0001-YM_UMRENP IS INITIAL )
AND /A1F/YMNS0001-YM_VRKME NE /A1F/YMNS0001-YM_BSTME.
A1F_TL_UNITSOFMEASURE-ALT_UNIT = /A1F/YMNS0001-YM_BSTME .
A1F_TL_UNITSOFMEASURE-ALT_UNIT_ISO = /A1F/YMNS0001-YM_BSTME .
A1F_TL_UNITSOFMEASURE-DENOMINATR = /A1F/YMNS0001-YM_UMRENP .
A1F_TL_UNITSOFMEASURE-NUMERATOR = /A1F/YMNS0001-YM_UMREZP .
APPEND A1F_TL_UNITSOFMEASURE .
A1F_TL_UNITSOFMEASUREX-ALT_UNIT = /A1F/YMNS0001-YM_BSTME .
A1F_TL_UNITSOFMEASUREX-ALT_UNIT_ISO = /A1F/YMNS0001-YM_BSTME .
A1F_TL_UNITSOFMEASUREX-DENOMINATR = 'X' .
A1F_TL_UNITSOFMEASUREX-NUMERATOR = 'X' .
APPEND A1F_TL_UNITSOFMEASUREX .
ENDIF .

CALL FUNCTION 'BAPI_MATERIAL_SAVEDATA'
EXPORTING
HEADDATA             = A1F_WL_HEADDATA
CLIENTDATA           = A1F_WL_CLIENTDATA
CLIENTDATAX          = A1F_WL_CLIENTDATAX
PLANTDATA            = A1F_WL_PLANTDATA
PLANTDATAX           = A1F_WL_PLANTDATAX
STORAGELOCATIONDATA  = A1F_WL_STORAGELOCATIONDATA
STORAGELOCATIONDATAX = A1F_WL_STORAGELOCATIONDATAX
VALUATIONDATA        = A1F_WL_VALUATIONDATA
VALUATIONDATAX       = A1F_WL_VALUATIONDATAX
SALESDATA            = A1F_WL_SALESDATA
SALESDATAX           = A1F_WL_SALESDATAX
IMPORTING
RETURN               = A1F_WL_RETURN
TABLES
MATERIALDESCRIPTION  = A1F_TL_MATERIALDESCRIPTION
UNITSOFMEASURE       = A1F_TL_UNITSOFMEASURE
UNITSOFMEASUREX      = A1F_TL_UNITSOFMEASUREX
TAXCLASSIFICATIONS   = A1F_TL_TAXCLASSIFICATIONS
RETURNMESSAGES       = A1F_TL_RETURNMESSAGES.
LOOP AT A1F_TL_RETURNMESSAGES
WHERE TYPE NE 'H' .
MESSAGE ID A1F_TL_RETURNMESSAGES-ID
TYPE A1F_TL_RETURNMESSAGES-TYPE
NUMBER A1F_TL_RETURNMESSAGES-NUMBER
WITH A1F_TL_RETURNMESSAGES-MESSAGE_V1
A1F_TL_RETURNMESSAGES-MESSAGE_V2
A1F_TL_RETURNMESSAGES-MESSAGE_V3
A1F_TL_RETURNMESSAGES-MESSAGE_V4.
ENDLOOP .

IF A1F_WL_RETURN-TYPE = 'E' .
EXIT .
ELSE .
A1F_WG_MARA-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_WG_MVKE-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_TG_MARC-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_TG_MARD-MATNR = /A1F/YMNS0001-YM_MATNR .
COMMIT WORK AND WAIT .
ENDIF .

CLEAR P_SUBRC .

ENDFORM.                    " a1f_save_material
*&---------------------------------------------------------------------*
*&      Form  a1f_save_Customer_Material
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SAVE_CUSTOMER_MATERIAL CHANGING P_SUBRC .

P_SUBRC = 9 .

DATA : A1F_WL_KNMT LIKE KNMT .
DATA : A1F_TL_KNMT_RETURN LIKE TABLE OF BAPIRET2
WITH HEADER LINE .

IF /A1F/YMNS0001-YM_KDMAT IS INITIAL  .
P_SUBRC = 1 .
EXIT .
ENDIF .

A1F_WL_KNMT-VKORG = /A1F/YMNS0001-VKORG .
A1F_WL_KNMT-VTWEG = /A1F/YMNS0001-VTWEG .
A1F_WL_KNMT-KUNNR = /A1F/YMNS0001-YM_KUNNR .
A1F_WL_KNMT-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_WL_KNMT-KDMAT = /A1F/YMNS0001-YM_KDMAT .
A1F_WL_KNMT-POSTX = /A1F/YMNS0001-YM_POSTX .
IF /A1F/YMNS0001-YM_TMPSRYHS IS INITIAL .
CLEAR A1F_WL_KNMT-VWPOS .
ELSE .
A1F_WL_KNMT-VWPOS = 'ZTMP' .
ENDIF .

PERFORM A1F_CT_CUSTOMER_MATERIAL TABLES A1F_TL_KNMT_RETURN
USING A1F_WL_KNMT .

LOOP AT A1F_TL_KNMT_RETURN
WHERE TYPE = 'E' .
MESSAGE ID A1F_TL_KNMT_RETURN-ID
TYPE A1F_TL_KNMT_RETURN-TYPE
NUMBER A1F_TL_KNMT_RETURN-NUMBER
WITH A1F_TL_KNMT_RETURN-MESSAGE_V1
A1F_TL_KNMT_RETURN-MESSAGE_V2
A1F_TL_KNMT_RETURN-MESSAGE_V3
A1F_TL_KNMT_RETURN-MESSAGE_V4 .
ENDLOOP .

A1F_WG_KNMT-MATNR = /A1F/YMNS0001-YM_MATNR .

CLEAR P_SUBRC .

ENDFORM.                    " a1f_save_Customer_Material
*&---------------------------------------------------------------------*
*&      Form  a1f_save_Purchase_info
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SAVE_PURCHASE_INFO CHANGING P_SUBRC .

P_SUBRC = 9 .

DATA : A1F_WL_EINE LIKE EINE .
DATA : A1F_WL_EINA LIKE EINA .
DATA : A1F_TL_EINE_RETURN LIKE TABLE OF BAPIRET2
WITH HEADER LINE .

IF /A1F/YMNS0001-YM_MWSKZ IS INITIAL  .
P_SUBRC = 1 .
EXIT .
ENDIF .

A1F_WL_EINE-EKORG = /A1F/YMNS0001-EKORG .
A1F_WL_EINE-WERKS = /A1F/YMNS0001-WERKS .
A1F_WL_EINA-LIFNR = /A1F/YMNS0001-YM_LIFNR .
A1F_WL_EINA-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_WL_EINA-IDNLF = /A1F/YMNS0001-YM_INDLF .
A1F_WL_EINA-URZTP = /A1F/YMNS0001-YM_URZTP .
A1F_WL_EINE-MWSKZ = /A1F/YMNS0001-YM_MWSKZ .
A1F_WL_EINE-APLFZ = /A1F/YMNS0001-YM_APLFZ .
A1F_WL_EINE-NORBM = 1 .
A1F_WL_EINE-NETPR = /A1F/YMNS0001-YM_PKBETR .
A1F_WL_EINE-WAERS = /A1F/YMNS0001-YM_PWAERS .
A1F_WL_EINE-PEINH = /A1F/YMNS0001-YM_PKPEIN .
A1F_WL_EINE-BPRME = /A1F/YMNS0001-YM_PKMEIN .
IF /A1F/YMNS0001-YM_SIRSKKBN2 IS INITIAL .
CLEAR A1F_WL_EINE-EVERS .
ELSE .
A1F_WL_EINE-EVERS = /A1F/YMNS0001-EVERS .
ENDIF .

* テキスト項目以下、共通化できませんでした。
* ごめんなさい。　長谷部
* 余裕があったら共通化してください。
PERFORM A1F_CT_PURCHASE_INFO TABLES A1F_TL_EINE_RETURN
USING A1F_WL_EINA
A1F_WL_EINE
/A1F/YMNS0001-YM_KUBIJUHUTYUK
/A1F/YMNS0001-YM_KUBIJUHUTYUK2
/A1F/YMNS0001-YM_KUBUJUHUTEXT
/A1F/YMNS0001-YM_SIRSKKBN1
/A1F/YMNS0001-YM_SIRSKKBN2
/A1F/YMNS0001-YM_PDATAB
/A1F/YMNS0001-YM_PDATBI
/A1F/YMNS0001-YM_PSKSTBM1
/A1F/YMNS0001-YM_PSKONMS1
/A1F/YMNS0001-YM_PSKBETR1
/A1F/YMNS0001-YM_PSKMEIN1
/A1F/YMNS0001-YM_PSKPEIN1
/A1F/YMNS0001-YM_PSKSTBM2
/A1F/YMNS0001-YM_PSKONMS2
/A1F/YMNS0001-YM_PSKBETR2
/A1F/YMNS0001-YM_PSKMEIN2
/A1F/YMNS0001-YM_PSKPEIN2
/A1F/YMNS0001-YM_PSKSTBM3
/A1F/YMNS0001-YM_PSKONMS3
/A1F/YMNS0001-YM_PSKBETR3
/A1F/YMNS0001-YM_PSKMEIN3
/A1F/YMNS0001-YM_PSKPEIN3
/A1F/YMNS0001-YM_PSKSTBM4
/A1F/YMNS0001-YM_PSKONMS4
/A1F/YMNS0001-YM_PSKBETR4
/A1F/YMNS0001-YM_PSKMEIN4
/A1F/YMNS0001-YM_PSKPEIN4
/A1F/YMNS0001-YM_PSKSTBM5
/A1F/YMNS0001-YM_PSKONMS5
/A1F/YMNS0001-YM_PSKBETR5
/A1F/YMNS0001-YM_PSKMEIN5
/A1F/YMNS0001-YM_PSKPEIN5.

LOOP AT A1F_TL_EINE_RETURN
WHERE TYPE = 'E' .
MESSAGE ID A1F_TL_EINE_RETURN-ID
TYPE A1F_TL_EINE_RETURN-TYPE
NUMBER A1F_TL_EINE_RETURN-NUMBER
WITH A1F_TL_EINE_RETURN-MESSAGE_V1
A1F_TL_EINE_RETURN-MESSAGE_V2
A1F_TL_EINE_RETURN-MESSAGE_V3
A1F_TL_EINE_RETURN-MESSAGE_V4 .
ENDLOOP .

A1F_TG_INFORECORD_GENERAL-MATERIAL = /A1F/YMNS0001-YM_MATNR .

CLEAR P_SUBRC .


ENDFORM.                    " a1f_save_Purchase_info
*&---------------------------------------------------------------------*
*&      Form  a1f_save_sales_price
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_SAVE_SALES_PRICE CHANGING P_SUBRC .

P_SUBRC = 9 .

DATA : A1F_TL_SP_RETURN LIKE TABLE OF BAPIRET2
WITH HEADER LINE .

IF /A1F/YMNS0001-YM_SKBETR IS INITIAL  .
P_SUBRC = 1 .
EXIT .
ENDIF .

PERFORM A1F_CT_SALES_PRICE TABLES A1F_TL_SP_RETURN
USING /A1F/YMNS0001-VKORG
/A1F/YMNS0001-VTWEG
/A1F/YMNS0001-SPART
/A1F/YMNS0001-YM_KUNNR
/A1F/YMNS0001-YM_MATNR
/A1F/YMNS0001-YM_KDMAT
/A1F/YMNS0001-YM_SDATAB
/A1F/YMNS0001-YM_SDATBI
/A1F/YMNS0001-YM_SKBETR
/A1F/YMNS0001-YM_SKMEIN
/A1F/YMNS0001-YM_SKPEIN
/A1F/YMNS0001-YM_SWAERS
/A1F/YMNS0001-YM_SSKSTBM1
/A1F/YMNS0001-YM_SSKONMS1
/A1F/YMNS0001-YM_SSKBETR1
/A1F/YMNS0001-YM_SSKMEIN1
/A1F/YMNS0001-YM_SSKPEIN1
/A1F/YMNS0001-YM_SSKSTBM2
/A1F/YMNS0001-YM_SSKONMS2
/A1F/YMNS0001-YM_SSKBETR2
/A1F/YMNS0001-YM_SSKMEIN2
/A1F/YMNS0001-YM_SSKPEIN2
/A1F/YMNS0001-YM_SSKSTBM3
/A1F/YMNS0001-YM_SSKONMS3
/A1F/YMNS0001-YM_SSKBETR3
/A1F/YMNS0001-YM_SSKMEIN3
/A1F/YMNS0001-YM_SSKPEIN3
/A1F/YMNS0001-YM_SSKSTBM4
/A1F/YMNS0001-YM_SSKONMS4
/A1F/YMNS0001-YM_SSKBETR4
/A1F/YMNS0001-YM_SSKMEIN4
/A1F/YMNS0001-YM_SSKPEIN4
/A1F/YMNS0001-YM_SSKSTBM5
/A1F/YMNS0001-YM_SSKONMS5
/A1F/YMNS0001-YM_SSKBETR5
/A1F/YMNS0001-YM_SSKMEIN5
/A1F/YMNS0001-YM_SSKPEIN5.

LOOP AT A1F_TL_SP_RETURN
WHERE TYPE = 'E' .
MESSAGE ID A1F_TL_SP_RETURN-ID
TYPE A1F_TL_SP_RETURN-TYPE
NUMBER A1F_TL_SP_RETURN-NUMBER
WITH A1F_TL_SP_RETURN-MESSAGE_V1
A1F_TL_SP_RETURN-MESSAGE_V2
A1F_TL_SP_RETURN-MESSAGE_V3
A1F_TL_SP_RETURN-MESSAGE_V4 .
ENDLOOP .

CLEAR P_SUBRC .

ENDFORM.                    " a1f_save_sales_price
*&---------------------------------------------------------------------*
*&      Form  a1f_check_CUSTOMER_MATERIAL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_CUSTOMER_MATERIAL .

IF /A1F/YMNS0001-YM_KUNNR IS INITIAL
OR /A1F/YMNS0001-YM_MATNR IS INITIAL .
EXIT .
ENDIF .

SELECT SINGLE  * FROM  KNMT
INTO A1F_WG_KNMT
WHERE  VKORG  = /A1F/YMNS0001-VKORG
AND    VTWEG  = /A1F/YMNS0001-VTWEG
AND    KUNNR  = /A1F/YMNS0001-YM_KUNNR
AND    MATNR  = /A1F/YMNS0001-YM_MATNR.
IF SY-SUBRC = 0 .
/A1F/YMNS0001-YM_KDMAT = A1F_WG_KNMT-KDMAT .
/A1F/YMNS0001-YM_POSTX = A1F_WG_KNMT-POSTX .
MESSAGE W254(/A1F/YLMS0100) WITH
/A1F/YMNS0001-YM_KUNNR
/A1F/YMNS0001-YM_MATNR .
ELSE .
CLEAR A1F_WG_KNMT .
ENDIF .

ENDFORM.                    " a1f_check_CUSTOMER_MATERIAL
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_PURCHASE_INFO
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_PURCHASE_INFO .

IF /A1F/YMNS0001-YM_LIFNR IS INITIAL
OR /A1F/YMNS0001-YM_MATNR IS INITIAL .
EXIT .
ENDIF .

DATA A1F_WL_PURCHORG_LINE_COUNT LIKE SY-TABIX .
DATA A1F_WL_GENERAL_LINE_COUNT LIKE SY-TABIX .
DATA : A1F_TL_RETURN_PURC_INFO        LIKE TABLE OF BAPIRETURN
WITH HEADER LINE .

CALL FUNCTION 'BAPI_INFORECORD_GETLIST'
EXPORTING
VENDOR              = /A1F/YMNS0001-YM_LIFNR
MATERIAL            = /A1F/YMNS0001-YM_MATNR
PURCH_ORG           = /A1F/YMNS0001-EKORG
INFO_TYPE           = '0'
TABLES
INFORECORD_GENERAL  = A1F_TG_INFORECORD_GENERAL
INFORECORD_PURCHORG = A1F_TG_INFORECORD_PURCHORG
RETURN              = A1F_TL_RETURN_PURC_INFO.
*
DESCRIBE TABLE A1F_TG_INFORECORD_GENERAL LINES
A1F_WL_GENERAL_LINE_COUNT.
IF A1F_WL_GENERAL_LINE_COUNT = 0.
CLEAR A1F_TG_INFORECORD_GENERAL .
ELSEIF A1F_WL_GENERAL_LINE_COUNT > 1.
MESSAGE W256(/A1F/YLMS0100) WITH
/A1F/YMNS0001-YM_MATNR
/A1F/YMNS0001-YM_LIFNR
A1F_WL_GENERAL_LINE_COUNT.
ELSE .
READ TABLE A1F_TG_INFORECORD_GENERAL INDEX 1 .
/A1F/YMNS0001-YM_INDLF = A1F_TG_INFORECORD_GENERAL-VEND_MAT .
MESSAGE W255(/A1F/YLMS0100) WITH
/A1F/YMNS0001-YM_LIFNR
/A1F/YMNS0001-YM_MATNR .
ENDIF .

DESCRIBE TABLE A1F_TG_INFORECORD_PURCHORG LINES
A1F_WL_PURCHORG_LINE_COUNT.
IF A1F_WL_PURCHORG_LINE_COUNT = 0.
CLEAR A1F_TG_INFORECORD_PURCHORG .
ELSE .
READ TABLE A1F_TG_INFORECORD_PURCHORG INDEX 1 .
/A1F/YMNS0001-YM_APLFZ = A1F_TG_INFORECORD_PURCHORG-PLND_DELRY .
/A1F/YMNS0001-YM_MWSKZ = A1F_TG_INFORECORD_PURCHORG-TAX_CODE .
MESSAGE W257(/A1F/YLMS0100) WITH
/A1F/YMNS0001-YM_LIFNR
/A1F/YMNS0001-YM_MATNR .
ENDIF .


ENDFORM.                    " A1F_CHECK_PURCHASE_INFO
*&---------------------------------------------------------------------*
*&      Form  a1f_ct_Customer_Material
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_A1F_WL_KNMT  text
*      -->P_A1F_TL_KNMT_RETURN  text
*----------------------------------------------------------------------*
FORM A1F_CT_CUSTOMER_MATERIAL
TABLES   P_A1F_TL_KNMT_RETURN STRUCTURE BAPIRET2
USING    P_A1F_WL_KNMT        STRUCTURE KNMT .

DATA : A1F_TL_BDCDATA LIKE TABLE OF BDCDATA
WITH HEADER LINE .

CLEAR A1F_TL_BDCDATA.
REFRESH A1F_TL_BDCDATA.

PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPMV10A'               '0100'                     'X',
'BDC_OKCODE'             '/00'                      ' ',
'MV10A-KUNNR'            P_A1F_WL_KNMT-KUNNR        ' ',
'MV10A-VKORG'            P_A1F_WL_KNMT-VKORG        ' ',
'MV10A-VTWEG'            P_A1F_WL_KNMT-VTWEG        ' ',
'SAPMV10A'               '0200'                     'X',
'BDC_CURSOR'             'MV10A-KDMAT(01)'          ' ',
'BDC_OKCODE'             '=SELE'                    ' ',
'MV10A-MATNR(01)'        P_A1F_WL_KNMT-MATNR        ' ',
'MV10A-KDMAT(01)'        P_A1F_WL_KNMT-KDMAT        ' ',
'SAPMV10A'               '0300'                     'X',
'BDC_OKCODE'             '=TEXT'                    ' ',
'MV10A-POSTX'            P_A1F_WL_KNMT-POSTX        ' ',
'MV10A-VWPOS'            P_A1F_WL_KNMT-VWPOS        ' ',
'SAPLV70T'               '0101'                     'X',
'BDC_OKCODE'             '=UPD'                    ' ',
'LV70T-LTX01(01)'        /A1F/YMNS0001-YM_SKSJBKU   ' ',
'LV70T-LTX01(03)'        /A1F/YMNS0001-YM_SUHNNAM   ' ',
'LV70T-LTX01(04)'        /A1F/YMNS0001-YM_YOUTO     ' ',
'SAPMV10A'               '0300'                     'X',
'BDC_OKCODE'             '=SICH'                    ' '.

PERFORM A1F_CALL_TRANSCTION TABLES A1F_TL_BDCDATA
P_A1F_TL_KNMT_RETURN
USING 'VD51'.


ENDFORM.                    " a1f_ct_Customer_Material
*&---------------------------------------------------------------------*
*&      Form  a1f_GENERATE_BDCDATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_A1F_TL_BDCDATA  text
*      -->P_2256   text
*      -->P_2257   text
*      -->P_2258   text
*----------------------------------------------------------------------*
FORM A1F_GENERATE_BDCDATA
TABLES   P_A1F_TL_BDCDATA STRUCTURE BDCDATA
USING    P_PROGRAM P_DYNPRO P_DYNBEGIN.

CLEAR P_A1F_TL_BDCDATA.

IF P_DYNBEGIN = 'X'.
P_A1F_TL_BDCDATA-PROGRAM  = P_PROGRAM.
P_A1F_TL_BDCDATA-DYNPRO   = P_DYNPRO.
P_A1F_TL_BDCDATA-DYNBEGIN = P_DYNBEGIN.
APPEND P_A1F_TL_BDCDATA.
ELSEIF P_DYNBEGIN = ' '.
P_A1F_TL_BDCDATA-FNAM = P_PROGRAM.
P_A1F_TL_BDCDATA-FVAL = P_DYNPRO.
APPEND P_A1F_TL_BDCDATA.
ENDIF.


ENDFORM.                    " a1f_GENERATE_BDCDATA
*&---------------------------------------------------------------------*
*&      Form  a1f_CALL_TRANSCTION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_A1F_TL_BDCDATA  text
*      -->P_P_A1F_TL_KNMT_RETURN  text
*      -->P_2281   text
*----------------------------------------------------------------------*
FORM A1F_CALL_TRANSCTION  TABLES   P_A1F_TL_BDCDATA
STRUCTURE BDCDATA
P_BAPIRET2
STRUCTURE BAPIRET2
USING  P_TCODE .

DATA : A1F_TL_BDCMSGCOLL LIKE TABLE OF BDCMSGCOLL
WITH HEADER LINE .

DATA A1F_WL_SY_SUBRC LIKE SY-SUBRC .

**** START ADD 2014/08/27 ISID・喩 ****
DATA LW_MODE TYPE CHAR1 VALUE 'N'.
**** END ADD 2014/08/27 ISID・喩 ****

CLEAR P_BAPIRET2 .
REFRESH P_BAPIRET2 .

CALL TRANSACTION P_TCODE
USING P_A1F_TL_BDCDATA
**** START UPD 2014/08/27 ISID・喩 ****
*       MODE 'E'
MODE LW_MODE
**** END UPD 2014/08/27 ISID・喩 ****
UPDATE 'S'
MESSAGES INTO A1F_TL_BDCMSGCOLL.

A1F_WL_SY_SUBRC = SY-SUBRC .

LOOP AT A1F_TL_BDCMSGCOLL .
P_BAPIRET2-TYPE = A1F_TL_BDCMSGCOLL-MSGTYP .
P_BAPIRET2-ID = A1F_TL_BDCMSGCOLL-MSGID.
P_BAPIRET2-NUMBER = A1F_TL_BDCMSGCOLL-MSGNR.
P_BAPIRET2-MESSAGE_V1 = A1F_TL_BDCMSGCOLL-MSGV1.
P_BAPIRET2-MESSAGE_V2 = A1F_TL_BDCMSGCOLL-MSGV2.
P_BAPIRET2-MESSAGE_V3 = A1F_TL_BDCMSGCOLL-MSGV3.
P_BAPIRET2-MESSAGE_V4 = A1F_TL_BDCMSGCOLL-MSGV4.
APPEND P_BAPIRET2 .
ENDLOOP.

SY-SUBRC = A1F_WL_SY_SUBRC .

ENDFORM.                    " a1f_CALL_TRANSCTION
*&---------------------------------------------------------------------*
*&      Form  A1F_CT_PURCHASE_INFO
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_A1F_TL_KNMT_RETURN  text
*      -->P_A1F_WL_EINE  text
*      -->P_A1F_WL_EINA  text
*----------------------------------------------------------------------*
FORM A1F_CT_PURCHASE_INFO
TABLES   P_A1F_TL_EINA_RETURN STRUCTURE BAPIRET2
USING    P_A1F_WL_EINA        STRUCTURE EINA
P_A1F_WL_EINE        STRUCTURE EINE
P_TEXT1
P_TEXT1_2
P_TEXT2
P_YM_SIRSKKBN1
P_YM_SIRSKKBN2
P_YM_PDATAB
P_YM_PDATBI
P_YM_PSKSTBM1
P_YM_PSKONMS1
P_YM_PSKBETR1
P_YM_PSKMEIN1
P_YM_PSKPEIN1
P_YM_PSKSTBM2
P_YM_PSKONMS2
P_YM_PSKBETR2
P_YM_PSKMEIN2
P_YM_PSKPEIN2
P_YM_PSKSTBM3
P_YM_PSKONMS3
P_YM_PSKBETR3
P_YM_PSKMEIN3
P_YM_PSKPEIN3
P_YM_PSKSTBM4
P_YM_PSKONMS4
P_YM_PSKBETR4
P_YM_PSKMEIN4
P_YM_PSKPEIN4
P_YM_PSKSTBM5
P_YM_PSKONMS5
P_YM_PSKBETR5
P_YM_PSKMEIN5
P_YM_PSKPEIN5.

DATA : A1F_TL_BDCDATA LIKE TABLE OF BDCDATA
WITH HEADER LINE .
DATA : A1F_WL_PEINH_CH5(5) ,
A1F_WL_APLFZ_CH3(3) ,
A1F_WL_BPRME_CH3(3) ,
A1F_WL_NORBM_CH13(13) ,
A1F_WL_NETPR_CH11(11) ,
A1F_WL_PSKSTBM1_CH13(13) ,
A1F_WL_PSKSTBM2_CH13(13) ,
A1F_WL_PSKSTBM3_CH13(13) ,
A1F_WL_PSKSTBM4_CH13(13) ,
A1F_WL_PSKSTBM5_CH13(13) ,
A1F_WL_PSKBETR1_CH11(11) ,
A1F_WL_PSKBETR2_CH11(11) ,
A1F_WL_PSKBETR3_CH11(11) ,
A1F_WL_PSKBETR4_CH11(11) ,
A1F_WL_PSKBETR5_CH11(11) ,
A1F_WL_PSKONMS1_CH3(3) .

A1F_WL_PEINH_CH5 = P_A1F_WL_EINE-PEINH .
WRITE P_A1F_WL_EINE-BPRME TO A1F_WL_BPRME_CH3 .
WRITE P_A1F_WL_EINE-NORBM UNIT P_A1F_WL_EINE-BPRME
TO A1F_WL_NORBM_CH13 .
WRITE P_A1F_WL_EINE-NETPR CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_NETPR_CH11 .
A1F_WL_APLFZ_CH3 = P_A1F_WL_EINE-APLFZ .
WRITE P_YM_PSKONMS1 TO A1F_WL_PSKONMS1_CH3 .
WRITE P_YM_PSKSTBM1 UNIT P_YM_PSKONMS1 TO A1F_WL_PSKSTBM1_CH13 .
WRITE P_YM_PSKSTBM2 UNIT P_YM_PSKONMS1 TO A1F_WL_PSKSTBM2_CH13 .
WRITE P_YM_PSKSTBM3 UNIT P_YM_PSKONMS1 TO A1F_WL_PSKSTBM3_CH13 .
WRITE P_YM_PSKSTBM4 UNIT P_YM_PSKONMS1 TO A1F_WL_PSKSTBM4_CH13 .
WRITE P_YM_PSKSTBM5 UNIT P_YM_PSKONMS1 TO A1F_WL_PSKSTBM5_CH13 .
WRITE P_YM_PSKBETR1 CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_PSKBETR1_CH11 .
WRITE P_YM_PSKBETR2 CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_PSKBETR2_CH11 .
WRITE P_YM_PSKBETR3 CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_PSKBETR3_CH11 .
WRITE P_YM_PSKBETR4 CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_PSKBETR4_CH11 .
WRITE P_YM_PSKBETR5 CURRENCY P_A1F_WL_EINE-WAERS
TO A1F_WL_PSKBETR5_CH11 .


CLEAR A1F_TL_BDCDATA.
REFRESH A1F_TL_BDCDATA.

PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMM06I'        '0100'              'X',
'BDC_OKCODE'      '/00'               ' ',
'EINA-LIFNR'      P_A1F_WL_EINA-LIFNR ' ',
'EINA-MATNR'      P_A1F_WL_EINA-MATNR ' ',
'EINE-EKORG'      P_A1F_WL_EINE-EKORG ' ',
'EINE-WERKS'      P_A1F_WL_EINE-WERKS ' '.
IF P_YM_SIRSKKBN1 IS INITIAL .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'RM06I-NORMB'     'X'                 ' '.
ELSE .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'RM06I-LOHNB'     'X'                 ' '.
ENDIF .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMM06I'        '0101'              'X',
'BDC_OKCODE'      '/00'               ' ',
'EINA-IDNLF'      P_A1F_WL_EINA-IDNLF ' ',
'EINA-URZTP'      P_A1F_WL_EINA-URZTP ' ',
'SAPMM06I'        '0102'              'X',
'BDC_OKCODE'      '=KO'               ' ',
'BDC_CURSOR'      'EINE-BPRME'        ' ',
'EINE-MWSKZ'      P_A1F_WL_EINE-MWSKZ ' ',
'EINE-EVERS'      P_A1F_WL_EINE-EVERS ' ',
'EINE-NORBM'      A1F_WL_NORBM_CH13   ' ',
'EINE-APLFZ'      A1F_WL_APLFZ_CH3    ' ',
'EINE-NETPR'      A1F_WL_NETPR_CH11   ' ',
'EINE-PEINH'      A1F_WL_PEINH_CH5    ' ',
'EINE-BPRME'      A1F_WL_BPRME_CH3    ' '.

IF P_YM_PSKSTBM2 IS INITIAL .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMV13A'        '0201'              'X',
'BDC_OKCODE'      '=BACK'             ' ',
'RV13A-DATAB'      P_YM_PDATAB        ' ',
'RV13A-DATBI'      P_YM_PDATBI        ' ',
'SAPMM06I'        '0102'              'X',
'BDC_OKCODE'      '/00'               ' ',

'SAPMM06I'        '0105'              'X',
'BDC_OKCODE'      '/00'               ' ',
'SAPMM06I'        '0103'              'X',
'BDC_OKCODE'      '=BU'               ' ',
'RM06I-LTEX1(01)' P_TEXT1             ' ',
'RM06I-LTEX2(01)' P_TEXT1_2           ' ',
'RM06I-LTEX1(02)' P_TEXT2             ' '.

ELSE .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMV13A'        '0201'              'X',
'BDC_OKCODE'      '=PSTF'             ' ',
'BDC_CURSOR'      'KONP-KBETR(01)'    ' ',
'RV13A-DATAB'      P_YM_PDATAB        ' ',
'RV13A-DATBI'      P_YM_PDATBI        ' ',
'SAPMV13A'        '0303'              'X',
'BDC_OKCODE'      '=BACK'             ' ',
'KONM-KSTBM(01)'      A1F_WL_PSKSTBM1_CH13   ' ',
'RV13A-KONMS(01)'     A1F_WL_PSKONMS1_CH3    ' ',
'KONM-KSTBM(02)'      A1F_WL_PSKSTBM2_CH13   ' ',
'KONM-KSTBM(03)'      A1F_WL_PSKSTBM3_CH13   ' ',
'KONM-KSTBM(04)'      A1F_WL_PSKSTBM4_CH13   ' ',
'KONM-KSTBM(05)'      A1F_WL_PSKSTBM5_CH13   ' ',
'KONM-KBETR(01)'      A1F_WL_PSKBETR1_CH11   ' ',
'KONM-KBETR(02)'      A1F_WL_PSKBETR2_CH11   ' ',
'KONM-KBETR(03)'      A1F_WL_PSKBETR3_CH11   ' ',
'KONM-KBETR(04)'      A1F_WL_PSKBETR4_CH11   ' ',
'KONM-KBETR(05)'      A1F_WL_PSKBETR5_CH11   ' ',
'SAPMV13A'        '0201'              'X',
'BDC_OKCODE'      '=BACK'             ' ',
'SAPMM06I'        '0102'              'X',
'BDC_OKCODE'      '/00'               ' ',

'SAPMM06I'        '0105'              'X',
'BDC_OKCODE'      '/00'               ' ',
'SAPMM06I'        '0103'              'X',
'BDC_OKCODE'      '=BU'               ' ',
'RM06I-LTEX1(01)' P_TEXT1             ' ',
'RM06I-LTEX2(01)' P_TEXT1_2           ' ',
'RM06I-LTEX1(02)' P_TEXT2             ' '.

ENDIF .

PERFORM A1F_CALL_TRANSCTION TABLES A1F_TL_BDCDATA
P_A1F_TL_EINA_RETURN
USING 'ME11'.

ENDFORM.                    " A1F_CT_PURCHASE_INFO
*&---------------------------------------------------------------------*
*&      Form  A1F_CT_SALES_PRICE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
FORM A1F_CT_SALES_PRICE
TABLES   P_A1F_TL_SP_RETURN STRUCTURE BAPIRET2
USING    P_VKORG
P_VTWEG
P_SPART
P_YM_KUNNR
P_YM_MATNR
P_YM_KDMAT
P_YM_SDATAB
P_YM_SDATBI
P_YM_SKBETR
P_YM_SKMEIN
P_YM_SKPEIN
P_YM_SWAERS
P_YM_SSKSTBM1
P_YM_SSKONMS1
P_YM_SSKBETR1
P_YM_SSKMEIN1
P_YM_SSKPEIN1
P_YM_SSKSTBM2
P_YM_SSKONMS2
P_YM_SSKBETR2
P_YM_SSKMEIN2
P_YM_SSKPEIN2
P_YM_SSKSTBM3
P_YM_SSKONMS3
P_YM_SSKBETR3
P_YM_SSKMEIN3
P_YM_SSKPEIN3
P_YM_SSKSTBM4
P_YM_SSKONMS4
P_YM_SSKBETR4
P_YM_SSKMEIN4
P_YM_SSKPEIN4
P_YM_SSKSTBM5
P_YM_SSKONMS5
P_YM_SSKBETR5
P_YM_SSKMEIN5
P_YM_SSKPEIN5.

DATA : A1F_TL_BDCDATA LIKE TABLE OF BDCDATA
WITH HEADER LINE .
DATA : A1F_WL_KPEIN_CH5(5) ,
A1F_WL_SKMEIN_CH3(3) ,
A1F_WL_NETPR_CH11(11) ,
A1F_WL_SSKSTBM1_CH13(13) ,
A1F_WL_SSKSTBM2_CH13(13) ,
A1F_WL_SSKSTBM3_CH13(13) ,
A1F_WL_SSKSTBM4_CH13(13) ,
A1F_WL_SSKSTBM5_CH13(13) ,
A1F_WL_SSKBETR1_CH11(11) ,
A1F_WL_SSKBETR2_CH11(11) ,
A1F_WL_SSKBETR3_CH11(11) ,
A1F_WL_SSKBETR4_CH11(11) ,
A1F_WL_SSKBETR5_CH11(11) ,
A1F_WL_SSKONMS1_CH3(3) .

A1F_WL_KPEIN_CH5 = P_YM_SKPEIN .
WRITE P_YM_SKMEIN TO A1F_WL_SKMEIN_CH3 .
WRITE P_YM_SKBETR CURRENCY P_YM_SWAERS TO A1F_WL_NETPR_CH11 .
WRITE P_YM_SSKONMS1 TO A1F_WL_SSKONMS1_CH3 .
WRITE P_YM_SSKSTBM1 UNIT P_YM_SSKONMS1 TO A1F_WL_SSKSTBM1_CH13 .
WRITE P_YM_SSKSTBM2 UNIT P_YM_SSKONMS1 TO A1F_WL_SSKSTBM2_CH13 .
WRITE P_YM_SSKSTBM3 UNIT P_YM_SSKONMS1 TO A1F_WL_SSKSTBM3_CH13 .
WRITE P_YM_SSKSTBM4 UNIT P_YM_SSKONMS1 TO A1F_WL_SSKSTBM4_CH13 .
WRITE P_YM_SSKSTBM5 UNIT P_YM_SSKONMS1 TO A1F_WL_SSKSTBM5_CH13 .
WRITE P_YM_SSKBETR1 CURRENCY P_YM_SWAERS TO A1F_WL_SSKBETR1_CH11 .
WRITE P_YM_SSKBETR2 CURRENCY P_YM_SWAERS TO A1F_WL_SSKBETR2_CH11 .
WRITE P_YM_SSKBETR3 CURRENCY P_YM_SWAERS TO A1F_WL_SSKBETR3_CH11 .
WRITE P_YM_SSKBETR4 CURRENCY P_YM_SWAERS TO A1F_WL_SSKBETR4_CH11 .
WRITE P_YM_SSKBETR5 CURRENCY P_YM_SWAERS TO A1F_WL_SSKBETR5_CH11 .


CLEAR A1F_TL_BDCDATA.
REFRESH A1F_TL_BDCDATA.

IF P_YM_SSKSTBM2 IS INITIAL .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMV13A'        '0100'              'X',
'BDC_OKCODE'      '/00'               ' ',
'RV13A-KSCHL'      A1F_CNS_KSCHL      ' ',
*             'SAPLV14A'        '0100'              'X',
*             'BDC_OKCODE'      '=WEIT'             ' ',
'SAPMV13A'        '1901'              'X',
'BDC_OKCODE'      '=SICH'             ' ',
'KOMG-VKORGAU'      P_VKORG             ' ',
'KOMG-VTWEG'      P_VTWEG             ' ',
'KOMG-SPART'      P_SPART             ' ',
'KOMG-KUNNR'      P_YM_KUNNR          ' ',
'KOMG-ZZZKDMAT(01)'      P_YM_KDMAT      ' ',
'KONP-KBETR(01)'      A1F_WL_NETPR_CH11    ' ',
'KONP-KONWA(01)'      P_YM_SWAERS    ' ',
'KONP-KPEIN(01)'      A1F_WL_KPEIN_CH5     ' ',
'KONP-KMEIN(01)'      A1F_WL_SKMEIN_CH3    ' ',
'RV13A-DATAB(01)'      P_YM_SDATAB    ' ',
'RV13A-DATBI(01)'      P_YM_SDATBI    ' '.
ELSE .
PERFORM A1F_GENERATE_BDCDATA
TABLES A1F_TL_BDCDATA
USING:
'SAPMV13A'        '0100'              'X',
'BDC_OKCODE'      '/00'               ' ',
'RV13A-KSCHL'      A1F_CNS_KSCHL      ' ',
*             'SAPLV14A'        '0100'              'X',
*             'BDC_OKCODE'      '=WEIT'             ' ',
'SAPMV13A'        '1901'              'X',
'BDC_OKCODE'      '=PSTF'             ' ',
'BDC_CURSOR'      'KONP-KBETR(01)'    ' ',
'KOMG-VKORGAU'      P_VKORG             ' ',
'KOMG-VTWEG'      P_VTWEG             ' ',
'KOMG-SPART'      P_SPART             ' ',
'KOMG-KUNNR'      P_YM_KUNNR          ' ',
'KOMG-ZZZKDMAT(01)'      P_YM_KDMAT      ' ',
'KONP-KBETR(01)'      A1F_WL_NETPR_CH11    ' ',
'KONP-KONWA(01)'      P_YM_SWAERS    ' ',
'KONP-KPEIN(01)'      A1F_WL_KPEIN_CH5     ' ',
'KONP-KMEIN(01)'      A1F_WL_SKMEIN_CH3    ' ',
'RV13A-DATAB(01)'      P_YM_SDATAB    ' ',
'RV13A-DATBI(01)'      P_YM_SDATBI    ' ',
'SAPMV13A'        '0303'              'X',
'BDC_OKCODE'      '=SICH'             ' ',
'KONM-KSTBM(01)'      A1F_WL_SSKSTBM1_CH13   ' ',
'RV13A-KONMS(01)'     A1F_WL_SSKONMS1_CH3    ' ',
'KONM-KSTBM(02)'      A1F_WL_SSKSTBM2_CH13   ' ',
'KONM-KSTBM(03)'      A1F_WL_SSKSTBM3_CH13   ' ',
'KONM-KSTBM(04)'      A1F_WL_SSKSTBM4_CH13   ' ',
'KONM-KSTBM(05)'      A1F_WL_SSKSTBM5_CH13   ' ',
'KONM-KBETR(01)'      A1F_WL_SSKBETR1_CH11   ' ',
'KONM-KBETR(02)'      A1F_WL_SSKBETR2_CH11   ' ',
'KONM-KBETR(03)'      A1F_WL_SSKBETR3_CH11   ' ',
'KONM-KBETR(04)'      A1F_WL_SSKBETR4_CH11   ' ',
'KONM-KBETR(05)'      A1F_WL_SSKBETR5_CH11   ' '.

ENDIF .

PERFORM A1F_CALL_TRANSCTION TABLES A1F_TL_BDCDATA
P_A1F_TL_SP_RETURN
USING 'VK11'.



ENDFORM.                    " A1F_CT_SALES_PRICE
*&---------------------------------------------------------------------*
*&      Form  A1F_COPY_MATERIAL_DETAIL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_COPY_MATERIAL_DETAIL .

IF /A1F/YMNS0001-YM_CPYMK IS INITIAL
OR /A1F/YMNS0001-YM_CPYMATNR IS INITIAL .
EXIT .
ENDIF .

DATA : A1F_WL_MARA LIKE MARA ,
A1F_WL_MVKE LIKE MVKE ,
A1F_WL_MARC LIKE MARC ,
A1F_WL_MBEW LIKE MBEW ,
A1F_WL_MARD LIKE MARD .

DATA : A1F_TL_MARM LIKE TABLE OF MARM WITH HEADER LINE .

SELECT SINGLE * FROM  MARA
INTO A1F_WL_MARA
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR.
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_MAKTX IS INITIAL .
SELECT SINGLE MAKTX FROM  MAKT
INTO /A1F/YMNS0001-YM_MAKTX
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR
AND    SPRAS  = SY-LANGU.
ENDIF .
IF /A1F/YMNS0001-YM_MEINS IS INITIAL .
/A1F/YMNS0001-YM_MEINS = A1F_WL_MARA-MEINS .
/A1F/YMNS0001-YM_MEINSS = A1F_WL_MARA-MEINS .
/A1F/YMNS0001-YM_MEINSP = A1F_WL_MARA-MEINS .
ENDIF .
IF /A1F/YMNS0001-YM_BSTME IS INITIAL .
/A1F/YMNS0001-YM_BSTME = A1F_WL_MARA-BSTME .
ENDIF .
IF /A1F/YMNS0001-YM_MATKL IS INITIAL .
/A1F/YMNS0001-YM_MATKL = A1F_WL_MARA-MATKL .
ENDIF .
IF /A1F/YMNS0001-YM_PRDHA IS INITIAL .
/A1F/YMNS0001-YM_PRDHA = A1F_WL_MARA-PRDHA .
ENDIF .
IF /A1F/YMNS0001-YM_HNMKTYP IS INITIAL .
/A1F/YMNS0001-YM_HNMKTYP = A1F_WL_MARA-MTART .
ENDIF .
* Append By Mis-Ohno
IF /A1F/YMNS0001-YM_WRKST IS INITIAL .
/A1F/YMNS0001-YM_WRKST = A1F_WL_MARA-WRKST .
ENDIF .
IF /A1F/YMNS0001-YM_NORMT IS INITIAL .
/A1F/YMNS0001-YM_NORMT = A1F_WL_MARA-NORMT .
ENDIF .
* End Append
ENDIF .

SELECT SINGLE * FROM  MVKE
INTO A1F_WL_MVKE
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR
AND    VKORG  = /A1F/YMNS0001-VKORG
AND    VTWEG  = /A1F/YMNS0001-VTWEG.
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_VRKME IS INITIAL .
/A1F/YMNS0001-YM_VRKME = A1F_WL_MVKE-VRKME .
ENDIF .
IF /A1F/YMNS0001-YM_MVGR1 IS INITIAL .
/A1F/YMNS0001-YM_MVGR1 = A1F_WL_MVKE-MVGR1 .
ENDIF .
IF /A1F/YMNS0001-YM_MVGR2 IS INITIAL .
/A1F/YMNS0001-YM_MVGR2 = A1F_WL_MVKE-MVGR2 .
ENDIF .
IF /A1F/YMNS0001-YM_MVGR3 IS INITIAL .
/A1F/YMNS0001-YM_MVGR3 = A1F_WL_MVKE-MVGR3 .
ENDIF .
IF /A1F/YMNS0001-YM_KIHTBHBIJSK IS INITIAL .
/A1F/YMNS0001-YM_KIHTBHBIJSK = A1F_WL_MVKE-MVGR4 .
ENDIF .
ENDIF .

IF NOT ( /A1F/YMNS0001-WERKS IS INITIAL ) .
SELECT SINGLE * FROM  MARC
INTO A1F_WL_MARC
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR
AND  WERKS  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_WEBAZ IS INITIAL .
/A1F/YMNS0001-YM_WEBAZ = A1F_WL_MARC-WEBAZ .
ENDIF .
ENDIF .

SELECT SINGLE * FROM  MARD
INTO A1F_WL_MARD
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR
AND  WERKS  = /A1F/YMNS0001-WERKS
AND  LGORT  = /A1F/YMNS0001-LGORT .
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_LGPBE IS INITIAL .
/A1F/YMNS0001-YM_LGPBE = A1F_WL_MARD-LGPBE .
ENDIF .
ENDIF .

ENDIF .

SELECT SINGLE * FROM  MBEW
INTO A1F_WL_MBEW
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR
AND    BWKEY  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_VERPR IS INITIAL .
/A1F/YMNS0001-YM_VERPR = A1F_WL_MBEW-VERPR .
ENDIF .
IF /A1F/YMNS0001-YM_PEINH IS INITIAL .
/A1F/YMNS0001-YM_PEINH = A1F_WL_MBEW-PEINH .
ENDIF .
ENDIF .

SELECT * FROM  MARM
INTO TABLE A1F_TL_MARM
WHERE  MATNR  = /A1F/YMNS0001-YM_CPYMATNR .
IF SY-SUBRC NE 0 .
ELSE .
IF /A1F/YMNS0001-YM_VRKME IS INITIAL .
ELSE .
READ TABLE A1F_TL_MARM WITH KEY
MATNR = /A1F/YMNS0001-YM_CPYMATNR
MEINH = /A1F/YMNS0001-YM_VRKME.
IF SY-SUBRC = 0 .
IF /A1F/YMNS0001-YM_UMRENS IS INITIAL .
/A1F/YMNS0001-YM_UMRENS = A1F_TL_MARM-UMREN .
ENDIF .
IF /A1F/YMNS0001-YM_UMREZS IS INITIAL .
/A1F/YMNS0001-YM_UMREZS = A1F_TL_MARM-UMREZ .
ENDIF .
ELSE .
ENDIF .
ENDIF .
IF /A1F/YMNS0001-YM_BSTME IS INITIAL .
ELSE .
READ TABLE A1F_TL_MARM WITH KEY
MATNR = /A1F/YMNS0001-YM_CPYMATNR
MEINH = /A1F/YMNS0001-YM_BSTME.
IF SY-SUBRC = 0 .
IF /A1F/YMNS0001-YM_UMRENP IS INITIAL .
/A1F/YMNS0001-YM_UMRENP = A1F_TL_MARM-UMREN .
ENDIF .
IF /A1F/YMNS0001-YM_UMREZP IS INITIAL .
/A1F/YMNS0001-YM_UMREZP = A1F_TL_MARM-UMREZ .
ENDIF .
ELSE .
ENDIF .
ENDIF .
ENDIF .

ENDFORM.                    " A1F_COPY_MATERIAL_DETAIL
*&---------------------------------------------------------------------*
*&      Form  A1F_CLEAR_MARM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_MARM .

CLEAR   : A1F_TG_MARM .
*            /A1F/YMNS0001-YM_LGPBE .
REFRESH : A1F_TG_MARM .

ENDFORM.                    " A1F_CLEAR_MARM
*&---------------------------------------------------------------------*
*&      Form  A1F_CLEAR_ALL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CLEAR_ALL .

*TABLES  /A1F/YMNS0001.

DATA : A1F_WL_ANSWER_01(1),
**** START ADD 2014/08/26 ISID･喩 ****
LW_MSGTXT_DUMMY1(25)  TYPE  C,
LW_MSGTXT_DUMMY2(25)  TYPE  C,
LW_MSGTXT_DUMMY3(25)  TYPE  C.
**** END ADD 2014/08/26 ISID･喩 ****

IF     /A1F/YMNS0001-YM_KUNNR IS INITIAL
AND /A1F/YMNS0001-YM_VKGRP IS INITIAL
AND /A1F/YMNS0001-YM_KDMAT IS INITIAL
AND /A1F/YMNS0001-YM_POSTX IS INITIAL
AND /A1F/YMNS0001-YM_MATNR IS INITIAL
AND /A1F/YMNS0001-YM_HNMKTYP IS INITIAL
AND /A1F/YMNS0001-YM_TMPSRYHS IS INITIAL
AND /A1F/YMNS0001-YM_MAKTX IS INITIAL
AND /A1F/YMNS0001-YM_MEINS IS INITIAL
AND /A1F/YMNS0001-YM_VRKME IS INITIAL
AND /A1F/YMNS0001-YM_UMRENS IS INITIAL
AND /A1F/YMNS0001-YM_UMREZS IS INITIAL
AND /A1F/YMNS0001-YM_BSTME IS INITIAL
AND /A1F/YMNS0001-YM_UMRENP IS INITIAL
AND /A1F/YMNS0001-YM_UMREZP IS INITIAL
AND /A1F/YMNS0001-YM_MATKL IS INITIAL
AND /A1F/YMNS0001-YM_PRDHA IS INITIAL
AND /A1F/YMNS0001-YM_MVGR1 IS INITIAL
AND /A1F/YMNS0001-YM_MVGR2 IS INITIAL
AND /A1F/YMNS0001-YM_MVGR3 IS INITIAL
AND /A1F/YMNS0001-YM_LGPBE IS INITIAL
AND /A1F/YMNS0001-YM_WEBAZ IS INITIAL
AND /A1F/YMNS0001-YM_VERPR IS INITIAL
AND /A1F/YMNS0001-YM_PEINH IS INITIAL
AND /A1F/YMNS0001-YM_LIFNR IS INITIAL
AND /A1F/YMNS0001-YM_SIRSKKBN1 IS INITIAL
AND /A1F/YMNS0001-YM_SIRSKKBN2 IS INITIAL
AND /A1F/YMNS0001-YM_INDLF IS INITIAL
AND /A1F/YMNS0001-YM_APLFZ IS INITIAL
AND /A1F/YMNS0001-YM_KUBIJUHUTYUK IS INITIAL
AND /A1F/YMNS0001-YM_KUBIJUHUTYUK2 IS INITIAL
AND /A1F/YMNS0001-YM_KUBUJUHUTEXT IS INITIAL
AND /A1F/YMNS0001-YM_MWSKZ IS INITIAL
AND /A1F/YMNS0001-YM_PKBETR IS INITIAL
AND /A1F/YMNS0001-YM_PKPEIN IS INITIAL
AND /A1F/YMNS0001-YM_SKBETR IS INITIAL
AND /A1F/YMNS0001-YM_SKPEIN IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM2 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR2 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM3 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR3 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM4 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR4 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM5 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR5 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM2 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR2 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM3 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR3 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM4 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR4 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM5 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR5 IS INITIAL .
ELSE .
IF A1F_WG_SAVE_FLG IS INITIAL .
**** START ADD 2014/08/26 ISID･喩 ****
CLEAR: LW_MSGTXT_DUMMY1,
LW_MSGTXT_DUMMY2,
LW_MSGTXT_DUMMY3.

MESSAGE S104(Z3) INTO LW_MSGTXT_DUMMY1.
MESSAGE S105(Z3) INTO LW_MSGTXT_DUMMY2.
MESSAGE S106(Z3) INTO LW_MSGTXT_DUMMY3.
**** END ADD 2014/08/26 ISID･喩 ****
CALL FUNCTION 'POPUP_CONTINUE_YES_NO'
EXPORTING
**** START UPD 2014/08/26 ISID･喩 ****
*                TEXTLINE1 = TEXT-102
*                TEXTLINE2 = TEXT-103
*                TITEL     = TEXT-100
TEXTLINE1 = LW_MSGTXT_DUMMY1
TEXTLINE2 = LW_MSGTXT_DUMMY2
TITEL     = LW_MSGTXT_DUMMY3
**** END UPD 2014/08/26 ISID･喩 ****
IMPORTING
ANSWER    = A1F_WL_ANSWER_01.

IF A1F_WL_ANSWER_01 NE 'J' .
EXIT .
ENDIF .
ENDIF .
ENDIF .

CLEAR  : A1F_WG_SAVE_FLG .

CLEAR  : A1F_WG_KNA1 ,
A1F_WG_KNVV ,
A1F_WG_LFA1 ,
A1F_WG_LFM1 ,
A1F_WG_MARA ,
A1F_WG_MVKE ,
A1F_WG_KNMT .

CLEAR  : A1F_TG_MARC ,
A1F_TG_MARD ,
A1F_TG_MARM ,
A1F_TG_EINA ,
A1F_TG_EINE .

REFRESH: A1F_TG_MARC ,
A1F_TG_MARD ,
A1F_TG_MARM ,
A1F_TG_EINA ,
A1F_TG_EINE .

CLEAR  : A1F_TG_INFORECORD_GENERAL ,
A1F_TG_INFORECORD_PURCHORG  .

REFRESH: A1F_TG_INFORECORD_GENERAL ,
A1F_TG_INFORECORD_PURCHORG  .

CLEAR: /A1F/YMNS0001-WERKS,
/A1F/YMNS0001-YM_KUNNR,
/A1F/YMNS0001-YM_TKISKNM,
/A1F/YMNS0001-YM_VKGRP,
/A1F/YMNS0001-YM_HNMKKBN1,
/A1F/YMNS0001-YM_HNMKKBN2,
/A1F/YMNS0001-YM_KDMAT,
/A1F/YMNS0001-YM_POSTX,
/A1F/YMNS0001-YM_MATNR,
/A1F/YMNS0001-YM_HNMKTYP,
/A1F/YMNS0001-YM_TMPSRYHS,
/A1F/YMNS0001-YM_MAKTX,
/A1F/YMNS0001-YM_MEINS,
/A1F/YMNS0001-YM_VRKME,
/A1F/YMNS0001-YM_UMRENS,
/A1F/YMNS0001-YM_UMREZS,
/A1F/YMNS0001-YM_MEINSS,
/A1F/YMNS0001-YM_BSTME,
/A1F/YMNS0001-YM_UMRENP,
/A1F/YMNS0001-YM_UMREZP,
/A1F/YMNS0001-YM_MEINSP,
/A1F/YMNS0001-YM_MATKL,
/A1F/YMNS0001-YM_PRDHA,
/A1F/YMNS0001-YM_MATKL_TEXT,
/A1F/YMNS0001-YM_PRDHA_TEXT,
/A1F/YMNS0001-YM_MVGR1,
/A1F/YMNS0001-YM_MVGR2,
/A1F/YMNS0001-YM_MVGR3,
/A1F/YMNS0001-YM_LGPBE,
/A1F/YMNS0001-YM_WEBAZ,
/A1F/YMNS0001-YM_VERPR,
/A1F/YMNS0001-YM_VERPR_CH,
/A1F/YMNS0001-YM_WAERS,
/A1F/YMNS0001-YM_PEINH,
/A1F/YMNS0001-YM_LIFNR,
/A1F/YMNS0001-YM_SIRSKNM,
/A1F/YMNS0001-YM_SIRSKKBN1,
/A1F/YMNS0001-YM_SIRSKKBN2,
/A1F/YMNS0001-YM_INDLF,
/A1F/YMNS0001-YM_APLFZ,
/A1F/YMNS0001-YM_KUBIJUHUTYUK,
/A1F/YMNS0001-YM_KUBIJUHUTYUK2,
/A1F/YMNS0001-YM_KUBUJUHUTEXT,
/A1F/YMNS0001-YM_MWSKZ,
/A1F/YMNS0001-YM_PDATAB,
/A1F/YMNS0001-YM_PDATBI,
/A1F/YMNS0001-YM_PKBETR,
/A1F/YMNS0001-YM_PKBETR_CH,
/A1F/YMNS0001-YM_PKMEIN,
/A1F/YMNS0001-YM_PKPEIN,
/A1F/YMNS0001-YM_PWAERS,
/A1F/YMNS0001-YM_SDATAB,
/A1F/YMNS0001-YM_SDATBI,
/A1F/YMNS0001-YM_SKBETR,
/A1F/YMNS0001-YM_SKBETR_CH,
/A1F/YMNS0001-YM_SKMEIN,
/A1F/YMNS0001-YM_SKPEIN,
/A1F/YMNS0001-YM_SWAERS,
/A1F/YMNS0001-YM_URKKK,
/A1F/YMNS0001-YM_ARRRT,
/A1F/YMNS0001-YM_SYUSUTNHYUJ,
/A1F/YMNS0001-YM_PSKSTBM1,
/A1F/YMNS0001-YM_PSKONMS1,
/A1F/YMNS0001-YM_PSKBETR1,
/A1F/YMNS0001-YM_PSKMEIN1,
/A1F/YMNS0001-YM_PSKPEIN1,
/A1F/YMNS0001-YM_PSKSTBM2,
/A1F/YMNS0001-YM_PSKONMS2,
/A1F/YMNS0001-YM_PSKBETR2,
/A1F/YMNS0001-YM_PSKMEIN2,
/A1F/YMNS0001-YM_PSKPEIN2,
/A1F/YMNS0001-YM_PSKSTBM3,
/A1F/YMNS0001-YM_PSKONMS3,
/A1F/YMNS0001-YM_PSKBETR3,
/A1F/YMNS0001-YM_PSKMEIN3,
/A1F/YMNS0001-YM_PSKPEIN3,
/A1F/YMNS0001-YM_PSKSTBM4,
/A1F/YMNS0001-YM_PSKONMS4,
/A1F/YMNS0001-YM_PSKBETR4,
/A1F/YMNS0001-YM_PSKMEIN4,
/A1F/YMNS0001-YM_PSKPEIN4,
/A1F/YMNS0001-YM_PSKSTBM5,
/A1F/YMNS0001-YM_PSKONMS5,
/A1F/YMNS0001-YM_PSKBETR5,
/A1F/YMNS0001-YM_PSKMEIN5,
/A1F/YMNS0001-YM_PSKPEIN5,
/A1F/YMNS0001-YM_SSKSTBM1,
/A1F/YMNS0001-YM_SSKONMS1,
/A1F/YMNS0001-YM_SSKBETR1,
/A1F/YMNS0001-YM_SSKMEIN1,
/A1F/YMNS0001-YM_SSKPEIN1,
/A1F/YMNS0001-YM_SSKSTBM2,
/A1F/YMNS0001-YM_SSKONMS2,
/A1F/YMNS0001-YM_SSKBETR2,
/A1F/YMNS0001-YM_SSKMEIN2,
/A1F/YMNS0001-YM_SSKPEIN2,
/A1F/YMNS0001-YM_SSKSTBM3,
/A1F/YMNS0001-YM_SSKONMS3,
/A1F/YMNS0001-YM_SSKBETR3,
/A1F/YMNS0001-YM_SSKMEIN3,
/A1F/YMNS0001-YM_SSKPEIN3,
/A1F/YMNS0001-YM_SSKSTBM4,
/A1F/YMNS0001-YM_SSKONMS4,
/A1F/YMNS0001-YM_SSKBETR4,
/A1F/YMNS0001-YM_SSKMEIN4,
/A1F/YMNS0001-YM_SSKPEIN4,
/A1F/YMNS0001-YM_SSKSTBM5,
/A1F/YMNS0001-YM_SSKONMS5,
/A1F/YMNS0001-YM_SSKBETR5,
/A1F/YMNS0001-YM_SSKMEIN5,
/A1F/YMNS0001-YM_SSKPEIN5,
/A1F/YMNS0001-IND_SECTOR,
/A1F/YMNS0001-MATL_TYPE,
/A1F/YMNS0001-LOADINGGRP,
/A1F/YMNS0001-AVAILCHECK,
/A1F/YMNS0001-PRICE_CTRL,
/A1F/YMNS0001-VAL_CLASS,
/A1F/YMNS0001-MATL_STATS,
/A1F/YMNS0001-MAT_PR_GRP,
/A1F/YMNS0001-ACCT_ASSGT,
/A1F/YMNS0001-PROD_ATT_1,
/A1F/YMNS0001-PROD_ATT_2,
/A1F/YMNS0001-PROD_ATT_3,
/A1F/YMNS0001-PROD_ATT_4,
/A1F/YMNS0001-PROD_ATT_5,
/A1F/YMNS0001-PROD_ATT_6,
/A1F/YMNS0001-PROD_ATT_7,
/A1F/YMNS0001-TRANS_GRP,
/A1F/YMNS0001-TAX_TYPE_1,
/A1F/YMNS0001-TAXCLASS_1,
/A1F/YMNS0001-DEPCOUNTRY,
/A1F/YMNS0001-TAX_IND,
/A1F/YMNS0001-YM_NEWMK,
/A1F/YMNS0001-YM_CPYMK,
/A1F/YMNS0001-YM_CPYMATNR,
/A1F/YMNS0001-YM_KIHTBHBIJSK.

CLEAR : A1F_WG_CURSOR .

** 2007/07/20 INSERT START
** マスタメンテ項目追加
CLEAR: /A1F/YMNS0001-YM_SKSJBKU,
/A1F/YMNS0001-YM_HERKL,
/A1F/YMNS0001-YM_STAWN,
/A1F/YMNS0001-YM_SUHNNAM,
/A1F/YMNS0001-YM_YOUTO,
/A1F/YMNS0001-YM_STOFF,
/A1F/YMNS0001-YM_NTGEW,
/A1F/YMNS0001-YM_URZTP.
** 2007/07/20 INSERT END

* Append By Mis-Ohno
CLEAR: /A1F/YMNS0001-YM_WRKST,
/A1F/YMNS0001-YM_NORMT.
* End Append

ENDFORM.                    " A1F_CLEAR_ALL
*&---------------------------------------------------------------------*
*&      Form  a1f_CALCULATION_margin
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CALCULATION_MARGIN .

DATA : A1F_WL_MARGIN1(16) TYPE P DECIMALS 4 ,
A1F_WL_MARGIN2(16) TYPE P ,
A1F_WL_TMP_VALUE LIKE BAPICURR-BAPICURR ,
A1F_WL_TMP_VALUE2 LIKE BAPICURR-BAPICURR ,
A1F_WL_NETPR TYPE F ,
A1F_WL_NETPR_C(20) .

IF /A1F/YMNS0001-YM_ARRRT IS INITIAL .
CLEAR /A1F/YMNS0001-YM_URKKK .
EXIT .
ENDIF .

CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_EXTERNAL'
EXPORTING
CURRENCY        = /A1F/YMNS0001-YM_PWAERS
AMOUNT_INTERNAL = /A1F/YMNS0001-YM_PKBETR
IMPORTING
AMOUNT_EXTERNAL = A1F_WL_TMP_VALUE.

A1F_WL_NETPR = A1F_WL_TMP_VALUE .

IF /A1F/YMNS0001-YM_ARRRT < 100 .
IF /A1F/YMNS0001-YM_SYUSUTNHYUJ IS INITIAL .
A1F_WL_MARGIN2 = A1F_WL_NETPR
/ ( ( 100 - /A1F/YMNS0001-YM_ARRRT ) / 100 ) .
WRITE A1F_WL_MARGIN2 TO /A1F/YMNS0001-YM_URKKK .
ELSE .
A1F_WL_MARGIN1 = A1F_WL_NETPR
/ ( ( 100 - /A1F/YMNS0001-YM_ARRRT ) / 100 ) .
WRITE A1F_WL_MARGIN1 TO /A1F/YMNS0001-YM_URKKK .
ENDIF .
ELSE.
/A1F/YMNS0001-YM_URKKK = '*******************' .
ENDIF .


ENDFORM.                    " a1f_CALCULATION_margin
*&---------------------------------------------------------------------*
*&      Form  a1f_check_before_save
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_BEFORE_SAVE .


* 品目コードの入力値チェック（禁則文字のチェック）
* 品目テキストの入力値チェック（禁則文字のチェック）
* 得意先品目コードの入力値チェック（禁則文字のチェック）

* 品目マスタ登録時の入力値チェック
IF A1F_WG_MARA-MATNR IS INITIAL .
PERFORM A1F_CHECK_MATERIAL_DATA .
ENDIF .
* 得意先品目情報マスタ登録時の入力値チェック
IF NOT ( /A1F/YMNS0001-YM_KUNNR IS INITIAL )  .
PERFORM A1F_CHECK_CUST_MAT_DATA .
ENDIF .
* 購買情報マスタ登録時のチェック
IF NOT ( /A1F/YMNS0001-YM_LIFNR IS INITIAL ) .
PERFORM A1F_CHECK_PURCHASE_INFO_DATA .
ENDIF .
* 販売価格マスタ登録時のチェック
IF NOT ( /A1F/YMNS0001-YM_KUNNR IS INITIAL )  .
PERFORM A1F_CHECK_SALES_PRICE_DATA .
ENDIF .


*
* 仕入れ価格と販売価格の逆鞘チェック
DATA : A1F_WG_PKBETR TYPE P DECIMALS 4 ,
A1F_WG_SKBETR TYPE P DECIMALS 4 .
A1F_WG_PKBETR = /A1F/YMNS0001-YM_PKBETR / /A1F/YMNS0001-YM_PKPEIN .
A1F_WG_SKBETR = /A1F/YMNS0001-YM_SKBETR / /A1F/YMNS0001-YM_SKPEIN .
IF NOT ( /A1F/YMNS0001-YM_PKBETR IS INITIAL )
AND NOT ( /A1F/YMNS0001-YM_SKBETR IS INITIAL ) .
IF A1F_WG_PKBETR > A1F_WG_SKBETR .
MESSAGE W265(/A1F/YLMS0100) .
ENDIF .
ENDIF .

* 2010/03/19 DMW1521対応          -----               START
* 販売スケール金額大小チェック
IF ( /A1F/YMNS0001-YM_SSKBETR1 <
/A1F/YMNS0001-YM_SSKBETR2 )
OR ( /A1F/YMNS0001-YM_SSKBETR2 <
/A1F/YMNS0001-YM_SSKBETR3 )
OR ( /A1F/YMNS0001-YM_SSKBETR3 <
/A1F/YMNS0001-YM_SSKBETR4 )
OR ( /A1F/YMNS0001-YM_SSKBETR4 <
/A1F/YMNS0001-YM_SSKBETR5 ).
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR1'.
MESSAGE E317(/A1F/YLMS0100) .
ENDIF.
* 2010/03/19 DMW1521対応          -----               E N D

ENDFORM.                    " a1f_check_before_save
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_MATERIAL_data
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_MATERIAL_DATA .

* 266 品目タイプの必須チェック  YM_HNMKTYP
IF /A1F/YMNS0001-YM_HNMKTYP IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_HNMKTYP'.
MESSAGE E266(/A1F/YLMS0100) .
ENDIF .
* 267 品目コードの必須チェック  YM_MATNR
IF /A1F/YMNS0001-YM_MATNR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATNR'.
MESSAGE E267(/A1F/YLMS0100) .
ENDIF .
*	268	品目テキストの必須チェック	YM_MAKTX
IF /A1F/YMNS0001-YM_MAKTX IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MAKTX'.
MESSAGE E268(/A1F/YLMS0100) .
ENDIF .
*	269	基本数量単位の必須チェック	YM_MEINS
IF /A1F/YMNS0001-YM_MEINS IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MEINS'.
MESSAGE E269(/A1F/YLMS0100) .
ENDIF .
*	270	品目グループの必須チェック	YM_MATKL
IF /A1F/YMNS0001-YM_MATKL IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MATKL'.
MESSAGE E270(/A1F/YLMS0100) .
ENDIF .
*	271	品目階層の必須チェック	YM_PRDHA
IF /A1F/YMNS0001-YM_PRDHA IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PRDHA'.
MESSAGE E271(/A1F/YLMS0100) .
ENDIF .
*	272	商品グループの必須チェック	YM_MVGR1
IF /A1F/YMNS0001-YM_MVGR1 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR1'.
MESSAGE E272(/A1F/YLMS0100) .
ENDIF .
*	273	最終製品の必須チェック	YM_MVGR2
IF /A1F/YMNS0001-YM_MVGR2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR2'.
MESSAGE E273(/A1F/YLMS0100) .
ENDIF .
*	274	商品分類の必須チェック	YM_MVGR3
IF /A1F/YMNS0001-YM_MVGR3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MVGR3'.
MESSAGE E274(/A1F/YLMS0100) .
ENDIF .
*	275	棚番の必須チェック	YM_LGPBE
IF /A1F/YMNS0001-YM_LGPBE IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_LGPBE'.
MESSAGE E275(/A1F/YLMS0100) .
ENDIF .
*	276	移動平均原価の必須チェック	YM_VERPR
IF /A1F/YMNS0001-YM_VERPR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_VERPR'.
MESSAGE E276(/A1F/YLMS0100) .
ENDIF .
* 277 価格単位（原価用）の必須チェック  YM_PEINH
IF /A1F/YMNS0001-YM_PEINH IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PEINH'.
MESSAGE E277(/A1F/YLMS0100) .
ENDIF .

* 入庫処理日数の入力値チェック
*  IF /A1F/YMNS0001-YM_SIRSKKBN2 IS INITIAL .
*    IF /A1F/YMNS0001-YM_WEBAZ BETWEEN 3 AND 4 .
*    ELSE .
*      SET CURSOR FIELD '/A1F/YMNS0001-YM_WEBAZ'.
*      MESSAGE W264(/A1F/YLMS0100) .
*    ENDIF .
*  ELSE .
*    IF NOT ( /A1F/YMNS0001-YM_WEBAZ BETWEEN 0 AND 0 ) .
*      SET CURSOR FIELD '/A1F/YMNS0001-YM_WEBAZ'.
*      MESSAGE W263(/A1F/YLMS0100) .
*    ENDIF .
*  ENDIF .

** 2007/07/20 INSERT START
** マスタメンテ項目追加
** 出荷指示備考、原産地、HSコード、危険物区分、該非判定、危険物コード
** 商品名、用途、重量、単位
IF /A1F/YMNS0001-YM_HERKL IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_HERKL'.
MESSAGE E312(/A1F/YLMS0100) .
ENDIF .
** 2007/07/20 INSERT END


ENDFORM.                    " A1F_CHECK_MATERIAL_data
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_CUST_MAT_data
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_CUST_MAT_DATA .

*	278	客先型番の必須チェック	YM_KDMAT
IF /A1F/YMNS0001-YM_KDMAT IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_KDMAT'.
MESSAGE E278(/A1F/YLMS0100) .
ENDIF .

ENDFORM.                    " A1F_CHECK_CUST_MAT_data
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_PURCHASE_INFO_data
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_PURCHASE_INFO_DATA .

*	279	税コードの必須チェック	YM_MWSKZ
IF /A1F/YMNS0001-YM_MWSKZ IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_MWSKZ'.
MESSAGE E279(/A1F/YLMS0100) .
ENDIF .
*	280	正味価格（仕入）の必須チェック	YM_PKBETR
IF /A1F/YMNS0001-YM_PKBETR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKBETR'.
MESSAGE E280(/A1F/YLMS0100) .
ENDIF .
*	281	価格単位（仕入）の必須チェック	YM_PKPEIN
IF /A1F/YMNS0001-YM_PKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PKPEIN'.
MESSAGE E281(/A1F/YLMS0100) .
ENDIF .
* 282 有効開始日（仕入）の必須チェック  YM_PDATAB
IF /A1F/YMNS0001-YM_PDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATAB'.
MESSAGE E282(/A1F/YLMS0100) .
ENDIF .
* 283 有効終了日（仕入）の必須チェック  YM_PDATBI
IF /A1F/YMNS0001-YM_PDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PDATBI'.
MESSAGE E283(/A1F/YLMS0100) .
ENDIF .
** 2008/06/24INSERT START
** 証明書区分の必須チェック追加
* 313 証明書区分の必須チェック  YM_URZTP
IF /A1F/YMNS0001-YM_URZTP IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_URZTP'.
MESSAGE E313(/A1F/YLMS0100) .
ENDIF .
** 2008/06/24 INSERT END
*	294	納入予定日数の必須チェック	YM_APLFZ
*  IF /A1F/YMNS0001-YM_APLFZ IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_APLFZ'.
*    MESSAGE E294(/A1F/YLMS0100) .
*  ENDIF .
**  284 スケール数量（仕入）の必須チェック YM_PSKSTBM1
*  IF /A1F/YMNS0001-YM_PSKSTBM1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKSTBM1'.
*    MESSAGE E284(/A1F/YLMS0100) .
*  ENDIF .
**  285 スケール金額（仕入）の必須チェック YM_PSKBETR1
*  IF /A1F/YMNS0001-YM_PSKBETR1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKBETR1'.
*    MESSAGE E285(/A1F/YLMS0100) .
*  ENDIF .
**  286 スケール数量単位（仕入）の必須チェック YM_PSKMEIN1
*  IF /A1F/YMNS0001-YM_PSKMEIN1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKMEIN1'.
*    MESSAGE E286(/A1F/YLMS0100) .
*  ENDIF .
*

DATA : A1F_WL_TMP_MATNR LIKE MARC-MATNR .
IF NOT ( A1F_WG_MARA-MATNR IS INITIAL ) .
SELECT SINGLE MATNR FROM  MARC
INTO A1F_WL_TMP_MATNR
WHERE  MATNR  = /A1F/YMNS0001-YM_MATNR
AND    WERKS  = /A1F/YMNS0001-WERKS .
IF SY-SUBRC NE 0 .
MESSAGE E306(/A1F/YLMS0100) WITH /A1F/YMNS0001-YM_MATNR
/A1F/YMNS0001-WERKS.
ENDIF .
ENDIF .



ENDFORM.                    " A1F_CHECK_PURCHASE_INFO_data
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_SALES_PRICE_data
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_SALES_PRICE_DATA .

*	287	正味価格（販売）の必須チェック	YM_SKBETR
IF /A1F/YMNS0001-YM_SKBETR IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKBETR'.
MESSAGE E287(/A1F/YLMS0100) .
ENDIF .
*	288	価格単位（販売）の必須チェック	YM_SKPEIN
IF /A1F/YMNS0001-YM_SKPEIN IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SKPEIN'.
MESSAGE E288(/A1F/YLMS0100) .
ENDIF .
* 289 有効開始日（販売）の必須チェック  YM_SDATAB
IF /A1F/YMNS0001-YM_SDATAB IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATAB'.
MESSAGE E289(/A1F/YLMS0100) .
ENDIF .
* 290 有効終了日（販売）の必須チェック  YM_SDATBI
IF /A1F/YMNS0001-YM_SDATBI IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SDATBI'.
MESSAGE E290(/A1F/YLMS0100) .
ENDIF .
**  291 スケール数量（販売）の必須チェック YM_SSKSTBM1
*  IF /A1F/YMNS0001-YM_SSKSTBM1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKSTBM1'.
*    MESSAGE E291(/A1F/YLMS0100) .
*  ENDIF .
**  292 スケール金額（販売）の必須チェック YM_SSKBETR1
*  IF /A1F/YMNS0001-YM_SSKBETR1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR1'.
*    MESSAGE E292(/A1F/YLMS0100) .
*  ENDIF .
**  293 スケール数量単位（販売）の必須チェック YM_SSKMEIN1
*  IF /A1F/YMNS0001-YM_SSKMEIN1 IS INITIAL .
*    SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKMEIN1'.
*    MESSAGE E293(/A1F/YLMS0100) .
*  ENDIF .

ENDFORM.                    " A1F_CHECK_SALES_PRICE_data
*&---------------------------------------------------------------------*
*&      Form  a1f_check_Scale_price_of_sales
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_SCALE_PRICE_OF_SALES .

IF NOT ( /A1F/YMNS0001-YM_SSKSTBM2 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKBETR2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR2'.
MESSAGE E292(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKBETR2 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKSTBM2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKSTBM2'.
MESSAGE E291(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKSTBM3 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKBETR3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR3'.
MESSAGE E292(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKBETR3 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKSTBM3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKSTBM3'.
MESSAGE E291(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKSTBM4 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKBETR4 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR4'.
MESSAGE E292(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKBETR4 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKSTBM4 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKSTBM4'.
MESSAGE E291(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKSTBM5 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKBETR5 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKBETR5'.
MESSAGE E292(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_SSKBETR5 IS INITIAL )
AND /A1F/YMNS0001-YM_SSKSTBM5 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_SSKSTBM5'.
MESSAGE E291(/A1F/YLMS0100) .
ENDIF .

PERFORM A1F_MERGE_SCALE_PRICE CHANGING
/A1F/YMNS0001-YM_SSKSTBM2
/A1F/YMNS0001-YM_SSKBETR2
/A1F/YMNS0001-YM_SSKSTBM3
/A1F/YMNS0001-YM_SSKBETR3
/A1F/YMNS0001-YM_SSKSTBM4
/A1F/YMNS0001-YM_SSKBETR4
/A1F/YMNS0001-YM_SSKSTBM5
/A1F/YMNS0001-YM_SSKBETR5 .


ENDFORM.                    " a1f_check_Scale_price_of_sales
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_SCALE_PRICE_OF_PURCH
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_CHECK_SCALE_PRICE_OF_PURCH .

IF NOT ( /A1F/YMNS0001-YM_PSKSTBM2 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKBETR2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKBETR2'.
MESSAGE E285(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKBETR2 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKSTBM2 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKSTBM2'.
MESSAGE E284(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKSTBM3 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKBETR3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKBETR3'.
MESSAGE E285(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKBETR3 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKSTBM3 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKSTBM3'.
MESSAGE E284(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKSTBM4 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKBETR4 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKBETR4'.
MESSAGE E285(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKBETR4 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKSTBM4 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKSTBM4'.
MESSAGE E284(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKSTBM5 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKBETR5 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKBETR5'.
MESSAGE E285(/A1F/YLMS0100) .
ENDIF .

IF NOT ( /A1F/YMNS0001-YM_PSKBETR5 IS INITIAL )
AND /A1F/YMNS0001-YM_PSKSTBM5 IS INITIAL .
SET CURSOR FIELD '/A1F/YMNS0001-YM_PSKSTBM5'.
MESSAGE E284(/A1F/YLMS0100) .
ENDIF .

PERFORM A1F_MERGE_SCALE_PRICE CHANGING
/A1F/YMNS0001-YM_PSKSTBM2
/A1F/YMNS0001-YM_PSKBETR2
/A1F/YMNS0001-YM_PSKSTBM3
/A1F/YMNS0001-YM_PSKBETR3
/A1F/YMNS0001-YM_PSKSTBM4
/A1F/YMNS0001-YM_PSKBETR4
/A1F/YMNS0001-YM_PSKSTBM5
/A1F/YMNS0001-YM_PSKBETR5 .



ENDFORM.                    " A1F_CHECK_SCALE_PRICE_OF_PURCH
*&---------------------------------------------------------------------*
*&      Form  A1F_MERGE_SCALE_PRICE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_/A1F/YMNS0001_YM_PSKSTBM2  text
*      <--P_/A1F/YMNS0001_YM_PSKBETR2  text
*      <--P_/A1F/YMNS0001_YM_PSKSTBM3  text
*      <--P_/A1F/YMNS0001_YM_PSKBETR3  text
*      <--P_/A1F/YMNS0001_YM_PSKSTBM4  text
*      <--P_/A1F/YMNS0001_YM_PSKBETR4  text
*      <--P_/A1F/YMNS0001_YM_PSKSTBM5  text
*      <--P_/A1F/YMNS0001_YM_PSKBETR5  text
*----------------------------------------------------------------------*
FORM A1F_MERGE_SCALE_PRICE  CHANGING P_KSTBM2
P_KBETR2
P_KSTBM3
P_KBETR3
P_KSTBM4
P_KBETR4
P_KSTBM5
P_KBETR5.

DATA : A1F_WL_TMP_KSTBM LIKE /A1F/YMNS0001-YM_PSKSTBM1 ,
A1F_WL_TMP_KBETR LIKE /A1F/YMNS0001-YM_PSKBETR1 .

IF P_KSTBM2 = P_KSTBM3 .
CLEAR : P_KSTBM3 , P_KBETR3 .
ENDIF .
IF P_KSTBM2 = P_KSTBM4 .
CLEAR : P_KSTBM4 , P_KBETR4 .
ENDIF .
IF P_KSTBM2 = P_KSTBM5 .
CLEAR : P_KSTBM5 , P_KBETR5 .
ENDIF .
IF P_KSTBM3 = P_KSTBM4 .
CLEAR : P_KSTBM4 , P_KBETR4 .
ENDIF .
IF P_KSTBM3 = P_KSTBM5 .
CLEAR : P_KSTBM5 , P_KBETR5 .
ENDIF .
IF P_KSTBM4 = P_KSTBM5 .
CLEAR : P_KSTBM5 , P_KBETR5 .
ENDIF .

IF P_KSTBM2 > P_KSTBM3 .
A1F_WL_TMP_KSTBM = P_KSTBM2 .
A1F_WL_TMP_KBETR = P_KBETR2 .
P_KSTBM2 = P_KSTBM3 .
P_KBETR2 = P_KBETR3 .
P_KSTBM3 = A1F_WL_TMP_KSTBM .
P_KBETR3 = A1F_WL_TMP_KBETR .
ENDIF .
IF P_KSTBM2 > P_KSTBM4 .
A1F_WL_TMP_KSTBM = P_KSTBM2 .
A1F_WL_TMP_KBETR = P_KBETR2 .
P_KSTBM2 = P_KSTBM4 .
P_KBETR2 = P_KBETR4 .
P_KSTBM4 = A1F_WL_TMP_KSTBM .
P_KBETR4 = A1F_WL_TMP_KBETR .
ENDIF .
IF P_KSTBM2 > P_KSTBM5 .
A1F_WL_TMP_KSTBM = P_KSTBM2 .
A1F_WL_TMP_KBETR = P_KBETR2 .
P_KSTBM2 = P_KSTBM5 .
P_KBETR2 = P_KBETR5 .
P_KSTBM5 = A1F_WL_TMP_KSTBM .
P_KBETR5 = A1F_WL_TMP_KBETR .
ENDIF .
IF P_KSTBM3 > P_KSTBM4 .
A1F_WL_TMP_KSTBM = P_KSTBM3 .
A1F_WL_TMP_KBETR = P_KBETR3 .
P_KSTBM3 = P_KSTBM4 .
P_KBETR3 = P_KBETR4 .
P_KSTBM4 = A1F_WL_TMP_KSTBM .
P_KBETR4 = A1F_WL_TMP_KBETR .
ENDIF .
IF P_KSTBM3 > P_KSTBM5 .
A1F_WL_TMP_KSTBM = P_KSTBM3 .
A1F_WL_TMP_KBETR = P_KBETR3 .
P_KSTBM3 = P_KSTBM5 .
P_KBETR3 = P_KBETR5 .
P_KSTBM5 = A1F_WL_TMP_KSTBM .
P_KBETR5 = A1F_WL_TMP_KBETR .
ENDIF .
IF P_KSTBM4 > P_KSTBM5 .
A1F_WL_TMP_KSTBM = P_KSTBM4 .
A1F_WL_TMP_KBETR = P_KBETR4 .
P_KSTBM4 = P_KSTBM5 .
P_KBETR4 = P_KBETR5 .
P_KSTBM5 = A1F_WL_TMP_KSTBM .
P_KBETR5 = A1F_WL_TMP_KBETR .
ENDIF .

DO 3 TIMES .
IF P_KSTBM2 IS INITIAL .
P_KSTBM2 = P_KSTBM3 . CLEAR P_KSTBM3 .
P_KBETR2 = P_KBETR3 . CLEAR P_KBETR3 .
ENDIF .
IF P_KSTBM3 IS INITIAL .
P_KSTBM3 = P_KSTBM4 . CLEAR P_KSTBM4 .
P_KBETR3 = P_KBETR4 . CLEAR P_KBETR4 .
ENDIF .
IF P_KSTBM4 IS INITIAL .
P_KSTBM4 = P_KSTBM5 . CLEAR P_KSTBM5 .
P_KBETR4 = P_KBETR5 . CLEAR P_KBETR5 .
ENDIF .
ENDDO .

ENDFORM.                    " A1F_MERGE_SCALE_PRICE
*&---------------------------------------------------------------------*
*&      Form  a1f_check_Em_size
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_/A1F/YMNS0001_YM_MATNR  text
*----------------------------------------------------------------------*
FORM A1F_CHECK_EM_SIZE USING    P_CHAR P_DIGIT .

DATA A1F_WL_NEW_POS TYPE I .
DATA : A1F_WL_TMP_CHAR1(100) ,
A1F_WL_TMP_CHAR2(100) .


DO P_DIGIT TIMES .
CALL FUNCTION 'STRING_SPLIT_AT_POSITION'
EXPORTING
STRING            = P_CHAR
POS               = SY-INDEX
IMPORTING
STRING1           = A1F_WL_TMP_CHAR1
STRING2           = A1F_WL_TMP_CHAR2
POS_NEW           = A1F_WL_NEW_POS
EXCEPTIONS
STRING1_TOO_SMALL = 1
STRING2_TOO_SMALL = 2
POS_NOT_VALID     = 3
OTHERS            = 4.
IF SY-SUBRC = 0.
IF SY-INDEX NE A1F_WL_NEW_POS .
MESSAGE E304(/A1F/YLMS0100) WITH P_CHAR .
ENDIF .
ENDIF.
ENDDO .

ENDFORM.                    " a1f_check_Em_size
*&---------------------------------------------------------------------*
*&      Form  A1F_CHECK_Illegal_char
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_/A1F/YMNS0001_YM_MATNR  text
*----------------------------------------------------------------------*
FORM A1F_CHECK_ILLEGAL_CHAR USING    P_CHAR P_DIGIT .

*  IF P_CHAR CA /A1F/YMNS0001-YM_KNSKMJ .
*    MESSAGE E305(/A1F/YLMS0100) WITH P_CHAR .
*  ENDIF .

DATA : A1F_WL_KNSKMJ1(1) .
DATA : A1F_WL_INDEX LIKE SY-INDEX .
DATA : A1F_WL_INDEX2 LIKE SY-INDEX.
DATA : A1F_WL_CHAR1(100).
DATA : A1F_WL_CHAR2(100).

* DMW1692 禁則文字チェック方法変更    - start T.arai(MIS)

*  DO 100 TIMES .
*    A1F_WL_INDEX = SY-INDEX - 1 .
*    A1F_WL_KNSKMJ1 = /A1F/YMNS0001-YM_KNSKMJ+A1F_WL_INDEX(1) .
*    IF A1F_WL_KNSKMJ1 IS INITIAL .
*      CONTINUE .
*    ENDIF .
*    DO P_DIGIT TIMES .
*      A1F_WL_INDEX = SY-INDEX - 1 .
*      IF A1F_WL_KNSKMJ1 = P_CHAR+A1F_WL_INDEX(1) .
*        MESSAGE E305(/A1F/YLMS0100) WITH P_CHAR .
*      ENDIF .
*    ENDDO .
*  ENDDO .

A1F_WL_CHAR1 = /A1F/YMNS0001-YM_KNSKMJ.
CONDENSE A1F_WL_CHAR1 NO-GAPS.
A1F_WL_INDEX = STRLEN( A1F_WL_CHAR1 ).

A1F_WL_CHAR2 = P_CHAR.
CONDENSE A1F_WL_CHAR2 NO-GAPS.
A1F_WL_INDEX2 = STRLEN( A1F_WL_CHAR2 ).

CHECK A1F_WL_INDEX NE 0 AND A1F_WL_INDEX2 NE 0.
IF P_CHAR+0(A1F_WL_INDEX2) CA /A1F/YMNS0001-YM_KNSKMJ+0(A1F_WL_INDEX).
MESSAGE E305(/A1F/YLMS0100) WITH P_CHAR .
ENDIF.

* ワイルドカード*は上記では検索できないから別チェック
IF /A1F/YMNS0001-YM_KNSKMJ CA '*' AND
P_CHAR CA '*'.
MESSAGE E305(/A1F/YLMS0100) WITH P_CHAR .
ENDIF.


* DMW1692 禁則文字チェック方法変更    - e n d T.arai(MIS)

ENDFORM.                    " A1F_CHECK_Illegal_char
*&---------------------------------------------------------------------*
*&      Form  A1F_SAVE_SOURCE_OF_SUPLY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_A1F_WL_SUBRC  text
*----------------------------------------------------------------------*
FORM A1F_SAVE_SOURCE_OF_SUPLY CHANGING P_SUBRC.

P_SUBRC = 9 .

IF /A1F/YMNS0001-YM_MWSKZ IS INITIAL  .
P_SUBRC = 1 .
EXIT .
ENDIF .

DATA : A1F_WL_EORD LIKE EORD .
DATA : A1F_TL_EORD_RETURN LIKE TABLE OF BAPIRET2
WITH HEADER LINE .

A1F_WL_EORD-VDATU = /A1F/YMNS0001-YM_PDATAB .
A1F_WL_EORD-BDATU = /A1F/YMNS0001-YM_PDATBI .
A1F_WL_EORD-LIFNR = /A1F/YMNS0001-YM_LIFNR .
A1F_WL_EORD-MATNR = /A1F/YMNS0001-YM_MATNR .
A1F_WL_EORD-EKORG = /A1F/YMNS0001-EKORG .
A1F_WL_EORD-WERKS = /A1F/YMNS0001-WERKS .

PERFORM A1F_CT_SOURCE_OF_SUPPLY TABLES A1F_TL_EORD_RETURN
USING A1F_WL_EORD .

LOOP AT A1F_TL_EORD_RETURN
WHERE TYPE = 'E' .
MESSAGE ID A1F_TL_EORD_RETURN-ID
TYPE A1F_TL_EORD_RETURN-TYPE
NUMBER A1F_TL_EORD_RETURN-NUMBER
WITH A1F_TL_EORD_RETURN-MESSAGE_V1
A1F_TL_EORD_RETURN-MESSAGE_V2
A1F_TL_EORD_RETURN-MESSAGE_V3
A1F_TL_EORD_RETURN-MESSAGE_V4 .
ENDLOOP .

A1F_TG_INFORECORD_GENERAL-MATERIAL = /A1F/YMNS0001-YM_MATNR .

CLEAR P_SUBRC .




ENDFORM.                    " A1F_SAVE_SOURCE_OF_SUPLY
*&---------------------------------------------------------------------*
*&      Form  A1F_CT_SOURCE_OF_SUPPLY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_A1F_TL_EORD_RETURN  text
*      -->P_A1F_WL_EORD  text
*----------------------------------------------------------------------*
FORM A1F_CT_SOURCE_OF_SUPPLY
TABLES   P_A1F_TL_EORD_RETURN STRUCTURE BAPIRET2
USING    P_A1F_WL_EORD        STRUCTURE EORD .

DATA : A1F_TL_BDCDATA LIKE TABLE OF BDCDATA
WITH HEADER LINE .

CLEAR A1F_TL_BDCDATA.
REFRESH A1F_TL_BDCDATA.

DATA : A1F_TL_EORD_SORCE LIKE TABLE OF EORD
WITH HEADER LINE .
DATA : A1F_TL_EORD_CNT LIKE SY-TABIX .

CLEAR A1F_TL_EORD_SORCE.
REFRESH A1F_TL_EORD_SORCE.

SELECT        * FROM  EORD
INTO TABLE A1F_TL_EORD_SORCE
WHERE  MATNR  = P_A1F_WL_EORD-MATNR
AND    WERKS  = P_A1F_WL_EORD-WERKS.

DESCRIBE TABLE A1F_TL_EORD_SORCE LINES A1F_TL_EORD_CNT .


PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0200'                     'X',
'BDC_OKCODE'             '/00'                      ' ',
'EORD-MATNR'             P_A1F_WL_EORD-MATNR        ' ',
'EORD-WERKS'             P_A1F_WL_EORD-WERKS        ' '.

IF NOT ( A1F_TL_EORD_CNT IS INITIAL ) .
PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=SA'                      ' ',
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=LOES'                    ' ',
'SAPLSPO1'               '0200'                     'X',
'BDC_OKCODE'             '=YES'                     ' '.
PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=NS'                      ' ',
'EORD-VDATU(01)'         P_A1F_WL_EORD-VDATU        ' ',
'EORD-BDATU(01)'         P_A1F_WL_EORD-BDATU        ' ',
'EORD-LIFNR(01)'         P_A1F_WL_EORD-LIFNR        ' ',
'EORD-EKORG(01)'         P_A1F_WL_EORD-EKORG        ' ',
'RM06W-FESKZ(01)'        'X'                        ' '.
LOOP AT A1F_TL_EORD_SORCE .
PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=NS'                      ' ',
'EORD-VDATU(02)'         A1F_TL_EORD_SORCE-VDATU    ' ',
'EORD-BDATU(02)'         A1F_TL_EORD_SORCE-BDATU    ' ',
'EORD-LIFNR(02)'         A1F_TL_EORD_SORCE-LIFNR    ' ',
'EORD-EKORG(02)'         A1F_TL_EORD_SORCE-EKORG    ' ',
'RM06W-FESKZ(02)'        ' '                        ' '.
ENDLOOP .
PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=BU'                      ' '.
ELSE .
PERFORM A1F_GENERATE_BDCDATA TABLES A1F_TL_BDCDATA
USING:
'SAPLMEOR'               '0205'                     'X',
'BDC_OKCODE'             '=BU'                      ' ',
'EORD-VDATU(01)'         P_A1F_WL_EORD-VDATU        ' ',
'EORD-BDATU(01)'         P_A1F_WL_EORD-BDATU        ' ',
'EORD-LIFNR(01)'         P_A1F_WL_EORD-LIFNR        ' ',
'EORD-EKORG(01)'         P_A1F_WL_EORD-EKORG        ' ',
'RM06W-FESKZ(01)'        'X'                        ' '.
ENDIF .

PERFORM A1F_CALL_TRANSCTION TABLES A1F_TL_BDCDATA
P_A1F_TL_EORD_RETURN
USING 'ME01'.


ENDFORM.                    " A1F_CT_SOURCE_OF_SUPPLY
*&---------------------------------------------------------------------*
*&      Form  A1F_LEAVE_PROGRAM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM A1F_LEAVE_PROGRAM.

DATA : A1F_WL_ANSWER_01(1),
**** START ADD 2014/08/26 ISID･喩 ****
LW_MSGTXT_DUMMY1(25)  TYPE  C,
LW_MSGTXT_DUMMY2(25)  TYPE  C,
LW_MSGTXT_DUMMY3(25)  TYPE  C.
**** END ADD 2014/08/26 ISID･喩 ****

IF     /A1F/YMNS0001-YM_KUNNR IS INITIAL
AND /A1F/YMNS0001-YM_VKGRP IS INITIAL
AND /A1F/YMNS0001-YM_KDMAT IS INITIAL
AND /A1F/YMNS0001-YM_POSTX IS INITIAL
AND /A1F/YMNS0001-YM_MATNR IS INITIAL
AND /A1F/YMNS0001-YM_HNMKTYP IS INITIAL
AND /A1F/YMNS0001-YM_TMPSRYHS IS INITIAL
AND /A1F/YMNS0001-YM_MAKTX IS INITIAL
AND /A1F/YMNS0001-YM_MEINS IS INITIAL
AND /A1F/YMNS0001-YM_VRKME IS INITIAL
AND /A1F/YMNS0001-YM_UMRENS IS INITIAL
AND /A1F/YMNS0001-YM_UMREZS IS INITIAL
AND /A1F/YMNS0001-YM_BSTME IS INITIAL
AND /A1F/YMNS0001-YM_UMRENP IS INITIAL
AND /A1F/YMNS0001-YM_UMREZP IS INITIAL
AND /A1F/YMNS0001-YM_MATKL IS INITIAL
AND /A1F/YMNS0001-YM_PRDHA IS INITIAL
AND /A1F/YMNS0001-YM_MVGR1 IS INITIAL
AND /A1F/YMNS0001-YM_MVGR2 IS INITIAL
AND /A1F/YMNS0001-YM_MVGR3 IS INITIAL
AND /A1F/YMNS0001-YM_LGPBE IS INITIAL
AND /A1F/YMNS0001-YM_WEBAZ IS INITIAL
AND /A1F/YMNS0001-YM_VERPR IS INITIAL
AND /A1F/YMNS0001-YM_PEINH IS INITIAL
AND /A1F/YMNS0001-YM_LIFNR IS INITIAL
AND /A1F/YMNS0001-YM_SIRSKKBN1 IS INITIAL
AND /A1F/YMNS0001-YM_SIRSKKBN2 IS INITIAL
AND /A1F/YMNS0001-YM_INDLF IS INITIAL
AND /A1F/YMNS0001-YM_APLFZ IS INITIAL
AND /A1F/YMNS0001-YM_KUBIJUHUTYUK IS INITIAL
AND /A1F/YMNS0001-YM_KUBIJUHUTYUK2 IS INITIAL
AND /A1F/YMNS0001-YM_KUBUJUHUTEXT IS INITIAL
AND /A1F/YMNS0001-YM_MWSKZ IS INITIAL
AND /A1F/YMNS0001-YM_PKBETR IS INITIAL
AND /A1F/YMNS0001-YM_PKPEIN IS INITIAL
AND /A1F/YMNS0001-YM_SKBETR IS INITIAL
AND /A1F/YMNS0001-YM_SKPEIN IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM2 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR2 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM3 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR3 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM4 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR4 IS INITIAL
AND /A1F/YMNS0001-YM_PSKSTBM5 IS INITIAL
AND /A1F/YMNS0001-YM_PSKBETR5 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM2 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR2 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM3 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR3 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM4 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR4 IS INITIAL
AND /A1F/YMNS0001-YM_SSKSTBM5 IS INITIAL
AND /A1F/YMNS0001-YM_SSKBETR5 IS INITIAL .
ELSE .
IF A1F_WG_SAVE_FLG IS INITIAL .
**** START ADD 2014/08/26 ISID･喩 ****
CLEAR: LW_MSGTXT_DUMMY1,
LW_MSGTXT_DUMMY2.

MESSAGE S104(Z3) INTO LW_MSGTXT_DUMMY1.
MESSAGE S106(Z3) INTO LW_MSGTXT_DUMMY2.
**** END ADD 2014/08/26 ISID･喩 ****
CALL FUNCTION 'POPUP_CONTINUE_YES_NO'
EXPORTING
**** START UPD 2014/08/26 ISID･喩 ****
*                TEXTLINE1 = TEXT-102
*                TEXTLINE2 = TEXT-104
TEXTLINE1 = LW_MSGTXT_DUMMY1
TEXTLINE2 = LW_MSGTXT_DUMMY2
**** END UPD 2014/08/26 ISID･喩 ****
TITEL     = TEXT-101
IMPORTING
ANSWER    = A1F_WL_ANSWER_01.

IF A1F_WL_ANSWER_01 NE 'J' .
EXIT .
ENDIF .
ENDIF .
ENDIF .

LEAVE PROGRAM.


ENDFORM.                    " A1F_LEAVE_PROGRAM
*&---------------------------------------------------------------------*
*&      Form  af1_conv_verpr_char_to_curr
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_/A1F/YMNS0001_YM_WAERS  text
*      -->P_/A1F/YMNS0001_YM_VERPR_CH  text
*      <--P_/A1F/YMNS0001_YM_PEINH  text
*      <--P_/A1F/YMNS0001_YM_VERPR  text
*----------------------------------------------------------------------*
FORM AF1_CONV_VERPR_CHAR_TO_CURR USING    P_WAERS
P_VERPR_CH
CHANGING P_PEINH
P_VERPR.

DATA TMP_VERPR TYPE BAPICURR-BAPICURR .
DATA TMP_VERPR_DEC8(16) TYPE P DECIMALS 8 .
DATA TMP_INT_AMOUNT1(16) TYPE P .
DATA TMP_INT_AMOUNT2(16) TYPE P .
DATA TMP_DEC2_AMOUNT1(16) TYPE P DECIMALS 2 .
DATA TMP_DEC2_AMOUNT2(16) TYPE P DECIMALS 2 .
DATA TMP_DEC3_AMOUNT1(16) TYPE P DECIMALS 3 .
DATA TMP_DEC3_AMOUNT2(16) TYPE P DECIMALS 3 .
DATA TMP_DEC4_AMOUNT1(16) TYPE P DECIMALS 4 .
DATA TMP_DEC4_AMOUNT2(16) TYPE P DECIMALS 4 .
DATA TMP_DEC5_AMOUNT1(16) TYPE P DECIMALS 5 .
DATA TMP_DEC5_AMOUNT2(16) TYPE P DECIMALS 5 .
DATA TMP_DEC6_AMOUNT1(16) TYPE P DECIMALS 6 .
DATA TMP_DEC6_AMOUNT2(16) TYPE P DECIMALS 6 .
DATA TMP_DEC7_AMOUNT1(16) TYPE P DECIMALS 7 .
DATA TMP_DEC7_AMOUNT2(16) TYPE P DECIMALS 7 .
DATA S_DECIMALS_OF_CURRENCY TYPE TCURX.
DATA DEC_CHECK(12) VALUE ' 0123456789.' .
DATA DEC_CHECK2(16) TYPE P DECIMALS 8 .

** 入力項目に数値と少数点以外が含まれる場合のエラーチェック
IF P_VERPR_CH CN DEC_CHECK .
MESSAGE E225(/A1F/YLMS0100) WITH P_VERPR_CH .
EXIT .
ENDIF .

** 小数点が二つあるなど数値として変換できない場合のエラーチェック
CATCH SYSTEM-EXCEPTIONS CONVERSION_ERRORS = 4 .
DEC_CHECK2 = P_VERPR_CH .
ENDCATCH .
IF SY-SUBRC NE 0  .
MESSAGE E226(/A1F/YLMS0100) WITH P_VERPR_CH .
EXIT .
ENDIF .

SELECT SINGLE * FROM  TCURX
INTO S_DECIMALS_OF_CURRENCY
WHERE CURRKEY = P_WAERS.
IF SY-SUBRC = 0 .
ELSE .
S_DECIMALS_OF_CURRENCY-CURRDEC = 2 .
ENDIF .

** 最終的な金額に小数点が含まれないパターン（JPYなど）CURRDEC=0
IF S_DECIMALS_OF_CURRENCY-CURRDEC = 0 .
TMP_VERPR_DEC8 = P_VERPR_CH .

TMP_INT_AMOUNT1  = TMP_VERPR_DEC8 .
TMP_DEC2_AMOUNT1 = TMP_VERPR_DEC8 * 100 .
TMP_INT_AMOUNT2  = TMP_VERPR_DEC8 * 100 .

IF TMP_INT_AMOUNT1 = TMP_VERPR_DEC8 .
P_PEINH = '1' .
ELSE .
IF TMP_DEC2_AMOUNT1 = TMP_INT_AMOUNT2 .
P_PEINH = '100' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 100 .
ELSE .
P_PEINH = '10000' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 10000 .
ENDIF .
ENDIF .

TMP_VERPR = TMP_VERPR_DEC8 .
CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_INTERNAL'
EXPORTING
CURRENCY             = P_WAERS
AMOUNT_EXTERNAL      = TMP_VERPR
MAX_NUMBER_OF_DIGITS = 10
IMPORTING
AMOUNT_INTERNAL      = P_VERPR.
**** START DEL 2014/08/27 ISID･喩 ****
*    IF SY-SUBRC = 0 .
*    ELSE .
*    ENDIF .
**** END DEL 2014/08/27 ISID･喩 ****

** 最終的な金額が小数点２桁のパターン（USDなど）
**                                   CURRDEC=2（取得できない）
ELSEIF S_DECIMALS_OF_CURRENCY-CURRDEC = 2 .
TMP_VERPR_DEC8 = P_VERPR_CH .

TMP_DEC2_AMOUNT1 = TMP_VERPR_DEC8 .
TMP_DEC4_AMOUNT1 = TMP_VERPR_DEC8 * 100 .
TMP_DEC2_AMOUNT2 = TMP_VERPR_DEC8 * 100 .

IF TMP_DEC2_AMOUNT1 = TMP_VERPR_DEC8 .
P_PEINH = '1' .
ELSE .
IF TMP_DEC4_AMOUNT1 = TMP_DEC2_AMOUNT2 .
P_PEINH = '100' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 100 .
ELSE .
P_PEINH = '10000' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 10000 .
ENDIF .
ENDIF .

TMP_VERPR = TMP_VERPR_DEC8 .
CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_INTERNAL'
EXPORTING
CURRENCY             = P_WAERS
AMOUNT_EXTERNAL      = TMP_VERPR
MAX_NUMBER_OF_DIGITS = 10
IMPORTING
AMOUNT_INTERNAL      = P_VERPR.
**** START DEL 2014/08/27 ISID･喩 ****
*    IF SY-SUBRC = 0 .
*    ELSE .
*    ENDIF .
**** END DEL 2014/08/27 ISID･喩 ****

** 最終的な金額が小数点３桁のパターン
**                                   CURRDEC=3
ELSEIF S_DECIMALS_OF_CURRENCY-CURRDEC = 3 .
TMP_VERPR_DEC8 = P_VERPR_CH .

TMP_DEC3_AMOUNT1 = TMP_VERPR_DEC8 .
TMP_DEC5_AMOUNT1 = TMP_VERPR_DEC8 * 100 .
TMP_DEC3_AMOUNT2 = TMP_VERPR_DEC8 * 100 .

IF TMP_DEC3_AMOUNT1 = TMP_VERPR_DEC8 .
P_PEINH = '1' .
ELSE .
IF TMP_DEC5_AMOUNT1 = TMP_DEC3_AMOUNT2 .
P_PEINH = '100' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 100 .
ELSE .
P_PEINH = '10000' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 10000 .
ENDIF .
ENDIF .

TMP_VERPR = TMP_VERPR_DEC8 .
CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_INTERNAL'
EXPORTING
CURRENCY             = P_WAERS
AMOUNT_EXTERNAL      = TMP_VERPR
MAX_NUMBER_OF_DIGITS = 10
IMPORTING
AMOUNT_INTERNAL      = P_VERPR.
**** START DEL 2014/08/27 ISID･喩 ****
*    IF SY-SUBRC = 0 .
*    ELSE .
*    ENDIF .
**** END DEL 2014/08/27 ISID･喩 ****

** 最終的な金額が小数点５桁のパターン
**                                   CURRDEC=5
ELSEIF S_DECIMALS_OF_CURRENCY-CURRDEC = 5 .
TMP_VERPR_DEC8 = P_VERPR_CH .

TMP_DEC5_AMOUNT1 = TMP_VERPR_DEC8 .
TMP_DEC7_AMOUNT1 = TMP_VERPR_DEC8 * 100 .
TMP_DEC5_AMOUNT2 = TMP_VERPR_DEC8 * 100 .

IF TMP_DEC5_AMOUNT1 = TMP_VERPR_DEC8 .
P_PEINH = '1' .
ELSE .
IF TMP_DEC7_AMOUNT1 = TMP_DEC5_AMOUNT2 .
P_PEINH = '100' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 100 .
ELSE .
P_PEINH = '10000' .
TMP_VERPR_DEC8 = TMP_VERPR_DEC8 * 10000 .
ENDIF .
ENDIF .

TMP_VERPR = TMP_VERPR_DEC8 .
CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_INTERNAL'
EXPORTING
CURRENCY             = P_WAERS
AMOUNT_EXTERNAL      = TMP_VERPR
MAX_NUMBER_OF_DIGITS = 10
IMPORTING
AMOUNT_INTERNAL      = P_VERPR.
**** START DEL 2014/08/27 ISID･喩 ****
*    IF SY-SUBRC = 0 .
*    ELSE .
*    ENDIF .
**** END DEL 2014/08/27 ISID･喩 ****

ENDIF .

ENDFORM.                    " af1_conv_verpr_char_to_curr
**** START ADD 2014/08/26 ISID･喩 ****
*&---------------------------------------------------------------------*
*&      Form  CHK_BUKRS
*&---------------------------------------------------------------------*
*       会社コードの関連チェック
*----------------------------------------------------------------------*
FORM CHK_BUKRS .
DATA: LW_BUKRS   TYPE BUKRS,
LW_VKORG   TYPE VKORG,
LW_EKORG   TYPE EKORG,
LW_WERKS   TYPE WERKS,
LW_LAND1   TYPE LAND1,
LW_KALSM   TYPE KALSM_D.

* 会社コードの存在チェック
SELECT SINGLE BUKRS
LAND1
INTO (LW_BUKRS, LW_LAND1)
FROM T001
WHERE BUKRS = /A1F/YMNS0001-BUKRS.

IF SY-SUBRC <> 0.
SET CURSOR FIELD '/A1F/YMNS0001-BUKRS'.
MESSAGE E016(Z3) WITH /A1F/YMNS0001-BUKRS.
ENDIF.

SELECT SINGLE KALSM
INTO LW_KALSM
FROM T005
WHERE LAND1 = LW_LAND1.

/A1F/YMNS0001-KALSM = LW_KALSM.

* 会社コードの権限チェック
AUTHORITY-CHECK OBJECT 'F_BKPF_BUK'
ID 'BUKRS' FIELD /A1F/YMNS0001-BUKRS
ID 'ACTVT' FIELD '03'.

IF SY-SUBRC <> 0.
SET CURSOR FIELD '/A1F/YMNS0001-BUKRS'.
MESSAGE E015(Z3) WITH /A1F/YMNS0001-BUKRS.
ENDIF.

IF /A1F/YMNS0001-WERKS IS NOT INITIAL.
LW_WERKS = /A1F/YMNS0001-WERKS.

*   会社コードとプラントの関連チェック
CALL FUNCTION 'ZEG_ZZ_WERKS_CHK'
EXPORTING
IMPBUKRS           = /A1F/YMNS0001-BUKRS
IMPWERKS           = LW_WERKS
*       IMPRNGWERKS        =
*      IMPORTING
*        EXPWERKS           =
*       EXPTABRET          =
EXCEPTIONS
WERKS_NOT_EXIST    = 1
WERKS_NO_AUTHORITY = 2
WERKS_BUKRS_ERROR  = 3
OTHERS             = 4.
IF SY-SUBRC <> 0.
SET CURSOR FIELD '/A1F/YMNS0001-WERKS'.
MESSAGE ID SY-MSGID TYPE 'E' NUMBER SY-MSGNO
WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.
ENDIF.

* 会社コードと販売組織の関連チェック
IF /A1F/YMNS0001-VKORG IS NOT INITIAL.
SELECT SINGLE VKORG
INTO LW_VKORG
FROM TVKO
WHERE BUKRS = /A1F/YMNS0001-BUKRS
AND VKORG = /A1F/YMNS0001-VKORG.

IF SY-SUBRC <> 0.
SET CURSOR FIELD '/A1F/YMNS0001-BUKRS'.
MESSAGE E077(Z3) WITH /A1F/YMNS0001-BUKRS /A1F/YMNS0001-VKORG.
ENDIF.
ENDIF.

* 会社コードと購買組織の関連チェック
IF /A1F/YMNS0001-EKORG IS NOT INITIAL.
SELECT SINGLE EKORG
INTO LW_EKORG
FROM T024E
WHERE BUKRS = /A1F/YMNS0001-BUKRS
AND EKORG = /A1F/YMNS0001-EKORG.

IF SY-SUBRC <> 0.
SET CURSOR FIELD '/A1F/YMNS0001-BUKRS'.
MESSAGE E078(Z3) WITH /A1F/YMNS0001-BUKRS /A1F/YMNS0001-EKORG.
ENDIF.
ENDIF.
ENDFORM.                    " CHK_BUKRS
**** END ADD 2014/08/26 ISID･喩 ****

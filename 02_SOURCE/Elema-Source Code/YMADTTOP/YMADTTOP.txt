***---------------------------------------------------------------------
** (c) Copyright 1998 OptiSystems Solutions LTD. All Rights Reserved  **
***---------------------------------------------------------------------
*&---------------------------------------------------------------------*
*& Include YMADTTOP                         Report YMADT000            *
*&                                                                     *
*&---------------------------------------------------------------------*
TABLES: YTR_ALERTS, YMA_MAIN_D, YMA_SCREEN, YMA_PRC, YMA_JOB, YMA_TREE,
YMA_INTERV, SPFIS, YMA_LOCK, ICONS, YMA_ALERTS, SM04DIC,
YMA_ST_OPM,YSQ_SQL_EX,YSQ_INT, YSQ_ZP_LIN,YSQ_ZQ_TB2,
YSQ_ZL_LNK,YSQ_SQL_TX, YMA_OT_GP.

PARAMETERS:
CYCLE   LIKE YMA_INTERV-NO_CYCLE,
TOTTIME LIKE YMA_SCREEN-RTSTART DEFAULT SY-UZEIT,
DATUM   LIKE YMA_SCREEN-RDATE   DEFAULT SY-DATUM,
NO_SCREN(4) .
DATA: TB_YMA_INTERV LIKE YMA_INTERV OCCURS   0 WITH HEADER LINE.
DATA G_SELECTED_INSTANCE LIKE  HELP_INFO-FLDVALUE.
RANGES   G_DATE FOR SY-DATUM.

DATA: BEGIN OF TB_YMA_MAIN_D OCCURS 0,
PROCESS_TYPE(10),
USR_WATING     LIKE YMA_SCREEN-PR_WAIT_B,
PRC_EXECUTION  LIKE YMA_SCREEN-PR_EXEC_B,
NUM_OF_PROCESS LIKE YMA_SCREEN-PR_ALL_B.
DATA: END OF TB_YMA_MAIN_D .

DATA: BEGIN OF TB_YMA_LOCK OCCURS 0,
A_TIME_LOC LIKE ICONS-L4,
GUNAME     LIKE YMA_LOCK-GUNAME,
GCLIENT    LIKE YMA_LOCK-GCLIENT,
Y_TIME_LOC LIKE YMA_LOCK-Y_TIME_LOC,
GNAME      LIKE YMA_LOCK-GNAME,
GTARG      LIKE YMA_LOCK-GTARG.
DATA: END OF TB_YMA_LOCK.

DATA: BEGIN OF TB_YSQ_SQL_EX OCCURS 0,
Y_SERVER     LIKE YSQ_SQL_EX-Y_SERVER,
Y_DATE       LIKE YSQ_SQL_EX-Y_DATE,
Y_NO_CYCLE   LIKE YSQ_SQL_EX-Y_NO_CYCLE,
Y_ADDRESS    LIKE YSQ_SQL_EX-Y_ADDRESS,
Y_PROGRAM    LIKE YSQ_SQL_EX-Y_PROGRAM,
Y_WP_NO      LIKE YSQ_SQL_EX-Y_WP_NO,
WP_NO        LIKE YSQ_SQL_EX-WP_NO,
WP_ITYPE     LIKE YSQ_SQL_EX-WP_ITYPE,
WP_TYP       LIKE YSQ_SQL_EX-WP_TYP,
WP_PID       LIKE YSQ_SQL_EX-WP_PID,
WP_ISTATUS   LIKE YSQ_SQL_EX-WP_ISTATUS,
WP_STATUS    LIKE YSQ_SQL_EX-WP_STATUS,
WP_IWAIT     LIKE YSQ_SQL_EX-WP_IWAIT,
WP_WAITING   LIKE YSQ_SQL_EX-WP_WAITING,
WP_SEM       LIKE YSQ_SQL_EX-WP_SEM,
WP_IRESTRT   LIKE YSQ_SQL_EX-WP_IRESTRT,
WP_RESTART   LIKE YSQ_SQL_EX-WP_RESTART,
WP_DUMPS     LIKE YSQ_SQL_EX-WP_DUMPS,
WP_CPU       LIKE YSQ_SQL_EX-WP_CPU,
WP_ELTIME    LIKE YSQ_SQL_EX-WP_ELTIME,
WP_MANDT     LIKE YSQ_SQL_EX-WP_MANDT,
*       wp_bname     like ysq_sql_ex-wp_bname,
WP_BNAME     LIKE YMA_SCREEN-YMA_USERNM,

WP_REPORT    LIKE YSQ_SQL_EX-WP_REPORT,
WP_IACTION   LIKE YSQ_SQL_EX-WP_IACTION,
WP_ACTION    LIKE YSQ_SQL_EX-WP_ACTION,
WP_TABLE     LIKE YSQ_SQL_EX-WP_TABLE,
WP_SERVER    LIKE YSQ_SQL_EX-WP_SERVER,
WP_WAITINF   LIKE YSQ_SQL_EX-WP_WAITINF,
WP_WAITTIM   LIKE YSQ_SQL_EX-WP_WAITTIM,
Y_TIME       LIKE YSQ_SQL_EX-Y_TIME,
Y_TRAN       LIKE YSQ_SQL_EX-Y_TRAN,
Y_SQL_S      LIKE YSQ_SQL_EX-Y_SQL_S,
Y_SQL_E      LIKE YSQ_SQL_EX-Y_SQL_E,
*** lokal
Y_STATUS(10),
*       y_new_status(15),
Y_NEW_STATUS LIKE YMA_SCREEN-YMA_SCRSTA,
*** lokal
Y_COL1_I     LIKE YSQ_SQL_EX-Y_COL1_I,
Y_COL1_D     LIKE YSQ_SQL_EX-Y_COL1_D,
Y_DELTA      LIKE YSQ_SQL_EX-Y_DELTA,
Y_C1_NB      LIKE YSQ_SQL_EX-Y_C1_NB,
Y_C2_LASTC   LIKE YSQ_SQL_EX-Y_C2_LASTC,
Y_C2_LASTD   LIKE YSQ_SQL_EX-Y_C2_LASTD.
DATA: END OF TB_YSQ_SQL_EX.

DATA:  G_MAIN_COUNT TYPE I.
*       tb_ysq_sql_ex like ysq_sql_ex occurs 0 with header line.

CONTROLS: TC_MA_MAIN TYPE TABLEVIEW   USING SCREEN 1,
TC_YMA_LOCK TYPE TABLEVIEW  USING SCREEN 3,
TC_PROC TYPE TABLEVIEW      USING SCREEN 9103,
TC_JOB TYPE TABLEVIEW       USING SCREEN 9104,
TCON1  TYPE TABLEVIEW       USING SCREEN 400,
TC_MA_ST_OPM TYPE TABLEVIEW USING SCREEN 4,
TC_YSQ_SQL_EX TYPE TABLEVIEW USING SCREEN 5.

DATA  G_SERVER LIKE YMA_SCREEN-INST_NAME.
DATA HOST LIKE YMA_SCREEN-HOST.
DATA  G_FCODE(4).
DATA  OKCODE(4).
DATA WA TYPE CXTAB_COLUMN.
DATA : G_FIELD(30) , G_SORT(1).
DATA: G_TAB_INDEX LIKE SY-TABIX.
DATA: G_INMAX TYPE I , G_COUNT TYPE I.
DATA  G_INDICATOR(8).

DATA: BEGIN OF INTERVAL_TBL OCCURS 0,
CHECK(1),
NO_CYCLE LIKE YMA_INTERV-NO_CYCLE,
RDSTOP  LIKE YMA_SCREEN-RDATE,
RTSTOP  LIKE YMA_SCREEN-RTSTOP,
END OF INTERVAL_TBL.
DATA  TEMP_INDEX LIKE SY-LOOPC.

DATA:
BEGIN OF COMMON PART OPTI_GO_PME,
FCODE        LIKE SY-TCODE,          "Needs to be the ok-code field
G_PRD_NM     LIKE YGO_CPROD-YOP_PRD_NM,
G_PRODUCT    LIKE YGO_CPROD-YOP_PRD_FN,
END OF COMMON PART OPTI_GO_PME.

DATA: FLAG_400           TYPE I VALUE 0.
DATA: CHOICE400             TYPE I,
SCREEN400_FLAG        TYPE I.
DATA: CURRENT_INDEX LIKE SY-INDEX,
INDEX         LIKE SY-INDEX.

DATA: BEGIN OF IMSXXLIST OCCURS 10.                     " SERVERS table
INCLUDE STRUCTURE MSXXLIST.
DATA: END OF IMSXXLIST.

DATA  G_FIRST TYPE I.
DATA: ST_CURR_INTERVAL   LIKE YMA_INTERV.
DATA  PREV_AVAILABLE_DATE   LIKE ST_CURR_INTERVAL-RDATE.
DATA  TMP_COUNT TYPE I.

DATA: BEGIN OF ST_OUT_TIME,
RDATE LIKE YMA_SCREEN-RDATE,
STIME LIKE YMA_SCREEN-RTSTART,
RTIME LIKE YMA_SCREEN-RTSTOP,
END OF ST_OUT_TIME.

DATA: BEGIN OF PAGE_BUTTONS OCCURS 0,
FCODE(4),
END OF PAGE_BUTTONS .

DATA: BEGIN OF BUTTONS OCCURS 0,
FCODE(4),
END OF BUTTONS .

DATA: BEGIN OF TB_YMA_ALERTS OCCURS 0,
ALR_STATUS LIKE YMA_ALERTS-ALR_STATUS,
USNAME     LIKE YMA_ALERTS-TEXT1,
TABNAME    LIKE YMA_ALERTS-TEXT2,
*       lock_time  like yma_alerts-yop_qt_yel,
LOCK_TIME  LIKE YMA_ALERTS-YOP_QT_VAL,
END OF TB_YMA_ALERTS.
DATA  G_CHECK_FLAG TYPE I.  " Check if not exist first push of button
" and work with cycle. For 'NEXI' and 'PREV'

DATA: G_SELNAME(30).       " name of aspect gettting after dblclck
DATA  G_TABLENAME LIKE TB_YMA_LOCK-GNAME.
DATA  BDC_TAB LIKE BDCDATA OCCURS 20 WITH HEADER LINE.
DATA  TCODE   LIKE SM04DIC-TCODE1.
DATA  G_USERNAME LIKE YMA_LOCK-GUNAME.
DATA  G_COLLECTOR_SBK LIKE G_USERNAME.
DATA: BEGIN OF TB_MYLISTV OCCURS 5,
LABEL(5) ,
BLOCKS TYPE I,
VALUE(8) TYPE P  DECIMALS 4,
PERCENT(10) TYPE P DECIMALS 1,
COLOR TYPE I,
*        no_cycle like ytr_work-no_cycle,
NO_CYCLE LIKE YMA_INTERV-NO_CYCLE,
RDATE LIKE SY-DATUM,
END OF TB_MYLISTV.
DATA  G_SY_UCOMM  LIKE SY-UCOMM.
***********************************************************************
DATA WIDTH TYPE I.
DATA: LENGTH TYPE I VALUE 39.         " Length of list
DATA  GETCOLOR TYPE I.
DATA: COLCOUNT TYPE I.                " Counter for horizontal
DATA G_PROG(8) VALUE 'YMADT000'.            " for program name parame
DATA  RETURN  LIKE SY-LILLI.          " bar position for function
DATA  G_CUTNAME(10).
DATA  G_ASPECT_SIGN(1).                   " signature of analys aspect
DATA  G_TABNAME(10).                   " var. of table names
DATA  G_ARGUMENT LIKE YMA_LOCK-GTARG.
DATA  G_TAB LIKE YMA_LOCK-GNAME.
DATA  G_TECHNICL_CMNTDATA(16)  .
DATA  G_CONV_FLAG  TYPE I.
DATA  G_CONVERT TYPE P DECIMALS 3.
DATA : BEGIN OF  G_NO_CYCLE OCCURS 10,
SIGN(1),
OPTION(2),
LOW LIKE YTR_WORK-NO_CYCLE,
HIGH LIKE YTR_WORK-NO_CYCLE,
END OF  G_NO_CYCLE.

DATA  TB_DAY_LIST LIKE TB_MYLISTV OCCURS 10 WITH HEADER LINE.
DATA  G_HIGH_CYCLE LIKE YMA_INTERV-NO_CYCLE.
DATA  G_LOWER_CYCLE LIKE YMA_INTERV-NO_CYCLE.
DATA  G_TECHNICL_CMNT(16).
DATA  G_MAXX(10) TYPE N.             " max index for  intabs
DATA  G_SCALE(8) TYPE N.             "dyn.value for histogram scale
DATA  G_LABEL(7) TYPE P.             "label for time dysplayng in histog

DATA: BEGIN OF TB_SHOW,                " display histogramm bars
BAR(5) TYPE C,
END   OF TB_SHOW  .
* screen 9103 - processes
DATA: TB_YMA_PRC LIKE YMA_PRC OCCURS 0 WITH HEADER LINE.
DATA: BEGIN OF TB_PROC OCCURS 0,
ALERT LIKE ICONS-L4,
TCODE LIKE YMA_PRC-TCODE,
USER LIKE YMA_PRC-WP_BNAME,
CLIENT LIKE YMA_PRC-WP_MANDT,
PROGRAM LIKE YMA_PRC-WP_REPORT,
PID LIKE YMA_PRC-WP_PID,
CPU LIKE YMA_PRC-WP_CPU,
TIME LIKE YMA_PRC-WP_ELTIME,
ALERT_DESCR LIKE YMA_TREE-YMA_DESC_S,
WP_NO LIKE YMA_PRC-WP_NO,
INSTANCE LIKE YMA_PRC-APSERVER,
AD_INDX LIKE YMA_PRC-AD_INDX.
DATA: END OF TB_PROC.
* screen 9104 - jobs
DATA: BEGIN OF TB_JOB OCCURS 0,
USER LIKE TBTCO-RELUNAME,
JOBNAME LIKE YMA_JOB-JOBNAME,
JOBNNO LIKE YMA_JOB-JOBCOUNT,
DESCRIPTION LIKE YMA_JOB-Y_RESULT.
DATA: END OF TB_JOB.
DATA: BEGIN OF TB_BUTTONS OCCURS 0,
FCODE(4),
END OF TB_BUTTONS .
DATA TB_INTERV LIKE YMA_INTERV OCCURS 0 WITH HEADER LINE.
* screen 9103 - detail info
DATA: LOC_WPINFO LIKE WPINFO,
WPINFO LIKE WPINFO,
PFNORM LIKE PFNORM.
DATA: BEGIN OF WP_TABL OCCURS 0.
INCLUDE STRUCTURE WPINFO.
DATA: END OF WP_TABL.
*==============================================================
*
*
DATA  G_SELFIELD(30).       " name of aspect gettting af
DATA: TB_YMA_MAIN_D_HIST LIKE YMA_MAIN_D OCCURS 0 WITH HEADER LINE,
G_TOP_LINE LIKE SY-INDEX.
DATA  G_HEADER(50).
*data  tb_yma_st_opm like yma_st_opm occurs 0 with header line.
DATA: BEGIN OF TB_YMA_ST_OPM OCCURS 0,
Y_TTYPE(30),
Y_PREV_VAL     LIKE YMA_ST_OPM-Y_NODIA_C,
Y_CURR_VAL     LIKE YMA_ST_OPM-Y_NODIA_C,
Y_DESCR        LIKE YMA_ST_OPM-Y_DESCR.
DATA: END OF TB_YMA_ST_OPM .

DATA: BEGIN OF TB_ALERTS_CYCLE OCCURS 0,
YOP_MSNAME LIKE YMA_ALERTS-YOP_MSNAME,
YMA_LVL    LIKE YMA_ALERTS-YMA_LVL,
RDATE      LIKE YMA_ALERTS-RDATE,
NO_CYCLE   LIKE YMA_ALERTS-NO_CYCLE,
YOP_QT_VAL LIKE YMA_ALERTS-YOP_QT_VAL,
TEXT1      LIKE YMA_ALERTS-TEXT1,
TEXT2      LIKE YMA_ALERTS-TEXT2,
TEXT3      LIKE YMA_ALERTS-TEXT3,
Y_CYCLE_NB LIKE YSQ_INT-Y_CYCLE_NB.
DATA: END OF TB_ALERTS_CYCLE.

DATA:  TB_YMA_MAIN_D_SUM LIKE YMA_MAIN_D OCCURS 0 WITH HEADER LINE ,
TB_YMA_SQL_ALERTS LIKE YMA_ALERTS OCCURS 0 WITH HEADER LINE,
TB_YSQ_SQL_EX_ALL LIKE YSQ_SQL_EX OCCURS 0 WITH HEADER LINE.

DATA  G_ENDTIME LIKE YMA_MAIN_D-RTIME.
DATA  G_ALL_INSTANCE.                         " Flag for all instance
DATA  G_NOT_FIRST_ENTRIES(3).                 " Flag for second entries
DATA:  GENERAL_ZP_LIN LIKE YSQ_ZP_LIN.
DATA:  TB_YSQ_ZP_LIN LIKE YSQ_ZP_LIN OCCURS 0 WITH HEADER LINE,
TB_YSQ_ZL_LNK LIKE YSQ_ZL_LNK OCCURS 0 WITH HEADER LINE.
DATA  STR_YSQ_SQL_EX LIKE YSQ_SQL_EX.
DATA  G_ANSWER.
DATA  G_SCR_FLAG TYPE I.
DATA  STRUCT_YSQ_SQL_EX LIKE YSQ_SQL_EX.
DATA: BEGIN OF TAB OCCURS 8,
FCODE(4),
END OF TAB.

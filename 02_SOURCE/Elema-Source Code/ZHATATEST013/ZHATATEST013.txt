Report ZHATATEST013 .

Tables : BSIK ,
BSAK ,
BKPF ,
BSEG .

Types : Begin Of TYP_HEAD ,
BUKRS Type BKPF-BUKRS ,
BELNR Type BKPF-BELNR ,
GJAHR Type BKPF-GJAHR ,
BLART Type BKPF-BLART ,
End Of TYP_HEAD ,
Begin Of TYP_DET ,
BUKRS Type BKPF-BUKRS ,
BELNR Type BKPF-BELNR ,
GJAHR Type BKPF-GJAHR ,
SHKZG Type BSEG-SHKZG ,
DMBTR Type BSEG-DMBTR ,
End Of TYP_DET .


Data : IT_HEADA Type Table Of TYP_HEAD ,
WK_HEADA Type TYP_HEAD ,
IT_HEADB Type Table Of TYP_HEAD ,
WK_HEADB Type TYP_HEAD ,
IT_DETAILA Type Table Of TYP_DET ,
WK_DETAILA Type TYP_DET ,
IT_DETAILB Type Table Of TYP_DET ,
WK_DETAILB Type TYP_DET ,
WA_DMBTRA Type BSEG-DMBTR ,
WA_DMBTRB Type BSEG-DMBTR ,
WA_DMBTRC Type BSEG-DMBTR .



Parameters : P_BUKRS Type BKPF-BUKRS ,
P_BLARTA Type BKPF-BLART ,
P_BLDATA Type BKPF-BLDAT ,
P_BLARTB Type BKPF-BLART ,
P_BLDATB Type BKPF-BLDAT ,
P_HKONT  Type BSEG-HKONT ,
P_LIFNR  Type BSEG-LIFNR .


Start-Of-Selection .
Perform Get_Header .
Perform Get_Detail .

Form Get_Header .
Select BUKRS
BELNR
GJAHR
BLART
From BKPF
Into Corresponding Fields Of Table IT_HEADA
Where BLART EQ P_BLARTA
And  BLDAT LE P_BLDATA
.

Select BUKRS
BELNR
GJAHR
BLART
From BKPF
Into Corresponding Fields Of Table IT_HEADB
Where BLART EQ P_BLARTB
And  BLDAT LE P_BLDATB
.

EndForm .
*
Form Get_Detail .
Clear : WA_DMBTRA ,
WA_DMBTRB ,
WA_DMBTRC .
Loop At IT_HEADA Into WK_HEADA .
Select BUKRS
BELNR
GJAHR
SHKZG
DMBTR
Into Corresponding Fields Of WK_DETAILA
From BSEG
Where BUKRS EQ WK_HEADA-BUKRS
And  BELNR EQ WK_HEADA-BELNR
And  GJAHR EQ WK_HEADA-GJAHR
And  HKONT EQ P_HKONT
And  LIFNR EQ P_LIFNR
.
Case WK_DETAILA-SHKZG .
When 'S' .
WA_DMBTRA = WA_DMBTRA + WK_DETAILA-DMBTR .
When 'H' .
WA_DMBTRA = WA_DMBTRA - WK_DETAILA-DMBTR .
EndCase .
Clear WK_DETAILA .

EndSelect .
Clear : WK_HEADA .
EndLoop .
Loop At IT_HEADB Into WK_HEADB .
Select BUKRS
BELNR
GJAHR
SHKZG
DMBTR
Into Corresponding Fields Of WK_DETAILB
From BSEG
Where BUKRS EQ WK_HEADB-BUKRS
And  BELNR EQ WK_HEADB-BELNR
And  GJAHR EQ WK_HEADB-GJAHR
And  HKONT EQ P_HKONT
And  LIFNR EQ P_LIFNR
.
Case WK_DETAILB-SHKZG .
When 'S' .
WA_DMBTRB = WA_DMBTRB + WK_DETAILB-DMBTR .
When 'H' .
WA_DMBTRB = WA_DMBTRB - WK_DETAILB-DMBTR .
EndCase .
Clear WK_DETAILB .

EndSelect .
Clear : WK_HEADB .
EndLoop .
WA_DMBTRC = WA_DMBTRA + WA_DMBTRB .
Write : / P_LIFNR ,
/ WA_DMBTRC Currency 'JPY' ,
/ WA_DMBTRA Currency 'JPY' ,
/ WA_DMBTRB Currency 'JPY' .
EndForm .

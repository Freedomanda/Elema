*&---------------------------------------------------------------------*
*& Include YMATRTOP                         Report YMATR000            *
*&                                                                     *
*&---------------------------------------------------------------------*

REPORT   YMATRTOP   MESSAGE-ID Y! NO STANDARD PAGE HEADING.
TABLES: YMA_TREE_U ,  YMA_TREE_J, YMA_OT_USR , RSSTCD, DD07L, USR02,

YMA_SCREEN.

TABLES: YMA_OT_GP.
PARAMETERS : P_TYPE TYPE I DEFAULT 1.

DATA: BEGIN OF TB_NODES OCCURS 100.
INCLUDE STRUCTURE SNODETEXT.
DATA: END OF TB_NODES.

DATA :  G_1_COLOR TYPE I VALUE 1,
G_2_COLOR TYPE I VALUE 2,
G_3_COLOR TYPE I VALUE 3,
G_4_COLOR TYPE I VALUE 4,
G_N1_COLOR TYPE I VALUE 1,
G_N2_COLOR TYPE I VALUE 2,
G_N3_COLOR TYPE I VALUE 3,
G_N4_COLOR TYPE I VALUE 4.
*DATA  TB_TREE LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA: BEGIN OF TB_TREE OCCURS 1.
INCLUDE STRUCTURE YMA_TREE_U.
DATA     YMA_DESC_S LIKE YMA_TREE-YMA_DESC_S.
DATA  END   OF TB_TREE.
DATA: G_APP_NAME LIKE YMA_TREE_U-YOP_MSNAME
, G_CHANGE_SCREEN TYPE I ,IO_NEW_ID LIKE SNODE-ID , G_TRANFL TYPE I.

DATA: BEGIN OF TB_INST_NAME OCCURS 2,
YOP_MSNAME LIKE YMA_TREE_U-YOP_MSNAME,
IS_ACTIVE(10).
DATA END OF TB_INST_NAME.
************************************************************************
DATA: USERNM LIKE TB_TREE-YMA_USERNM,
G_LINE TYPE I,  G_PASS_NODE LIKE TB_NODES, TR_NAME LIKE
YMA_SCREEN-Y_TRANS,
US_NAME LIKE YTR_SCREEN-USER_ID, NODES LIKE  STREEATTR,
NEW_ID LIKE SNODE-ID.
DATA  G_TEXT6 LIKE TB_NODES-TEXT6.   "USR02-BNAME
DATA  TB_TREE_LKL LIKE TB_TREE OCCURS 1 WITH HEADER LINE.
DATA  FL_EXIST TYPE I.
DATA  OLD_USERNM LIKE TB_TREE-YMA_USERNM.
DATA  TCODE LIKE TB_TREE-YMA_TCODE .
DATA: Y_THRESHOLD LIKE  YMA_SCREEN-Y_THRESHLD,
R_THRESHOLD LIKE  YMA_SCREEN-R_THRESHLD,
PRIORITY LIKE  YMA_SCREEN-Y_PRIORITY.
DATA  TB_TREE_JOB LIKE   YMA_TREE_J OCCURS 1 WITH HEADER LINE.
DATA  IS_FIRST .
DATA  TB_JOB_TREE LIKE YMA_TREE_J OCCURS 1 WITH HEADER LINE.
TABLES  YMA_OP_MOD.
DATA: LIST  LIKE MSXXLIST OCCURS 5 WITH HEADER LINE,
G_MIN ,                             "KE YMA_OP_MOD. "A_MIN.
G_MAX  LIKE YMA_SCREEN-YMA_OP_MOD, G_NODE LIKE SEUCOMM,
OP_MOD LIKE YMA_OP_MOD OCCURS 5 WITH HEADER LINE,
G_ML_CANC LIKE YMA_SCREEN-MAIL_CANCL,G_ALL_SERV_IND TYPE I,
MODIFY_YMA_TREE_U LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
TABLES  YMA_TREE.
DATA:  OK_CODE LIKE SY-TCODE, GROUP_NAME LIKE USR02-CLASS.
DATA  G_EVENT(4) VALUE 'USER'.
DATA  USER_RATIO(8) VALUE 'Group'.
DATA:  FL_TR TYPE I, G_DESCRIPTION LIKE TB_TREE.
DATA  G_FIELDS_EMPTY TYPE I.
TABLES:  YMA_TR_OP , YMA_TR_JOB , YMA_TR_JOP , YMA_LOC_TR,
YMA_TR_LOC , YMA_SQL_TR , YMA_TR_SQL.
DATA  G_INT_TO_TEXT(10) TYPE N .
DATA  G_FIRST_OP_NOD TYPE I.
DATA: OLD_SERVER LIKE LIST-NAME VALUE 'X',G_JOP_VAL LIKE
YMA_TR_JOP-YOP_QT_VAL, G_JOP_PRT LIKE YMA_TR_JOP-YOP_QT_PRT,
"YMA_TR_JOP-YOP_QT_PRT,
OLD_PROC LIKE YMA_OP_MOD-YMA_PROCES, G_JOB_USERNM LIKE
YMA_TR_JOP-YMA_USERNM ,G_JOB_PARAME LIKE YMA_TR_JOP-YMA_PARAME.
DATA  TB_TR_JOP LIKE YMA_TR_JOP OCCURS 1 WITH HEADER LINE.
DATA: FIELDS_CHANGED TYPE I,
IN_NODES LIKE TB_NODES OCCURS 4 WITH HEADER LINE.
DATA  MODIFY_YMA_TREE_Y LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA  PASS_NODES LIKE TB_NODES-TEXT6 OCCURS 1 WITH HEADER LINE.
DATA  G_NODE_NEW TYPE I.
DATA  G_TOGLE_SET.
DATA: CUR_INTERV LIKE YMA_SCREEN-YMA_INT4_4,
INTERVAL_FIELD LIKE YMA_SCREEN-YMA_INT4_3,
TIME_FIELD LIKE YMA_SCREEN-YMA_INT4_1.
DATA  DEF1(4).
DATA  DEF2(4).
DATA  G_EDIT TYPE I.
DATA  TB_YMA_OT_GP LIKE YMA_OT_GP OCCURS 1 WITH HEADER LINE.
DATA  IND.
DATA: Y_IP_ADDR_FLD LIKE YMA_SCREEN-Y_IP_ADDR,
Y_PORT_FLD LIKE YMA_SCREEN-Y_PORT_FLD,
Y_STATUS_FLD LIKE YMA_SCREEN-Y_STATUS_F.
DATA  TB_YMA_OT_GP2 LIKE YMA_OT_GP OCCURS 1 WITH HEADER LINE.
DATA  LAST_USER        LIKE YMA_OT_USR OCCURS 10 WITH HEADER LINE.
DATA  USR_NAME         LIKE YMA_SCREEN-USR_NAME.
DATA:  USER_LIST ,  DISTR_LIST ,   NONE ,  FLAG1.
DATA FCODE        LIKE SY-TCODE.     "Needed to be the ok-code field
DATA  OKCODE LIKE FCODE.
DATA G_LOCK_FLAG VALUE 'T'.
DATA: BEGIN OF TAB OCCURS 10,
G_FCODE(4),
END OF TAB.
DATA  TB_AUX_NODES LIKE TB_NODES OCCURS 2 WITH HEADER LINE.
DATA  TB_AUX_APP LIKE TB_NODES OCCURS 2 WITH HEADER LINE.
DATA  TEXT6 LIKE TB_NODES-TEXT6 .
DATA  TB_PASS_INST LIKE TB_INST_NAME OCCURS 1 WITH HEADER LINE.
DATA:  APSERVER LIKE  TB_PASS_INST-YOP_MSNAME,
ID LIKE TB_NODES-ID.
DATA  YMA_ADD_APPSERVERS LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA  ASP_NAME LIKE TB_TREE-YMA_PARAME.
DATA  TB_MODIFY_YMA_TREE LIKE YMA_TREE OCCURS 1 WITH HEADER LINE.
DATA:  TB_MODIFY_LOCK_TR LIKE YMA_LOC_TR OCCURS 1 WITH HEADER LINE,
TB_MODIFY_YMA_LOC_TR LIKE YMA_LOC_TR OCCURS 1 WITH HEADER LINE.
DATA  APSERV(20).
DATA GR_USER LIKE NODES-TEXT1.
DATA G_U_NAME LIKE NODES-TEXT .
DATA  RELAT(5).
DATA:  YMA_ADD_YMA_TR_JOP LIKE YMA_TR_JOP OCCURS 1 WITH HEADER LINE,
TB_MODIFY_YMA_TREE_J LIKE YMA_TREE_J OCCURS 1 WITH HEADER LINE,
TB_MODIFY_YMA_OP_MOD LIKE YMA_OP_MOD OCCURS 1 WITH HEADER LINE,
TB_MODIFY_YMA_SQL_TR LIKE YMA_SQL_TR OCCURS 1 WITH HEADER LINE,
TB_DEL_YMA_TREE_U LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA  GR_EXIST TYPE I.
DATA:F15 , G_ETE.
DATA:  PRTY LIKE YMA_TREE_J-YMA_PRT_JB,X LIKE TB_NODES-ID.
DATA  YMA_DEL_JBS LIKE YMA_TR_JOP OCCURS 1 WITH HEADER LINE.
DATA: G_USER_IN_GROUP TYPE I , G_GROUP_CONTAIN_USER TYPE I , G_IN_EXC.
DATA: G_ANSWER , G_ANS.
DATA:  YMA_JB_CHANGE_INCLUDE LIKE YMA_TR_JOP OCCURS 5 WITH HEADER LINE,
G_FLAG_EXCLUDE TYPE I.
DATA  TB_DEL_USER_RLP_LOOP LIKE YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA  TB_EXCLUDE_YMA_TREE_U LIKE YMA_TREE_U OCCURS 2 WITH HEADER LINE.
DATA: TB_INCLUDE_YMA_TREE_U LIKE YMA_TREE_U OCCURS 2 WITH HEADER LINE,
TB_YMA_TREE_U_COPY LIKE YMA_TREE_U OCCURS 2 WITH HEADER LINE.
DATA  TB_DEL_YMA_LOC_TR LIKE YMA_LOC_TR OCCURS 2 WITH HEADER LINE.
DATA: YMA_LOCK_CHANGE_INCLUDE LIKE YMA_LOC_TR OCCURS 2 WITH HEADER LINE,
TB_EXCLUDE_YMA_LOC_TR LIKE YMA_LOC_TR OCCURS 2 WITH HEADER LINE.
DATA  G_ALL_CHANGED TYPE I VALUE 0.
DATA  G_CHANGED TYPE I VALUE 0.
DATA  G_ANSWR.
DATA  G_RETURN TYPE I.
DATA  TB_EXPAND_LIST LIKE SNODETEXT OCCURS 1 WITH HEADER LINE.
DATA TB_D_NODES LIKE TB_NODES OCCURS 1 WITH HEADER LINE.
DATA  G_IS_FIRST.
DATA  G_RLP_NEW.
DATA  G_ON_TRANSACTION TYPE I.
DATA  YMA_TR_JOP_DELETE LIKE YMA_TR_JOP OCCURS 1 WITH HEADER LINE.
DATA  TB_DEL_YMA_TREE_U1 LIKE  YMA_TREE_U OCCURS 1 WITH HEADER LINE.
DATA  G_YMA_JOB LIKE YMA_TREE_J-YMA_JOB.
DATA  TB_ADD_YMA_TREE_J LIKE  YMA_TREE_J OCCURS 1 WITH HEADER LINE.
DATA  TB_YMA_TREE_J_DEL LIKE  YMA_TREE_J OCCURS 1 WITH HEADER LINE.
DATA  G_USER_GROUP_ERROR TYPE I.
DATA  IS_APPENDED TYPE I.
DATA  LOCK_TEXT(28).
DATA  IS_FRST.
DATA  FL_EX TYPE I.
DATA  DBL_MODIFY_YMA_TREE_U LIKE MODIFY_YMA_TREE_U OCCURS 1 WITH HEADER
LINE.
DATA  LKL TYPE I.
*DATA Y_PROGRAM LIKE YMA_TREE_U-YMA_TCODE.
DATA  Y_APPSERV LIKE YMA_TREE_U-YOP_MSNAME.
DATA  SET_ERROR TYPE I.
DATA  SET_ERROR1 TYPE I.
DATA  FL_DL_NOT_VALID TYPE I.
DATA  G_SQL_ERROR TYPE I.
TABLES:  TRDIR.
DATA  G_CHANGE TYPE I.
DATA TB_AD_YMA_SQL_TR LIKE YMA_SQL_TR OCCURS 5 WITH HEADER LINE.
* YMA_SQL_TR
DATA: BEGIN OF TB_EXCL_YMA_SQL_TR OCCURS 5,
Y_MSNAME  LIKE YMA_SQL_TR-Y_MSNAME,
Y_USER    LIKE YMA_SQL_TR-Y_USER,
Y_TCODE   LIKE YMA_SQL_TR-Y_TCODE,
Y_PROGRAM LIKE YMA_SQL_TR-Y_PROGRAM,
Y_PARAME  LIKE YMA_SQL_TR-Y_PARAME,
END   OF TB_EXCL_YMA_SQL_TR.

DATA: BEGIN OF TB_DEL_YMA_SQL_TR  OCCURS 5.
INCLUDE  STRUCTURE TB_EXCL_YMA_SQL_TR.
DATA:  CASE(4),
END   OF TB_DEL_YMA_SQL_TR.
DATA  G_SQL_PRM_ERROR TYPE I.
DATA  DEFAULT TYPE I.
DATA  APP_FLAG TYPE I.
DATA  TR_RATIO(6) VALUE 'Job'.
*DATA  JOB_NAME LIKE YMA_TREE_U-YMA_TCODE.
DATA  G_BUTTON_LOCD TYPE I .
DATA  G_PROCESS_TYPE(20).
DATA  G_COMP TYPE I.
DATA  IS_DELITE .
DATA AUTH_VAL LIKE SY-SUBRC.  " Flag for Authority check back value.
DATA OPERATION LIKE YGO_CPROD-YOP_PRD_PS.
DATA  G_W LIKE YGO_CPROD-YOP_DESC VALUE 'PATROL for mySAP.com'.

* begin of insert by Sagit.S
DATA: TMPFIELD(30) TYPE C.
DATA: I_USER LIKE USR02 OCCURS 0 WITH HEADER LINE.

AT USER-COMMAND.
CASE SY-UCOMM.
WHEN 'CLOS'.
SET SCREEN 0.
LEAVE SCREEN.
WHEN 'SELE'.
US_NAME = I_USER-BNAME.
SET SCREEN 0.
LEAVE SCREEN.
WHEN 'SORA'.
GET CURSOR FIELD TMPFIELD.
CASE TMPFIELD.
WHEN 'I_USER-MANDT'.
SORT I_USER BY MANDT BNAME.
WHEN 'I_USER-BNAME'.
SORT I_USER BY BNAME MANDT.
WHEN 'I_USER-USTYP'.
SORT I_USER BY USTYP MANDT BNAME.
WHEN 'I_USER-ERDAT'.
SORT I_USER BY ERDAT MANDT BNAME.
ENDCASE.
*        set screen 0.
CALL SCREEN 9100 STARTING AT 10 2 ENDING AT 56 12.
SET SCREEN 0.
LEAVE SCREEN.
ENDCASE.
* end  of insert by Sagit.S

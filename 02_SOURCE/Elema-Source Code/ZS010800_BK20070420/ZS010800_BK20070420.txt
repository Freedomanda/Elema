************************************************************************
* [ÉvÉçÉOÉâÉÄñº]
*   ZS010800    éÛíçécÉäÉXÉgçÏê¨
*
* [èàóùäTóv]
*   î≠íçèÓïÒÇÃîcà¨ÇÃÇΩÇﬂÅAëIëâÊñ Ç≈éwíËÇ≥ÇÍÇΩâ∫ãLÇÃí†ï[ÇèoóÕÇ∑ÇÈÅB
*     á@éÛíçécàÍóóï\
*       âcã∆èä/âcã∆ÉOÉãÅ[Év(âcã∆àı)/ìæà”êÊÉåÉxÉãÇÃí†ï[ÇèoóÕ
*       Å®ìæà”êÊçáåv•âcã∆ÉOÉãÅ[Évçáåv(âcã∆àı)/âcã∆èäçáåvÇèoóÕ
*     áAëSé–
*       âcã∆èäÉåÉxÉãÇÃí†ï[èoóÕ
*     áBâcã∆èä
*       âcã∆èä/âcã∆ÉOÉãÅ[ÉvÉåÉxÉãÇÃí†ï[èoóÕ
*
* [â¸íËóöó]
*Å@YYYY/MM/DD   Programar         Description
*  2001/12/07   PSD K.igarashi        êVãKäJî≠
*  2001/12/14   PSD k.igarashi        édólïœçXëŒâû
*  2002/01/09   PSD k.igarashi        ì‡ïîÉeÅ[ÉuÉãÉ^ÉCÉvèCê≥
*  2002/01/09   PSD k.igarashi        ÉfÅ[É^ç\ë¢í«â¡
*  2002/01/10   PSD k.igarashi        ABAPÉäÉXÉgÉrÉÖÅ[ÉAédólïœçXëŒâû
*  2002/01/17   PSD k.igarashi        èâä˙âªèàóùí«â¡
*  2002/01/23   PSD k.igarashi        édólïœçXëŒâû
*  2002/01/25   PSD k.igarashi        édólïœçXëŒâû
*  2002/01/30   PSD k.igarashi        édólïœçXëŒâû
*  2002/02/01   PSD k.igarashi        édólïœçXëŒâû
*  2002/03/18   PSD M.Arai            âcã∆àıéÊìæÉGÉâÅ[çÌèú
*  2002/03/19   PSD T.SAITOH          ALVÉXÉeÅ[É^ÉXàÛç¸ãëî€ê›íË
*  2002/05/20   PSD K.ARAI            éÛíçécï™êÕèÓïÒíäèoèåèïœçX
*  2002/05/24   PSD K.ARAI            âcã∆èäëIëéûÇÃ
*                                     éÛíçécã‡äzéZèoï˚ñ@èCê≥
*  2002/05/24   PSD K.ARAI            ì`ï[É^ÉCÉvçló∂
*  2002/06/06   PSD T.SAITOH          ì˙ïtÉfÉtÉHÉãÉgîpé~ÅAëSåèOKÅI
*  2002/06/20   PSD T.SAITOH          çƒà⁄ëó
*  2002/08/08   ÉJÉbÉgÉIÅ[ÉoÅ[ ---------------------------------------*
*  2002/08/08   PSD T.SAITOH          ÉyÅ[ÉWî‘çÜïtâ¡
*  2002/08/14   PSD T.SAITOH          âcã∆àıÉRÅ[ÉhÇ≈éwíËäOÇëŒè€äO
*                             ÇΩÇæÇµÅAèåèÇÕâ∫ãLÇÃí ÇËÇ∆Ç∑ÇÈ
*                             a:âcã∆àıÉ{É^ÉìÇâüâ∫
*                             b:âcã∆àıÉRÅ[ÉhÇéwíË
*                             c:âcã∆àıñºë∂ç›óLÇË
*                             ab (not r) ÇÃéûëŒè€äOÉåÉRÅ[ÉhÇ∆Ç»ÇÈ
*  2002/08/30   PSD T.SAITOH          éÛíçécã‡äzçÄñ⁄í«â¡ÅyÇQí†ï[Åz
*                                     éÛíçécã‡äzåvéZéÆïœçXÅyÇPí†ï[Åz
*  2002/09/12   PSD T.SAITOH          äÛñ]î[ä˙ÅAìæà”êÊâÒìöî[ä˙ÅAéÛíçì˙ÇÃ
*                                     ÉtÉãåÖëŒâû
*  2003/09/01   DMC R.Hata            å¥âøåvéZÉçÉWÉbÉNèCê≥
************************************************************************
REPORT  ZS010800.

************************************************************************
* TYPES
************************************************************************
TYPE-POOLS SLIS.

* á@âcã∆èäì‡ïîÇsÇaÇkå^
TYPES: BEGIN OF TYP_EIGYOUSHO,
VKBUR TYPE TVKBT-VKBUR,                          "âcã∆èäÉRÅ[Éh
BEZEI TYPE TVKBT-BEZEI,                              "ÉeÉLÉXÉg
END OF TYP_EIGYOUSHO.

* áAâcã∆ÉOÉãÅ[Évì‡ïîÇsÇaÇkå^
TYPES: BEGIN OF TYP_EIGYOUGRP,
VKGRP TYPE TVGRT-VKGRP,                          "âcã∆ÉOÉãÅ[Év
BEZEI TYPE TVGRT-BEZEI,                              "ÉeÉLÉXÉg
END OF TYP_EIGYOUGRP.

* áBå¬êlèÓïÒì‡ïîÇsÇaÇkå^
TYPES: BEGIN OF TYP_KOJIN_INFO,
PERNR TYPE PA0002-PERNR,                           "è]ã∆àıî‘çÜ
NACHN TYPE PA0002-NACHN,                                   "ê©
END OF TYP_KOJIN_INFO.

* áDï™êÕ(éÛíçéc)ì‡ïîÇsÇaÇkå^
TYPES: BEGIN OF TYP_BUNSEKI_A,
VBELN    TYPE YS0011-VBELN,                      "îÃîÑì`ï[î‘çÜ
POSNR    TYPE YS0011-POSNR,                      "îÃîÑì`ï[ñæç◊
JUCHU    TYPE YS0011-JUCHU,                          "éÛíçêîó 
SEIKYU   TYPE YS0011-SEIKYU,                       "îÑè„çœêîó 
PICKUP   TYPE YS0011-PICKUP,                       "à¯ìñçœêîó 
MSHUKKO  TYPE YS0011-MSHUKKO,                      "èoâ◊çœêîó 
KINGAKU1 TYPE YS0011-KINGAKU1,                       "éÛíçã‡äz
KUNNR    TYPE YS0011-KUNNR,                      "ìæà”êÊÉRÅ[Éh
* Add 2004/07/02 --->
KUNWE    TYPE YS0011-KUNWE,                      "èoâ◊êÊÉRÅ[Éh
NAME1_W  TYPE YS0011-NAME1_W ,                   "èoâ◊êÊñº
* Add 2004/07/02 <---
NOUKI    TYPE YS0011-NOUKI,                      "ï™î[ì˙íˆì˙ït
BSTNK    TYPE YS0011-BSTNK,                    "ìæà”êÊî≠íçî‘çÜ
MAKTX    TYPE YS0011-MAKTX,                      "ïiñ⁄ÉeÉLÉXÉg
KINGAKU5 TYPE YS0011-KINGAKU5,                     "îÑè„çœã‡äz
VKBUR    TYPE YS0011-VKBUR,                            "âcã∆èä
VKGRP    TYPE YS0011-VKGRP,                      "âcã∆ÉOÉãÅ[Év
* 2002/02/01  PSD k.igarashi  ADD Å´
BACKODR  TYPE YS0011-BACKODR,                      "ñ¢à¯ìñêîó 
* 2002/02/01  PSD k.igarashi  ADD Å™
*---APPEND START PSD T.SAITOH 2002/08/30 ---------------------------*
WAERK    TYPE YS0011-WAERK,                        "í â›ÉRÅ[Éh
KINGAKU2 TYPE YS0011-KINGAKU2,                     "à¯ìñçœã‡äz
KINGAKU3 TYPE YS0011-KINGAKU3,                     "ñ¢à¯ìñã‡äz
KINGAKU4 TYPE YS0011-KINGAKU4,                     "èoâ◊çœã‡äz
KINGAKU6 TYPE YS0011-KINGAKU6,                     "èoå…çœã‡äz
AUART    TYPE YS0011-AUART,                        "ì`ï[É^ÉCÉv
*---APPEND END   PSD T.SAITOH 2002/08/30 ---------------------------*
* Add 2006.06.16--->
YUSOUTOU TYPE YS0011-YUSOUTOU ,
* Add 2006.06.16<---


END OF TYP_BUNSEKI_A.

* áEï™êÕ(ëSé–•âcã∆èä)ÇsÇaÇkå^
TYPES: BEGIN OF TYP_BUNSEKI_B,
VBELN    TYPE YS0011-VBELN,                      "îÃîÑì`ï[î‘çÜ
POSNR    TYPE YS0011-POSNR,                      "îÃîÑñæç◊î‘çÜ
KINGAKU1 TYPE YS0011-KINGAKU1,                       "éÛíçã‡äz
KINGAKU5 TYPE YS0011-KINGAKU5,                     "îÑè„çœã‡äz
VKBUR    TYPE YS0011-VKBUR,                            "âcã∆èä
VKGRP    TYPE YS0011-VKGRP,                      "âcã∆ÉOÉãÅ[Év
WAERK    TYPE YS0011-WAERK,                              "í â›
STCUR    TYPE VBAP-STCUR,                    "ìùåvópä∑éZÉåÅ[Ég
EDATU    TYPE VBEP-EDATU,                            "î[ì¸ä˙ì˙
* APPEND PSD K.ARAI 2002/05/24
JUCHU    TYPE YS0011-JUCHU,                         " éÛíçêîó 
SEIKYU   TYPE YS0011-SEIKYU,                      " îÑè„çœêîó 
MSHUKKO  TYPE YS0011-MSHUKKO,                     " èoâ◊çœêîó 
NETPR    TYPE VBAP-NETPR,                           " îÃîÑíPâø
KPEIN    TYPE VBAP-KPEIN,                       " âøäièåèíPà 
AUART    TYPE VBAK-AUART,
* APPEN END
END OF TYP_BUNSEKI_B.

* A) í†ï[èoóÕópèÓïÒéÊìæÇsÇaÇk-Ç`å^
TYPES: BEGIN OF TYP_VBPA_KD,
PERNR   TYPE VBPA-PERNR,                            "è]ã∆àıNo.
ADRNR   TYPE VBPA-ADRNR,                                 "èZèä
BSTDK_E TYPE VBKD-BSTDK_E,             "èoâ◊êÊÇÃìæà”êÊî≠íçî‘çÜ
* 2002/01/30 PSD k.igarashi  ADD  Å´
KURSK   TYPE VBKD-KURSK,            "ä∑éZÉåÅ[ÉgÅ|âøäiê›íË/ìùåv
* 2002/01/30 PSD k.igarashi  ADD  Å™
END OF TYP_VBPA_KD.

* B) í†ï[èoóÕópèÓïÒéÊìæÇsÇaÇk-Çaå^
TYPES: BEGIN OF TYP_VBAK_AP,
VDATU  TYPE VBAK-VDATU,                          "éwíËî[ì¸ä˙ì˙
WAERK  TYPE VBAK-WAERK,                                  "í â›
AUART  TYPE VBAK-AUART,                        "îÃîÑì`ï\É^ÉCÉv
BSTDK  TYPE VBAK-BSTDK,                        "ìæà”êÊî≠íçì˙ït
* 2002/01/23  PSD k.igarashi  ADD Å´
AUDAT  TYPE VBAK-AUDAT,                              "ì`ï[ì˙ït
* 2002/01/23  PSD k.igarashi  ADD Å™
PSTYV  TYPE VBAP-PSTYV,                          "ñæç◊ÉJÉeÉSÉä
* UNDELETE PSD K.ARAI 2002/05/24
* 2002/01/30  PSD k.igarashi  DEL Å´
STCUR  TYPE VBAP-STCUR,                      "ìùåvópä∑éZÉåÅ[Ég
* 2002/01/30  PSD k.igarashi  DEL Å™
* UNDELETE END
NETPR  TYPE VBAP-NETPR,                              "îÃîÑíPâø
MATNR  TYPE VBAP-MATNR,                            "ïiñ⁄ÉRÅ[Éh
KDMAT  TYPE VBAP-KDMAT,                      "ìæà”êÊïiñ⁄ÉRÅ[Éh
NETWR  TYPE VBAP-NETWR,            "ì`ï\í â›Ç≈ÇÃéÛíçñæç◊ê≥ñ°äz
KBMENG TYPE VBAP-KBMENG,                         "ó›êœämîFêîíl
WAVWR  TYPE VBAP-WAVWR,                                  "å¥âø
* 2002/02/01  PSD k.igarashi  ADD Å´
KPEIN  TYPE VBAP-KPEIN,                           "âøäièåèíPà 
* 2002/02/01  PSD k.igarashi  DEL Å™
END OF TYP_VBAK_AP.

* 2002/01/09  PSD k.igarashi  MOD Å´
** C) í†ï[èoóÕópèÓïÒéÊìæÇsÇaÇk-Çbå^
*TYPES: BEGIN OF TYP_VBEP_EKPO,
*         EBELN TYPE EKPO-EBELN,                           "çwîÉî≠íçì`ï[
*         EBELP TYPE EKPO-EBELP,                           "çwîÉî≠íçñæç◊
*         MENGE TYPE EKPO-MENGE,                               "î≠íçêîó 
*         LLIEF TYPE EKKO-LLIEF,                             "ã§í édì¸êÊ
*         EVERS TYPE EKPO-EVERS,                               "èoâ◊éwé¶
*       END OF TYP_VBEP_EKPO.

* C) í†ï[èoóÕópèÓïÒéÊìæÇsÇaÇk-Çbå^
TYPES: BEGIN OF TYP_VBEP_EKPO,
EBELN TYPE EKPO-EBELN,                           "çwîÉî≠íçì`ï[
EBELP TYPE EKPO-EBELP,                           "çwîÉî≠íçñæç◊
MENGE TYPE EKPO-MENGE,                               "î≠íçêîó 
LIFNR TYPE EKKO-LIFNR,                           "édì¸êÊÉRÅ[Éh
EVERS TYPE EKPO-EVERS,                               "èoâ◊éwé¶
END OF TYP_VBEP_EKPO.
* 2002/01/09  PSD k.igarashi  MOD Å™

* 2002/01/23  PSD k.igarashi  ADD Å´
* A) í†ï[èoóÕópèÓïÒéÊìæÇsÇaÇk-Çcå^
TYPES: BEGIN OF TYP_VBPA,
PERNR   TYPE VBPA-PERNR,                            "è]ã∆àıNo.
END OF TYP_VBPA.
* 2002/01/23  PSD k.igarashi  ADD Å™

************************************************************************
* DATA
************************************************************************

*--- ì‡ïîÉeÅ[ÉuÉã
* á@âcã∆èäì‡ïîÇsÇaÇk
DATA: GF_EIGYOUSHO TYPE TYP_EIGYOUSHO,
GT_EIGYOUSHO LIKE TABLE OF GF_EIGYOUSHO.

* áAâcã∆ÉOÉãÅ[Évì‡ïîÇsÇaÇk
DATA: GF_EIGYOUGRP TYPE TYP_EIGYOUGRP,
GT_EIGYOUGRP LIKE TABLE OF GF_EIGYOUGRP.

* áBå¬êlèÓïÒì‡ïîÇsÇaÇk
DATA: GF_KOJIN_INFO TYPE TYP_KOJIN_INFO,
GT_KOJIN_INFO LIKE TABLE OF GF_KOJIN_INFO.

* áCï™êÕ(éÛíçéc)ì‡ïîÇsÇaÇk
DATA: GF_BUNSEKI_A TYPE TYP_BUNSEKI_A,
GT_BUNSEKI_A LIKE TABLE OF GF_BUNSEKI_A.

* áDï™êÕ(ëSé–•âcã∆èä)ì‡ïîÇsÇaÇk
DATA: GF_BUNSEKI_B TYPE TYP_BUNSEKI_B,
GT_BUNSEKI_B LIKE TABLE OF GF_BUNSEKI_B.

* áEí†ï[èoóÕóp(è⁄ç◊)ì‡ïîÇsÇaÇk
DATA: GF_WRITE_A LIKE ZSLIST_V08_01,
GT_WRITE_A LIKE TABLE OF GF_WRITE_A.

* áFí†ï[èoóÕóp(ëSé–•âcã∆èä)ì‡ïîÇsÇaÇk
DATA: GF_WRITE_B LIKE ZSLIST_V08_02,
GT_WRITE_B LIKE TABLE OF GF_WRITE_B.

*--- ç\ë¢
DATA : GF_VBPA_KD TYPE TYP_VBPA_KD,    "ÉeÅ[ÉuÉãì«Ç›çûÇ›èåèáIèÓïÒäiî[óp
GF_VBAK_AP TYPE TYP_VBAK_AP,    "ÉeÅ[ÉuÉãì«Ç›çûÇ›èåèáEèÓïÒäiî[óp
GF_VBEP_EKPO TYPE TYP_VBEP_EKPO,
" ÉeÅ[ÉuÉãì«Ç›çûÇ›èåèáFèÓïÒäiî[óp
GF_VBPA TYPE TYP_VBPA.     "ÉeÅ[ÉuÉãì«Ç›çûÇ›èåèáFèÓïÒäiî[óp

*--- DATA
DATA: VKBUR LIKE TVKBT-VKBUR,                        "select-optionóp
VKGRP LIKE TVGRT-VKGRP,                        "select-optionóp
PERNR LIKE PA0002-PERNR,                       "select-optionóp
KUNNR LIKE YS0011-KUNNR.                       "select-optionóp

DATA: KAKO_BSTDK_E LIKE GF_WRITE_A-ZKKAITOU,      "ìæà”êÊâÒìöî[ä˙â¡çHóp
KAKO_VDATU   LIKE GF_WRITE_A-ZLKAITOU,      "édì¸êÊâÒìöî[ä˙â¡çHóp
KAKO_BSTDK   LIKE GF_WRITE_A-ZJUDAY,              "éÛíçì˙ïtâ¡çHóp
*--- MODIFY PSD K.ARAI 2002/05/20                   " ÉoÉCÉgêîïœçX
HTANKA(20)    TYPE C, "TYP_WRITE_A-JTANKA,     "îÃîÑíPâøâøäiïœä∑óp
*      HTANKA(8)    TYPE C, "TYP_WRITE_A-JTANKA,     "îÃîÑíPâøâøäiïœä∑óp
*--- MODIFY END
NYUKOSU      LIKE GF_WRITE_A-ZHWEMNG,                     "ì¸å…êî
SHIIRESAKI   LIKE LFA1-NAME1,                           "édì¸êÊñº
KIBOHNOUKI   TYPE TYP_BUNSEKI_A-NOUKI.                  "äÛñ]î[ä˙

DATA: JZANKINGAKU       LIKE YS0011-KINGAKU1,     "éÛíçécã‡äzâøäiïœä∑óp
I_JZANKINGAKU(15) TYPE C,                   "éÛíçécã‡äzâøäiïœä∑óp
H_JZANKINGAKU(10) TYPE P DECIMALS 3.        "éÛíçécã‡äzñMâ›ä∑éZóp

DATA: YEARS   TYPE D,                               "î[ì¸ä˙ì˙ïœä∑èàóùóp
YEARS_1 TYPE D,                               "î[ì¸ä˙ì˙ïœèàóùä∑óp
YEARS_2 TYPE D,                               "î[ì¸ä˙ì˙ïœä∑èàóùóp
YEARS_3 TYPE D.                               "î[ì¸ä˙ì˙ïœä∑èàóùóp

DATA: LM_ZANKIN TYPE P DECIMALS 3,                "éÛíçécã‡äz(ëOåéà»ëO)
TM_ZANKIN TYPE P DECIMALS 3,                    "éÛíçécã‡äz(ìñåé)
N1M_ZANKIN TYPE P DECIMALS 3,                   "éÛíçécã‡äz(óÇåé)
N2M_ZANKIN TYPE P DECIMALS 3,                 "éÛíçécã‡äz(óÇÅXåé)
N3M_ZANKIN TYPE P DECIMALS 3,               "éÛíçécã‡äz(óÇÅXóÇåé)
N4M_ZANKIN TYPE P DECIMALS 3.           "éÛíçécã‡äz(óÇÅXóÇåéà»ç~)

* 2002/01/09  PSD k.igarashi  ADD Å´
DATA: EN_JKINGAKU(24) TYPE C,                               "âøäiïœä∑óp
EN_GENKA(24)    TYPE C.                               "âøäiïœä∑óp
* 2002/01/09  PSD k.igarashi  ADD Å™

*--- ÉäÉXÉgÉrÉÖÅ[ÉAä÷òA
DATA: GF_REPID     LIKE SY-REPID,                         "ÉåÉ|Å[ÉgÇhÇc
GF_LAYOUT   TYPE SLIS_LAYOUT_ALV,                 "ÉåÉCÉAÉEÉgç\ë¢
GF_VARIANT   TYPE DISVARIANT.               "ÉoÉäÉAÉìÉgï€ë∂ê›íËóp

* REUSE_ALV_COMMENTARY_WRITE
DATA: GF_HEAD_ALV   TYPE SLIS_LISTHEADER,                   "ÉwÉbÉ_ç\ë¢
GT_T_HEAD_ALV TYPE SLIS_T_LISTHEADER.            "ÉwÉbÉ_ópì‡ïîTBL

* ABAPÉäÉXÉgÉrÉÖÅ[ÉAÉwÉbÉ_ÉfÅ[É^ï€éù
DATA: GF_HEADER_A LIKE GF_WRITE_A,                      "ÉwÉbÉ_ï\é¶èÓïÒ
GF_HEADER_B LIKE GF_WRITE_B.

* REUSE_ALV_LIST_DISPLAY
DATA: TOP_OF_PAGE TYPE SLIS_FORMNAME VALUE 'TOP_OF_PAGE'.

* REUSE_ALV_EVENT
DATA: GT_EVENT TYPE SLIS_T_EVENT,                  "ÉCÉxÉìÉgèÓïÒì‡ïîTBL
GF_EVENT LIKE LINE OF GT_EVENT.                 "ÉCÉxÉìÉgèÓïÒç\ë¢

* 2002/01/10  PSD k.igarashi  ADD Å´
DATA: GT_ALV_A     TYPE TABLE OF ZSLIST_V08_01
WITH HEADER LINE.
DATA: GT_ALV_B     TYPE TABLE OF ZSLIST_V08_02
WITH HEADER LINE.
* 2002/01/10  PSD k.igarashi  ADD Å™
*---APPEND START PSD T.SAITOH 2002/03/19 ALVÉXÉeÅ[É^ÉXàÛç¸ãëî€ê›íË----*
DATA: GF_PRINT      TYPE SLIS_PRINT_ALV.
*---APPEND END   PSD T.SAITOH 2002/03/19 ---------------------------*
* add 2004/03/24
DATA: WA_TCURR TYPE TCURR,
IT_TCURR LIKE STANDARD TABLE OF WA_TCURR.
* add 2004/03/24
************************************************************************
* CONSTANTS
************************************************************************
CONSTANTS: CNS_JA(2)      TYPE C VALUE 'JA',
CNS_0001(4)    TYPE C VALUE '0001',
CNS_READTXT(9) TYPE C VALUE 'READ_TEXT',
CNS_X(1)       TYPE C VALUE    'X',
CNS_AG(2)      TYPE C VALUE 'AG',
* 2002/01/23  PSD k.igarashi  ADD Å´
CNS_VE(2)      TYPE C VALUE 'VE',
CNS_ZSEO(4)    TYPE C VALUE 'ZSEO',
CNS_ZSEK(4)    TYPE C VALUE 'ZSEK'.
* APPEND PSD K.ARAI 2002/05/24
CONSTANTS: CNS_RE(2)      TYPE C VALUE 'RE',
CNS_KR(2)      TYPE C VALUE 'KR',
CNS_ZRE(3)     TYPE C VALUE 'ZRE'.
* APPEND END
* 2002/01/23  PSD k.igarashi  ADD Å™
CONSTANTS: CNS_TVKBT(5)      TYPE C VALUE 'TVKBT',
CNS_TVGRT(5)      TYPE C VALUE 'TVGRT',
CNS_PA0002(6)     TYPE C VALUE 'PA0002',
CNS_LFA1(4)       TYPE C VALUE 'LFA1',
CNS_YS0011(6)     TYPE C VALUE 'YS0011',
CNS_YS0011_VBAP_VBEP(16) TYPE C VALUE 'YS0011 VBAP VBEP',
CNS_VBPA_VBKD(9)  TYPE C VALUE 'VBPA VBKD',
CNS_VBAK_VBAP(9)  TYPE C VALUE 'VBAK VBAP',
CNS_VBEP_EKPO_EKKO(14) TYPE C VALUE 'VBEP EKPO EKKO',
CNS_EKET(4)       TYPE C VALUE 'EKET'.
CONSTANTS: CNS_TOP(11)       TYPE C VALUE 'TOP_OF_PAGE',
CNS_FTOP(15)      TYPE C VALUE 'FRM_TOP_OF_PAGE'.
************************************************************************
* ëIëâÊñ 
************************************************************************
* âcã∆èäÉRÅ[Éh
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS R_BALANC RADIOBUTTON GROUP RD_1 DEFAULT 'X'.
SELECTION-SCREEN COMMENT 2(10) TEXT-007  FOR FIELD R_BALANC.
SELECTION-SCREEN COMMENT 17(12) TEXT-018 FOR FIELD P_VKBUR.
SELECTION-SCREEN POSITION 32.
PARAMETERS P_VKBUR LIKE VKBUR.
SELECTION-SCREEN END OF LINE.

* âcã∆ÉOÉãÅ[Év
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 14.
PARAMETERS R_EIGYOG RADIOBUTTON GROUP RD_2 DEFAULT 'X'.
SELECTION-SCREEN COMMENT 17(12) TEXT-010 FOR FIELD S_VKGRP.
SELECTION-SCREEN POSITION 29.
SELECT-OPTIONS S_VKGRP FOR VKGRP.
SELECTION-SCREEN END OF LINE.

* âcã∆àıÉRÅ[Éh
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 14.
PARAMETERS R_EIGYOI RADIOBUTTON GROUP RD_2.
SELECTION-SCREEN COMMENT 17(12) TEXT-011 FOR FIELD S_PERNR.
SELECTION-SCREEN POSITION 29.
SELECT-OPTIONS S_PERNR FOR PERNR.
SELECTION-SCREEN END OF LINE.

* ìæà”êÊÉRÅ[Éh
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT 17(12) TEXT-012 FOR FIELD S_KUNNR.
SELECTION-SCREEN POSITION 29.
SELECT-OPTIONS S_KUNNR FOR KUNNR.
SELECTION-SCREEN END OF LINE.

* ì˙ït
SELECTION-SCREEN BEGIN OF LINE.
*--- MODIFY PSD K.ARAI 2002/05/20   " ì˙ïtÅ®äÛñ]î[ä˙
SELECTION-SCREEN COMMENT 17(12) TEXT-032 FOR FIELD S_DATUM.
*  SELECTION-SCREEN COMMENT 17(12) TEXT-013 FOR FIELD S_DATUM.
*--- MODIFY END
SELECTION-SCREEN POSITION 29.
*---MODIFY START PSD T.SAITOH 2002/06/06 ---------------------------*
*  SELECT-OPTIONS S_DATUM FOR SY-DATUM DEFAULT SY-DATUM.
SELECT-OPTIONS S_DATUM FOR SY-DATUM.
*---MODIFY END   PSD T.SAITOH 2002/06/06 ---------------------------*
SELECTION-SCREEN END OF LINE.

* ëSé–(éÛíçécã‡àÍóóï\)
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS R_ZENSHA  RADIOBUTTON GROUP RD_1.
SELECTION-SCREEN COMMENT 2(20) TEXT-014 FOR FIELD R_ZENSHA.
SELECTION-SCREEN END OF LINE.

* âcã∆èä(éÛíçécã‡àÍóóï\)
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS R_EIGYOS RADIOBUTTON GROUP RD_1.
SELECTION-SCREEN COMMENT 2(22) TEXT-015 FOR FIELD R_EIGYOS.
SELECTION-SCREEN POSITION 29.
SELECT-OPTIONS S_VKBUR FOR VKBUR.
SELECTION-SCREEN END OF LINE.

************************************************************************
* AT SELECTION-SCREEN                                                  *
************************************************************************
* 2-1 ì¸óÕÉ`ÉFÉbÉNèàóù
AT SELECTION-SCREEN.

CASE CNS_X.
WHEN R_BALANC.
PERFORM FRM_CHECK_ZANDAKA.
WHEN R_EIGYOS.
PERFORM FRM_CHECK_EIGYOUSHO.
ENDCASE.
************************************************************************
* START-OF-SELECTION
************************************************************************
START-OF-SELECTION.
* add 2004/03/24
* ÉåÅ[ÉgéÊìæ
PERFORM GET_RATE.
* add 2004/03/24
* 2-2 ëŒè€ÉfÅ[É^íäèoèàóù
CASE CNS_X.
* éÛíçécàÍóóï\ÇëIë
WHEN R_BALANC.
PERFORM FRM_SEL_JUCHUZANICHIRAN.                    "ëŒè€ÉfÅ[É^íäèo
PERFORM FRM_MAKE_ZANDAKA.                    "í†ï[(è⁄ç◊)ì‡ïîTBLçÏê¨
PERFORM FRM_WRITE_ICHIRAN_A.                    "í†ï[(è⁄ç◊)èoóÕèàóù
* ëSé–ÅEâcã∆èä(éÛíçécã‡äzàÍóóï\)ÇëIë
WHEN OTHERS.
PERFORM FRM_SEL_KINGAKUICHIRAN.                     "ëŒè€ÉfÅ[É^íäèo
PERFORM FRM_MAKE_KINGAKUICHIRAN.     "í†ï[(âÔé–ÅEâcã∆èä)ì‡ïîTBLçÏê¨
PERFORM FRM_WRITE_ICHIRAN_B.            "í†ï[(âÔé–ÅEâcã∆èä)èoóÕèàóù
ENDCASE.
*&---------------------------------------------------------------------*
*&      Form  frm_check_zandaka
*&---------------------------------------------------------------------*
*       2-1-á@ ÉâÉWÉIÉ{É^ÉìÅFéÛíçécàÍóóëIëéû
*----------------------------------------------------------------------*
FORM FRM_CHECK_ZANDAKA.

* a) âcã∆èäÉRÅ[Éhì¸óÕÉ`ÉFÉbÉN
IF P_VKBUR = ' '.
MESSAGE E006(Z1) WITH TEXT-019.
ENDIF.

* b) ÉVÉXÉeÉÄì˙ïtïKê{É`ÉFÉbÉN
*---DELETE START PSD T.SAITOH 2002/06/06 ---------------------------*
*  IF S_DATUM-LOW = '00000000'.
*    MESSAGE E006(Z1) WITH text-027.
*  ENDIF.
*---DELETE END   PSD T.SAITOH 2002/06/06 ---------------------------*

ENDFORM.                    " frm_check_zandaka
*&---------------------------------------------------------------------*
*&      Form  frm_check_eigyousho
*&---------------------------------------------------------------------*
*       2-1-áA ÉâÉWÉIÉ{É^ÉìÅFâcã∆èäëIëéû
*----------------------------------------------------------------------*
FORM FRM_CHECK_EIGYOUSHO.

* âcã∆èäÉRÅ[Éhì¸óÕÉ`ÉFÉbÉN
IF S_VKBUR-LOW = ' '.
MESSAGE E006(Z1) WITH TEXT-018.
ENDIF.

ENDFORM.                    " frm_check_zensha
*&---------------------------------------------------------------------*
*&      Form  frm_sel_juchuzanichiran
*&---------------------------------------------------------------------*
*       2-2-á@ éÛíçécàÍóóëIëéû
*----------------------------------------------------------------------*
FORM FRM_SEL_JUCHUZANICHIRAN.

* âcã∆èäÉOÉãÅ[ÉvÅAâcã∆àıÉRÅ[Éhèdï°É`ÉFÉbÉN
PERFORM FRM_CHECK_ZANDAKA.

* a) âcã∆èäíäèoèàóù
PERFORM FRM_SEL_EIGYOUSHO_A.

* b) âcã∆ÉOÉãÅ[Évíäèoèàóù
PERFORM FRM_SEL_EIGYOUGRP_A.

* c) âcã∆àıíäèoèàóù
PERFORM FRM_SEL_EIGYOUIN.

* e) éÛíçécï™êÕèÓïÒíäèoèàóù
PERFORM FRM_SEL_BUNSEKI_A.

ENDFORM.                    " frm_sel_juchuzanichiran
*&---------------------------------------------------------------------*
*&      Form  frm_sel_kingakuichiran
*&---------------------------------------------------------------------*
*       2-2-áAÅEáB ëSé–ÅEâcã∆èäëIëéû
*----------------------------------------------------------------------*
FORM FRM_SEL_KINGAKUICHIRAN.

* âcã∆èäÉRÅ[ÉhïKê{É`ÉFÉbÉN(âcã∆èäëIëéû)
CASE CNS_X.
WHEN R_EIGYOS.
PERFORM FRM_CHECK_EIGYOUSHO.
ENDCASE.

* èâä˙èàóù(ëSé–ëIëéûÅ|âcã∆èäÉpÉâÉÅÅ[É^ÉuÉâÉìÉNê›íË)
CASE CNS_X.
WHEN R_ZENSHA.
FREE S_VKBUR.
ENDCASE.

* a)âcã∆èäíäèoèàóù
PERFORM FRM_SEL_EIGYOUSHO_B.

* b)âcã∆ÉOÉãÅ[ÉvëIëèàóù(âcã∆èäëIëéû)
CASE CNS_X.
WHEN R_EIGYOS.
PERFORM FRM_SEL_EIGYOUGRP_B.
ENDCASE.

* c)éÛíçécï™êÕèÓïÒíäèoèàóù
PERFORM FRM_SEL_BUNSEKI_B.

ENDFORM.                    " frm_sel_kingakuichiran
*&---------------------------------------------------------------------*
*&      Form  frm_sel_eigyousho_a
*&---------------------------------------------------------------------*
*       2-2-á@-a âcã∆èäíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_EIGYOUSHO_A.

SELECT * FROM TVKBT
INTO CORRESPONDING FIELDS OF TABLE GT_EIGYOUSHO
WHERE SPRAS = CNS_JA
AND   VKBUR = P_VKBUR.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-019.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_TVKBT SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_eigyousho_a
*&---------------------------------------------------------------------*
*&      Form  frm_sel_eigyougrp_a
*&---------------------------------------------------------------------*
*       2-2-á@-b âcã∆ÉOÉãÅ[Évíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_EIGYOUGRP_A.

SELECT * FROM TVGRT
INTO CORRESPONDING FIELDS OF TABLE GT_EIGYOUGRP
WHERE SPRAS = CNS_JA
AND   VKGRP IN S_VKGRP.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-020.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_TVGRT SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_eigyougrp_a
*&---------------------------------------------------------------------*
*&      Form  frm_sel_eigyouin
*&---------------------------------------------------------------------*
*       2-2-á@-c âcã∆àıíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_EIGYOUIN.

SELECT * FROM PA0002
INTO CORRESPONDING FIELDS OF TABLE GT_KOJIN_INFO
WHERE PERNR IN S_PERNR.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
* Å´ DELETE 2002.03.18 PSD M.ARAI âcã∆àıéÊìæÉGÉâÅ[çÌèú
*      MESSAGE S600(Z1) WITH text-021.
*      STOP.
* Å™
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_PA0002 SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_eigyouin
*&---------------------------------------------------------------------*
*&      Form  frm_sel_bunseki_a
*&---------------------------------------------------------------------*
*       2-2-á@-e éÛíçécï™êÕèÓïÒíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_BUNSEKI_A.

SELECT * FROM YS0011
INTO CORRESPONDING FIELDS OF TABLE GT_BUNSEKI_A
WHERE VKBUR = P_VKBUR
AND  VKGRP IN S_VKGRP
AND  KUNNR IN S_KUNNR
*--- MODIFY PSD K.ARAI 2002/05/20  " íäèoèåèïœçX
AND  NOUKI IN S_DATUM.
*     AND  NOUKI <= S_DATUM.
*--- MODIFY END

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-023.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_YS0011 SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_bunseki_a
*&---------------------------------------------------------------------*
*&      Form  frm_sel_eigyousho_b
*&---------------------------------------------------------------------*
*       2-2-áAÅEáB-a ëSé–ÅEâcã∆èäíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_EIGYOUSHO_B.

SELECT * FROM TVKBT
INTO CORRESPONDING FIELDS OF TABLE GT_EIGYOUSHO
WHERE SPRAS = CNS_JA
AND  VKBUR IN S_VKBUR.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-019.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_TVKBT SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_eigyousho_b
*&---------------------------------------------------------------------*
*&      Form  frm_sel_bunseki_b
*&---------------------------------------------------------------------*
*       2-2-áAÅEáB éÛíçécï™êÕèÓïÒíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_BUNSEKI_B.

*---MODIFY START PSD T.SAITOH 2002/05/22 ---------------------------*
*  SELECT
*    a~VBELN a~POSNR a~KINGAKU1 a~KINGAKU5 a~VKBUR a~VKGRP a~WAERK
*    b~STCUR
*    c~EDATU
*   INTO CORRESPONDING FIELDS OF TABLE GT_BUNSEKI_B
*   FROM YS0011 AS a INNER JOIN VBAP      AS b
*    ON a~VBELN = b~VBELN AND
*       a~POSNR = b~POSNR INNER JOIN VBEP AS c
*    ON a~VBELN = c~VBELN AND
*       a~POSNR = c~POSNR
*   WHERE a~VKBUR IN S_VKBUR
*    AND  c~ETENR = CNS_0001.
SELECT
*--- APPEND PSD K.ARAI 2002/05/24
A~JUCHU A~MSHUKKO A~SEIKYU
B~NETPR B~KPEIN
*--- APPEN END
A~VBELN A~POSNR A~KINGAKU1 A~KINGAKU5 A~VKBUR A~VKGRP A~WAERK
B~STCUR
C~EDATU
INTO CORRESPONDING FIELDS OF GF_BUNSEKI_B
FROM YS0011 AS A INNER JOIN VBAP      AS B
ON A~VBELN = B~VBELN AND
A~POSNR = B~POSNR INNER JOIN VBEP AS C
ON A~VBELN = C~VBELN AND
A~POSNR = C~POSNR
WHERE A~VKBUR IN S_VKBUR
AND  C~ETENR = CNS_0001.

SELECT SINGLE
KURSK
FROM VBKD
INTO GF_BUNSEKI_B-STCUR
WHERE VBELN = GF_BUNSEKI_B-VBELN.

* APPEND PSD K.ARAI 2002/05/24
SELECT SINGLE
WAERK
AUART
FROM VBAK
INTO (GF_BUNSEKI_B-WAERK,
GF_BUNSEKI_B-AUART)
WHERE VBELN = GF_BUNSEKI_B-VBELN.
* APPEND END


APPEND GF_BUNSEKI_B TO GT_BUNSEKI_B.

ENDSELECT.
CLEAR GF_BUNSEKI_B.
*---MODIFY END   PSD T.SAITOH 2002/05/22 ---------------------------*
CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-023.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_YS0011_VBAP_VBEP SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_bunseki_b
*&---------------------------------------------------------------------*
*&      Form  frm_sel_eigyougrp_b
*&---------------------------------------------------------------------*
*       2-2-áB-b âcã∆ÉOÉãÅ[Évíäèoèàóù
*----------------------------------------------------------------------*
FORM FRM_SEL_EIGYOUGRP_B.

SELECT * FROM TVGRT
INTO CORRESPONDING FIELDS OF TABLE GT_EIGYOUGRP
WHERE SPRAS = CNS_JA.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-020.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_TVGRT SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_sel_eigyougrp_b
*&---------------------------------------------------------------------*
*&      Form  frm_make_zandaka
*&---------------------------------------------------------------------*
*       2-3-á@éÛíçécã‡äzëIëéû
*----------------------------------------------------------------------*
FORM FRM_MAKE_ZANDAKA.

*--- ÉãÅ[ÉvèàóùäJén
LOOP AT GT_BUNSEKI_A INTO GF_BUNSEKI_A.

* 2002/01/17  PSD k.igarashi  ADD Å´
* èâä˙âªèàóù
CLEAR: GF_VBEP_EKPO,
SHIIRESAKI,
GF_WRITE_A.
* 2002/01/17  PSD k.igarashi  ADD Å™


* 2002/01/30  PSD k.igarashi  DEL Å´
* a) í†ï[IDÇÃê›íË
*    GF_WRITE_A-ZLISTID = '1'.
* 2002/01/30  PSD k.igarashi  DEL Å™

* b) ï™êÕ(éÛíçéc)ì‡ïîTBLîÒâ¡çHçÄñ⁄ÇÃí†ï[èoóÕóp(è⁄ç◊)ì‡ïîTBLÇ÷ÇÃê›íË
PERFORM FRM_SET_INFO_1B.
* c) âcã∆èäÉeÉLÉXÉgÇÃê›íË
PERFORM FRM_SET_INFO_1C.
* d) âcã∆ÉOÉãÅ[ÉvñºÇÃê›íË
PERFORM FRM_SET_INFO_1D.
* e) âcã∆àıñºÇÃê›íË
PERFORM FRM_SET_INFO_1E_STEP1.

CASE SY-SUBRC.
WHEN 0.
*          GF_WRITE_A-PERNR = GF_VBPA_KD-PERNR.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-024.
CONTINUE.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_VBPA_VBKD SY-SUBRC.
ENDCASE.

* 2002/01/23  PSD k.igarashi  ADD Å´
*- 2002/01/25  PSD k.igarashi  DEL Å´
*    IF R_EIGYOI = CNS_X.
*- 2002/01/25  PSD k.igarashi  DEL Å™
PERFORM FRM_WHEN_EIGYOIN_CHECK.

CASE SY-SUBRC.
WHEN 0.
*          CLEAR GF_WRITE_A-PERNR.
GF_WRITE_A-PERNR = GF_VBPA-PERNR.
WHEN 4.
*- 2002/01/25  PSD k.igarashi  DEL Å´
*          MESSAGE S600(Z1) WITH text-024.
*          CONTINUE.
*- 2002/01/25  PSD k.igarashi  DEL Å™
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_VBPA_VBKD SY-SUBRC.
ENDCASE.
*- 2002/01/25  PSD k.igarashi  DEL Å´
*    ENDIF.
*- 2002/01/25  PSD k.igarashi  DEL Å™
* 2002/01/23  PSD k.igarashi  ADD Å™

PERFORM FRM_SET_INFO_1E_STEP2.
*---APPEND START PSD T.SAITOH 2002/08/14 ---------------------------*
*   âcã∆àıéwíËéûÅ@Ç©Ç¬Å@âcã∆àıéwíËÇ™ÉuÉâÉìÉNÇ≈Ç»Ç¢Å@Ç©Ç¬
*   âcã∆àıñºÇ™Ç»Ç¢èÍçáëŒè€äOÇ∆Ç∑ÇÈ
IF R_EIGYOI = CNS_X AND NOT S_PERNR IS INITIAL
AND SY-SUBRC <> 0.
CONTINUE.
ENDIF.
*---APPEND END   PSD T.SAITOH 2002/08/14 ---------------------------*

* f) ìæà”êÊñºÇÃê›íË
PERFORM FRM_SET_INFO_1F.
* g) ìæà”êÊâÒìöî[ä˙ÇÃê›íË
PERFORM FRM_SET_INFO_1G.

* h) ñ¢èoâ◊êîó ÇÃê›íË
* 2002/02/01  PSD k.igarashi  MOD Å´
*    GF_WRITE_A-MSHUKKO = GF_BUNSEKI_A-JUCHU - GF_BUNSEKI_A-MSHUKKO.
GF_WRITE_A-MSHUKKO = GF_BUNSEKI_A-JUCHU - GF_BUNSEKI_A-MSHUKKO
- GF_BUNSEKI_A-SEIKYU.
* 2002/02/01  PSD k.igarashi  MOD Å™

* i) èoâ◊â¬î\êîó ÇÃê›íË
* 2002/02/01  PSD k.igarashi  MOD Å´
*    GF_WRITE_A-ZKANOU = GF_BUNSEKI_A-PICKUP - GF_BUNSEKI_A-MSHUKKO.
GF_WRITE_A-ZKANOU = GF_BUNSEKI_A-JUCHU - GF_BUNSEKI_A-MSHUKKO
- GF_BUNSEKI_A-SEIKYU - GF_BUNSEKI_A-BACKODR.
* 2002/02/01  PSD k.igarashi  MOD Å™

* j) ãÊÅAéÛíçíPâøÅAéÛíçécã‡äzÅAédì¸êÊâÒìöî[ä˙ÅA
*                        éÛíçì˙ïtÅAäeîÒï\é¶çÄñ⁄ÇÃê›íË
PERFORM FRM_SET_INFO_1J.
* k) î≠íçî‘çÜÅAî≠íçñæç◊ÅAî≠íçécêîÅAédì¸êÊñºÇÃê›íË
PERFORM FRM_SET_INFO_1K.
* l) äÛñ]î[ä˙ÇÃê›íË
PERFORM FRM_SET_INFO_1L.
* m) èoâ◊éwé¶îıçlÇÃê›íË
PERFORM FRM_SET_INFO_1M.

*---APPEND START PSD T.SAITOH 2002/08/30 ---------------------------*
* í«â¡) éÛíçécã‡äzÇÃê›íË
PERFORM FRM_SET_ORDER_ACOUNT.
*---APPEND END   PSD T.SAITOH 2002/08/30 ---------------------------*
* Add 2004/07/02 --->
Move : GF_BUNSEKI_A-KUNWE To GF_WRITE_A-KUNWE ,
GF_BUNSEKI_A-NAME1_W To GF_WRITE_A-NAME1_W .
* Add 2004/07/02 <---

* n) í†ï[èoóÕóp(è⁄ç◊)ì‡ïîTBLÉåÉRÅ[Éhí«â¡èàóù
APPEND GF_WRITE_A TO GT_WRITE_A.

*--- ÉãÅ[ÉvèàóùèIóπ
ENDLOOP.

ENDFORM.                    " frm_make_zandaka
*&---------------------------------------------------------------------*
*&      Form  frm_make_kingakuichiran
*&---------------------------------------------------------------------*
*       2-3-áAëSé–ëIëéû
*----------------------------------------------------------------------*
FORM FRM_MAKE_KINGAKUICHIRAN.

* ÉãÅ[ÉvèàóùäJén
LOOP AT GT_BUNSEKI_B INTO GF_BUNSEKI_B.

* èâä˙âªèàóù
*--- í†ï[ópç\ë¢
CLEAR: GF_WRITE_B-ZZENIZEN,
GF_WRITE_B-ZTOUGETU,
GF_WRITE_B-ZYOKGETU,
GF_WRITE_B-ZYYKGETU,
GF_WRITE_B-ZYYYGETU,
GF_WRITE_B-ZYYYIKOU.
*--- éÛíçécã‡î‰ärópÉIÉuÉWÉFÉNÉg
CLEAR: LM_ZANKIN,
TM_ZANKIN,
N1M_ZANKIN,
N2M_ZANKIN,
N3M_ZANKIN,
N4M_ZANKIN.

* a) í†ï[ÇhÇcÇÃê›íË
PERFORM FRM_SET_INFO_2A.
* b) âcã∆èäÉRÅ[ÉhÅAâcã∆èäñºÇÃê›íË
PERFORM FRM_SET_INFO_2B.
* c) âcã∆ÉOÉãÅ[ÉvñºÇÃê›íË
CASE CNS_X.
WHEN R_EIGYOS.
PERFORM FRM_SET_INFO_2C.
ENDCASE.
* d) éÛíçécã‡äzÇÃê›íË
PERFORM FRM_SET_INFO_2D.
* e) í†ï[èoóÕóp(âÔé–ÅEâcã∆èä)ì‡ïîÇsÇaÇkÇÃê›íË
PERFORM FRM_SET_INFO_2E.

ENDLOOP.

ENDFORM.                    " frm_make_kingakuichiran
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1b
*&---------------------------------------------------------------------*
*       2-3-á@-(b)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1B.

GF_WRITE_A-VKBUR = GF_BUNSEKI_A-VKBUR. "âcã∆èäÉRÅ[ÉhÅ©âcã∆èä
GF_WRITE_A-VKGRP = GF_BUNSEKI_A-VKGRP. "âcã∆ÉOÉãÅ[ÉvÅ©âcã∆ÉOÉãÅ[Év
GF_WRITE_A-KUNNR = GF_BUNSEKI_A-KUNNR. "ìæà”êÊÉRÅ[ÉhÅ©ìæà”êÊÉRÅ[Éh
GF_WRITE_A-BSTNK = GF_BUNSEKI_A-BSTNK. "ìæà”êÊî≠íçî‘çÜÅ©ìæà”êÊî≠íçî‘çÜ
GF_WRITE_A-MAKTX = GF_BUNSEKI_A-MAKTX. "ïiñ⁄Å©ïiñ⁄ÉeÉLÉXÉg
GF_WRITE_A-JUCHU = GF_BUNSEKI_A-JUCHU. "éÛíçêîÅ©éÛíçêîó 
GF_WRITE_A-VBELN = GF_BUNSEKI_A-VBELN. "éÛíçî‘çÜÅ©îÃîÑì`ï[î‘çÜ
GF_WRITE_A-POSNR = GF_BUNSEKI_A-POSNR. "éÛíçñæç◊Å©îÃîÑì`ï[ñæç◊
* Add 2006.06.16 --->
GF_WRITE_A-yusoutou = GF_BUNSEKI_A-yusoutou.
* Add2006.06.16 <---

ENDFORM.                    " frm_set_info_1b
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1c
*&---------------------------------------------------------------------*
*       2-3-á@-(c)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1C.

READ TABLE GT_EIGYOUSHO WITH KEY VKBUR = GF_BUNSEKI_A-VKBUR
INTO GF_EIGYOUSHO.

CASE SY-SUBRC.
WHEN 0.
GF_WRITE_A-BUBZI = GF_EIGYOUSHO-BEZEI.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-019.
STOP.
ENDCASE.

ENDFORM.                    " frm_set_info_1c
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1d
*&---------------------------------------------------------------------*
*       2-3-á@-(d)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1D.

READ TABLE GT_EIGYOUGRP WITH KEY VKGRP = GF_BUNSEKI_A-VKGRP
INTO GF_EIGYOUGRP.

CASE SY-SUBRC.
WHEN 0.
GF_WRITE_A-GRBZI = GF_EIGYOUGRP-BEZEI.
WHEN 4.
MESSAGE S600(Z1) WITH TEXT-020.
STOP.
ENDCASE.

ENDFORM.                    " frm_set_info_1d
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1e_step1
*&---------------------------------------------------------------------*
*       2-3-á@-(e)-(ÉA)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1E_STEP1.

* 2001/12/14  PSD k.igarashi  MOD Å´
*--- ÉA) è]ã∆àıNo.ÇÃéÊìæ
*  SELECT SINGLE *
*   INTO CORRESPONDING FIELDS OF GF_VBPA_KD
*   FROM VBPA AS a INNER JOIN VBKD AS b
*    ON a~VBELN = b~VBELN AND
*       a~POSNR = b~POSNR
*   WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*    AND  a~POSNR = GF_BUNSEKI_A-POSNR.

SELECT SINGLE *
INTO CORRESPONDING FIELDS OF GF_VBPA_KD
FROM VBPA AS A INNER JOIN VBKD AS B
ON A~VBELN = B~VBELN AND
A~POSNR = B~POSNR
WHERE A~VBELN = GF_BUNSEKI_A-VBELN
AND  A~PARVW = CNS_AG.                         "01/12/14èåèí«â¡
*    AND  a~POSNR = GF_BUNSEKI_A-POSNR.             "àÍéûìIë[íu
* 2001/12/14  PSD k.igarashi  MOD Å™

ENDFORM.                    " frm_set_info_1e_step1
*&---------------------------------------------------------------------*
*&      Form  frm_when_eigyoin_check
*&---------------------------------------------------------------------*
*       âcã∆àıëIëéûÇÃèàóù
*----------------------------------------------------------------------*
FORM FRM_WHEN_EIGYOIN_CHECK.

SELECT SINGLE *
INTO CORRESPONDING FIELDS OF GF_VBPA
FROM VBPA AS A INNER JOIN VBKD AS B
ON A~VBELN = B~VBELN AND
A~POSNR = B~POSNR
WHERE A~VBELN = GF_BUNSEKI_A-VBELN
AND  A~PARVW = CNS_VE.

ENDFORM.                    " frm_when_eigyoin_check

*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1e_step2
*&---------------------------------------------------------------------*
*       2-3-á@-(e)-(ÉC)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1E_STEP2.

*--- ÉC) âcã∆àıñºÇÃéÊìæ
READ TABLE GT_KOJIN_INFO WITH KEY PERNR = GF_WRITE_A-PERNR
INTO GF_KOJIN_INFO.

CASE SY-SUBRC.
WHEN 0.
GF_WRITE_A-NACHN = GF_KOJIN_INFO-NACHN.
WHEN 4.
GF_WRITE_A-NACHN = ' '.
ENDCASE.

ENDFORM.                    " frm_set_info_1e_step2
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1f
*&---------------------------------------------------------------------*
*       2-3-á@-(f)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1F.

* îƒópÉÇÉWÉÖÅ[Éã'ADDR_GET'ópç\ë¢
DATA: ADDRESS  LIKE ADDR1_SEL.         "ÉAÉhÉåÉXî‘çÜê›íËóp
DATA: LF_TNAME LIKE SADR.              "ìæà”êÊñºéÊìæóp

* èâä˙èàóù(ÉAÉhÉåÉXî‘çÜÇÃê›íË)
ADDRESS-ADDRNUMBER = GF_VBPA_KD-ADRNR.

* ìæà”êÊñºéÊìæ(îƒópÉÇÉWÉÖÅ[ÉãåƒÇ—èoÇµ)
CALL FUNCTION 'ADDR_GET'
EXPORTING
ADDRESS_SELECTION = ADDRESS
IMPORTING
SADR              = LF_TNAME
EXCEPTIONS
PARAMETER_ERROR   = 1
ADDRESS_NOT_EXIST = 2
VERSION_NOT_EXIST = 3
INTERNAL_ERROR    = 4
OTHERS            = 5.

IF SY-SUBRC = 0.
GF_WRITE_A-ZKNAME = LF_TNAME-NAME1.
ELSEIF ( SY-SUBRC = 1 ) OR ( SY-SUBRC = 2 ) OR ( SY-SUBRC = 3 ) OR
( SY-SUBRC = 4 ) OR ( SY-SUBRC = 5 ).
GF_WRITE_A-ZKNAME = ' '.
ENDIF.

ENDFORM.                    " frm_set_info_1f
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1g
*&---------------------------------------------------------------------*
*       2-3-á@-(g)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1G.

CONCATENATE GF_VBPA_KD-BSTDK_E+4(2)
'/'
GF_VBPA_KD-BSTDK_E+6(2)
INTO KAKO_BSTDK_E.
GF_WRITE_A-ZKKAITOU = KAKO_BSTDK_E.
*---APPEND START PSD T.SAITOH 2002/09/12 ---------------------------*
* ìæà”êÊâÒìöî[ä˙ÉtÉãåÖëŒâû
GF_WRITE_A-ZZKKAITOU = GF_VBPA_KD-BSTDK_E.
*---APPEND END   PSD T.SAITOH 2002/09/12 ---------------------------*

ENDFORM.                    " frm_set_info_1g
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1j
*&---------------------------------------------------------------------*
*       2-3-á@-(j)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1J.

* 2002/01/23  PSD k.igarashi  MOD Å´
*  SELECT SINGLE
*      a~VDATU a~WAERK a~AUART a~BSTDK
*      b~PSTYV b~STCUR b~NETPR b~MATNR b~KDMAT b~NETWR b~KBMENG b~WAVWR
*     INTO CORRESPONDING FIELDS OF GF_VBAK_AP
*     FROM VBAK AS a INNER JOIN VBAP AS b
*      ON a~VBELN = b~VBELN
*     WHERE b~VBELN = GF_BUNSEKI_A-VBELN.
**      AND  b~POSNR = GF_BUNSEKI_A-POSNR.

* 2002/02/01  PSD k.igarashi  MOD Å´
*  SELECT SINGLE
*      a~VDATU a~WAERK a~AUART a~BSTDK a~AUDAT
*      b~PSTYV b~STCUR b~NETPR b~MATNR b~KDMAT b~NETWR b~KBMENG b~WAVWR
*     INTO CORRESPONDING FIELDS OF GF_VBAK_AP
*     FROM VBAK AS a INNER JOIN VBAP AS b
*      ON a~VBELN = b~VBELN
*     WHERE b~VBELN = GF_BUNSEKI_A-VBELN
*      AND  b~POSNR = GF_BUNSEKI_A-POSNR.
* 2002/01/23  PSD k.igarashi  MOD Å™

SELECT SINGLE
A~VDATU A~WAERK A~AUART A~BSTDK A~AUDAT
B~PSTYV B~STCUR B~NETPR B~MATNR B~KDMAT
B~NETWR B~KBMENG B~WAVWR B~KPEIN
INTO CORRESPONDING FIELDS OF GF_VBAK_AP
FROM VBAK AS A INNER JOIN VBAP AS B
ON A~VBELN = B~VBELN
WHERE B~VBELN = GF_BUNSEKI_A-VBELN
AND  B~POSNR = GF_BUNSEKI_A-POSNR.
* 2002/02/01  PSD k.igarashi  MOD Å™

CASE SY-SUBRC.
WHEN 0.
*--- APPEND PSD K.ARAI 2002/05/24
PERFORM FRM_GET_VBKD_KURSK.
*--- APPEND END


* 2002/01/23  PSD k.igarashi  MOD Å´
*--- ÉA) ãÊÇÃê›íË
*        GF_WRITE_A-PSTYV = GF_VBAK_AP-PSTYV.

IF GF_VBAK_AP-PSTYV = CNS_ZSEO.             "ZSEO
GF_WRITE_A-PSTYV = TEXT-030.
ELSEIF GF_VBAK_AP-PSTYV = CNS_ZSEK.         "ZSEK
GF_WRITE_A-PSTYV = TEXT-031.
ELSE.
GF_WRITE_A-PSTYV = 'Å@'.
ENDIF.
* 2002/01/23  PSD k.igarashi  MOD Å™

*--- ÉC) éÛíçíPâøÇÃê›íË
*   (˙@) îÃîÑíPâøÇÃâøäiïœä∑
CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_IDOC'
EXPORTING
CURRENCY    = GF_VBAK_AP-WAERK
SAP_AMOUNT  = GF_VBAK_AP-NETPR
IMPORTING
IDOC_AMOUNT = HTANKA.


* 2002/02/01  PSD k.igarashi  ADD Å´
*- 2002/01/09  PSD k.igarashi  ADD Å´
*    GF_WRITE_A-NETPR = HTANKA.
* Å´APPEND 2002/02/08 PSD M.Arai 0èúéZ¡™Ø∏í«â¡
*    GF_WRITE_A-NETPR = HTANKA / GF_VBAK_AP-KPEIN.
IF GF_VBAK_AP-KPEIN = 0.
GF_WRITE_A-NETPR = 0.
ELSE.
GF_WRITE_A-NETPR = HTANKA / GF_VBAK_AP-KPEIN.
ENDIF.
* Å™
*- 2002/01/09  PSD k.igarashi  ADD Å™
* 2002/02/01  PSD k.igarashi  ADD Å™

*   (˙A)éÛíçíPâøéÊìæ
* 2002/02/01  PSD k.igarashi  ADD Å´
*- 2002/01/30  PSD k.igarashi  ADD Å´
*    GF_WRITE_A-ZJNETPR = HTANKA * GF_VBAK_AP-STCUR.
*    GF_WRITE_A-ZJNETPR = HTANKA * GF_VBPA_KD-KURSK.
* Å´APPEND 2002/02/08 PSD M.Arai 0èúéZ¡™Ø∏í«â¡
*    GF_WRITE_A-ZJNETPR = HTANKA / GF_VBAK_AP-KPEIN * GF_VBPA_KD-KURSK.
IF GF_VBAK_AP-KPEIN = 0 OR
GF_VBPA_KD-KURSK = 0.
GF_WRITE_A-ZJNETPR = 0.
ELSE.
GF_WRITE_A-ZJNETPR = HTANKA / GF_VBAK_AP-KPEIN * GF_VBPA_KD-KURSK.
ENDIF.
* Å™
*- 2002/01/30  PSD k.igarashi  ADD Å™
* 2002/02/01  PSD k.igarashi  ADD Å™

*--- ÉE) éÛíçécã‡äz(ñ¢èoâ◊ã‡äz)ÇÃê›íË
GF_WRITE_A-ZMISHUKKA = GF_WRITE_A-MSHUKKO * GF_WRITE_A-ZJNETPR.

*--- APPEND PSD K.ARAI 2002/05/24
* ì`ï[É^ÉCÉvÇ™'RE''ZRE''KR'ÇÃéûÇÕÉ}ÉCÉiÉXÇPÇÇ©ÇØÇÈ
IF  ( GF_VBAK_AP-AUART = CNS_RE
OR GF_VBAK_AP-AUART = CNS_KR
OR GF_VBAK_AP-AUART = CNS_ZRE ).
GF_WRITE_A-ZMISHUKKA = GF_WRITE_A-ZMISHUKKA * -1 .
ENDIF.
*--- APPEND END.

*--- ÉG) édì¸êÊâÒìöî[ä˙ÇÃê›íË
CONCATENATE GF_VBAK_AP-VDATU+4(2)
'/'
GF_VBAK_AP-VDATU+6(2)
INTO KAKO_VDATU.
GF_WRITE_A-ZLKAITOU = KAKO_VDATU.

* 2002/01/23  PSD k.igarashi  ADD Å´
*--- ÉI) éÛíçì˙ïtÇÃê›íË
*    CONCATENATE GF_VBAK_AP-BSTDK+4(2)
*                '/'
*                GF_VBAK_AP-BSTDK+6(2)
*                INTO KAKO_BSTDK.
*    GF_WRITE_A-ZJUDAY = KAKO_BSTDK.

CONCATENATE GF_VBAK_AP-AUDAT+4(2)
'/'
GF_VBAK_AP-AUDAT+6(2)
INTO KAKO_BSTDK.
GF_WRITE_A-ZJUDAY = KAKO_BSTDK.
*---APPEND START PSD T.SAITOH 2002/09/12 ---------------------------*
* éÛíçì˙ÉtÉãåÖëŒâû
GF_WRITE_A-ZZJUDAY = GF_VBAK_AP-AUDAT.
*---APPEND END   PSD T.SAITOH 2002/09/12 ---------------------------*
* 2002/01/23  PSD k.igarashi  ADD Å™

*--- ÉJ) îÒï\é¶ópçÄñ⁄ÇÃê›íË
* (˙@) îÒâ¡çHçÄñ⁄ÇÃê›íË
GF_WRITE_A-MATNR  = GF_VBAK_AP-MATNR.
GF_WRITE_A-KDMAT  = GF_VBAK_AP-KDMAT.
GF_WRITE_A-NETWR  = GF_VBAK_AP-NETWR.
GF_WRITE_A-WAERS  = GF_VBAK_AP-WAERK.
GF_WRITE_A-AUART  = GF_VBAK_AP-AUART.
* 2002/01/30  PSD k.igarashi  ADD Å´
*    GF_WRITE_A-STCUR  = GF_VBAK_AP-STCUR.
GF_WRITE_A-STCUR  = GF_VBPA_KD-KURSK.
* 2002/01/30  PSD k.igarashi  ADD Å™
GF_WRITE_A-KBMENG = GF_VBAK_AP-KBMENG.

* 2002/01/09  PSD k.igarashi  ADD Å´
** (˙A) éÛíçã‡äz(â~åöÇƒ)ÇÃê›íË
*    GF_WRITE_A-ZNETWR = GF_WRITE_A-NETWR * GF_WRITE_A-STCUR.

** (˙B) å¥âø(â~åöÇƒ)ÇÃê›íË
*    GF_WRITE_A-ZGYEN = GF_VBAK_AP-WAVWR * GF_WRITE_A-STCUR.
*      WHEN 4.
*        MESSAGE S600(Z1) WITH text-024.
*        STOP.
*      WHEN 8.
*        MESSAGE A603(Z1) WITH SY-REPID CNS_VBAK_VBAP SY-SUBRC.
*    ENDCASE.

* (˙A) éÛíçã‡äz(â~åöÇƒ)ÇÃê›íË
CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_IDOC'
EXPORTING
CURRENCY    = GF_VBAK_AP-WAERK
SAP_AMOUNT  = GF_VBAK_AP-NETWR
IMPORTING
IDOC_AMOUNT = EN_JKINGAKU.

GF_WRITE_A-ZNETWR = EN_JKINGAKU * GF_WRITE_A-STCUR.

* (˙B) å¥âø(â~åöÇƒ)ÇÃê›íË
CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_IDOC'
EXPORTING
CURRENCY    = GF_VBAK_AP-WAERK
SAP_AMOUNT  = GF_VBAK_AP-WAVWR
IMPORTING
IDOC_AMOUNT = EN_GENKA.
* 2002/02/01  PSD k.igarashi  ADD Å´
*    GF_WRITE_A-ZGYEN = EN_GENKA * GF_WRITE_A-STCUR.
* Å´APPEND 2002/02/08 PSD M.Arai 0èúéZ¡™Ø∏í«â¡
*    GF_WRITE_A-ZGYEN = EN_GENKA / GF_VBAK_AP-KBMENG * GF_WRITE_A-STCUR.
* Mod 2003.09.01 --->
*    IF GF_VBAK_AP-KBMENG = 0 OR
IF GF_BUNSEKI_A-JUCHU = 0 OR
GF_WRITE_A-STCUR  = 0.
GF_WRITE_A-ZGYEN = 0.
ELSE.
*      GF_WRITE_A-ZGYEN = EN_GENKA / GF_VBAK_AP-KBMENG
GF_WRITE_A-ZGYEN = EN_GENKA / GF_BUNSEKI_A-JUCHU
* GF_WRITE_A-STCUR.
ENDIF.
* Mod 2003.09.01 <---

* 2002/02/01  PSD k.igarashi  ADD Å™

WHEN 4.
MESSAGE S600(Z1) WITH TEXT-024.
STOP.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_VBAK_VBAP SY-SUBRC.
ENDCASE.
* 2002/01/09  PSD k.igarashi  ADD Å™

ENDFORM.                    " frm_set_info_1j
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1k
*&---------------------------------------------------------------------*
*       2-3-á@-(k)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1K.

* 2002/01/14  PSD k.igarashi  ADD Å´
*    SELECT SINGLE
*      b~EBELN b~EBELP b~MENGE c~LLIEF
*     INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
*     FROM VBEP AS a INNER JOIN EKPO        AS b
*      ON a~BANFN = b~EBELN AND
*         a~BNFPO = b~EBELP INNER JOIN EKKO AS c
*      ON b~EBELN = c~EBELN
*     WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*     AND   a~POSNR = GF_BUNSEKI_A-POSNR
*     AND   a~ETENR = '0001'.

*    SELECT SINGLE
*      b~EBELN b~EBELP b~MENGE b~EVERS c~LLIEF
*     INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
*     FROM VBEP AS a INNER JOIN EKPO        AS b
*      ON a~BANFN = b~BANFN AND
*         a~BNFPO = b~BNFPO INNER JOIN EKKO AS c
*      ON b~EBELN = c~EBELN
*     WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*     AND   a~POSNR = GF_BUNSEKI_A-POSNR
*     AND   a~ETENR = '0001'.
* 2002/01/14  PSD k.igarashi  ADD Å™

* 2002/12/26  PSD k.igarashi  ADD Å´
*    SELECT SINGLE
*      b~EBELN b~EBELP b~MENGE b~EVERS c~LLIEF
*     INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
*     FROM VBEP AS a INNER JOIN EKPO        AS b
*      ON a~BANFN = b~BANFN AND
*         a~BNFPO = b~BNFPO INNER JOIN EKKO AS c
*      ON b~EBELN = c~EBELN
*     WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*     AND   a~POSNR = GF_BUNSEKI_A-POSNR
*     AND   a~ETENR = '0001'.

*    SELECT SINGLE
*      c~EBELN c~EBELP c~MENGE c~EVERS d~LLIEF
*     INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
*     FROM VBEP AS a INNER JOIN EKET        AS b
*      ON a~BANFN = b~BANFN AND
*         a~BNFPO = b~BNFPO INNER JOIN EKPO AS c
*      ON b~EBELN = c~EBELN AND
*         b~EBELP = c~EBELP INNER JOIN EKKO AS d
*      ON c~EBELN = d~EBELN
*     WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*     AND   a~POSNR = GF_BUNSEKI_A-POSNR
*     AND   a~ETENR = '0001'
*     AND   b~ETENR = '0001'
*     AND   a~BANFN <> ' '.
* 2002/12/26  PSD k.igarashi  ADD Å™

* 2002/01/09  PSD k.igarashi  ADD Å´
*    SELECT SINGLE
*      c~EBELN c~EBELP c~MENGE c~EVERS d~LLIEF
*     INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
*     FROM VBEP AS a INNER JOIN EKET        AS b
*      ON a~BANFN = b~BANFN AND
*         a~BNFPO = b~BNFPO INNER JOIN EKPO AS c
*      ON b~EBELN = c~EBELN AND
*         b~EBELP = c~EBELP INNER JOIN EKKO AS d
*      ON c~EBELN = d~EBELN
*     WHERE a~VBELN = GF_BUNSEKI_A-VBELN
*     AND   a~POSNR = GF_BUNSEKI_A-POSNR
*     AND   a~ETENR = '0001'
*     AND   b~ETENR = '0001'
*     AND   a~BANFN <> ' '.


SELECT SINGLE
C~EBELN C~EBELP C~MENGE C~EVERS D~LIFNR
INTO CORRESPONDING FIELDS OF GF_VBEP_EKPO
FROM VBEP AS A INNER JOIN EKET        AS B
ON A~BANFN = B~BANFN AND
A~BNFPO = B~BNFPO INNER JOIN EKPO AS C
ON B~EBELN = C~EBELN AND
B~EBELP = C~EBELP INNER JOIN EKKO AS D
ON C~EBELN = D~EBELN
WHERE A~VBELN = GF_BUNSEKI_A-VBELN
AND   A~POSNR = GF_BUNSEKI_A-POSNR
AND   A~ETENR = '0001'
AND   B~ETENR = '0001'
AND   A~BANFN <> ' '.
* 2002/01/09  PSD k.igarashi  ADD Å™

CASE SY-SUBRC.
WHEN 0.
PERFORM FRM_SET_INFO_1K_STEP1.
WHEN 4.
GF_VBEP_EKPO-EBELN = ' '.    "çwîÉî≠íçì`ï[
GF_VBEP_EKPO-EBELP = ' '.    "çwîÉî≠íçñæç◊
GF_VBEP_EKPO-MENGE = ' '.    "î≠íçêîó 
PERFORM FRM_SET_INFO_1K_STEP1.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_VBEP_EKPO_EKKO SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_set_info_1k
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1k_step1
*&---------------------------------------------------------------------*
*       2-3-á@-(k)-(ÉA)(ÉC)(ÉE)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1K_STEP1.

*--- ÉA) î≠íçî‘çÜÅAî≠íçñæç◊ÇÃê›íË
GF_WRITE_A-EBELN = GF_VBEP_EKPO-EBELN.
GF_WRITE_A-EBELP = GF_VBEP_EKPO-EBELP.
GF_WRITE_A-EVERS = GF_VBEP_EKPO-EVERS.

*--- ÉC) î≠íçécêîÅAî≠íçêîó (îÒï\é¶)ÅAì¸å…ç›å…(îÒï\é¶)ÇÃê›íË
SELECT SUM( WEMNG )
INTO NYUKOSU
FROM EKET
WHERE EBELN = GF_WRITE_A-EBELN
AND   EBELP = GF_WRITE_A-EBELP.

CASE SY-SUBRC.
WHEN 0.
PERFORM FRM_SET_INFO_1K_STEP2.
WHEN 4.
NYUKOSU = 0.
PERFORM FRM_SET_INFO_1K_STEP2.
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_EKET SY-SUBRC.
ENDCASE.

* 2002/01/09  PSD k.igarashi  ADD Å´
** (ÉE) édì¸êÊÇÃê›íË
*  SELECT SINGLE NAME1 FROM LFA1
*    INTO SHIIRESAKI
*    WHERE LIFNR = GF_VBEP_EKPO-LLIEF.
*
*  CASE SY-SUBRC.
*    WHEN 0.
*      GF_WRITE_A-ZLNAME = SHIIRESAKI.
*    WHEN 4.
**      MESSAGE S600(Z1) WITH text-022.    "ébíËìIÉRÉÅÉìÉg
*    WHEN 8.
*      MESSAGE A603(Z1) WITH SY-REPID CNS_LFA1 SY-SUBRC.
*  ENDCASE.

* (ÉE) édì¸êÊÇÃê›íË
SELECT SINGLE NAME1 FROM LFA1
INTO SHIIRESAKI
WHERE LIFNR = GF_VBEP_EKPO-LIFNR.

CASE SY-SUBRC.
WHEN 0.
GF_WRITE_A-ZLNAME = SHIIRESAKI.
WHEN 4.
*      MESSAGE S600(Z1) WITH text-022.    "ébíËìIÉRÉÅÉìÉg
WHEN 8.
MESSAGE A603(Z1) WITH SY-REPID CNS_LFA1 SY-SUBRC.
ENDCASE.
* 2002/01/09  PSD k.igarashi  ADD Å™

ENDFORM.                    " frm_set_info_1kstep1
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1k_step2
*&---------------------------------------------------------------------*
*       2-3-á@-(k)-(ÉC) î≠íçécêîÅAî≠íçêîó ÅAì¸å…êîó ÇÃê›íË
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1K_STEP2.

* (˙@) î≠íçécêî
GF_WRITE_A-HZNUM = GF_VBEP_EKPO-MENGE - NYUKOSU.
* (˙A) î≠íçêîó 
GF_WRITE_A-ZHMENGE = GF_VBEP_EKPO-MENGE.
* (˙B) ì¸å…êîó 
GF_WRITE_A-ZHWEMNG = NYUKOSU.
* (˙C) î≠íçêÊÉRÅ[Éh
GF_WRITE_A-LIFNR = GF_VBEP_EKPO-LIFNR.

ENDFORM.                    " frm_set_info_1k_step2
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1l
*&---------------------------------------------------------------------*
*       2-3-á@-(l)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1L.

CONCATENATE GF_BUNSEKI_A-NOUKI+4(2)
'/'
GF_BUNSEKI_A-NOUKI+6(2)
INTO KIBOHNOUKI.
GF_WRITE_A-ZKIBOU = KIBOHNOUKI.
*---APPEND START PSD T.SAITOH 2002/09/12 ---------------------------*
* äÛñ]î[ä˙ÉtÉãåÖê›íË
GF_WRITE_A-ZZKIBOU = GF_BUNSEKI_A-NOUKI.
*---APPEND END   PSD T.SAITOH 2002/09/12 ---------------------------*

ENDFORM.                    " frm_set_info_1l
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_1m
*&---------------------------------------------------------------------*
*       2-3-á@-(m)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_1M.

* èoâ◊éwé¶îıçlÇÃÉeÉLÉXÉgäiî[ópì‡ïîÇsÇaÇk
DATA: LF_TEXT LIKE TLINE,
LT_TEXT LIKE TABLE OF LF_TEXT.
DATA: NAME  LIKE THEAD-TDNAME.

CONCATENATE GF_BUNSEKI_A-VBELN
GF_BUNSEKI_A-POSNR
INTO NAME.

CALL FUNCTION 'READ_TEXT'
EXPORTING
ID                      = '9001'
LANGUAGE                = 'J'
NAME                    = NAME
OBJECT                  = 'VBBP'
TABLES
LINES                   = LT_TEXT
EXCEPTIONS
ID                      = 1
LANGUAGE                = 2
NAME                    = 3
NOT_FOUND               = 4
OBJECT                  = 5
REFERENCE_CHECK         = 6
WRONG_ACCESS_TO_ARCHIVE = 7
OTHERS                  = 8.

CASE SY-SUBRC.
WHEN 0.
READ TABLE LT_TEXT INTO LF_TEXT INDEX 1.
GF_WRITE_A-ZSETC = LF_TEXT-TDLINE+0(40).
WHEN 4.
* 2003/06/23 >>>>
WHEN 6.
MESSAGE I403(Z1) WITH GF_BUNSEKI_A-VBELN
'-'
GF_BUNSEKI_A-POSNR
'ÇÃîÃîÑÉeÉLÉXÉgÇ™Ç†ÇËÇ‹ÇπÇÒÅB'
.
* 2003/06/23 <<<<
WHEN OTHERS.
MESSAGE E001(Z1) WITH CNS_READTXT SY-SUBRC.
ENDCASE.

ENDFORM.                    " frm_set_info_1m
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_2a
*&---------------------------------------------------------------------*
*       2-3-áA•áB-(a)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_2A.

CASE CNS_X.
WHEN R_ZENSHA.
GF_WRITE_B-ZLISTID = '2'.                            "í†ï[ÇhÇc
WHEN R_EIGYOS.
GF_WRITE_B-ZLISTID = '3'.                            "í†ï[ÇhÇc
ENDCASE.

ENDFORM.                    " frm_set_info_2a
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_2b
*&---------------------------------------------------------------------*
*       2-3-áA•áB-(b)(âcã∆èäÉRÅ[ÉhÅEâcã∆èäñºÇÃê›íË)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_2B.

READ TABLE GT_EIGYOUSHO WITH KEY VKBUR = GF_BUNSEKI_B-VKBUR
INTO GF_EIGYOUSHO.

GF_WRITE_B-VKBUR = GF_EIGYOUSHO-VKBUR.          "âcã∆èäÉRÅ[Éh
GF_WRITE_B-BUBZI = GF_EIGYOUSHO-BEZEI.         "âcã∆èäñº

ENDFORM.                    " frm_set_info_2b
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_2c
*&---------------------------------------------------------------------*
*       2-3-áB-(c)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_2C.

READ TABLE GT_EIGYOUGRP WITH KEY VKGRP = GF_BUNSEKI_B-VKGRP
INTO GF_EIGYOUGRP.
*   âcã∆ÉOÉãÅ[Év
GF_WRITE_B-VKGRP = GF_EIGYOUGRP-VKGRP.
*   âcã∆ÉOÉãÅ[ÉvÉeÉLÉXÉg
GF_WRITE_B-GRBZI = GF_EIGYOUGRP-BEZEI.

ENDFORM.                    " frm_set_info_2c
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_2d
*&---------------------------------------------------------------------*
*       2-3-áA•áB-(d)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_2D.

DATA: LOOP_CNT TYPE P VALUE 1.
*--- APPEND PSD K.ARAI 2002/05/24
DATA: L_NETIMP  LIKE WMTO_S-AMOUNT, " éÛíçíPâø
L_NETINT  LIKE WMTO_S-AMOUNT.
*--- APPEND END

*--- MODIFY PSD K.ARAI 2002/05/24
L_NETINT = GF_BUNSEKI_B-NETPR.
*--- éÛíçíPâøÇÃéÊìæ
CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_DISPLAY'
EXPORTING
CURRENCY        = GF_BUNSEKI_B-WAERK
AMOUNT_INTERNAL = L_NETINT
IMPORTING
AMOUNT_DISPLAY  = L_NETIMP
EXCEPTIONS
INTERNAL_ERROR  = 1
OTHERS          = 2.
IF SY-SUBRC <> 0.
MESSAGE A502(Z1) WITH 'CURRENCY_AMOUNT_SAP_TO_DISPLAY'
SY-SUBRC.
ENDIF.

L_NETIMP = L_NETIMP / GF_BUNSEKI_B-KPEIN .

*--- (ÉA) éÛíçécã‡äzÇÃéÊìæ
*---MODIFY START PSD T.SAITOH 2002/08/30 ---------------------------*
* éÛíçécã‡äz = (éÛíçêîó  - èoâ◊çœêîó  - îÑè„çœêîó ) Å~ éÛíçíPâø(äOâ›)
*                                                   Å~ ä∑éZÉåÅ[Ég
*  H_JZANKINGAKU = ( GF_BUNSEKI_B-JUCHU - GF_BUNSEKI_B-MSHUKKO
*                   - GF_BUNSEKI_B-SEIKYU ) * L_NETIMP
*                   * GF_BUNSEKI_B-STCUR.

* éÛíçécã‡äz = (éÛíçêîó  - îÑè„çœêîó ) Å~ éÛíçíPâø(äOâ›)
*                                    Å~ ä∑éZÉåÅ[Ég
* add 2004/03/24 y.tsukahara start
* ÉåÅ[ÉgéÊìæ
CLEAR: WA_TCURR.
LOOP AT IT_TCURR INTO WA_TCURR
WHERE FCURR = GF_BUNSEKI_B-WAERK.
GF_BUNSEKI_B-STCUR = WA_TCURR-UKURS.
EXIT.
ENDLOOP.
* add 2004/03/24 y.tsukahara end
H_JZANKINGAKU = ( GF_BUNSEKI_B-JUCHU
-   GF_BUNSEKI_B-SEIKYU ) * L_NETIMP
*   GF_BUNSEKI_B-STCUR.

*---MODIFY END   PSD T.SAITOH 2002/08/30 ---------------------------*

* ì`ï[É^ÉCÉvÇ™'RE''ZRE''KR'ÇÃÇ∆Ç´ÇÕÉ}ÉCÉiÉXÇPÇÇ©ÇØÇÈ
IF  ( GF_BUNSEKI_B-AUART = CNS_RE
OR GF_BUNSEKI_B-AUART = CNS_KR
OR GF_BUNSEKI_B-AUART = CNS_ZRE ).
H_JZANKINGAKU = H_JZANKINGAKU * -1 .
ENDIF.
*  JZANKINGAKU = GF_BUNSEKI_B-KINGAKU1 - GF_BUNSEKI_B-KINGAKU5.
*--- MODIFY END

*--- DELETE PSD K.ARAI 2002/05/24
**--- (ÉC) éÛíçécã‡äzÇÃâøäiïœä∑
*CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_IDOC'
*  EXPORTING
*    CURRENCY          = GF_BUNSEKI_B-WAERK
*    SAP_AMOUNT        = JZANKINGAKU
* IMPORTING
*   IDOC_AMOUNT       = I_JZANKINGAKU.
**--- (ÉE) ñMâ›ä∑éZ
*    H_JZANKINGAKU = I_JZANKINGAKU * GF_BUNSEKI_B-STCUR.
*--- DELETE END

*--- (ÉG) éÛíçécã‡äzëŒè€åéÇÃê›íË
* ëŒè€åéÇÃê›íË(ÇP)
YEARS = SY-DATUM.  "GF_BUNSEKI_B-EDATU."+6(2).

DO.
CASE LOOP_CNT.
WHEN 1.
YEARS+6(2) = 1.
YEARS_1 = YEARS + 31.
WHEN 2.
YEARS_1+6(2) = 1.
YEARS_2 = YEARS_1 + 31.
WHEN 3.
YEARS_2+6(2) = 1.
YEARS_3 = YEARS_2 + 31.
ENDCASE.

LOOP_CNT = LOOP_CNT + 1.

IF LOOP_CNT = 4.
EXIT.
ENDIF.

ENDDO.

* éÛíçécã‡äz(ñMâ›)ÇÃê›íË
IF GF_BUNSEKI_B-EDATU+0(6) < SY-DATUM+0(6).                  "ëOåéà»ëO
LM_ZANKIN = H_JZANKINGAKU.
ELSEIF GF_BUNSEKI_B-EDATU+0(6) = SY-DATUM+0(6).                  "ìñåé
TM_ZANKIN = H_JZANKINGAKU.
ELSEIF GF_BUNSEKI_B-EDATU+0(6) = YEARS_1+0(6).                   "óÇåé
N1M_ZANKIN = H_JZANKINGAKU.
ELSEIF GF_BUNSEKI_B-EDATU+0(6) = YEARS_2+0(6).                 "óÇÅXåé
N2M_ZANKIN = H_JZANKINGAKU.
ELSEIF GF_BUNSEKI_B-EDATU+0(6) = YEARS_3+0(6).               "óÇÅXóÇåé
N3M_ZANKIN = H_JZANKINGAKU.
ELSEIF GF_BUNSEKI_B-EDATU+0(6) > YEARS_3+0(6).           "óÇÅXóÇåéà»ç~
N4M_ZANKIN = H_JZANKINGAKU.
ENDIF.

** óÇåéÇÃê›íË
*  YEARS = GF_BUNSEKI_B-EDATU."+6(2).
*
*  DO.
*    CASE LOOP_CNT.
*      WHEN 1.
*        YEARS+6(2) = 1.
*        YEARS_1 = YEARS + 31.
*      WHEN 2.
*        YEARS_1+6(2) = 1.
*        YEARS_2 = YEARS_1 + 31.
*      WHEN 3.
*        YEARS_2+6(2) = 1.
*        YEARS_3 = YEARS_2 + 31.
*    ENDCASE.
*
*    LOOP_CNT = LOOP_CNT + 1.
*
*    IF LOOP_CNT = 4.
*      EXIT.
*    ENDIF.
*
*  ENDDO.
*
* éÛíçécã‡äz(ñMâ›)ÇÃê›íË
*  IF GF_BUNSEKI_B-EDATU+0(6) < SY-DATUM+0(6).       "ëOåéà»ëO
*      LM_ZANKIN = H_JZANKINGAKU.
*  ELSEIF GF_BUNSEKI_B-EDATU+0(6) = SY-DATUM+0(6).   "ìñåé
*      TM_ZANKIN = H_JZANKINGAKU.
*  ELSEIF YEARS_1+0(6) = SY-DATUM+0(6).              "óÇåé
*      N1M_ZANKIN = H_JZANKINGAKU.
*  ELSEIF YEARS_2+0(6) = SY-DATUM+0(6).              "óÇÅXåé
*      N2M_ZANKIN = H_JZANKINGAKU.
*  ELSEIF YEARS_3+0(6) = SY-DATUM+0(6).              "óÇÅXóÇåé
*      N3M_ZANKIN = H_JZANKINGAKU.
*  ELSEIF YEARS_3+0(6) > SY-DATUM+0(6).              "óÇÅXóÇåéà»ç~
*      N4M_ZANKIN = H_JZANKINGAKU.
*  ENDIF.

*--- (ÉI) çáåvÇÃê›åv
GF_WRITE_B-ZGOUKEI = H_JZANKINGAKU.               "çáåv

ENDFORM.                    " frm_set_info_2d
*&---------------------------------------------------------------------*
*&      Form  frm_set_info_2e
*&---------------------------------------------------------------------*
*       2-3-áA•áB-(e)
*----------------------------------------------------------------------*
FORM FRM_SET_INFO_2E.

* í†ï[(âÔé–ÅEâcã∆èä)ÉfÅ[É^äiî[ópÉçÅ[ÉJÉãÉIÉuÉWÉFÉNÉg
DATA: LF_WRITE_B LIKE GF_WRITE_B.

* èâä˙âªèàóù
CLEAR: LF_WRITE_B-ZZENIZEN,
LF_WRITE_B-ZTOUGETU,
LF_WRITE_B-ZYOKGETU,
LF_WRITE_B-ZYYKGETU,
LF_WRITE_B-ZYYYGETU,
LF_WRITE_B-ZYYYIKOU.

CASE CNS_X.
WHEN R_ZENSHA.      "ëSé–ëIëéû
READ TABLE GT_WRITE_B WITH KEY VKBUR = GF_BUNSEKI_B-VKBUR
INTO LF_WRITE_B.
WHEN R_EIGYOS.      "âcã∆èäëIëéû
READ TABLE GT_WRITE_B WITH KEY
VKBUR = GF_BUNSEKI_B-VKBUR
VKGRP = GF_BUNSEKI_B-VKGRP INTO LF_WRITE_B.
ENDCASE.

CASE SY-SUBRC.
*--- (ÉC) ÉfÅ[É^Ç†ÇË
WHEN 0.
GF_WRITE_B-ZZENIZEN  = LM_ZANKIN + LF_WRITE_B-ZZENIZEN.
GF_WRITE_B-ZTOUGETU  = TM_ZANKIN + LF_WRITE_B-ZTOUGETU.
GF_WRITE_B-ZYOKGETU = N1M_ZANKIN + LF_WRITE_B-ZYOKGETU.
GF_WRITE_B-ZYYKGETU = N2M_ZANKIN + LF_WRITE_B-ZYYKGETU.
GF_WRITE_B-ZYYYGETU = N3M_ZANKIN + LF_WRITE_B-ZYYYGETU.
GF_WRITE_B-ZYYYIKOU = N4M_ZANKIN + LF_WRITE_B-ZYYYIKOU.
GF_WRITE_B-ZGOUKEI  = GF_WRITE_B-ZGOUKEI + LF_WRITE_B-ZGOUKEI.

MODIFY TABLE GT_WRITE_B FROM GF_WRITE_B.
*--- (ÉA) ÉfÅ[É^ñ≥Çµ
WHEN 4.
GF_WRITE_B-ZZENIZEN  = LM_ZANKIN.
GF_WRITE_B-ZTOUGETU  = TM_ZANKIN.
GF_WRITE_B-ZYOKGETU = N1M_ZANKIN.
GF_WRITE_B-ZYYKGETU = N2M_ZANKIN.
GF_WRITE_B-ZYYYGETU = N3M_ZANKIN.
GF_WRITE_B-ZYYYIKOU = N4M_ZANKIN.

APPEND GF_WRITE_B TO GT_WRITE_B.
ENDCASE.

ENDFORM.                    " frm_set_info_2e
*&---------------------------------------------------------------------*
*&      Form  frm_write_ichiran_a
*&---------------------------------------------------------------------*
*       2-4-á@ í†ï[èoóÕèàóù
*----------------------------------------------------------------------*
FORM FRM_WRITE_ICHIRAN_A.

* Ç`ÇkÇuâ¸ÉyÅ[ÉWä÷òAèàóù
PERFORM FRM_ALV_PAGE_NEXT.

* èâä˙ê›íË
GF_REPID = SY-REPID.

* ÉyÅ[ÉWêÿÇËë÷Ç¶ê›íË
GF_LAYOUT-GROUP_CHANGE_EDIT = CNS_JA.

CASE CNS_X.
WHEN R_EIGYOG.
GF_VARIANT-VARIANT = '/ZS010800_01'.           "âcã∆ÉOÉãÅ[ÉvëIëéû
WHEN R_EIGYOI.
GF_VARIANT-VARIANT = '/ZS010800_02'.                 "âcã∆àıëIëéû
ENDCASE.

* 2002/01/23  PSD k.igarashi  ADD Å´
*--- ì‡ïîÉeÅ[ÉuÉãïœä∑èàóù
GT_ALV_A[] = GT_WRITE_A[].
* 2002/01/23  PSD k.igarashi  ADD Å™

* 2002/01/17  PSD k.igarashi  ADD Å´
GF_LAYOUT-TOTALS_TEXT = 'çáåv'.
* 2002/01/17  PSD k.igarashi  ADD Å™

*---APPEND START PSD T.SAITOH 2002/03/19 ALVÉXÉeÅ[É^ÉXàÛç¸ãëî€ê›íË---*
GF_PRINT-NO_PRINT_LISTINFOS = CNS_X.
*---APPEND END   PSD T.SAITOH 2002/03/19 ---------------------------*

* í†ï[ÇÃèoóÕ
CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
EXPORTING
I_CALLBACK_PROGRAM             = GF_REPID              "ÉåÉ|Å[ÉgID
*      I_CALLBACK_TOP_OF_PAGE         = TOP_OF_PAGE          "G_HEAD_FRM
I_STRUCTURE_NAME               = 'ZSLIST_V08_01'             "ç\ë¢
IS_LAYOUT                      = GF_LAYOUT         "ÉåÉCÉAÉEÉgê›íË
*      IT_FIELDCAT                    = GT_FIELDCAT[]      "ÉJÉ^ÉçÉOê›íË
I_SAVE                         = 'A'               "ÉåÉCÉAÉEÉgï€ë∂
IS_VARIANT                     = GF_VARIANT
IT_EVENTS                      = GT_EVENT[]          "ÉCÉxÉìÉgê›íË
*---APPEND START PSD T.SAITOH 2002/03/19 ALVÉXÉeÅ[É^ÉXàÛç¸ãëî€ê›íË----*
IS_PRINT                       = GF_PRINT      "àÛç¸ê›íË
*---APPEND END   PSD T.SAITOH 2002/03/19 ---------------------------*
TABLES
* 2002/01/10  PSD k.igarashi  ADD Å´
*      T_OUTTAB                       = GT_WRITE_A          "TABLE_TYPE
T_OUTTAB                       = GT_ALV_A            "TABLE_TYPE
* 2002/01/10  PSD k.igarashi  ADD Å™
EXCEPTIONS
PROGRAM_ERROR                  = 1
OTHERS                         = 2.

IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.

ENDFORM.                    " frm_write_ichiran_a
*&---------------------------------------------------------------------*
*&      Form  frm_write_ichiran_b
*&---------------------------------------------------------------------*
*       2-4-áA í†ï[èoóÕèàóù
*----------------------------------------------------------------------*
FORM FRM_WRITE_ICHIRAN_B.

* Ç`ÇkÇuâ¸ÉyÅ[ÉWä÷òAèàóù
PERFORM FRM_ALV_PAGE_NEXT.

* èâä˙ê›íË
GF_REPID = SY-REPID.

* ÉyÅ[ÉWêÿÇËë÷Ç¶ê›íË
GF_LAYOUT-GROUP_CHANGE_EDIT = CNS_JA.

* 2002/01/23  PSD k.igarashi  ADD Å´
* ÉåÉCÉAÉEÉgê›íË
*  CASE CNS_X.
*    WHEN R_ZENSHA.
*      GF_VARIANT-VARIANT = '/ZS010800_03'.             "ëSé–ëIëéû
*    WHEN R_EIGYOS.
*      GF_VARIANT-VARIANT = '/ZS010800_04'.           "âcã∆èäëIëéû
*  ENDCASE.

IF R_ZENSHA = CNS_X.
GF_VARIANT-VARIANT = '/ZS010800_03'.             "ëSé–ëIëéû
ELSEIF R_EIGYOS = CNS_X.
GF_VARIANT-VARIANT = '/ZS010800_04'.           "âcã∆èäëIëéû
ENDIF.
* 2002/01/23  PSD k.igarashi  ADD Å™


* 2002/01/10  PSD k.igarashi  ADD Å´
*--- ì‡ïîÉeÅ[ÉuÉãïœä∑èàóù
GT_ALV_B[] = GT_WRITE_B[].
* 2002/01/10  PSD k.igarashi  ADD Å™

* 2002/01/17  PSD k.igarashi  ADD Å´
GF_LAYOUT-TOTALS_TEXT = 'çáåv'.
* 2002/01/17  PSD k.igarashi  ADD Å™

* í†ï[ÇÃèoóÕ
CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
EXPORTING
I_CALLBACK_PROGRAM             = GF_REPID              "ÉåÉ|Å[ÉgID
*      I_CALLBACK_TOP_OF_PAGE         = TOP_OF_PAGE           G_HEAD_FRM
I_STRUCTURE_NAME               = 'ZSLIST_V08_02'             "ç\ë¢
IS_LAYOUT                      = GF_LAYOUT         "ÉåÉCÉAÉEÉgê›íË
*      IT_FIELDCAT                    = GT_FIELDCAT[]      "ÉJÉ^ÉçÉOê›íË
I_SAVE                         = 'A'               "ÉåÉCÉAÉEÉgï€ë∂
IS_VARIANT                     = GF_VARIANT
IT_EVENTS                      = GT_EVENT[]          "ÉCÉxÉìÉgê›íË
TABLES
* 2002/01/10  PSD k.igarashi  ADD Å´
*      T_OUTTAB                       = GT_WRITE_B           "TABLE_TYPE
T_OUTTAB                       = GT_ALV_B            "TABLE_TYPE
* 2002/01/10  PSD k.igarashi  ADD Å™
EXCEPTIONS
PROGRAM_ERROR                  = 1
OTHERS                         = 2.

IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.

ENDFORM.                    " frm_write_ichiran_b
*&---------------------------------------------------------------------*
*&      Form  FRM_ALV_PAGE_NEXT
*&---------------------------------------------------------------------*
*       4-á@ â¸ÉyÅ[ÉWä÷òAèàóù
*----------------------------------------------------------------------*
FORM FRM_ALV_PAGE_NEXT.

* égópâ¬î\ÉCÉxÉìÉgÇÃÉ`ÉFÉbÉN
CALL FUNCTION 'REUSE_ALV_EVENTS_GET'
EXPORTING
I_LIST_TYPE     = 0
IMPORTING
ET_EVENTS       = GT_EVENT  "égópâ¬î\Ç»ÉCÉxÉìÉgéÊìæ
EXCEPTIONS
LIST_TYPE_WRONG = 1
OTHERS          = 2.

IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.

* 2002/01/10  PSD k.igarashi  ADD Å´
** égópÉCÉxÉìÉgÇ…é¿çsÇ∑ÇÈÉTÉuÉãÅ[É`ÉìñºÇê›íË
*  LOOP AT GT_EVENT INTO GS_EVENT WHERE NAME = CNS_TOP.
*      GS_EVENT-FORM = CNS_FTOP.  "FRM_TOP_OF_PAGE
*      MODIFY GT_EVENT FROM GS_EVENT.
*  ENDLOOP.

* égópÉCÉxÉìÉgÇ…é¿çsÇ∑ÇÈÉTÉuÉãÅ[É`ÉìñºÇê›íË
LOOP AT GT_EVENT INTO GF_EVENT.
CASE GF_EVENT-NAME.
WHEN 'TOP_OF_PAGE'.
GF_EVENT-FORM = 'FRM_TOP_OF_PAGE'.
MODIFY GT_EVENT FROM GF_EVENT.
WHEN 'CALLER_EXIT'.
GF_EVENT-FORM = 'FRM_CALLER_EXIT'.
MODIFY GT_EVENT FROM GF_EVENT.
ENDCASE.
ENDLOOP.
* 2002/01/10  PSD k.igarashi  ADD Å™

ENDFORM.                    " FRM_ALV_PAGE_NEXT
*&---------------------------------------------------------------------*
*&      Form  TOP_OF_PAGE
*&---------------------------------------------------------------------*
*       í†ï[ÉwÉbÉ_èëÇ´èoÇµèàóù
*----------------------------------------------------------------------*
FORM FRM_TOP_OF_PAGE.

DATA: L_SY-TABIX TYPE P.

L_SY-TABIX = SY-TABIX.

* 2002/01/10  PSD k.igarashi  ADD Å´
** í†ï[èoóÕÉ}ÉXÉ^Ç©ÇÁÉwÉbÉ_èÓïÒéÊìæ
*IF R_BALANC = CNS_X AND R_EIGYOG = CNS_X.
** 1ÉyÅ[ÉWñ⁄
*  IF SY-PAGNO = 1.
*    READ TABLE GT_WRITE_A INTO GF_HEADER_A INDEX 1.
*    WRITE: 42 text-026.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_A-VKBUR,'/',GF_HEADER_A-BUBZI,
*             text-020,':',GF_HEADER_A-VKGRP,'/',GF_HEADER_A-GRBZI.
* 2ÉyÅ[ÉWñ⁄à»ç~
*  ELSEIF SY-PAGNO >= 2.
*    READ TABLE GT_WRITE_A INTO GF_HEADER_A INDEX L_SY-TABIX.
*    WRITE: 42 text-026.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_A-VKBUR,'/',GF_HEADER_A-BUBZI,
*             text-020,':',GF_HEADER_A-VKGRP,'/',GF_HEADER_A-GRBZI.
*  ENDIF.
*ELSEIF R_BALANC = CNS_X AND R_EIGYOI = CNS_X.
** 1ÉyÅ[ÉWñ⁄
*  IF SY-PAGNO = 1.
*    READ TABLE GT_WRITE_A INTO GF_HEADER_A INDEX 1.
*    WRITE: 42 text-026.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_A-VKBUR,'/',GF_HEADER_A-BUBZI,
*             text-021,':',GF_HEADER_A-PERNR,'/',GF_HEADER_A-NACHN.
** 2ÉyÅ[ÉWñ⁄à»ç~
*  ELSEIF SY-PAGNO >= 2.
*    READ TABLE GT_WRITE_A INTO GF_HEADER_A INDEX L_SY-TABIX.
*    WRITE: 42 text-026.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_A-VKBUR,'/',GF_HEADER_A-BUBZI,
*             text-021,':',GF_HEADER_A-PERNR,'/',GF_HEADER_A-NACHN.
*  ENDIF.
*
*ELSEIF R_ZENSHA = CNS_X.
*  WRITE: 42 text-028.
*  SKIP.
*
*ELSEIF R_EIGYOS = CNS_X.
** 1ÉyÅ[ÉWñ⁄
*  IF SY-PAGNO = 1.
*    READ TABLE GT_WRITE_B INTO GF_HEADER_B INDEX 1.
*    WRITE :42 text-029.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_B-VKBUR,'/',GF_HEADER_B-BUBZI.
** 2ÉyÅ[ÉWñ⁄à»ç~
*  ELSEIF SY-PAGNO >= 2.
*    READ TABLE GT_WRITE_B INTO GF_HEADER_B INDEX L_SY-TABIX.
*    WRITE :42 text-029.
*    SKIP.
*    WRITE: / text-019,':',GF_HEADER_B-VKBUR,'/',GF_HEADER_B-BUBZI.
*  ENDIF.
*
*ENDIF.

* í†ï[èoóÕÉ}ÉXÉ^Ç©ÇÁÉwÉbÉ_èÓïÒéÊìæ
IF R_BALANC = CNS_X AND R_EIGYOG = CNS_X.
* 1ÉyÅ[ÉWñ⁄
IF SY-PAGNO = 1.
READ TABLE GT_ALV_A INTO GF_HEADER_A INDEX 1.
WRITE: 42 TEXT-026.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_A-VKBUR,'/',GT_ALV_A-BUBZI,
TEXT-020,':',GT_ALV_A-VKGRP,'/',GT_ALV_A-GRBZI.

* 2ÉyÅ[ÉWñ⁄à»ç~
ELSEIF SY-PAGNO >= 2.
READ TABLE GT_ALV_A INTO GF_HEADER_A INDEX L_SY-TABIX.
WRITE: 42 TEXT-026.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_A-VKBUR,'/',GT_ALV_A-BUBZI,
TEXT-020,':',GT_ALV_A-VKGRP,'/',GT_ALV_A-GRBZI.
ENDIF.

ELSEIF R_BALANC = CNS_X AND R_EIGYOI = CNS_X.
* 1ÉyÅ[ÉWñ⁄
IF SY-PAGNO = 1.
READ TABLE GT_ALV_A INTO GF_HEADER_A INDEX 1.
WRITE: 42 TEXT-026.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_A-VKBUR,'/',GT_ALV_A-BUBZI,
TEXT-021,':',GT_ALV_A-PERNR,'/',GT_ALV_A-NACHN.
* 2ÉyÅ[ÉWñ⁄à»ç~
ELSEIF SY-PAGNO >= 2.
READ TABLE GT_ALV_A INTO GF_HEADER_A INDEX L_SY-TABIX.
WRITE: 42 TEXT-026.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_A-VKBUR,'/',GT_ALV_A-BUBZI,
TEXT-021,':',GT_ALV_A-PERNR,'/',GT_ALV_A-NACHN.
ENDIF.

ELSEIF R_ZENSHA = CNS_X.
WRITE: 42 TEXT-028.
SKIP.

ELSEIF R_EIGYOS = CNS_X.
* 1ÉyÅ[ÉWñ⁄
IF SY-PAGNO = 1.
READ TABLE GT_ALV_B INTO GF_HEADER_B INDEX 1.
WRITE :42 TEXT-029.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_B-VKBUR,'/',GT_ALV_B-BUBZI.
* 2ÉyÅ[ÉWñ⁄à»ç~
ELSEIF SY-PAGNO >= 2.

*- 2002/01/23  PSD k.igarashi  ADD Å´
*    READ TABLE GT_ALV_B INTO GT_ALV_B INDEX L_SY-TABIX.
READ TABLE GT_ALV_B INTO GF_HEADER_B INDEX L_SY-TABIX.
*- 2002/01/23  PSD k.igarashi  ADD Å™

WRITE :42 TEXT-029.
SKIP.
WRITE: / TEXT-019,':',GT_ALV_B-VKBUR,'/',GT_ALV_B-BUBZI.
ENDIF.

ENDIF.
* 2002/01/10  PSD k.igarashi  ADD Å™

*---APPEND START PSD T.SAITOH 2002/08/08 ---------------------------*
*   ÉyÅ[ÉWî‘çÜïtâ¡
WRITE: 120 'PAGE:',SY-PAGNO."<<< 2002/08/15 èCê≥
*---APPEND END   PSD T.SAITOH 2002/08/08 ---------------------------*

ENDFORM.

************************************************************************
* ALV CALLER_EXITÅi 2002/01/10 PSD K.IGARASHI í«â¡ START Åj
***********************************************************************
FORM FRM_CALLER_EXIT USING RS_DATA TYPE SLIS_DATA_CALLER_EXIT.
RS_DATA-CALLBACK_HEADER_TRANSPORT = 'FILITEXTS_TEXT_TRANSPORT'.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  FRM_GET_VBKD_KURSK
*&---------------------------------------------------------------------*
*       ä∑éZÉåÅ[ÉgÇÃéÊìæ
*----------------------------------------------------------------------*
FORM FRM_GET_VBKD_KURSK.
SELECT SINGLE KURSK
FROM VBKD
INTO GF_VBAK_AP-STCUR
WHERE VBELN = GF_BUNSEKI_A-VBELN.

ENDFORM.                    " FRM_GET_VBKD_KURSK
*---APPEND START PSD T.SAITOH 2002/08/30 ---------------------------*
*&---------------------------------------------------------------------*
*&      Form  FRM_SET_ORDER_ACOUNT
*&---------------------------------------------------------------------*
*       í«â¡ÅFéÛíçécã‡äzÇÃê›íË
*----------------------------------------------------------------------*
FORM FRM_SET_ORDER_ACOUNT.

DATA:L_KINGAKU1(9) TYPE P,"éÛíçã‡äz
L_KINGAKU5(9) TYPE P."îÑè„çœÇ›ã‡äz
* add 2004/03/24 y.tsukahara start
DATA: L_RATE TYPE TCURR-UKURS VALUE 1,
L_NETPR TYPE VBAP-NETPR,   "ê≥ñ°âøäi
L_KPEIN TYPE VBAP-KPEIN,   "âøäièåèíPà 
L_TANKA TYPE WMTO_S-AMOUNT."ïœä∑å„ê≥ñ°âøäi
* add 2004/03/24 y.tsukahara end
* äeã‡äzÇâøäiïœä∑
PERFORM FRM_KINGAKU_HENKAN USING    GF_BUNSEKI_A-WAERK
GF_BUNSEKI_A-KINGAKU1
CHANGING L_KINGAKU1.
PERFORM FRM_KINGAKU_HENKAN USING    GF_BUNSEKI_A-WAERK
GF_BUNSEKI_A-KINGAKU5
CHANGING L_KINGAKU5.

*--- (ÉA) éÛíçécã‡äzÇÃåvéZ
* mod 2004/03/24 y.tsukahara start
*  H_JZANKINGAKU = L_KINGAKU1 "éÛíçã‡äz
*                - L_KINGAKU5."îÑè„çœã‡äz

SELECT SINGLE NETPR KPEIN FROM VBAP INTO (L_NETPR,L_KPEIN)
WHERE VBELN = GF_BUNSEKI_A-VBELN
AND POSNR = GF_BUNSEKI_A-POSNR.
IF ( SY-SUBRC <> 0 ).
MESSAGE S400(Z1) WITH 'íPâøÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÇ≈ÇµÇΩ'.
STOP.
ENDIF.
PERFORM FRM_KINGAKU_HENKAN USING    GF_BUNSEKI_A-WAERK
L_NETPR
CHANGING L_TANKA.

L_TANKA = L_TANKA / L_KPEIN.

CLEAR: WA_TCURR.
* ÉåÅ[ÉgéÊìæ
IF ( GF_BUNSEKI_A-WAERK <> 'JPY' ).
LOOP AT IT_TCURR INTO WA_TCURR WHERE FCURR = GF_BUNSEKI_A-WAERK.
L_RATE = WA_TCURR-UKURS.
EXIT.
ENDLOOP.
ENDIF.

H_JZANKINGAKU = ( GF_BUNSEKI_A-JUCHU -  GF_BUNSEKI_A-SEIKYU )
* L_TANKA * L_RATE.
* mod 2004/03/24 y.tsukahara end

* ì`ï[É^ÉCÉvÇ™'RE''ZRE''KR'ÇÃÇ∆Ç´ÇÕÉ}ÉCÉiÉXÇPÇÇ©ÇØÇÈ
IF  ( GF_BUNSEKI_A-AUART = CNS_RE
OR GF_BUNSEKI_A-AUART = CNS_KR
OR GF_BUNSEKI_A-AUART = CNS_ZRE ).
H_JZANKINGAKU = H_JZANKINGAKU * -1 .
ENDIF.

*--- éÛíçécã‡äzÇÃê›íË
GF_WRITE_A-ZGOUKEI = H_JZANKINGAKU.
ENDFORM.                    " frm_set_info_2dÇÃÉRÉsÅ[
*&---------------------------------------------------------------------*
*&      Form  FRM_KINGAKU_HENKAN
*&---------------------------------------------------------------------*
*       ã‡äzïœä∑èàóù
*----------------------------------------------------------------------*
*      -->P_TSUKACD  í â›ÉRÅ[Éh
*      -->P_KINGAKU  ïœä∑ëOã‡äz
*      <--P_HENKAN   ïœä∑å„ã‡äz
*----------------------------------------------------------------------*
FORM FRM_KINGAKU_HENKAN USING    P_TSUKACD
P_KINGAKU
CHANGING P_HENKAN.
DATA : L_AMOUNT_DIS TYPE WMTO_S-AMOUNT,
L_AMOUNT_INT TYPE WMTO_S-AMOUNT.
L_AMOUNT_INT = P_KINGAKU.
*--- îƒópÉÇÉWÉÖÅ[Éãã‡äzïœä∑ÉÇÉWÉÖÅ[Éã
CALL FUNCTION 'CURRENCY_AMOUNT_SAP_TO_DISPLAY'
EXPORTING
CURRENCY        = P_TSUKACD
AMOUNT_INTERNAL = L_AMOUNT_INT
IMPORTING
AMOUNT_DISPLAY  = L_AMOUNT_DIS
EXCEPTIONS
INTERNAL_ERROR  = 1
OTHERS          = 2.
IF SY-SUBRC <> 1.
P_HENKAN = L_AMOUNT_DIS.
ENDIF.

ENDFORM.                    " FRM_KINGAKU_HENKAN

*---APPEND END   PSD T.SAITOH 2002/08/30 ---------------------------*
*&---------------------------------------------------------------------*
*&      Form  get_rate
*&---------------------------------------------------------------------*
* ÉåÅ[ÉgÉeÅ[ÉuÉãéÊìæ
*----------------------------------------------------------------------*
FORM GET_RATE.
* ÉçÅ[ÉJÉãïœêîêÈåæ
DATA: L_DATE TYPE TCURR-GDATU.

CALL FUNCTION 'CONVERSION_EXIT_INVDT_INPUT'
EXPORTING
INPUT  = SY-DATUM
IMPORTING
OUTPUT = L_DATE.

SELECT * FROM TCURR INTO TABLE IT_TCURR
WHERE KURST = 'M'
AND   TCURR = 'JPY'
AND   GDATU >= L_DATE.

IF ( SY-SUBRC <> 0 ).
MESSAGE S400(Z1) WITH 'ä∑éZÉåÅ[ÉgéÊìæÉGÉâÅ['.
STOP.
ELSE.
SORT IT_TCURR BY FCURR GDATU.
ENDIF.
ENDFORM.                    " get_rate

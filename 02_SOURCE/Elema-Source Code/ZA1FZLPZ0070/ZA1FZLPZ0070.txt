REPORT ZLPZ0070 NO STANDARD PAGE HEADING LINE-COUNT 90 LINE-SIZE 120.
* 画 面 定 義
SELECTION-SCREEN SKIP 1.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT  1(33) TEXT-001.
PARAMETERS: NENNSU(4) DEFAULT SY-DATUM(4) OBLIGATORY.
SELECTION-SCREEN COMMENT 40(02) TEXT-002.
PARAMETERS: STHIDU LIKE SY-DATUM+4(2) DEFAULT SY-DATUM+4(2)
OBLIGATORY.
SELECTION-SCREEN COMMENT 46(06) TEXT-003.
PARAMETERS: ENHIDU LIKE SY-DATUM+4(2).
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN SKIP 1.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT  1(33) TEXT-008.
PARAMETERS: STWARK LIKE TFAVT-IDENT.
SELECTION-SCREEN COMMENT 46(06) TEXT-009.
PARAMETERS: ENWARK LIKE TFAVT-IDENT.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT  1(33) TEXT-004.
PARAMETERS: STKANJ LIKE SKAT-SAKNR MATCHCODE OBJECT SAKO.
SELECTION-SCREEN COMMENT 46(06) TEXT-005.
PARAMETERS: ENKANJ LIKE SKAT-SAKNR MATCHCODE OBJECT SAKO.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN SKIP 1.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT  1(33) TEXT-006.
PARAMETERS: SOUKN AS CHECKBOX.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT  1(33) TEXT-007.
PARAMETERS: HOJYO AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN SKIP 1.
PARAMETERS: PRINT LIKE TSP01-RQDEST OBLIGATORY.
PARAMETERS: WK-BUKRS like t001-bukrs .
PARAMETERS: WK-KTOPL like t001-KTOPL .
* ------------------------------------------------------------------ *
TABLES: BSIS,BSAS,TFAVT,TFAVW,SKAT,GLT0,SKA1,TSP03.
*<no.020313 N.Takahashi add S>---------------------------------------
*{   DELETE         TEDK906558                                        1
*\TABLES : ZCONT.
*}   DELETE
*<no.020313 N.Takahashi add E>---------------------------------------
* ------------------------------------------------------------------ *
DATA: BEGIN OF INDATA OCCURS 1000,
INDEX     TYPE I,                        " 種別 KEY
BUDAT(08) TYPE C,                        " 日    付
LTEXT(50) TYPE C,                        " 摘    要
KARIK(15) TYPE P,                        " 借方金額
KASIK(15) TYPE P,                        " 貸方金額
HKONT     LIKE BSIS-HKONT,
END OF INDATA.
*
DATA: BEGIN OF TLDATA OCCURS 1000,
INDEX     TYPE I,                        " 種別 KEY
FRAGS(01) TYPE C,                        " P/L年期
TITOL(50) TYPE C,                        " タイトル
ZANKI(15) TYPE P,                        " 残高金額
HKONT     LIKE BSIS-HKONT,
END OF TLDATA.
*
DATA: BEGIN OF BSISX OCCURS 1000,              " BSIS,BSAS用内部ﾃｰﾌﾞﾙ
BUKRS LIKE BSIS-BUKRS,                   " 会社ｺｰﾄﾞ
BELNR LIKE BSIS-BELNR,                   " 参照伝票番号
GJAHR LIKE BSIS-GJAHR,                   " 会計年度
SHKZG LIKE BSIS-SHKZG,                   " 借方/貸方ﾌﾗｸﾞ
DMBTR LIKE BSIS-DMBTR,                   " 国内通貨額
HKONT LIKE BSIS-HKONT,                   " 勘定ｺｰﾄﾞ
SGTXT LIKE BSIS-SGTXT,                   " 明細ﾃｷｽﾄ
BUDAT LIKE BSIS-BUDAT,                   " 転記日付
END OF BSISX.
*
DATA: BEGIN OF SKATX OCCURS 1000,              " SKAT用内部ﾃｰﾌﾞﾙ
SAKNR LIKE SKAT-SAKNR,                   " 勘定ｺｰﾄﾞ
TXT50 LIKE SKAT-TXT50,                   " 勘定ﾃｷｽﾄ（長）
END OF SKATX.
* ---------------------------------------------------------------- *
DATA  WK-ENDAT     TYPE D.                     " 日付検索用
DATA: SUM-KARIK(15) TYPE P,                    " 借方合計用
SUM-KASIK(15) TYPE P,                    " 貸方合計用
SUM-ZANKI(15) TYPE P,                    " 残高金額用
SUM-HIKAR(15) TYPE P,                    " 借方日毎合計
SUM-HIKAS(15) TYPE P.                    " 貸方日毎合計
*
DATA: OUT-HOKAR(19) TYPE C,                    " 補助借方表示
OUT-HOKAS(19) TYPE C,                    " 補助貸方表示
OUT-SOKAR(19) TYPE C,                    " 総勘借方表示
OUT-SOKAS(19) TYPE C,                    " 総勘貸方表示
OUT-KARGO(19) TYPE C,                    " 借方合計表示
OUT-KASGO(19) TYPE C,                    " 貸方合計表示
OUT-ZANKI(19) TYPE C.                    " 残高金額表示
*
DATA: WK-STDAT(08) TYPE C,                     " 日付検索用
WK-BUDAT(08) TYPE C,                     " 日付累計検出
WK-NENNS(04) TYPE C,                     " 年の検索用
WK-TUKIS(02) TYPE C.                     " 残高ﾃﾞｰﾀ検出月
*
DATA: WK-INDEX(04) TYPE C,                     " 見出しｶｳﾝﾀ
WK-COUNT     TYPE I,                     " 種別 KEY-ｶｳﾝﾀ
WK-COUNS     TYPE I.                     " 出力 KEY-ｶｳﾝﾀ
*
DATA  WK-LTEXT(50) TYPE C.                     " 摘要欄用ﾜｰｸ
DATA  WK-FLAGS(01) TYPE C.                     " 勘定科目変更ﾌﾗｸﾞ
DATA  WK-PRINT(04) TYPE C.                     " 出力先ﾌﾟﾘﾝﾀｰ
DATA  WK-IDENT(10) TYPE C.                     " ﾜｰｸﾘｽﾄ制御
DATA  WK-HSL00(16) TYPE P.                     " 合計残高金額
DATA  WK-KRZAN(16) TYPE P.                     " 当月ﾃﾞｰﾀなし残高
DATA  WK-LINES     TYPE I.                     " 1ﾍﾟｰｼﾞﾗｲﾝ数
DATA  WK-KRFLA     TYPE I.                     " ﾃﾞｰﾀなし残高登録
DATA  WK-DMBTR LIKE BSIS-DMBTR.                " 金額用ﾜｰｸ

DATA  WK-HKONT LIKE BSIS-HKONT.

* ------------------------------------------------------------------ *
*    画  面 入  力  値  チ ェ ッ ク
* ------------------------------------------------------------------ *
SELECT COUNT(*) FROM TSP03 WHERE PADEST = PRINT.
IF SY-SUBRC = 4 .
WRITE:/ '**************************************'.
WRITE:/ '  入力されたプリンタ−が見つかりません。'.
WRITE:/ '**************************************'.
STOP.
ENDIF.
IF NOT STHIDU BETWEEN 1 AND 12.
WRITE:/ '*********************************************'.
WRITE:/ '  開始月は１月〜１２月までを指定して下さい。    '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( NOT ENHIDU BETWEEN 1 AND 12 ) AND ENHIDU <> SPACE.
WRITE:/ '*********************************************'.
WRITE:/ '  終了月は１月〜１２月までを指定して下さい。    '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF STHIDU = ENHIDU.
WRITE:/ '*********************************************'.
WRITE:/ '  開始月と終了月が同じ指定は出来ません。        '.
WRITE:/ '  開始月と終了月の指定は１２ヶ月の範囲内です。  '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF NENNSU < '1900'.
WRITE:/ '*********************************************'.
WRITE:/ '  1900年以下の指定は出来ません。               '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF SOUKN = 'X' AND HOJYO = 'X'.
WRITE:/ '*********************************************'.
WRITE:/ '  出力帳票は一方しか選択出来ません。            '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF SOUKN = SPACE AND HOJYO = SPACE.
WRITE:/ '*********************************************'.
WRITE:/ '  出力帳票をどちらか一方選択して下さい。       '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( STWARK = SPACE AND ENWARK = SPACE )
AND ( STKANJ = SPACE AND ENKANJ = SPACE ).
WRITE:/ '*********************************************'.
WRITE:/ '  ﾜｰｸﾘｽﾄ又は勘定科目ｺｰﾄﾞを指定して下さい。     '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( STWARK <> SPACE OR ENWARK <> SPACE )
AND ( STKANJ <> SPACE OR ENKANJ <> SPACE ).
WRITE:/ '*********************************************'.
WRITE:/ '  ﾜｰｸﾘｽﾄ又は勘定科目ｺｰﾄﾞはどちらか一方         '.
WRITE:/ '                          を指定して下さい。  '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( STWARK = SPACE AND ENWARK = SPACE AND ENKANJ <> SPACE )
AND ( STKANJ > ENKANJ ).
WRITE:/ '*********************************************'.
WRITE:/ '  勘定科目ｺｰﾄﾞはｺｰﾄﾞが小さい方から             '.
WRITE:/ '                  大きい方に指定して下さい。   '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( STKANJ = SPACE AND ENKANJ = SPACE AND  ENWARK <> SPACE )
AND ( STWARK > ENWARK ).
WRITE:/ '*********************************************'.
WRITE:/ '  ワークリストはｺｰﾄﾞが小さい方から             '.
WRITE:/ '                  大きい方に指定して下さい。   '.
WRITE:/ '*********************************************'.
STOP.
ELSEIF ( STWARK = SPACE AND ENWARK = SPACE )
AND ( STKANJ = SPACE AND ENKANJ <> SPACE ).
MOVE ENKANJ TO STKANJ.
ELSEIF STWARK = SPACE AND STKANJ <> SPACE AND ENKANJ = SPACE.
MOVE STKANJ TO ENKANJ.
ELSEIF ( STWARK = SPACE AND ENWARK <> SPACE )
AND ( STKANJ = SPACE AND ENKANJ = SPACE ).
MOVE ENWARK TO STWARK.
ELSEIF ( STWARK <> SPACE AND ENWARK = SPACE )
AND ( STKANJ = SPACE AND ENKANJ = SPACE ).
MOVE STWARK TO ENWARK.
ENDIF.
* ------------------------------------------------------------------ *
*     主    処    理
* ------------------------------------------------------------------ *
START-OF-SELECTION.

PERFORM HIDUKEH-GET.
IF STWARK <> SPACE AND STKANJ = SPACE AND ENKANJ = SPACE.
SELECT * FROM TFAVT
WHERE IDENT BETWEEN STWARK AND ENWARK
AND SPRAS = 'J' AND OBJCT = 'SAKNR'.
SELECT * FROM TFAVW
WHERE OBJCT = TFAVT-OBJCT AND IDENT = TFAVT-IDENT.
CHECK TFAVW-VALUE <> SPACE.
MOVE '1' TO WK-FLAGS.
PERFORM KENSYUTU-DAT USING TFAVW-VALUE.
ENDSELECT.
IF WK-KRFLA = 1.
MOVE TFAVT-LTEXT TO TLDATA-TITOL.
MOVE WK-COUNT    TO TLDATA-INDEX.
MOVE WK-KRZAN    TO TLDATA-ZANKI.
TLDATA-HKONT = TFAVW-VALUE.
APPEND TLDATA.
CLEAR: WK-KRFLA,WK-KRZAN.
ELSE.
ADD 1 TO WK-COUNT.
MOVE TFAVT-LTEXT TO TLDATA-TITOL.
MOVE WK-COUNT    TO TLDATA-INDEX.
MOVE WK-KRZAN    TO TLDATA-ZANKI.
TLDATA-HKONT = TFAVW-VALUE.
APPEND TLDATA.
MOVE WK-COUNT    TO INDATA-INDEX.
MOVE SPACE       TO INDATA-BUDAT.
MOVE SPACE       TO INDATA-LTEXT.
CLEAR: INDATA-KARIK,INDATA-KASIK.
INDATA-HKONT = TFAVW-VALUE.
APPEND INDATA.
CLEAR  WK-KRZAN.
ENDIF.
ENDSELECT.
IF SY-SUBRC = 0 AND WK-COUNT > 0.
PERFORM PRINT-SET.
PERFORM PRINT-DAT.
ELSE.
WRITE:/ '************************************'.
WRITE:/ ' 対象データが見つかりませんでした。'.
WRITE:/ '************************************'.
ENDIF.
ELSEIF STWARK = SPACE AND ( STKANJ <> SPACE OR ENKANJ <> SPACE ).
SELECT SAKNR TXT50 FROM SKAT
INTO TABLE SKATX
WHERE SAKNR BETWEEN STKANJ AND ENKANJ AND KTOPL = WK-KTOPL
AND SPRAS = 'J'.
*
LOOP AT SKATX.
ADD   1  TO WK-COUNT.
MOVE '1' TO WK-FLAGS.
PERFORM KENSYUTU-DAT USING SKATX-SAKNR.
ENDLOOP.
IF SY-SUBRC = 0 AND WK-COUNT > 0.
PERFORM PRINT-SET.
PERFORM PRINT-DAT.
ELSE.
WRITE:/ '************************************'.
WRITE:/ ' 対象データが見つかりませんでした。'.
WRITE:/ '************************************'.
ENDIF.
ENDIF.
END-OF-SELECTION.
* ------------------------------------------------------------------ *
*  ﾃﾞｰﾀ検出の開始日付から終了日付を得る
* ------------------------------------------------------------------ *
FORM HIDUKEH-GET.
IF STHIDU <> SPACE AND ENHIDU = SPACE.
CONCATENATE NENNSU STHIDU '01' INTO WK-STDAT.
MOVE WK-STDAT TO WK-ENDAT.
IF WK-ENDAT+4(2) = '12'.
WK-ENDAT(4) = WK-ENDAT(4) + 1.
WK-ENDAT+4(2) = '01'.
ELSE.
WK-ENDAT+4(2) = WK-ENDAT+4(2) + 1.
ENDIF.
WK-ENDAT = WK-ENDAT - 1.
ELSE.
IF STHIDU < ENHIDU.
CONCATENATE NENNSU STHIDU '01' INTO WK-STDAT.
CONCATENATE NENNSU ENHIDU '01' INTO WK-ENDAT.
ELSE.
CONCATENATE NENNSU STHIDU '01' INTO WK-STDAT.
NENNSU = NENNSU + 1.
CONCATENATE NENNSU ENHIDU '01' INTO WK-ENDAT.
NENNSU = NENNSU - 1.
ENDIF.
IF WK-ENDAT+4(2) = '12'.
WK-ENDAT(4) = WK-ENDAT(4) + 1.
WK-ENDAT+4(2) = '01'.
ELSE.
WK-ENDAT+4(2) = WK-ENDAT+4(2) + 1.
ENDIF.
WK-ENDAT = WK-ENDAT - 1.
ENDIF.
ENDFORM.
* ------------------------------------------------------------------ *
*     データ検出サブルーチン
* ------------------------------------------------------------------ *
FORM KENSYUTU-DAT USING WK-KANJYO.
SELECT BUKRS BELNR GJAHR SHKZG DMBTR HKONT SGTXT BUDAT FROM BSIS
INTO TABLE BSISX
WHERE HKONT = WK-KANJYO
AND BUDAT BETWEEN WK-STDAT AND WK-ENDAT
*<no.020313 N.Takahashi modi S>--------------------------------------
*       AND BUKRS = 'MECL'.
AND BUKRS = wk-bukrs.
*<no.020313 N.Takahashi modi E>--------------------------------------

SELECT BUKRS BELNR GJAHR SHKZG DMBTR HKONT SGTXT BUDAT FROM BSAS
APPENDING TABLE BSISX
WHERE HKONT = WK-KANJYO
AND BUDAT BETWEEN WK-STDAT AND WK-ENDAT
*<no.020313 N.Takahashi modi S>--------------------------------------
*       AND BUKRS = 'MECL'.
AND BUKRS = wk-bukrs.
*<no.020313 N.Takahashi modi E>--------------------------------------
SORT BSISX BY HKONT BUDAT.
*
LOOP AT BSISX.
MOVE BSISX-DMBTR TO WK-DMBTR.
MOVE BSISX-SGTXT TO WK-LTEXT.
MOVE '1' TO WK-KRFLA.
IF STWARK <> SPACE AND TFAVT-IDENT <> WK-IDENT.
ADD 1 TO WK-COUNT.
MOVE TFAVT-IDENT TO WK-IDENT.
ENDIF.
PERFORM INPUT-DAT USING BSISX-SHKZG BSISX-BUDAT.
ENDLOOP.
IF SY-SUBRC <> 0.
IF STWARK <> SPACE.
PERFORM ZANDAKA-GET USING WK-KANJYO.
WK-KRZAN = WK-KRZAN + WK-HSL00.
ELSE.
PERFORM ZANDAKA-GET USING WK-KANJYO.
WK-KRZAN = WK-KRZAN + WK-HSL00.
MOVE SKATX-TXT50 TO TLDATA-TITOL.
MOVE WK-COUNT    TO TLDATA-INDEX.
MOVE WK-KRZAN    TO TLDATA-ZANKI.
TLDATA-HKONT = WK-KANJYO.
APPEND TLDATA.
MOVE WK-COUNT    TO INDATA-INDEX.
MOVE SPACE       TO INDATA-BUDAT.
MOVE SPACE       TO INDATA-LTEXT.
CLEAR: INDATA-KARIK,INDATA-KASIK.
INDATA-HKONT = WK-KANJYO.
APPEND INDATA.
CLEAR  WK-KRZAN.
ENDIF.
ENDIF.
CLEAR BSISX.
REFRESH BSISX.
ENDFORM.
* ------------------------------------------------------------------ *
*    データ入力サブルーチン
* ------------------------------------------------------------------ *
FORM INPUT-DAT USING WK-SHKZG WK-BUDAT.
IF WK-FLAGS = '1'.
IF STWARK <> SPACE.
MOVE TFAVT-LTEXT TO TLDATA-TITOL.
ELSE.
MOVE SKATX-TXT50  TO TLDATA-TITOL.
ENDIF.
MOVE WK-COUNT   TO TLDATA-INDEX.
PERFORM ZANDAKA-GET USING BSISX-HKONT.
TLDATA-ZANKI = WK-HSL00.

TLDATA-HKONT = BSISX-HKONT.

APPEND TLDATA.
ENDIF.
MOVE WK-COUNT   TO INDATA-INDEX.
MOVE WK-BUDAT   TO INDATA-BUDAT.
MOVE WK-LTEXT   TO INDATA-LTEXT.
CASE WK-SHKZG.
WHEN 'S'.
INDATA-KARIK = WK-DMBTR * 100.
INDATA-KASIK = 0.
WHEN 'H'.
INDATA-KASIK = WK-DMBTR * 100.
INDATA-KARIK = 0.
ENDCASE.

INDATA-HKONT = BSISX-HKONT.

APPEND INDATA.
CLEAR: WK-DMBTR,WK-FLAGS.
CLEAR: TLDATA,INDATA.
ENDFORM.
* ------------------------------------------------------------------ *
*     残高会得サブルーチン
* ------------------------------------------------------------------ *
FORM ZANDAKA-GET USING WK-HKONT.
DATA  WK-NENNS(04) TYPE C.                  " 検出年数
*<no.020313 N.Takahashi modi S　XX月度残高のXXのコメント変更>-----------
DATA: WK-HSLVT(16) TYPE P,                  " 前期残高繰越
WK-HSL01(16) TYPE P,                  " ０４月度残高
WK-HSL02(16) TYPE P,                  " ０５月度残高
WK-HSL03(16) TYPE P,                  " ０６月度残高
WK-HSL04(16) TYPE P,                  " ０７月度残高
WK-HSL05(16) TYPE P,                  " ０８月度残高
WK-HSL06(16) TYPE P,                  " ０９月度残高
WK-HSL07(16) TYPE P,                  " １０月度残高
WK-HSL08(16) TYPE P,                  " １１月度残高
WK-HSL09(16) TYPE P,                  " １２月度残高
WK-HSL10(16) TYPE P,                  " ０１月度残高
WK-HSL11(16) TYPE P.                  " ０２月度残高
*<no.020313 N.Takahashi modi E>-----------------------------------------
*<no.020313 N.Takahashi modi S>-----------------------------------------
*   IF STHIDU < 6.
IF STHIDU < 4.
*<no.020313 N.Takahashi modi E>-----------------------------------------
WK-NENNS = NENNSU - 1.
ELSE.
WK-NENNS = NENNSU.
ENDIF.
SELECT * FROM GLT0
*<no.020313 N.Takahashi modi S>-----------------------------------------
*     WHERE RACCT = WK-HKONT AND BUKRS = 'MECL'
WHERE RACCT = WK-HKONT AND BUKRS = wk-bukrs
*<no.020313 N.Takahashi modi E>-----------------------------------------

AND RYEAR = WK-NENNS AND RLDNR = '00'
AND ( DRCRK = 'S' OR DRCRK = 'H' )
ORDER BY DRCRK.
WK-HSLVT = WK-HSLVT + ( GLT0-HSLVT * 100 ).
WK-HSL01 = WK-HSL01 + ( GLT0-HSL01 * 100 ).
WK-HSL02 = WK-HSL02 + ( GLT0-HSL02 * 100 ).
WK-HSL03 = WK-HSL03 + ( GLT0-HSL03 * 100 ).
WK-HSL04 = WK-HSL04 + ( GLT0-HSL04 * 100 ).
WK-HSL05 = WK-HSL05 + ( GLT0-HSL05 * 100 ).
WK-HSL06 = WK-HSL06 + ( GLT0-HSL06 * 100 ).
WK-HSL07 = WK-HSL07 + ( GLT0-HSL07 * 100 ).
WK-HSL08 = WK-HSL08 + ( GLT0-HSL08 * 100 ).
WK-HSL09 = WK-HSL09 + ( GLT0-HSL09 * 100 ).
WK-HSL10 = WK-HSL10 + ( GLT0-HSL10 * 100 ).
WK-HSL11 = WK-HSL11 + ( GLT0-HSL11 * 100 ).
ENDSELECT.
*
SELECT SINGLE * FROM SKA1
WHERE SAKNR = WK-HKONT AND KTOPL = WK-KTOPL.
CASE STHIDU.
*<no.020313 N.Takahashi modi S 会計期間の変更>--------------------------
*      WHEN '06'.
WHEN '04'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT.
ELSE.
WK-HSL00 = 0.
TLDATA-FRAGS = 1.
ENDIF.
*      WHEN '07'.
WHEN '05'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01.
ELSE.
WK-HSL00 = WK-HSL01.
ENDIF.
*      WHEN '08'.
WHEN '06'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02.
ELSE.
WK-HSL00 = WK-HSL01 + WK-HSL02.
ENDIF.
*      WHEN '09'.
WHEN '07'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03.
ELSE.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03.
ENDIF.
*      WHEN '10'.
WHEN '08'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04.
ELSE.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04.
ENDIF.
*      WHEN '11'.
WHEN '09'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05.
ELSE.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04
+ WK-HSL05.
ENDIF.
*      WHEN '12'.
WHEN '10'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06.
ELSE.
*           WK-HSL00 = 0.
*           TLDATA-FRAGS = 1.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04
+ WK-HSL05 + WK-HSL06.
ENDIF.
*      WHEN '01'.
WHEN '11'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06 + WK-HSL07.
ELSE.
*           WK-HSL00 = WK-HSL07.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04
+ WK-HSL05 + WK-HSL06 + WK-HSL07.
ENDIF.
*      WHEN '02'.
WHEN '12'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08.
ELSE.
*           WK-HSL00 = WK-HSL07 + WK-HSL08.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04
+ WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08.
ENDIF.
*      WHEN '03'.
WHEN '01'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08
+ WK-HSL09.
ELSE.
*           WK-HSL00 = WK-HSL07 + WK-HSL08 + WK-HSL09.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03 + WK-HSL04
+ WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08 + WK-HSL09.
ENDIF.
*      WHEN '04'.
WHEN '02'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08
+ WK-HSL09 + WK-HSL10.
ELSE.
*           WK-HSL00 = WK-HSL07 + WK-HSL08 + WK-HSL09 + WK-HSL10.
WK-HSL00 = WK-HSL01 + WK-HSL02 + WK-HSL03  + WK-HSL04
+ WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08  + WK-HSL09
+ WK-HSL10.
ENDIF.
*      WHEN '05'.
WHEN '03'.
IF SKA1-XBILK = 'X'.
WK-HSL00 = WK-HSLVT + WK-HSL01 + WK-HSL02 + WK-HSL03
+ WK-HSL04 + WK-HSL05 + WK-HSL06 + WK-HSL07 + WK-HSL08
+ WK-HSL09 + WK-HSL10 + WK-HSL11.
ELSE.
*           WK-HSL00 = WK-HSL07 + WK-HSL08 + WK-HSL09 + WK-HSL10
*         + WK-HSL11.
WK-HSL00 = WK-HSL08 + WK-HSL09 + WK-HSL10 + WK-HSL11.
ENDIF.
*<no.020313 N.Takahashi modi E 会計期間の変更>--------------------------
ENDCASE.
.

ENDFORM.
* ------------------------------------------------------------------ *
*     プ リ ン タ − 設  定
* ------------------------------------------------------------------ *
FORM PRINT-SET.
MOVE PRINT TO WK-PRINT.
NEW-PAGE PRINT ON DESTINATION WK-PRINT
LAYOUT 'X_90_120'
LIST NAME 'SOUKAN'
IMMEDIATELY 'X'
KEEP IN SPOOL 'X'
NO DIALOG.
ENDFORM.
* ------------------------------------------------------------------ *
*    データ出力サブルーチン
* ------------------------------------------------------------------ *
FORM PRINT-DAT.

DATA : CHK-KURI,
CHK-FLG       TYPE I,
SUM-WZANK(15) TYPE P.

DATA : SUM-WKARI(15) TYPE P,
SUM-WKASI(15) TYPE P.
CLEAR: WK-COUNS.
WHILE WK-COUNS <= WK-COUNT.
CLEAR: SUM-ZANKI.
CLEAR : CHK-FLG.
ADD 1 TO WK-COUNS.
IF STWARK <> SPACE.
SORT TLDATA BY TITOL.
LOOP AT TLDATA WHERE INDEX = WK-COUNS.

CHK-FLG = CHK-FLG + TLDATA-FRAGS.
SUM-WZANK = SUM-WZANK + TLDATA-ZANKI.
IF TLDATA-HKONT BETWEEN 40000 AND 89999.
SUM-ZANKI = SUM-ZANKI + ( TLDATA-ZANKI * -1 ).
ELSE.
SUM-ZANKI = SUM-ZANKI + TLDATA-ZANKI.
ENDIF.

ENDLOOP.
ELSE.
LOOP AT TLDATA WHERE INDEX = WK-COUNS.

CHK-FLG = CHK-FLG + TLDATA-FRAGS.
SUM-WZANK = TLDATA-ZANKI.
IF TLDATA-HKONT BETWEEN 40000 AND 89999.
SUM-ZANKI =  ( TLDATA-ZANKI * -1 ).
ELSE.
SUM-ZANKI =  TLDATA-ZANKI.
ENDIF.

ENDLOOP.
ENDIF.
SORT INDATA BY BUDAT KARIK KASIK.
LOOP AT INDATA WHERE INDEX = WK-COUNS.
IF INDATA-BUDAT = SPACE.
NEW-PAGE.
CLEAR: WK-LINES.
PERFORM SENTARING-DAT.
IF SOUKN = 'X'.
WRITE:/1 '（総勘定元帳）'.
ELSE.
WRITE:/1 '（補助簿）'.
ENDIF.
WRITE:/ SY-ULINE(120).
WRITE:/ SY-VLINE,2'日 付',7 SY-VLINE,
8 '         摘                            要',
60 SY-VLINE,63 '借  方   金  額',80 SY-VLINE,
83 '貸  方   金  額',100 SY-VLINE,
103 '残  高   金  額',120 SY-VLINE.
WRITE: SY-ULINE(120).
LOOP AT TLDATA WHERE INDEX = WK-COUNS.
ENDLOOP.
CLEAR CHK-KURI.
*<no.020313 N.Takahashi modi S 会計期間の変更>--------------------------
*            IF ( STHIDU = '06' OR STHIDU = '12' )
* AND CHK-FLG = 0.
IF STHIDU = '04' AND CHK-FLG = 0.
*<no.020313 N.Takahashi modi E 会計期間の変更>--------------------------
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,2 STHIDU,4 '/',5 '01',
7 SY-VLINE,8 '前期より繰越',60 SY-VLINE.
CHK-KURI = 1.
*<no.020313 N.Takahashi modi S 会計期間の変更>--------------------------
*            ELSEIF ( STHIDU <> '06' AND STHIDU <> '12' ).
ELSEIF STHIDU <> '04'.
*<no.020313 N.Takahashi modi E 会計期間の変更>--------------------------
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,2 STHIDU,4 '/',5 '01',
7 SY-VLINE,8 '前月より繰越',60 SY-VLINE.
CHK-KURI = 1.
ENDIF.
IF CHK-KURI = 1.
IF SUM-WZANK < 0.
IF SUM-WZANK = SUM-ZANKI.
SUM-KASIK = ( 0 - SUM-ZANKI ).
ELSE.
SUM-KASIK = SUM-ZANKI.
ENDIF.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-ZANKI.
WRITE: 79 '0',80 SY-VLINE,81 OUT-ZANKI,100 SY-VLINE.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
ELSE.
SUM-KARIK = SUM-ZANKI.
WRITE: 61 OUT-ZANKI, 80 SY-VLINE,99 '0',
100 SY-VLINE.
ENDIF.
WRITE: 101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
ELSE.
*
IF HOJYO = 'X'. ADD 1 TO WK-LINES. ENDIF.
IF INDATA-INDEX <> WK-INDEX OR WK-LINES > 35.
IF WK-LINES > 35.
PERFORM KINGAKU-HEN USING SUM-KARIK OUT-KARGO.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-KASGO.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,7 SY-VLINE,8'次ページへ',60 SY-VLINE,
61 OUT-KARGO,80 SY-VLINE,81 OUT-KASGO,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ENDIF.
IF SOUKN <> 'X' OR WK-LINES <> 1.
NEW-PAGE.
CLEAR: WK-LINES.
PERFORM SENTARING-DAT.
IF SOUKN = 'X'.
WRITE:/1 '（総勘定元帳）'.
ELSE.
WRITE:/1 '（補助簿）'.
ENDIF.
WRITE:/ SY-ULINE(120).
WRITE:/ SY-VLINE,2'日 付',7 SY-VLINE,
8 '         摘                            要',
60 SY-VLINE,63 '借  方   金  額',80 SY-VLINE,
83 '貸  方   金  額',100 SY-VLINE,
103 '残  高   金  額',120 SY-VLINE.
WRITE: SY-ULINE(120).
IF OUT-KARGO <> SPACE OR OUT-KASGO <> SPACE.
WRITE:/ SY-VLINE,7 SY-VLINE,8 '前ページより',
60 SY-VLINE,61 OUT-KARGO,80 SY-VLINE,
81 OUT-KASGO,100 SY-VLINE,101 OUT-ZANKI,
120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
LOOP AT TLDATA WHERE INDEX = WK-COUNS.
ENDLOOP.
CLEAR CHK-KURI.
IF INDATA-INDEX <> WK-INDEX
*<no.020313 N.Takahashi modi S 会計期間の変更>--------------------------
*                   AND ( STHIDU = '06' OR STHIDU = '12' )
* AND CHK-FLG = 0.
AND STHIDU = '04' AND CHK-FLG = 0.
*<no.020313 N.Takahashi modi E 会計期間の変更>--------------------------
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,2 STHIDU,4 '/',5 '01',
7 SY-VLINE,8 '前期より繰越',60 SY-VLINE.
CHK-KURI = 1.
ELSEIF INDATA-INDEX <> WK-INDEX
*<no.020313 N.Takahashi modi S 会計期間の変更>--------------------------
*                  AND ( STHIDU <> '06' AND STHIDU <> '12' ).
AND STHIDU <> '04'.
*<no.020313 N.Takahashi modi E 会計期間の変更>--------------------------
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,2 STHIDU,4 '/',5 '01',
7 SY-VLINE,8 '前月より繰越',60 SY-VLINE.
CHK-KURI = 1.
ENDIF.
IF CHK-KURI = 1.
IF SUM-WZANK < 0.
IF SUM-WZANK = SUM-ZANKI.
SUM-KASIK = ( 0 - SUM-ZANKI ).
ELSE.
SUM-KASIK = SUM-ZANKI.
ENDIF.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-ZANKI.
WRITE: 79 '0',80 SY-VLINE,81 OUT-ZANKI,100 SY-VLINE.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
ELSE.
SUM-KARIK = SUM-ZANKI.
WRITE: 61 OUT-ZANKI, 80 SY-VLINE,99 '0',
100 SY-VLINE.
ENDIF.
WRITE: 101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
IF SOUKN = 'X'.
MOVE INDATA-BUDAT TO WK-BUDAT.
ENDIF.
MOVE INDATA-INDEX TO WK-INDEX.
ENDIF.
ENDIF.
IF SOUKN = 'X'.
IF INDATA-BUDAT = WK-BUDAT.
SUM-HIKAR = SUM-HIKAR + INDATA-KARIK.
SUM-HIKAS = SUM-HIKAS + INDATA-KASIK.

IF INDATA-HKONT BETWEEN 40000 AND 89999.
SUM-WKARI = SUM-WKARI - INDATA-KARIK.
SUM-WKASI = SUM-WKASI + INDATA-KASIK.
ELSE.
SUM-WKARI = SUM-WKARI + INDATA-KARIK.
SUM-WKASI = SUM-WKASI - INDATA-KASIK.
ENDIF.

ELSE.

SUM-ZANKI = SUM-ZANKI + SUM-WKARI.
SUM-KARIK = SUM-KARIK + SUM-HIKAR.
IF SUM-HIKAR <> 0.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
PERFORM KINGAKU-HEN USING SUM-HIKAR OUT-SOKAR.
WRITE:/ SY-VLINE,2 WK-BUDAT+4(2),4 '/',
5 WK-BUDAT+6(2),7 SY-VLINE,60 SY-VLINE,
61 OUT-SOKAR,80 SY-VLINE,99 '0',100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
IF WK-LINES > 35.
PERFORM KINGAKU-HEN USING SUM-KARIK OUT-KARGO.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-KASGO.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,7 SY-VLINE,8'次ページへ',60 SY-VLINE,
61 OUT-KARGO,80 SY-VLINE,81 OUT-KASGO,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
NEW-PAGE.
CLEAR: WK-LINES.
PERFORM SENTARING-DAT.
WRITE:/1 '（総勘定元帳）'.
WRITE:/ SY-ULINE(120).
WRITE:/ SY-VLINE,2'日 付',7 SY-VLINE,
8 '         摘                            要',
60 SY-VLINE,63 '借  方   金  額',80 SY-VLINE,
83 '貸  方   金  額',100 SY-VLINE,
103 '残  高   金  額',120 SY-VLINE.
WRITE: SY-ULINE(120).
WRITE:/ SY-VLINE,7 SY-VLINE,8'前ページより',
60 SY-VLINE,61 OUT-KARGO,80 SY-VLINE,
81 OUT-KASGO,100 SY-VLINE,101 OUT-ZANKI,
120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
MOVE INDATA-INDEX TO WK-INDEX.
ENDIF.

SUM-ZANKI = SUM-ZANKI + SUM-WKASI.
SUM-KASIK = SUM-KASIK + SUM-HIKAS.
IF SUM-HIKAS <> 0.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
PERFORM KINGAKU-HEN USING SUM-HIKAS OUT-SOKAS.
WRITE:/ SY-VLINE,2 WK-BUDAT+4(2),4 '/',
5 WK-BUDAT+6(2),7 SY-VLINE,60 SY-VLINE,79 '0',
80 SY-VLINE,81 OUT-SOKAS,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
CLEAR: SUM-HIKAR,SUM-HIKAS.
CLEAR : SUM-WKARI, SUM-WKASI.
MOVE INDATA-BUDAT TO WK-BUDAT.
SUM-HIKAR = SUM-HIKAR + INDATA-KARIK.
SUM-HIKAS = SUM-HIKAS + INDATA-KASIK.
IF INDATA-HKONT BETWEEN 40000 AND 89999.
SUM-WKARI = SUM-WKARI - INDATA-KARIK.
SUM-WKASI = SUM-WKASI + INDATA-KASIK.
ELSE.
SUM-WKARI = SUM-WKARI + INDATA-KARIK.
SUM-WKASI = SUM-WKASI - INDATA-KASIK.
ENDIF.
ENDIF.
ELSE.

IF INDATA-HKONT BETWEEN 40000 AND 89999.
SUM-ZANKI = SUM-ZANKI - INDATA-KARIK + INDATA-KASIK.
ELSE.
SUM-ZANKI = SUM-ZANKI + INDATA-KARIK - INDATA-KASIK.
ENDIF.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
PERFORM KINGAKU-HEN USING INDATA-KARIK OUT-HOKAR.
PERFORM KINGAKU-HEN USING INDATA-KASIK OUT-HOKAS.
WRITE:/ SY-VLINE,2 INDATA-BUDAT+4(2),4 '/',
5 INDATA-BUDAT+6(2),7 SY-VLINE,8 INDATA-LTEXT,
60 SY-VLINE,61 OUT-HOKAR,80 SY-VLINE,
81 OUT-HOKAS,100 SY-VLINE,101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
SUM-KARIK = SUM-KARIK + INDATA-KARIK.
SUM-KASIK = SUM-KASIK + INDATA-KASIK.
ENDIF.
ENDIF.
ENDLOOP.
IF SY-SUBRC = 0.
IF SOUKN = 'X' AND ( SUM-HIKAR <> 0 OR SUM-HIKAS <> 0 ).
IF WK-LINES > 35.
PERFORM KINGAKU-HEN USING SUM-KARIK OUT-KARGO.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-KASGO.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,7 SY-VLINE,8'次ページへ',60 SY-VLINE,
61 OUT-KARGO,80 SY-VLINE,81 OUT-KASGO,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
NEW-PAGE.
CLEAR: WK-LINES.
PERFORM SENTARING-DAT.
WRITE:/1 '（総勘定元帳）'.
WRITE:/ SY-ULINE(120).
WRITE:/ SY-VLINE,2'日 付',7 SY-VLINE,
8 '         摘                            要',
60 SY-VLINE,63 '借  方   金  額',80 SY-VLINE,
83 '貸  方   金  額',100 SY-VLINE,
103 '残  高   金  額',120 SY-VLINE.
WRITE: SY-ULINE(120).
WRITE:/ SY-VLINE,7 SY-VLINE,8'前ページより',
60 SY-VLINE,61 OUT-KARGO,80 SY-VLINE,
81 OUT-KASGO,100 SY-VLINE,101 OUT-ZANKI,
120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
MOVE INDATA-INDEX TO WK-INDEX.
ENDIF.

SUM-ZANKI = SUM-ZANKI + SUM-WKARI.
SUM-KARIK = SUM-KARIK + SUM-HIKAR.

IF SUM-HIKAR <> 0.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
PERFORM KINGAKU-HEN USING SUM-HIKAR OUT-SOKAR.
WRITE:/ SY-VLINE,2 WK-BUDAT+4(2),4 '/',
5 WK-BUDAT+6(2),7 SY-VLINE,60 SY-VLINE,
61 OUT-SOKAR,80 SY-VLINE,99 '0',100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
IF WK-LINES > 35.
PERFORM KINGAKU-HEN USING SUM-KARIK OUT-KARGO.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-KASGO.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,7 SY-VLINE,8'次ページへ',60 SY-VLINE,
61 OUT-KARGO,80 SY-VLINE,81 OUT-KASGO,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
NEW-PAGE.
CLEAR: WK-LINES.
PERFORM SENTARING-DAT.
WRITE:/1 '（総勘定元帳）'.
WRITE:/ SY-ULINE(120).
WRITE:/ SY-VLINE,2'日 付',7 SY-VLINE,
8 '         摘                            要',
60 SY-VLINE,63 '借  方   金  額',80 SY-VLINE,
83 '貸  方   金  額',100 SY-VLINE,
103 '残  高   金  額',120 SY-VLINE.
WRITE: SY-ULINE(120).
WRITE:/ SY-VLINE,7 SY-VLINE,8'前ページより',
60 SY-VLINE,61 OUT-KARGO,80 SY-VLINE,
81 OUT-KASGO,100 SY-VLINE,101 OUT-ZANKI,
120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
MOVE INDATA-INDEX TO WK-INDEX.
ENDIF.

SUM-ZANKI = SUM-ZANKI + SUM-WKASI.
SUM-KASIK = SUM-KASIK + SUM-HIKAS.

IF SUM-HIKAS <> 0.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
PERFORM KINGAKU-HEN USING SUM-HIKAS OUT-SOKAS.
WRITE:/ SY-VLINE,2 WK-BUDAT+4(2),4 '/',
5 WK-BUDAT+6(2),7 SY-VLINE,60 SY-VLINE,
79 '0',80 SY-VLINE,81 OUT-SOKAS,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDIF.
ENDIF.
IF SOUKN = 'X'.
WHILE WK-LINES < 36.
WRITE:/ SY-VLINE,7 SY-VLINE,60 SY-VLINE,80 SY-VLINE,
100 SY-VLINE,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDWHILE.
ELSE.
WHILE WK-LINES < 35.
WRITE:/ SY-VLINE,7 SY-VLINE,60 SY-VLINE,80 SY-VLINE,
100 SY-VLINE,120 SY-VLINE.
WRITE: SY-ULINE(120).
ADD 1 TO WK-LINES.
ENDWHILE.
ENDIF.
PERFORM KINGAKU-HEN USING SUM-KARIK OUT-KARGO.
PERFORM KINGAKU-HEN USING SUM-KASIK OUT-KASGO.
PERFORM KINGAKU-HEN USING SUM-ZANKI OUT-ZANKI.
WRITE:/ SY-VLINE,7 SY-VLINE,8 '合   計',60 SY-VLINE,
61 OUT-KARGO,80 SY-VLINE,81 OUT-KASGO,100 SY-VLINE,
101 OUT-ZANKI,120 SY-VLINE.
WRITE: SY-ULINE(120).
CLEAR: WK-LINES,SUM-KARIK,SUM-KASIK,SUM-HIKAR,SUM-HIKAS,
OUT-KARGO,OUT-KASGO.
CLEAR : SUM-WKARI, SUM-WKASI.
ENDIF.
ENDWHILE.
ENDFORM.
* -------------------------------------------------------- *
*    表題のセンタリング表示
* -------------------------------------------------------- *
FORM SENTARING-DAT.
DATA: WK-CNT01     TYPE I,                 " 文 　字 　数
WK-CNT02     TYPE I,                 " 書込文字位置
WK-WARKS(01) TYPE C.                 " ワークエリア
DO.
MOVE TLDATA-TITOL+WK-CNT01(01) TO WK-WARKS.
IF WK-WARKS <> ' ' OR WK-CNT01 > 49.
ADD 1 TO WK-CNT01.
ELSE.
EXIT.
ENDIF.
ENDDO.
WK-CNT02 = 61 - ( WK-CNT01 / 2 ).
POSITION WK-CNT02. WRITE TLDATA-TITOL.
ENDFORM.
* ----------------------------------------------------------- *
*   数値カンマ＆マイナス編集．
* ----------------------------------------------------------- *
FORM KINGAKU-HEN USING SUM-KARIK WK-KNGAK.
DATA: WK-CNT01     TYPE I,                   " 取出文字位置
WK-CNT02     TYPE I,                   " 書込文字位置
WK-WARKS(01) TYPE C,                   " ワークエリア
WK-KNDAT(19) TYPE C.                   " 変更前データ
CLEAR WK-KNGAK.
IF SUM-KARIK > 999999999999999 OR SUM-KARIK < -999999999999999.
MOVE '*******************' TO WK-KNGAK.
EXIT.
ENDIF.
MOVE SUM-KARIK TO WK-KNDAT.
WK-CNT01 = 17. WK-CNT02 = 18.
DO.
MOVE WK-KNDAT+WK-CNT01(01) TO WK-WARKS.
IF WK-WARKS <> ' '.
IF WK-CNT02 = 15 OR WK-CNT02 = 11 OR WK-CNT02 = 7
OR WK-CNT02 = 3.
MOVE ',' TO WK-KNGAK+WK-CNT02(1).
SUBTRACT 1 FROM WK-CNT02.
ENDIF.
MOVE WK-WARKS TO WK-KNGAK+WK-CNT02(1).
SUBTRACT 1 FROM WK-CNT02.
SUBTRACT 1 FROM WK-CNT01.
ELSE.
EXIT.
ENDIF.
ENDDO.
IF WK-KNDAT+18(01) = '-' AND WK-CNT02 => 0.
MOVE '-' TO WK-KNGAK+WK-CNT02(1).
ENDIF.
ENDFORM.

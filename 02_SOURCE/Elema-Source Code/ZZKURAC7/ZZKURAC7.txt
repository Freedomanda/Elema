Report ZB010300 .



Tables : S902 .

Data : T_S902 Type Table Of S902 ,
W_S902 Type S902 ,
T_READ Type Table Of S902 ,
W_READ Type S902 .




Parameters : P_FILE Type LOCALFILE .

Parameters : P_TEST As CheckBox .



Start-Of-Selection .


Perform File_Read .
Perform Data_Check .


Form File_Read .
Call Function 'WS_UPLOAD'
EXPORTING
FILENAME                      = P_FILE
FILETYPE                      = 'DAT'
TABLES
DATA_TAB                      = T_READ
EXCEPTIONS
CONVERSION_ERROR              = 1
FILE_OPEN_ERROR               = 2
FILE_READ_ERROR               = 3
INVALID_TYPE                  = 4
NO_BATCH                      = 5
UNKNOWN_ERROR                 = 6
INVALID_TABLE_WIDTH           = 7
GUI_REFUSE_FILETRANSFER       = 8
CUSTOMER_ERROR                = 9
OTHERS                        = 10
.
If SY-SUBRC NE 0 .
Message I209(Z1) .
Stop .
EndIf .

EndForm .


Form Data_Check .
Select *
From S902
Into Table T_S902
For All Entries In T_READ
Where VRSIO EQ T_READ-VRSIO
And  SPMON EQ T_READ-SPMON
And  VKORG EQ T_READ-VKORG
And  VKBUR EQ T_READ-VKBUR
And  VKGRP EQ T_READ-VKGRP
And  KDGRP EQ T_READ-KDGRP
And  ZZKUNNR1C EQ T_READ-ZZKUNNR1C
And  PKUNAG EQ T_READ-PKUNAG
And  PRODH EQ T_READ-PRODH
And  MATKL EQ T_READ-MATKL
And  MATNR EQ T_READ-MATNR .

Loop At T_READ Into W_READ .
Move : SY-MANDT To W_READ-MANDT .
Write :/ W_READ-VRSIO ,
W_READ-SPMON ,
W_READ-VKORG ,
W_READ-VKBUR ,
W_READ-VKGRP ,
W_READ-KDGRP ,
W_READ-ZZKUNNR1C ,
W_READ-PKUNAG ,
W_READ-PRODH ,
W_READ-MATKL ,
W_READ-MATNR .
Call Function 'CONVERSION_EXIT_ALPHA_INPUT'
Exporting
INPUT         = W_READ-PKUNAG
Importing
OUTPUT        = W_READ-PKUNAG
.
Call Function 'CONVERSION_EXIT_MATN1_INPUT'
EXPORTING
INPUT              = W_READ-MATNR
IMPORTING
OUTPUT             = W_READ-MATNR
EXCEPTIONS
LENGTH_ERROR       = 1
OTHERS             = 2
.
Call Function 'CONVERSION_EXIT_CUNIT_INPUT'
EXPORTING
INPUT                = W_READ-VRKME
LANGUAGE             = SY-LANGU
IMPORTING
OUTPUT               = W_READ-VRKME
EXCEPTIONS
UNIT_NOT_FOUND       = 1
OTHERS               = 2
.
IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.

IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
ENDIF.
If W_READ-STWAE EQ 'JPY' .
Divide : W_READ-NETWR By 100 ,
W_READ-WAVWR By 100 ,
W_READ-ZZARAIGAKU By 100 .
EndIf .



Modify T_READ From W_READ .
Loop At T_S902 Into W_S902 Where VRSIO EQ W_READ-VRSIO
And  SPMON EQ W_READ-SPMON
And  VKORG EQ W_READ-VKORG
And  VKBUR EQ W_READ-VKBUR
And  VKGRP EQ W_READ-VKGRP
And  PKUNAG EQ W_READ-PKUNAG
And  KDGRP EQ W_READ-KDGRP
And  ZZKUNNR1C EQ W_READ-ZZKUNNR1C
And  PRODH EQ W_READ-PRODH
And  MATNR EQ W_READ-MATNR .
EndLoop .
If W_S902 EQ W_READ .
Write : '変更なし' .
Else .
Write : / '変更前:' ,
W_S902-NETWR CURRENCY W_S902-STWAE ,
W_S902-WAVWR CURRENCY W_S902-STWAE ,
W_S902-ZZARAIGAKU CURRENCY W_S902-STWAE .

Write : / '変更後:' ,
W_READ-NETWR CURRENCY W_READ-STWAE ,
W_READ-WAVWR CURRENCY W_READ-STWAE ,
W_READ-ZZARAIGAKU CURRENCY W_READ-STWAE .
EndIf .
Clear : W_S902 , W_READ .
Uline .
EndLoop .
If P_TEST Is Initial .
Modify S902 From Table T_READ .
EndIf .

EndForm .

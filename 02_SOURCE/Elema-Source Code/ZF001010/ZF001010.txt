*&-------------------------------------------------------------------
*& Report  ZF001010
*&-------------------------------------------------------------------
* [プログラム名]
*   ZF001010  予算実績データレポート
* [処理概要]
*　　　予算実績データを予算テーブル(S901)からダウンロードし
* 　   レポートを作成する
* [改定履歴]
*　YYYY/MM/DD    Programar    Description
*  2004/01/29    T.KIHARA     新規開発
*  2004/04/13    T.KIHARA     金額表示を小数点以下四捨五入
*  2004/06/30  　T.KIHARA     月別合計行追加
*　2004/06/30  　T.KIHARA     ダウンロード時に各行の粗利率及び
*                             合計行/列を空白にする
*　2004/06/30    T.KIHARA     印刷書式の設定
*  2004/07/09    T.KIHARA     印刷書式の設定 Ver.2
*  2004/12/27    DMC A.MASUDA 金額の集計ロジックの変更
*  2005/01/04    DMC A.MASUDA 出力レイアウトの修正
*  2009/04/06    S.MIKAMI     年度設定ロジックの不具合修正
*  2009/10/20    K.KAJISA     「使用不可」データを対象外化
*  2012/08/15    ISID         ES-UP
*  2014/08/29    ISID18       コードページを"UTF-8"に修正
*  2015/02/03    ISID11       コードページ処理の再修正
*&-------------------------------------------------------------------
REPORT ZF001010
LINE-SIZE 262
LINE-COUNT 70
NO STANDARD PAGE HEADING.

* 構造宣言
TYPES: BEGIN OF TYP_ZF001010,
VRSIO       TYPE   S901-VRSIO,       "バージョン
SPMON       TYPE   S901-SPMON,       "分析期間-月
VKBUR       TYPE   TVBUR-VKBUR,      "営業所
VKGRP       TYPE   TVKGR-VKGRP,      "営業グループ
PKUNAG      TYPE   KNA1-KUNNR,       "得意先コード
PRODH       TYPE   T179-PRODH,       "品目階層
NETWR       TYPE   S901-NETWR,       "売上
ZZARAIGAKU  TYPE   S901-ZZARAIGAKU,  "粗利金額
ZZARAIRITU  TYPE   S901-ZZARAIRITU,  "粗利率
VTEXT       TYPE   T179T-VTEXT,      "品目階層テキスト
NAME1       TYPE   KNA1-NAME1,       "受注先名
END OF TYP_ZF001010.
* DATA宣言（処理用、帳票出力用）
DATA: GT_EXEC  TYPE TABLE OF TYP_ZF001010 ,"処理用
GF_EXEC  TYPE TYP_ZF001010.          "処理用構造

* 会社コードマスタ構造
TYPES: BEGIN OF TYP_T001,
BUKRS TYPE T001-BUKRS,  "営業所
BUTXT TYPE T001-BUTXT,  "営業所名
WAERS TYPE T001-WAERS,  "通貨コード
END OF TYP_T001.
* DATA宣言（処理用、帳票出力用）
DATA: GT_T001 TYPE TABLE OF TYP_T001,
GF_T001 TYPE TYP_T001.

* 品目テキスト構造
TYPES: BEGIN OF TYP_MAKT,
MATNR TYPE MAKT-MATNR,  "品目コード
MAKTX TYPE MAKT-MAKTX,  "品目テキスト
END OF TYP_MAKT.
* DATA宣言（処理用、帳票出力用）
DATA: GT_MAKT TYPE TABLE OF TYP_MAKT,
GF_MAKT TYPE TYP_MAKT.

* 営業所構造
TYPES: BEGIN OF TYP_TVBUR,
VKBUR TYPE TVBUR-VKBUR,  "営業所
BEZEI TYPE TVKBT-BEZEI,  "営業所名
END OF TYP_TVBUR.
* DATA宣言（処理用、帳票出力用）
DATA: GT_TVBUR TYPE TABLE OF TYP_TVBUR,
GF_TVBUR TYPE TYP_TVBUR.

* 営業グループ構造
TYPES: BEGIN OF TYP_TVKGR,
VKGRP TYPE TVKGR-VKGRP,  "営業Gr
END OF TYP_TVKGR.
* DATA宣言（処理用、帳票出力用）
DATA: GT_TVKGR TYPE TABLE OF TYP_TVKGR,
GF_TVKGR TYPE TYP_TVKGR.

*品目階層
TYPES: BEGIN OF TYP_T179,
PRODH TYPE T179-PRODH,  "品目階層
END OF TYP_T179.
* DATA宣言（処理用、帳票出力用）
DATA: GT_T179 TYPE TABLE OF TYP_T179,
GF_T179 TYPE TYP_T179.

* 予算
TYPES: BEGIN OF TYP_S901,
VRSIO       TYPE  S901-VRSIO,        "バージョン
SPMON       TYPE  S901-SPMON,        "年月
VKBUR       TYPE  S901-VKBUR,        "営業所
VKGRP       TYPE  S901-VKGRP,        "営業Gr
PKUNAG      TYPE  S901-PKUNAG,       "得意先コード
PRODH       TYPE  S901-PRODH,        "品目階層
NETWR       TYPE  S901-NETWR,        "売上
ZZARAIGAKU  TYPE  S901-ZZARAIGAKU,   "粗利
ZZARAIRITU  TYPE  S901-ZZARAIRITU,   "粗利率
VTEXT       TYPE  T179T-VTEXT,       "品目階層テキスト
NAME1       TYPE  KNA1-NAME1,        "得意先名
END OF TYP_S901.
* DATA宣言（処理用、帳票出力用）
DATA: GF_S901 TYPE TYP_S901,
GT_S901 TYPE TABLE OF TYP_S901.

*  構造宣言(合計)
TYPES: BEGIN OF TYP_SUM,
NETWRKEI      TYPE  S901-NETWR,        "売上
ZZARAGAKUKEI  TYPE  S901-ZZARAIGAKU,   "粗利
ZZARARITUKEI  TYPE  S901-ZZARAIRITU,   "粗利率
NETWRMONKEI   TYPE  S901-NETWR,        "月別売上
ZZARAMONKEI   TYPE  S901-ZZARAIGAKU,   "月別粗利
ZZRITUMONKEI  TYPE  S901-ZZARAIRITU,   "月別粗利率
END OF TYP_SUM.
* DATA宣言（処理用、帳票出力用）
DATA: GF_SUM TYPE TYP_SUM,
GT_SUM TYPE TABLE OF TYP_SUM.

* 得意先マスタ構造
TYPES: BEGIN OF TYP_KNA1,
KUNNR TYPE KNA1-KUNNR,  "得意先コード
NAME1 TYPE KNA1-NAME1,  "得意先名
END OF TYP_KNA1.
* DATA宣言（処理用、帳票出力用）
DATA: GT_KNA1 TYPE TABLE OF TYP_KNA1,
GF_KNA1 TYPE TYP_KNA1.

* 日付範囲チェック用構造
TYPES: BEGIN OF TYP_DATE,
MINDATE TYPE S901-SPMON,  "年月(最小値)
MAXDATE TYPE S901-SPMON,  "年月(最大値)
END OF TYP_DATE.
* DATA宣言（処理用、帳票出力用）
DATA: GT_DATE TYPE TABLE OF TYP_DATE,
GF_DATE TYPE TYP_DATE.

* ダウンロード用構造
* セグメント別
TYPES : BEGIN OF TYP_YOSANDL ,
* Mod ES-UP 2012/10/29 -->
*            yosan_line(1000) TYPE c,    "予算構造
YOSAN_LINE TYPE STRING,    "予算構造
* Mod ES-UP 2012/10/29 <--
END OF TYP_YOSANDL .
* DATA宣言（処理用、帳票出力用）
DATA : GT_YOSANDL TYPE TABLE OF TYP_YOSANDL ,
GF_YOSANDL TYPE TYP_YOSANDL .

DATA :YOSAN_LINE(1000) TYPE C ,
* Mod ES-UP 2012/08/15 -->
*      w_tab TYPE x VALUE '09'.
W_TAB TYPE STRING.
W_TAB = CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB.
* Mod ES-UP 2012/08/15 <--

* Add 2004.12.27 --->
DATA : W_VER  LIKE S901-VRSIO .
* Add 2004.12.27 <---

* 選択画面 *----------------------------------------------------*
* 分析期間
SELECTION-SCREEN BEGIN OF BLOCK BMON
*フレームのタイトル設定(『分析期間』)
WITH FRAME TITLE TEXT-069.
* 選択項目 年月(任意)
PARAMETERS: S_SPMON LIKE GF_S901-SPMON DEFAULT SY-DATUM(6) OBLIGATORY.
SELECTION-SCREEN END   OF BLOCK BMON.

* 特性
SELECTION-SCREEN BEGIN OF BLOCK BTOK
*フレームのタイトル設定(『特性』)
WITH FRAME TITLE TEXT-071.
* 選択項目 営業所(任意) 複数選択
SELECT-OPTIONS:S_VKBUR FOR GF_TVBUR-VKBUR MEMORY ID BUR.
* 選択項目 営業グループ(任意) 複数選択
SELECT-OPTIONS:S_VKGRP FOR GF_TVKGR-VKGRP.
* 選択項目 受注先(任意) 複数選択
SELECT-OPTIONS:S_PKUNAG FOR GF_KNA1-KUNNR.
* 選択項目 品目階層(任意) 複数選択
SELECT-OPTIONS:S_PRODH FOR GF_T179-PRODH VISIBLE LENGTH 4.
SELECTION-SCREEN END   OF BLOCK BTOK.

* 表示設定
SELECTION-SCREEN BEGIN OF BLOCK BKOP
*フレームのタイトル設定(『金額表示』)
WITH FRAME TITLE TEXT-070.
*チェックボックス設定(千円、円表示)
PARAMETERS: R_SENEN RADIOBUTTON GROUP R1."千円
PARAMETERS: R_EN    RADIOBUTTON GROUP R1."円
SELECTION-SCREEN END   OF BLOCK BKOP.

SELECTION-SCREEN BEGIN OF BLOCK DOWN WITH FRAME TITLE TEXT-004.
PARAMETERS:
*ラジオボタン(『ダウンロードしない』)
R_NOT       RADIOBUTTON GROUP R2,
*ラジオボタン(『データをダウンロードする』)
R_DOWN      RADIOBUTTON GROUP R2,
*出力ファイル名
P_FILE      LIKE RLGRAP-FILENAME.
SELECTION-SCREEN END   OF BLOCK DOWN.

*---------------------------------------------------------------------
AT SELECTION-SCREEN ON BLOCK DOWN.
*---------------------------------------------------------------------
*--- 入力ファイルのチェック
IF R_DOWN = 'X'.
IF P_FILE IS INITIAL.
* ファイルパスを指定してください
MESSAGE E855(Z1).
ENDIF.
ENDIF.

*---------------------------------------------------------------------
AT SELECTION-SCREEN ON VALUE-REQUEST FOR P_FILE.
*---------------------------------------------------------------------
*--- ファイル名呼び出し(保存する場所選択画面表示)
PERFORM FRM_CHK_FILE.

*--------------------------------------------------------------*
* INITIALIZATION
*--------------------------------------------------------------*
INITIALIZATION.

*---------------------------------------------------------------------
* at selection-screen
*---------------------------------------------------------------------
AT SELECTION-SCREEN.

*入力チェック(月､営業所､営業グループ､品目階層、得意先)
IF SY-UCOMM+0(1) <> '%'.
* 営業所チェック
PERFORM FRM_CHECK_VKBUR.
* 営業Grチェック
PERFORM FRM_CHECK_VKGRP.
* 品目階層チェック
PERFORM FRM_CHECK_PRODH.
* 得意先チェック
PERFORM FRM_CHECK_PKUNAG.
ENDIF.

*---------------------------------------------------------------------
* TOP-OF-PAGE
*---------------------------------------------------------------------
TOP-OF-PAGE.
*ヘッダ設定
PERFORM FRM_TOP_OF_PAGE.

*&---------------------------------------------------------------------*
*&      Form  FRM_TOP_OF_PAGE
*&---------------------------------------------------------------------*
FORM FRM_TOP_OF_PAGE.

ENDFORM.                    " FRM_TOP_OF_PAGE

*---------------------------------------------------------------------
* START-OF-SELECTION
*---------------------------------------------------------------------
START-OF-SELECTION.

* S901からデータ取得
PERFORM GET_DATA.

* レポート出力&ダウンロード
PERFORM FRM_WRITE_DETAIL.
IF R_DOWN = 'X'.
PERFORM FRM_DATA_DL.
ENDIF.

*&---------------------------------------------------------------------*
*&      CHECK_VKBUR
*&---------------------------------------------------------------------*
*&      Form  FRM_CHECK_VKBUR
*&---------------------------------------------------------------------*
*       営業所存在チェック
*----------------------------------------------------------------------*
FORM FRM_CHECK_VKBUR.
DATA:LT_DUMMY TYPE TABLE OF TYP_TVBUR.

SELECT VKBUR
FROM TVBUR
INTO CORRESPONDING FIELDS OF TABLE LT_DUMMY
WHERE VKBUR IN S_VKBUR.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE E606(Z1) WITH TEXT-007.
ENDCASE.

ENDFORM.                    "frm_check_vkbur

*&---------------------------------------------------------------------*
*&      CHECK_vkgrp
*&---------------------------------------------------------------------*
*&      Form  FRM_CHECK_vkgrp
*&---------------------------------------------------------------------*
*      営業グループ存在チェック
*----------------------------------------------------------------------*
FORM FRM_CHECK_VKGRP.
DATA:LT_DUMMY TYPE  TABLE OF TYP_TVKGR.

SELECT VKGRP
FROM TVKGR
INTO CORRESPONDING FIELDS OF TABLE LT_DUMMY
WHERE VKGRP IN S_VKGRP.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE E606(Z1) WITH TEXT-092.
ENDCASE.

ENDFORM.                    "frm_check_vkgrp

*&---------------------------------------------------------------------*
*&      CHECK_PRODH
*&---------------------------------------------------------------------*
*&      Form  FRM_CHECK_PRODH
*&---------------------------------------------------------------------*
*      品目階層存在チェック
*----------------------------------------------------------------------*
FORM FRM_CHECK_PRODH.
DATA:LT_DUMMY TYPE  TABLE OF TYP_T179.

SELECT PRODH
FROM T179
INTO CORRESPONDING FIELDS OF TABLE LT_DUMMY
WHERE PRODH IN S_PRODH.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE E606(Z1) WITH TEXT-096.
ENDCASE.

ENDFORM.                    "frm_check_prodh

*&---------------------------------------------------------------------*
*&      CHECK_PKUNAG
*&---------------------------------------------------------------------*
*&      Form  FRM_CHECK_pkunag
*&---------------------------------------------------------------------*
*      受注先存在チェック
*----------------------------------------------------------------------*
FORM FRM_CHECK_PKUNAG.
DATA:LT_DUMMY TYPE  TABLE OF TYP_KNA1.

SELECT KUNNR
FROM KNA1
INTO CORRESPONDING FIELDS OF TABLE LT_DUMMY
WHERE KUNNR IN S_PKUNAG.

CASE SY-SUBRC.
WHEN 0.
WHEN 4.
MESSAGE E606(Z1) WITH TEXT-093.
ENDCASE.

ENDFORM.                    "frm_check_pkunag

*&---------------------------------------------------------------------*
*&      SELECT NUMBER
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_MON
*&---------------------------------------------------------------------*
*       日付を取得する
*----------------------------------------------------------------------*
FORM FRM_SELECT_MON.

SELECT SPMON
FROM S901
INTO CORRESPONDING FIELDS OF GF_S901
WHERE SPMON = S_SPMON.

ENDSELECT.

ENDFORM.                    "frm_select_mon

*&---------------------------------------------------------------------*
*&      SELECT NUMBER
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_TVBUR
*&---------------------------------------------------------------------*
*       営業所コードを取得する
*----------------------------------------------------------------------*
FORM FRM_SELECT_TVBUR.

SELECT VKBUR
FROM TVBUR
INTO CORRESPONDING FIELDS OF GF_TVBUR
WHERE VKBUR IN S_VKBUR.

ENDSELECT.
ENDFORM.                    "frm_select_tvbur

*&---------------------------------------------------------------------*
*&      SELECT NUMBER
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_TVKGR
*&---------------------------------------------------------------------*
*       営業グループを取得する
*----------------------------------------------------------------------*
FORM FRM_SELECT_TVKGR.

SELECT VKGRP
FROM TVKGR
INTO CORRESPONDING FIELDS OF GF_TVKGR
WHERE VKGRP IN S_VKGRP.

ENDSELECT.

ENDFORM.                    "frm_select_tvkgr

*&---------------------------------------------------------------------*
*&      SELECT NUMBER
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_prodh
*&---------------------------------------------------------------------*
*       品目階層を取得する
*----------------------------------------------------------------------*
FORM FRM_SELECT_T179.

SELECT PRODH
FROM T179
INTO CORRESPONDING FIELDS OF GF_T179
WHERE PRODH IN S_PRODH.

ENDSELECT.

ENDFORM.                    "frm_select_t179

*&---------------------------------------------------------------------*
*&      SELECT NUMBER
*&---------------------------------------------------------------------*
*&      Form  FRM_SELECT_T179T
*&---------------------------------------------------------------------*
*       品目階層テキストを取得する
*----------------------------------------------------------------------*
*      -->P_PRODH  品目階層
*      <--P_VTEXT  品目階層テキスト
*----------------------------------------------------------------------*
FORM FRM_SELECT_T179T USING    P_PRODH
CHANGING P_VTEXT.

SELECT SINGLE
VTEXT
FROM T179T
INTO (P_VTEXT)
WHERE PRODH = P_PRODH
AND SPRAS = 'J'.

ENDFORM.                    " FRM_SELECT_T179T

*&---------------------------------------------------------------------*
*&      Form  get_data
*&---------------------------------------------------------------------*
*       S901テーブルから実データを取得し、
*       T179Tテーブルから品目階層テキストを取得する
*----------------------------------------------------------------------*
FORM GET_DATA.
*   modify 2009/04/06 S.MIKAMI {
*  DATA: year1(1) TYPE n,
*        year2(1) TYPE n,
DATA: YEAR1(4) TYPE N,
* } modify 2009/04/06 S.MIKAMI
NXTYEAR(4) TYPE N,
BEFYEAR(4) TYPE N,
MINDATE TYPE S901-SPMON,
MAXDATE TYPE S901-SPMON.

*----------------------------------------------------------
***  対象データの抽出条件(年月)を設定
*----------------------------------------------------------
* 入力月が4月〜12月の間の場合、
* 入力された年の４月〜入力された年+1の３月まで
* 例)2003/09と入力したら2003/04〜2004/03までが対象
*----------------------------------------------------------
IF ( S_SPMON+4(2) => 04 ) AND ( S_SPMON+4(2) <= 12 ).
*   modify 2009/04/06 S.MIKAMI {
*    year1 = s_spmon+3(1).
*    year2 = year1 + 1.
*    CONCATENATE s_spmon(3) year2 INTO nxtyear.
YEAR1   = S_SPMON(04).
NXTYEAR = YEAR1 + 1.
* } modify 2009/04/06 S.MIKAMI
CONCATENATE S_SPMON(4) '04' INTO MINDATE.
CONCATENATE NXTYEAR '03' INTO MAXDATE.
*----------------------------------------------------------
* 入力月が1月〜3月の間の場合
* 入力された年-1の4月〜入力された年の３月まで
* 例)2004/02と入力されたら2003/04〜2004/03までが対象
*----------------------------------------------------------
ELSEIF ( S_SPMON+4(2) => 01 ) AND ( S_SPMON+4(2) <= 03 ).
*   modify 2009/04/06 S.MIKAMI {
*    year1 = s_spmon+3(1).
*    year2 = year1 - 1.
*    CONCATENATE s_spmon(3) year2 INTO befyear.
YEAR1   = S_SPMON(04).
BEFYEAR = YEAR1 - 1.
* } modify 2009/04/06 S.MIKAMI
CONCATENATE BEFYEAR '04' INTO MINDATE.
CONCATENATE S_SPMON(4) '03' INTO MAXDATE.
ENDIF.

SELECT *
FROM  S901
INTO CORRESPONDING FIELDS OF GF_S901
WHERE  ( SPMON >= MINDATE )  "年月 => 上記で定義したmindate
AND    ( SPMON <= MAXDATE )  "年月 <= 上記で定義したmaxdate
AND    VKBUR  IN S_VKBUR     "営業所
AND    VKGRP  IN S_VKGRP     "営業グループ
AND    PKUNAG IN S_PKUNAG    "受注先
AND    PKUNAG NE SPACE
AND    PRODH  IN S_PRODH     "品目階層
AND    PRODH  NE SPACE.

*品目階層テキスト取得
PERFORM FRM_SELECT_T179T USING GF_S901-PRODH
CHANGING GF_S901-VTEXT.

* 2009/10/21 MOD START
*-- 使用不可のデータは出力対象外
*    APPEND gf_s901 TO gt_exec.
IF GF_S901-VTEXT <> TEXT-001."使用不可
APPEND GF_S901 TO GT_EXEC.
ENDIF.
* 2009/10/21 MOD END

ENDSELECT.

ENDFORM.                    " get_data

*&---------------------------------------------------------------------*
*&      Form  FRM_WRITE_DETAIL
*&---------------------------------------------------------------------*
*       明細部分帳票出力処理
*----------------------------------------------------------------------*
FORM FRM_WRITE_DETAIL.
* 年月→月
DATA  TUKI(2) TYPE C.
* 品目階層が変わったかどうかをチェックするために使用
DATA FLGHIN(2) TYPE C.
* 品目階層のグループが変わったかどうかをチェックするために使用
DATA FLGHGR(1) TYPE C.
* セグメント分割用
DATA  SEGNUM(2) TYPE P.
* セグメント表示用
DATA: SEGTEXT(40) TYPE C,  "品目階層テキスト
SEGTEXT1(40) TYPE C,
SEGTEXT2(40) TYPE C.
* 予算を取得するため
DATA: VER(3) TYPE C.
* 月別売上金額(小数点以下2桁)
DATA: JANNETWR(16) TYPE P,                                "1月売上
FEBNETWR(16) TYPE P,                                "2月売上
MARNETWR(16) TYPE P,                                "3月売上
APRNETWR(16) TYPE P,                                "4月売上
MAYNETWR(16) TYPE P,                                "5月売上
JUNNETWR(16) TYPE P,                                "6月売上
JULNETWR(16) TYPE P,                                "7月売上
AUGNETWR(16) TYPE P,                                "8月売上
SEPNETWR(16) TYPE P,                                "9月売上
OCTNETWR(16) TYPE P,                                "10月売上
NOVNETWR(16) TYPE P,                                "11月売上
DECNETWR(16) TYPE P,                                "12月売上
* 売上計
JANNETWRKEI(16) TYPE P,                             "1月売上計
FEBNETWRKEI(16) TYPE P,                             "2月売上計
MARNETWRKEI(16) TYPE P,                             "3月売上計
APRNETWRKEI(16) TYPE P,                             "4月売上計
MAYNETWRKEI(16) TYPE P,                             "5月売上計
JUNNETWRKEI(16) TYPE P,                             "6月売上計
JULNETWRKEI(16) TYPE P,                             "7月売上計
AUGNETWRKEI(16) TYPE P,                             "8月売上計
SEPNETWRKEI(16) TYPE P,                             "9月売上計
OCTNETWRKEI(16) TYPE P,                             "10月売上計
NOVNETWRKEI(16) TYPE P,                             "11月売上計
DECNETWRKEI(16) TYPE P,                             "12月売上計
* 売上総計
ALLJANNETWRKEI(16) TYPE P,                          "1月売上総計
ALLFEBNETWRKEI(16) TYPE P,                          "2月売上総計
ALLMARNETWRKEI(16) TYPE P,                          "3月売上総計
ALLAPRNETWRKEI(16) TYPE P,                          "4月売上総計
ALLMAYNETWRKEI(16) TYPE P,                          "5月売上総計
ALLJUNNETWRKEI(16) TYPE P,                          "6月売上総計
ALLJULNETWRKEI(16) TYPE P,                          "7月売上総計
ALLAUGNETWRKEI(16) TYPE P,                          "8月売上総計
ALLSEPNETWRKEI(16) TYPE P,                          "9月売上総計
ALLOCTNETWRKEI(16) TYPE P,                         "10月売上総計
ALLNOVNETWRKEI(16) TYPE P,                         "11月売上総計
ALLDECNETWRKEI(16) TYPE P,                         "12月売上総計
SUM_NETWR(16) TYPE P,                              "売上計
SUM_SEGNETWR(16) TYPE P,                           "売上小計
SUM_ALLNETWR(16) TYPE P.                           "売上総計
*  月別粗利金額
DATA: JANARARI(16) TYPE P,                                "1月粗利
FEBARARI(16) TYPE P,                                "2月粗利
MARARARI(16) TYPE P,                                "3月粗利
APRARARI(16) TYPE P,                                "4月粗利
MAYARARI(16) TYPE P,                                "5月粗利
JUNARARI(16) TYPE P,                                "6月粗利
JULARARI(16) TYPE P,                                "7月粗利
AUGARARI(16) TYPE P,                                "8月粗利
SEPARARI(16) TYPE P,                                "9月粗利
OCTARARI(16) TYPE P,                                "10月粗利
NOVARARI(16) TYPE P,                                "11月粗利
DECARARI(16) TYPE P,                                "12月粗利
* 粗利計
JANARARIKEI(16) TYPE P,                             "1月粗利計
FEBARARIKEI(16) TYPE P,                             "2月粗利計
MARARARIKEI(16) TYPE P,                             "3月粗利計
APRARARIKEI(16) TYPE P,                             "4月粗利計
MAYARARIKEI(16) TYPE P,                             "5月粗利計
JUNARARIKEI(16) TYPE P,                             "6月粗利計
JULARARIKEI(16) TYPE P,                             "7月粗利計
AUGARARIKEI(16) TYPE P,                             "8月粗利計
SEPARARIKEI(16) TYPE P,                             "9月粗利計
OCTARARIKEI(16) TYPE P,                             "10月粗利計
NOVARARIKEI(16) TYPE P,                             "11月粗利計
DECARARIKEI(16) TYPE P,                             "12月粗利計
* 粗利総計
ALLJANARARIKEI(16) TYPE P,                          "1月粗利総計
ALLFEBARARIKEI(16) TYPE P,                          "2月粗利総計
ALLMARARARIKEI(16) TYPE P,                          "3月粗利総計
ALLAPRARARIKEI(16) TYPE P,                          "4月粗利総計
ALLMAYARARIKEI(16) TYPE P,                          "5月粗利総計
ALLJUNARARIKEI(16) TYPE P,                          "6月粗利総計
ALLJULARARIKEI(16) TYPE P,                          "7月粗利総計
ALLAUGARARIKEI(16) TYPE P,                          "8月粗利総計
ALLSEPARARIKEI(16) TYPE P,                          "9月粗利総計
ALLOCTARARIKEI(16) TYPE P,                         "10月粗利総計
ALLNOVARARIKEI(16) TYPE P,                         "11月粗利総計
ALLDECARARIKEI(16) TYPE P,                         "12月粗利総計
SUM_ARARI(16) TYPE P,                    "粗利計
SUM_SEGARARI(16) TYPE P,                 "粗利小計
SUM_ALLARARI(16) TYPE P.                            "粗利総計
*  月別粗利率
DATA: JANRITU(16) TYPE P DECIMALS 2,                      "1月粗利率
FEBRITU(16) TYPE P DECIMALS 2,                      "2月粗利率
MARRITU(16) TYPE P DECIMALS 2,                      "3月粗利率
APRRITU(16) TYPE P DECIMALS 2,                      "4月粗利率
MAYRITU(16) TYPE P DECIMALS 2,                      "5月粗利率
JUNRITU(16) TYPE P DECIMALS 2,                      "6月粗利率
JULRITU(16) TYPE P DECIMALS 2,                      "7月粗利率
AUGRITU(16) TYPE P DECIMALS 2,                      "8月粗利率
SEPRITU(16) TYPE P DECIMALS 2,                      "9月粗利率
OCTRITU(16) TYPE P DECIMALS 2,                      "10月粗利率
NOVRITU(16) TYPE P DECIMALS 2,                      "11月粗利率
DECRITU(16) TYPE P DECIMALS 2,                      "12月粗利率
* 小計粗利率
JANRITUKEI(16) TYPE P DECIMALS 2,                   "1月計粗利率
FEBRITUKEI(16) TYPE P DECIMALS 2,                   "2月計粗利率
MARRITUKEI(16) TYPE P DECIMALS 2,                   "3月計粗利率
APRRITUKEI(16) TYPE P DECIMALS 2,                   "4月計粗利率
MAYRITUKEI(16) TYPE P DECIMALS 2,                   "5月計粗利率
JUNRITUKEI(16) TYPE P DECIMALS 2,                   "6月計粗利率
JULRITUKEI(16) TYPE P DECIMALS 2,                   "7月計粗利率
AUGRITUKEI(16) TYPE P DECIMALS 2,                   "8月計粗利率
SEPRITUKEI(16) TYPE P DECIMALS 2,                   "9月計粗利率
OCTRITUKEI(16) TYPE P DECIMALS 2,                  "10月計粗利率
NOVRITUKEI(16) TYPE P DECIMALS 2,                  "11月計粗利率
DECRITUKEI(16) TYPE P DECIMALS 2,                  "12月計粗利率
* 総計粗利率
ALLJANRITUKEI(16) TYPE P DECIMALS 2,              "1月総計粗利率
ALLFEBRITUKEI(16) TYPE P DECIMALS 2,              "2月総計粗利率
ALLMARRITUKEI(16) TYPE P DECIMALS 2,              "3月総計粗利率
ALLAPRRITUKEI(16) TYPE P DECIMALS 2,              "4月総計粗利率
ALLMAYRITUKEI(16) TYPE P DECIMALS 2,              "5月総計粗利率
ALLJUNRITUKEI(16) TYPE P DECIMALS 2,              "6月総計粗利率
ALLJULRITUKEI(16) TYPE P DECIMALS 2,              "7月総計粗利率
ALLAUGRITUKEI(16) TYPE P DECIMALS 2,              "8月総計粗利率
ALLSEPRITUKEI(16) TYPE P DECIMALS 2,              "9月総計粗利率
ALLOCTRITUKEI(16) TYPE P DECIMALS 2,             "10月総計粗利率
ALLNOVRITUKEI(16) TYPE P DECIMALS 2,             "11月総計粗利率
ALLDECRITUKEI(16) TYPE P DECIMALS 2,             "12月総計粗利率
SUM_RITU(16) TYPE P DECIMALS 2,                     "計粗利率
SUM_SEGRITU(16) TYPE P DECIMALS 2,                  "小計粗利率
SUM_ALLRITU(16) TYPE P DECIMALS 2.                  "総計粗利率

* ダウンロード用項目定義(全て文字型で定義)
* 月別売上金額
DATA: C_JANNETWR(16) TYPE C,                              "1月売上
C_FEBNETWR(16) TYPE C,                              "2月売上
C_MARNETWR(16) TYPE C,                              "3月売上
C_APRNETWR(16) TYPE C,                              "4月売上
C_MAYNETWR(16) TYPE C,                              "5月売上
C_JUNNETWR(16) TYPE C,                              "6月売上
C_JULNETWR(16) TYPE C,                              "7月売上
C_AUGNETWR(16) TYPE C,                              "8月売上
C_SEPNETWR(16) TYPE C,                              "9月売上
C_OCTNETWR(16) TYPE C,                              "10月売上
C_NOVNETWR(16) TYPE C,                              "11月売上
C_DECNETWR(16) TYPE C,                              "12月売上
* 売上小計
C_JANNETWRKEI(16) TYPE C,                           "1月売上計
C_FEBNETWRKEI(16) TYPE C,                           "2月売上計
C_MARNETWRKEI(16) TYPE C,                           "3月売上計
C_APRNETWRKEI(16) TYPE C,                           "4月売上計
C_MAYNETWRKEI(16) TYPE C,                           "5月売上計
C_JUNNETWRKEI(16) TYPE C,                           "6月売上計
C_JULNETWRKEI(16) TYPE C,                           "7月売上計
C_AUGNETWRKEI(16) TYPE C,                           "8月売上計
C_SEPNETWRKEI(16) TYPE C,                           "9月売上計
C_OCTNETWRKEI(16) TYPE C,                           "10月売上計
C_NOVNETWRKEI(16) TYPE C,                           "11月売上計
C_DECNETWRKEI(16) TYPE C,                           "12月売上計
* 売上総計
C_ALLJANNETWRKEI(16) TYPE C,                        "1月売上総計
C_ALLFEBNETWRKEI(16) TYPE C,                        "2月売上総計
C_ALLMARNETWRKEI(16) TYPE C,                        "3月売上総計
C_ALLAPRNETWRKEI(16) TYPE C,                        "4月売上総計
C_ALLMAYNETWRKEI(16) TYPE C,                        "5月売上総計
C_ALLJUNNETWRKEI(16) TYPE C,                        "6月売上総計
C_ALLJULNETWRKEI(16) TYPE C,                        "7月売上総計
C_ALLAUGNETWRKEI(16) TYPE C,                        "8月売上総計
C_ALLSEPNETWRKEI(16) TYPE C,                        "9月売上総計
C_ALLOCTNETWRKEI(16) TYPE C,                       "10月売上総計
C_ALLNOVNETWRKEI(16) TYPE C,                       "11月売上総計
C_ALLDECNETWRKEI(16) TYPE C.                       "12月売上総計

*  月別粗利金額
DATA: C_JANARARI(16) TYPE C,                              "1月粗利
C_FEBARARI(16) TYPE C,                              "2月粗利
C_MARARARI(16) TYPE C,                              "3月粗利
C_APRARARI(16) TYPE C,                              "4月粗利
C_MAYARARI(16) TYPE C,                              "5月粗利
C_JUNARARI(16) TYPE C,                              "6月粗利
C_JULARARI(16) TYPE C,                              "7月粗利
C_AUGARARI(16) TYPE C,                              "8月粗利
C_SEPARARI(16) TYPE C,                              "9月粗利
C_OCTARARI(16) TYPE C,                              "10月粗利
C_NOVARARI(16) TYPE C,                              "11月粗利
C_DECARARI(16) TYPE C,                              "12月粗利
* 粗利小計
C_JANARARIKEI(16) TYPE C,                           "1月計粗利
C_FEBARARIKEI(16) TYPE C,                           "2月計粗利
C_MARARARIKEI(16) TYPE C,                           "3月計粗利
C_APRARARIKEI(16) TYPE C,                           "4月計粗利
C_MAYARARIKEI(16) TYPE C,                           "5月計粗利
C_JUNARARIKEI(16) TYPE C,                           "6月計粗利
C_JULARARIKEI(16) TYPE C,                           "7月計粗利
C_AUGARARIKEI(16) TYPE C,                           "8月計粗利
C_SEPARARIKEI(16) TYPE C,                           "9月計粗利
C_OCTARARIKEI(16) TYPE C,                           "10月計粗利
C_NOVARARIKEI(16) TYPE C,                           "11月計粗利
C_DECARARIKEI(16) TYPE C,                           "12月計粗利
* 粗利総計
C_ALLJANARARIKEI(16) TYPE C,                        "1月総計粗利
C_ALLFEBARARIKEI(16) TYPE C,                        "2月総計粗利
C_ALLMARARARIKEI(16) TYPE C,                        "3月総計粗利
C_ALLAPRARARIKEI(16) TYPE C,                        "4月総計粗利
C_ALLMAYARARIKEI(16) TYPE C,                        "5月総計粗利
C_ALLJUNARARIKEI(16) TYPE C,                        "6月総計粗利
C_ALLJULARARIKEI(16) TYPE C,                        "7月総計粗利
C_ALLAUGARARIKEI(16) TYPE C,                        "8月総計粗利
C_ALLSEPARARIKEI(16) TYPE C,                        "9月総計粗利
C_ALLOCTARARIKEI(16) TYPE C,                       "10月総計粗利
C_ALLNOVARARIKEI(16) TYPE C,                       "11月総計粗利
C_ALLDECARARIKEI(16) TYPE C.                       "12月総計粗利

*  月別粗利率
DATA: C_JANRITU(16) TYPE C,                               "1月粗利率
C_FEBRITU(16) TYPE C,                               "2月粗利率
C_MARRITU(16) TYPE C,                               "3月粗利率
C_APRRITU(16) TYPE C,                               "4月粗利率
C_MAYRITU(16) TYPE C,                               "5月粗利率
C_JUNRITU(16) TYPE C,                               "6月粗利率
C_JULRITU(16) TYPE C,                               "7月粗利率
C_AUGRITU(16) TYPE C,                               "8月粗利率
C_SEPRITU(16) TYPE C,                               "9月粗利率
C_OCTRITU(16) TYPE C,                               "10月粗利率
C_NOVRITU(16) TYPE C,                               "11月粗利率
C_DECRITU(16) TYPE C,                               "12月粗利率
* 小計粗利率
C_JANRITUKEI(16) TYPE C,                            "1月計粗利率
C_FEBRITUKEI(16) TYPE C,                            "2月計粗利率
C_MARRITUKEI(16) TYPE C,                            "3月計粗利率
C_APRRITUKEI(16) TYPE C,                            "4月計粗利率
C_MAYRITUKEI(16) TYPE C,                            "5月計粗利率
C_JUNRITUKEI(16) TYPE C,                            "6月計粗利率
C_JULRITUKEI(16) TYPE C,                            "7月計粗利率
C_AUGRITUKEI(16) TYPE C,                            "8月計粗利率
C_SEPRITUKEI(16) TYPE C,                            "9月計粗利率
C_OCTRITUKEI(16) TYPE C,                           "10月計粗利率
C_NOVRITUKEI(16) TYPE C,                           "11月計粗利率
C_DECRITUKEI(16) TYPE C,                           "12月計粗利率
* 総計粗利率
C_ALLJANRITUKEI(16) TYPE C,                       "1月総計粗利率
C_ALLFEBRITUKEI(16) TYPE C,                       "2月総計粗利率
C_ALLMARRITUKEI(16) TYPE C,                       "3月総計粗利率
C_ALLAPRRITUKEI(16) TYPE C,                       "4月総計粗利率
C_ALLMAYRITUKEI(16) TYPE C,                       "5月総計粗利率
C_ALLJUNRITUKEI(16) TYPE C,                       "6月総計粗利率
C_ALLJULRITUKEI(16) TYPE C,                       "7月総計粗利率
C_ALLAUGRITUKEI(16) TYPE C,                       "8月総計粗利率
C_ALLSEPRITUKEI(16) TYPE C,                       "9月総計粗利率
C_ALLOCTRITUKEI(16) TYPE C,                      "10月総計粗利率
C_ALLNOVRITUKEI(16) TYPE C,                      "11月総計粗利率
C_ALLDECRITUKEI(16) TYPE C.                      "12月総計粗利率

*  合計用
DATA: C_NETWRKEI(16) TYPE C,                              "売上計
C_ZZARAGAKUKEI(16) TYPE C,                          "粗利計
C_ZZARARITUKEI(16) TYPE C,                          "計粗利率
C_NETWRMONKEI(16) TYPE C,                           "月別売上計
C_ZZARAMONKEI(16) TYPE C,                           "月別粗利計
C_ZZRITUMONKEI(16) TYPE C,                         "月別計粗利率
C_ALLNETWRMONKEI(16) TYPE C,                       "月別売上総計
C_ALLZZARAMONKEI(16) TYPE C,                       "月別粗利総計
C_ALLZZRITUMONKEI(16) TYPE C.                    "月別総計粗利率

*-------------------------------------------------------------------
***  印刷書式設定　2004/06/30 追加
*-------------------------------------------------------------------
CALL FUNCTION 'SET_PRINT_PARAMETERS'
EXPORTING
LAYOUT = 'ZX_70_265'.
*-------------------------------------------------------------------

* 帳票タイトル『**予算実績データ一覧表**』
WRITE :/117(24) TEXT-100.
WRITE : 197 '処理日付' ,
213  SY-DATUM ,       "システム日付
229 '処理時刻' ,
245  SY-UZEIT .       "システム時刻
WRITE: /01(04) TEXT-067,      "'年月'
12(20) S_SPMON,       "年月
/01(06) TEXT-010,      "'営業所'
12(04) S_VKBUR-LOW.   "営業所‐自
IF S_VKBUR-HIGH NE SPACE.     "営業所を範囲指定の場合
WRITE  17(02)   '〜'.
ENDIF.
WRITE: 20(04)  S_VKBUR-HIGH,  "営業所‐至
/01(06) TEXT-011,        "'営業Gr'
12(03) S_VKGRP-LOW.     "営業Gr‐自
IF S_VKGRP-HIGH NE SPACE.     "営業Grを範囲指定の場合
WRITE  16(02)   '〜'.
ENDIF.
WRITE: 19(03)  S_VKGRP-HIGH,  "営業Gr‐至
/01(06) TEXT-013,        "'得意先'
12(10) S_PKUNAG-LOW.    "得意先‐自
IF S_PKUNAG-HIGH NE SPACE.    "得意先を範囲指定の場合
WRITE  23(02)   '〜'.
ENDIF.
WRITE: 26(02)  S_PKUNAG-HIGH, "得意先‐至
/01(10) TEXT-016,        "'セグメント'
12(2) S_PRODH-LOW.      "セグメント‐自
IF S_PRODH-HIGH NE SPACE.     "セグメントを範囲指定の場合
WRITE  15(02)   '〜'.
ENDIF.
WRITE: 18(02)  S_PRODH-HIGH.  "セグメント‐至

*  WRITE:/ space.

IF R_EN = 'X'.
WRITE: 245(10) TEXT-068,   "単位：円
/01(262) SY-ULINE.  "下線
ELSE.
WRITE: 245(10) TEXT-031,   "単位：千円
/01(262) SY-ULINE.  "下線
ENDIF.

WRITE: /4(20)  TEXT-074 CENTERED,           "小区分
27(20) TEXT-015 CENTERED,          "大区分
47(06) TEXT-017,                   "金額
53(16) TEXT-018 RIGHT-JUSTIFIED,   "４月
69(16) TEXT-019 RIGHT-JUSTIFIED,   "５月
85(16) TEXT-020 RIGHT-JUSTIFIED,   "６月
101(16) TEXT-021 RIGHT-JUSTIFIED,  "７月
117(16) TEXT-022 RIGHT-JUSTIFIED,  "８月
133(16) TEXT-023 RIGHT-JUSTIFIED,  "９月
149(16) TEXT-024 RIGHT-JUSTIFIED,  "１０月
165(16) TEXT-025 RIGHT-JUSTIFIED,  "１１月
181(16) TEXT-026 RIGHT-JUSTIFIED,  "１２月
197(16) TEXT-027 RIGHT-JUSTIFIED,  "１月
213(16) TEXT-028 RIGHT-JUSTIFIED,  "２月
229(16) TEXT-029 RIGHT-JUSTIFIED,  "３月
257(16) TEXT-030,  "合計
/01(262) SY-ULINE. "下線

*----------------------------------------------------------
***  レポート出力
*----------------------------------------------------------
IF R_DOWN = 'X'.

*　1行目(タイトル行)
CONCATENATE
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
TEXT-100   "'**予算実績データ一覧表**'
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
SPACE      "空白
'処理日付'
SY-DATUM   "システム日付
'処理時刻'
SY-UZEIT   "システム時刻
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(空行)
CONCATENATE
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　3行目(単位行)
*  単位が'円'の場合
IF R_EN = 'X'.
CONCATENATE
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
TEXT-068 "'単位：円'
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*  単位が'千円'の場合
ELSE.
CONCATENATE
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
SPACE    "空白
TEXT-031 "'単位：千円'
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

ENDIF.
ENDIF.

CONCATENATE
SPACE       "空白
TEXT-074    "'大区分'
SPACE       "空白
TEXT-015    "'小区分'
TEXT-017    "'金額'
TEXT-018                                              "'4月'
TEXT-019                                              "'5月'
TEXT-020                                              "'6月'
TEXT-021                                              "'7月'
TEXT-022                                              "'8月'
TEXT-023                                              "'9月'
TEXT-024                                              "'10月'
TEXT-025                                              "'11月'
TEXT-026                                              "'12月'
TEXT-027                                              "'1月'
TEXT-028                                              "'2月'
TEXT-029                                              "'3月'
TEXT-030    "'合計'
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　品目階層、年月、営業所、受注先、バージョンの順で昇順
SORT GT_EXEC BY PRODH SPMON VKBUR PKUNAG ASCENDING
VRSIO DESCENDING.

* Add 2004.12.27 --->
MOVE '001' TO W_VER .
LOOP AT GT_EXEC INTO GF_EXEC
WHERE VRSIO EQ '002' .
MOVE '002' TO W_VER .
EXIT .
ENDLOOP .
* Add 2004.12.27 <---

*  初期値
LOOP AT GT_EXEC INTO GF_EXEC.
FLGHIN = GF_EXEC-PRODH.                    "品目階層
FLGHGR = GF_EXEC-PRODH(1).                 "品目階層の1桁目
VER = GF_EXEC-VRSIO.
EXIT.
ENDLOOP.

LOOP AT GT_EXEC INTO GF_EXEC.
***********************************************************
***  品目階層が新しい値に変わった時
***********************************************************
IF FLGHIN NE GF_EXEC-PRODH.
*----------------------------------------------------------
***  月別粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
* 1月
IF JANARARI = 0.
JANRITU = '0.0'.
ELSEIF JANNETWR = 0.
JANRITU = '-100.0'.
ELSEIF ( JANNETWR = JANARARI ).
JANRITU = '100.0'.
ELSE.
JANRITU = ( JANARARI / JANNETWR ) * 100.
ENDIF.
* 2月
IF FEBARARI = 0.
FEBRITU = '0.0'.
ELSEIF FEBNETWR = 0.
FEBRITU = '-100.0'.
ELSEIF ( FEBNETWR = FEBARARI ).
FEBRITU = '100.0'.
ELSE.
FEBRITU = ( FEBARARI / FEBNETWR ) * 100.
ENDIF.
* 3月
IF MARARARI = 0.
MARRITU = '0.0'.
ELSEIF MARNETWR = 0.
MARRITU = '-100.0'.
ELSEIF ( MARNETWR = MARARARI ).
MARRITU = '100.0'.
ELSE.
MARRITU = ( MARARARI / MARNETWR ) * 100.
ENDIF.
* 4月
IF APRARARI = 0.
APRRITU = '0.0'.
ELSEIF APRNETWR = 0.
APRRITU = '-100.0'.
ELSEIF ( APRNETWR = APRARARI ).
APRRITU = '100.0'.
ELSE.
APRRITU = ( APRARARI / APRNETWR ) * 100.
ENDIF.
* 5月
IF MAYARARI = 0.
MAYRITU = '0.0'.
ELSEIF MAYNETWR = 0.
MAYRITU = '-100.0'.
ELSEIF ( MAYNETWR = MAYARARI ).
MAYRITU = '100.0'.
ELSE.
MAYRITU = ( MAYARARI / MAYNETWR ) * 100.
ENDIF.
* 6月
IF JUNARARI = 0.
JUNRITU = '0.0'.
ELSEIF JUNNETWR = 0.
JUNRITU = '-100.0'.
ELSEIF ( JUNNETWR = JUNARARI ).
JUNRITU = '100.0'.
ELSE.
JUNRITU = ( JUNARARI / JUNNETWR ) * 100.
ENDIF.
* 7月
IF JULARARI = 0.
JULRITU = '0.0'.
ELSEIF JULNETWR = 0.
JULRITU = '-100.0'.
ELSEIF ( JULNETWR = JULARARI ).
JULRITU = '100.0'.
ELSE.
JULRITU = ( JULARARI / JULNETWR ) * 100.
ENDIF.
* 8月
IF AUGARARI = 0.
AUGRITU = '0.0'.
ELSEIF AUGNETWR = 0.
AUGRITU = '-100.0'.
ELSEIF ( AUGNETWR = AUGARARI ).
AUGRITU = '100.0'.
ELSE.
AUGRITU = ( AUGARARI / AUGNETWR ) * 100.
ENDIF.
* 9月
IF SEPARARI = 0.
SEPRITU = '0.0'.
ELSEIF SEPNETWR = 0.
SEPRITU = '-100.0'.
ELSEIF ( SEPNETWR = SEPARARI ).
SEPRITU = '100.0'.
ELSE.
SEPRITU = ( SEPARARI / SEPNETWR ) * 100.
ENDIF.
* 10月
IF OCTARARI = 0.
OCTRITU = '0.0'.
ELSEIF OCTNETWR = 0.
OCTRITU = '-100.0'.
ELSEIF ( OCTNETWR = OCTARARI ).
OCTRITU = '100.0'.
ELSE.
OCTRITU = ( OCTARARI / OCTNETWR ) * 100.
ENDIF.
* 11月
IF NOVARARI = 0.
NOVRITU = '0.0'.
ELSEIF NOVNETWR = 0.
NOVRITU = '-100.0'.
ELSEIF ( NOVNETWR = NOVARARI ).
NOVRITU = '100.0'.
ELSE.
NOVRITU = ( NOVARARI / NOVNETWR ) * 100.
ENDIF.
* 12月
IF DECARARI = 0.
DECRITU = '0.0'.
ELSEIF DECNETWR = 0.
DECRITU = '-100.0'.
ELSEIF ( DECNETWR = DECARARI ).
DECRITU = '100.0'.
ELSE.
DECRITU = ( DECARARI / DECNETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*　　セグメント別の売上計・実績計を単位変換された金額で計算する
*----------------------------------------------------------
SUM_NETWR = APRNETWR +
MAYNETWR +
JUNNETWR +
JULNETWR +
AUGNETWR +
SEPNETWR +
OCTNETWR +
NOVNETWR +
DECNETWR +
JANNETWR +
FEBNETWR +
MARNETWR.

SUM_ARARI = APRARARI +
MAYARARI +
JUNARARI +
JULARARI +
AUGARARI +
SEPARARI +
OCTARARI +
NOVARARI +
DECARARI +
JANARARI +
FEBARARI +
MARARARI.

*----------------------------------------------------------
***  総粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
IF SUM_ARARI = 0.
SUM_RITU = '0.0'.
ELSEIF SUM_NETWR = 0.
SUM_RITU = '-100.0'.
ELSEIF ( SUM_ARARI = SUM_NETWR ).
SUM_RITU = '100.0'.
ELSE.
SUM_RITU = ( SUM_ARARI / SUM_NETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*** 金額表示が'千円'の場合、単位変換(円→千円)
*** 売上・粗利を1000で割る
*----------------------------------------------------------
IF R_SENEN = 'X'.
APRNETWR = APRNETWR / 1000.
MAYNETWR = MAYNETWR / 1000.
JUNNETWR = JUNNETWR / 1000.
JULNETWR = JULNETWR / 1000.
AUGNETWR = AUGNETWR / 1000.
SEPNETWR = SEPNETWR / 1000.
OCTNETWR = OCTNETWR / 1000.
NOVNETWR = NOVNETWR / 1000.
DECNETWR = DECNETWR / 1000.
JANNETWR = JANNETWR / 1000.
FEBNETWR = FEBNETWR / 1000.
MARNETWR = MARNETWR / 1000.
APRARARI = APRARARI / 1000.
MAYARARI = MAYARARI / 1000.
JUNARARI = JUNARARI / 1000.
JULARARI = JULARARI / 1000.
AUGARARI = AUGARARI / 1000.
SEPARARI = SEPARARI / 1000.
OCTARARI = OCTARARI / 1000.
NOVARARI = NOVARARI / 1000.
DECARARI = DECARARI / 1000.
JANARARI = JANARARI / 1000.
FEBARARI = FEBARARI / 1000.
MARARARI = MARARARI / 1000.
SUM_NETWR = SUM_NETWR / 1000.
SUM_ARARI = SUM_ARARI / 1000.
ENDIF.

*----------------------------------------------------------
*** マイナス記号を後から前に移動する
*----------------------------------------------------------
*   数値型を文字型に変換
*   値の受渡をイコールで行うとカンマが無視される
*   カンマを残すにはWRITE〜TO〜を使用する
*----------------------------------------------------------
WRITE: APRNETWR TO C_APRNETWR,
MAYNETWR TO C_MAYNETWR,
JUNNETWR TO C_JUNNETWR,
JULNETWR TO C_JULNETWR,
AUGNETWR TO C_AUGNETWR,
SEPNETWR TO C_SEPNETWR,
OCTNETWR TO C_OCTNETWR,
NOVNETWR TO C_NOVNETWR,
DECNETWR TO C_DECNETWR,
JANNETWR TO C_JANNETWR,
FEBNETWR TO C_FEBNETWR,
MARNETWR TO C_MARNETWR,
APRARARI TO C_APRARARI,
MAYARARI TO C_MAYARARI,
JUNARARI TO C_JUNARARI,
JULARARI TO C_JULARARI,
AUGARARI TO C_AUGARARI,
SEPARARI TO C_SEPARARI,
OCTARARI TO C_OCTARARI,
NOVARARI TO C_NOVARARI,
DECARARI TO C_DECARARI,
JANARARI TO C_JANARARI,
FEBARARI TO C_FEBARARI,
MARARARI TO C_MARARARI,
APRRITU TO C_APRRITU,
MAYRITU TO C_MAYRITU,
JUNRITU TO C_JUNRITU,
JULRITU TO C_JULRITU,
AUGRITU TO C_AUGRITU,
SEPRITU TO C_SEPRITU,
OCTRITU TO C_OCTRITU,
NOVRITU TO C_NOVRITU,
DECRITU TO C_DECRITU,
JANRITU TO C_JANRITU,
FEBRITU TO C_FEBRITU,
MARRITU TO C_MARRITU,
SUM_NETWR TO C_NETWRKEI,
SUM_ARARI TO C_ZZARAGAKUKEI,
SUM_RITU TO C_ZZARARITUKEI.

*----------------------------------------------------------
*   汎用モジュール CLOI_PUT_SIGN_IN_FRONTを使用
*----------------------------------------------------------
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARAGAKUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARARITUKEI.

*----------------------------------------------------------
***  品目階層別出力
*----------------------------------------------------------
*  セグメントテキストの分割
*----------------------------------------------------------
* Mod ES-UP 2012/08/31 -->
*      SEARCH segtext FOR '　'.
*      IF ( sy-subrc = 0 ) AND ( sy-fdpos <> 0 ).
*        segnum = sy-fdpos + 2.
*        WRITE: segtext(sy-fdpos) TO segtext1,
*               segtext+segnum TO segtext2.
*      ELSE.
*        WRITE: segtext TO segtext1,
*               segtext TO segtext2.
*      ENDIF.
SPLIT SEGTEXT AT '　' INTO SEGTEXT1 SEGTEXT2.
IF SEGTEXT2 IS INITIAL.
SEGTEXT2 = SEGTEXT1.
ENDIF.
* Mod ES-UP 2012/08/31 <--
WRITE: /1(03) FLGHGR CENTERED,                        "小区分
4(20) SEGTEXT1 CENTERED,                      "品目階層名
24(03) FLGHIN CENTERED,
27(20) SEGTEXT2 CENTERED,
47(06) TEXT-062,                              "'売上'
53(16) C_APRNETWR RIGHT-JUSTIFIED,            "4月売上
69(16) C_MAYNETWR RIGHT-JUSTIFIED,            "5月売上
85(16) C_JUNNETWR RIGHT-JUSTIFIED,            "6月売上
101(16) C_JULNETWR RIGHT-JUSTIFIED,           "7月売上
117(16) C_AUGNETWR RIGHT-JUSTIFIED,           "8月売上
133(16) C_SEPNETWR RIGHT-JUSTIFIED,           "9月売上
149(16) C_OCTNETWR RIGHT-JUSTIFIED,           "10月売上
165(16) C_NOVNETWR RIGHT-JUSTIFIED,           "11月売上
181(16) C_DECNETWR RIGHT-JUSTIFIED,           "12月売上
197(16) C_JANNETWR RIGHT-JUSTIFIED,           "1月売上
213(16) C_FEBNETWR RIGHT-JUSTIFIED,           "2月売上
229(16) C_MARNETWR RIGHT-JUSTIFIED,           "3月売上
245(16) C_NETWRKEI RIGHT-JUSTIFIED,           "売上計
/47(06) TEXT-063,                              "'粗利'
53(16) C_APRARARI RIGHT-JUSTIFIED,            "4月粗利
69(16) C_MAYARARI RIGHT-JUSTIFIED,            "5月粗利
85(16) C_JUNARARI RIGHT-JUSTIFIED,            "6月粗利
101(16) C_JULARARI RIGHT-JUSTIFIED,           "7月粗利
117(16) C_AUGARARI RIGHT-JUSTIFIED,           "8月粗利
133(16) C_SEPARARI RIGHT-JUSTIFIED,           "9月粗利
149(16) C_OCTARARI RIGHT-JUSTIFIED,           "10月粗利
165(16) C_NOVARARI RIGHT-JUSTIFIED,           "11月粗利
181(16) C_DECARARI RIGHT-JUSTIFIED,           "12月粗利
197(16) C_JANARARI RIGHT-JUSTIFIED,           "1月粗利
213(16) C_FEBARARI RIGHT-JUSTIFIED,           "2月粗利
229(16) C_MARARARI RIGHT-JUSTIFIED,           "3月粗利
245(16) C_ZZARAGAKUKEI RIGHT-JUSTIFIED,       "粗利計
/47(06) TEXT-064,                              "粗利率
53(16) C_APRRITU RIGHT-JUSTIFIED,             "4月粗利率
69(16) C_MAYRITU RIGHT-JUSTIFIED,             "5月粗利率
85(16) C_JUNRITU RIGHT-JUSTIFIED,             "6月粗利率
101(16) C_JULRITU RIGHT-JUSTIFIED,            "7月粗利率
117(16) C_AUGRITU RIGHT-JUSTIFIED,            "8月粗利率
133(16) C_SEPRITU RIGHT-JUSTIFIED,            "9月粗利率
149(16) C_OCTRITU RIGHT-JUSTIFIED,            "10月粗利率
165(16) C_NOVRITU RIGHT-JUSTIFIED,            "11月粗利率
181(16) C_DECRITU RIGHT-JUSTIFIED,            "12月粗利率
197(16) C_JANRITU RIGHT-JUSTIFIED,            "1月粗利率
213(16) C_FEBRITU RIGHT-JUSTIFIED,            "2月粗利率
229(16) C_MARRITU RIGHT-JUSTIFIED,            "3月粗利率
245(16) C_ZZARARITUKEI RIGHT-JUSTIFIED,       "粗利率
/01(262) SY-ULINE.                             "下線

*----------------------------------------------------------
***  レポート出力
*----------------------------------------------------------
IF R_DOWN = 'X'.

*　1行目(売上行)
CONCATENATE
FLGHGR                                          "品目階層Gr
SEGTEXT1
FLGHIN                                          "品目階層
SEGTEXT2                                  "品目階層テキスト
TEXT-062                                        "'売上'
C_APRNETWR                                      "4月売上
C_MAYNETWR                                      "5月売上
C_JUNNETWR                                      "6月売上
C_JULNETWR                                      "7月売上
C_AUGNETWR                                      "8月売上
C_SEPNETWR                                      "9月売上
C_OCTNETWR                                      "10月売上
C_NOVNETWR                                      "11月売上
C_DECNETWR                                      "12月売上
C_JANNETWR                                      "1月売上
C_FEBNETWR                                      "2月売上
C_MARNETWR                                      "3月売上
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計列を入れていた処理を削除
*-------------------------------------------------------------------
*            c_netwrkei                                      "売上合計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(粗利行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-063                                      "'粗利'
C_APRARARI                                    "4月粗利
C_MAYARARI                                    "5月粗利
C_JUNARARI                                    "6月粗利
C_JULARARI                                    "7月粗利
C_AUGARARI                                    "8月粗利
C_SEPARARI                                    "9月粗利
C_OCTARARI                                    "10月粗利
C_NOVARARI                                    "11月粗利
C_DECARARI                                    "12月粗利
C_JANARARI                                    "1月粗利
C_FEBARARI                                    "2月粗利
C_MARARARI                                    "3月粗利
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計列を入れていた処理を削除
*-------------------------------------------------------------------
*              c_zzaragakukei                                "粗利計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　3行目(粗利率行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-064                                      "'粗利率'
*-------------------------------------------------------------------
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 粗利率を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprritu                                     "4月粗利率
*              c_mayritu                                     "5月粗利率
*              c_junritu                                     "6月粗利率
*              c_julritu                                     "7月粗利率
*              c_augritu                                     "8月粗利率
*              c_sepritu                                     "9月粗利率
*              c_octritu                                     "10月粗利率
*              c_novritu                                     "11月粗利率
*              c_decritu                                     "12月粗利率
*              c_janritu                                     "1月粗利率
*              c_febritu                                     "2月粗利率
*              c_marritu                                     "3月粗利率
*              c_zzararitukei                                "計粗利率
*-------------------------------------------------------------------
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

ENDIF.

*----------------------------------------------------------
***  品目階層グループ別売上計・粗利計計算
*----------------------------------------------------------
JANNETWRKEI = JANNETWRKEI + JANNETWR.
FEBNETWRKEI = FEBNETWRKEI + FEBNETWR.
MARNETWRKEI = MARNETWRKEI + MARNETWR.
APRNETWRKEI = APRNETWRKEI + APRNETWR.
MAYNETWRKEI = MAYNETWRKEI + MAYNETWR.
JUNNETWRKEI = JUNNETWRKEI + JUNNETWR.
JULNETWRKEI = JULNETWRKEI + JULNETWR.
AUGNETWRKEI = AUGNETWRKEI + AUGNETWR.
SEPNETWRKEI = SEPNETWRKEI + SEPNETWR.
OCTNETWRKEI = OCTNETWRKEI + OCTNETWR.
NOVNETWRKEI = NOVNETWRKEI + NOVNETWR.
DECNETWRKEI = DECNETWRKEI + DECNETWR.
JANARARIKEI = JANARARIKEI + JANARARI.
FEBARARIKEI = FEBARARIKEI + FEBARARI.
MARARARIKEI = MARARARIKEI + MARARARI.
APRARARIKEI = APRARARIKEI + APRARARI.
MAYARARIKEI = MAYARARIKEI + MAYARARI.
JUNARARIKEI = JUNARARIKEI + JUNARARI.
JULARARIKEI = JULARARIKEI + JULARARI.
AUGARARIKEI = AUGARARIKEI + AUGARARI.
SEPARARIKEI = SEPARARIKEI + SEPARARI.
OCTARARIKEI = OCTARARIKEI + OCTARARI.
NOVARARIKEI = NOVARARIKEI + NOVARARI.
DECARARIKEI = DECARARIKEI + DECARARI.
SUM_SEGNETWR = SUM_SEGNETWR + SUM_NETWR.
SUM_SEGARARI = SUM_SEGARARI + SUM_ARARI.

*----------------------------------------------------------
*** 変数初期化
*----------------------------------------------------------
JANNETWR = 0.
FEBNETWR = 0.
MARNETWR = 0.
APRNETWR = 0.
MAYNETWR = 0.
JUNNETWR = 0.
JULNETWR = 0.
AUGNETWR = 0.
SEPNETWR = 0.
OCTNETWR = 0.
NOVNETWR = 0.
DECNETWR = 0.
JANARARI = 0.
FEBARARI = 0.
MARARARI = 0.
APRARARI = 0.
MAYARARI = 0.
JUNARARI = 0.
JULARARI = 0.
AUGARARI = 0.
SEPARARI = 0.
OCTARARI = 0.
NOVARARI = 0.
DECARARI = 0.
SUM_NETWR = 0.
SUM_ARARI = 0.
ENDIF.

***********************************************************
***  品目階層グループが新しい値に変わった時
***********************************************************
IF FLGHGR NE GF_EXEC-PRODH(1).
*----------------------------------------------------------
***  品目階層グループ別の粗利率計算 ( 粗利率 = 粗利計 / 売上計 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利計 / 売上計
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
* 1月
IF JANARARIKEI = 0.
JANRITUKEI = '0.0'.
ELSEIF JANNETWRKEI = 0.
JANRITUKEI = '-100.0'.
ELSEIF ( JANNETWRKEI = JANARARIKEI ).
JANRITUKEI = '100.0'.
ELSE.
JANRITUKEI = ( JANARARIKEI / JANNETWRKEI ) * 100.
ENDIF.
* 2月
IF FEBARARIKEI = 0.
FEBRITUKEI = '0.0'.
ELSEIF FEBNETWRKEI = 0.
FEBRITUKEI = '-100.0'.
ELSEIF ( FEBNETWRKEI = FEBARARIKEI ).
FEBRITUKEI = '100.0'.
ELSE.
FEBRITUKEI = ( FEBARARIKEI / FEBNETWRKEI ) * 100.
ENDIF.
* 3月
IF MARARARIKEI = 0.
MARRITUKEI = '0.0'.
ELSEIF MARNETWRKEI = 0.
MARRITUKEI = '-100.0'.
ELSEIF ( MARNETWRKEI = MARARARIKEI ).
MARRITUKEI = '100.0'.
ELSE.
MARRITUKEI = ( MARARARIKEI / MARNETWRKEI ) * 100.
ENDIF.
* 4月
IF APRARARIKEI = 0.
APRRITUKEI = '0.0'.
ELSEIF APRNETWRKEI = 0.
APRRITUKEI = '-100.0'.
ELSEIF ( APRNETWRKEI = APRARARIKEI ).
APRRITUKEI = '100.0'.
ELSE.
APRRITUKEI = ( APRARARIKEI / APRNETWRKEI ) * 100.
ENDIF.
* 5月
IF MAYARARIKEI = 0.
MAYRITUKEI = '0.0'.
ELSEIF MAYNETWRKEI = 0.
MAYRITUKEI = '-100.0'.
ELSEIF ( MAYNETWRKEI = MAYARARIKEI ).
MAYRITUKEI = '100.0'.
ELSE.
MAYRITUKEI = ( MAYARARIKEI / MAYNETWRKEI ) * 100.
ENDIF.
* 6月
IF JUNARARIKEI = 0.
JUNRITUKEI = '0.0'.
ELSEIF JUNNETWRKEI = 0.
JUNRITUKEI = '-100.0'.
ELSEIF ( JUNNETWRKEI = JUNARARIKEI ).
JUNRITUKEI = '100.0'.
ELSE.
JUNRITUKEI = ( JUNARARIKEI / JUNNETWRKEI ) * 100.
ENDIF.
* 7月
IF JULARARIKEI = 0.
JULRITUKEI = '0.0'.
ELSEIF JULNETWRKEI = 0.
JULRITUKEI = '-100.0'.
ELSEIF ( JULNETWRKEI = JULARARIKEI ).
JULRITUKEI = '100.0'.
ELSE.
JULRITUKEI = ( JULARARIKEI / JULNETWRKEI ) * 100.
ENDIF.
* 8月
IF AUGARARIKEI = 0.
AUGRITUKEI = '0.0'.
ELSEIF AUGNETWRKEI = 0.
AUGRITUKEI = '-100.0'.
ELSEIF ( AUGNETWRKEI = AUGARARIKEI ).
AUGRITUKEI = '100.0'.
ELSE.
AUGRITUKEI = ( AUGARARIKEI / AUGNETWRKEI ) * 100.
ENDIF.
* 9月
IF SEPARARIKEI = 0.
SEPRITUKEI = '0.0'.
ELSEIF SEPNETWRKEI = 0.
SEPRITUKEI = '-100.0'.
ELSEIF ( SEPNETWRKEI = SEPARARIKEI ).
SEPRITUKEI = '100.0'.
ELSE.
SEPRITUKEI = ( SEPARARIKEI / SEPNETWRKEI ) * 100.
ENDIF.
* 10月
IF OCTARARIKEI = 0.
OCTRITUKEI = '0.0'.
ELSEIF OCTNETWRKEI = 0.
OCTRITUKEI = '-100.0'.
ELSEIF ( OCTNETWRKEI = OCTARARIKEI ).
OCTRITUKEI = '100.0'.
ELSE.
OCTRITUKEI = ( OCTARARIKEI / OCTNETWRKEI ) * 100.
ENDIF.
* 11月
IF NOVARARIKEI = 0.
NOVRITUKEI = '0.0'.
ELSEIF NOVNETWRKEI = 0.
NOVRITUKEI = '-100.0'.
ELSEIF ( NOVNETWRKEI = NOVARARIKEI ).
NOVRITUKEI = '100.0'.
ELSE.
NOVRITUKEI = ( NOVARARIKEI / NOVNETWRKEI ) * 100.
ENDIF.
* 12月
IF DECARARIKEI = 0.
DECRITUKEI = '0.0'.
ELSEIF DECNETWRKEI = 0.
DECRITUKEI = '-100.0'.
ELSEIF ( DECNETWRKEI = DECARARIKEI ).
DECRITUKEI = '100.0'.
ELSE.
DECRITUKEI = ( DECARARIKEI / DECNETWRKEI ) * 100.
ENDIF.

*----------------------------------------------------------
*　　セグメント別の売上計・実績計を単位変換された金額で計算する
*----------------------------------------------------------
SUM_SEGNETWR = APRNETWRKEI +
MAYNETWRKEI +
JUNNETWRKEI +
JULNETWRKEI +
AUGNETWRKEI +
SEPNETWRKEI +
OCTNETWRKEI +
NOVNETWRKEI +
DECNETWRKEI +
JANNETWRKEI +
FEBNETWRKEI +
MARNETWRKEI.

SUM_SEGARARI = APRARARIKEI +
MAYARARIKEI +
JUNARARIKEI +
JULARARIKEI +
AUGARARIKEI +
SEPARARIKEI +
OCTARARIKEI +
NOVARARIKEI +
DECARARIKEI +
JANARARIKEI +
FEBARARIKEI +
MARARARIKEI.

*----------------------------------------------------------
***  総合計計算
*----------------------------------------------------------
* 月別売上総計
ALLJANNETWRKEI = ALLJANNETWRKEI + JANNETWRKEI.
ALLFEBNETWRKEI = ALLFEBNETWRKEI + FEBNETWRKEI.
ALLMARNETWRKEI = ALLMARNETWRKEI + MARNETWRKEI.
ALLAPRNETWRKEI = ALLAPRNETWRKEI + APRNETWRKEI.
ALLMAYNETWRKEI = ALLMAYNETWRKEI + MAYNETWRKEI.
ALLJUNNETWRKEI = ALLJUNNETWRKEI + JUNNETWRKEI.
ALLJULNETWRKEI = ALLJULNETWRKEI + JULNETWRKEI.
ALLAUGNETWRKEI = ALLAUGNETWRKEI + AUGNETWRKEI.
ALLSEPNETWRKEI = ALLSEPNETWRKEI + SEPNETWRKEI.
ALLOCTNETWRKEI = ALLOCTNETWRKEI + OCTNETWRKEI.
ALLNOVNETWRKEI = ALLNOVNETWRKEI + NOVNETWRKEI.
ALLDECNETWRKEI = ALLDECNETWRKEI + DECNETWRKEI.
* 月別粗利総計
ALLJANARARIKEI = ALLJANARARIKEI + JANARARIKEI.
ALLFEBARARIKEI = ALLFEBARARIKEI + FEBARARIKEI.
ALLMARARARIKEI = ALLMARARARIKEI + MARARARIKEI.
ALLAPRARARIKEI = ALLAPRARARIKEI + APRARARIKEI.
ALLMAYARARIKEI = ALLMAYARARIKEI + MAYARARIKEI.
ALLJUNARARIKEI = ALLJUNARARIKEI + JUNARARIKEI.
ALLJULARARIKEI = ALLJULARARIKEI + JULARARIKEI.
ALLAUGARARIKEI = ALLAUGARARIKEI + AUGARARIKEI.
ALLSEPARARIKEI = ALLSEPARARIKEI + SEPARARIKEI.
ALLOCTARARIKEI = ALLOCTARARIKEI + OCTARARIKEI.
ALLNOVARARIKEI = ALLNOVARARIKEI + NOVARARIKEI.
ALLDECARARIKEI = ALLDECARARIKEI + DECARARIKEI.
* 総合計
SUM_ALLNETWR = SUM_ALLNETWR + SUM_SEGNETWR.
SUM_ALLARARI = SUM_ALLARARI + SUM_SEGARARI.

*----------------------------------------------------------
***  品目階層グループ別の総粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
IF SUM_SEGARARI = 0.
SUM_SEGRITU = '0.0'.
ELSEIF SUM_SEGNETWR = 0.
SUM_SEGRITU = '-100.0'.
ELSEIF ( SUM_SEGNETWR = SUM_SEGARARI ).
SUM_SEGRITU = '100.0'.
ELSE.
SUM_SEGRITU = ( SUM_SEGARARI / SUM_SEGNETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*** マイナス記号を後から前に移動する
*----------------------------------------------------------
*   数値型を文字型に変換
*----------------------------------------------------------
WRITE:  APRNETWRKEI TO C_APRNETWRKEI,
MAYNETWRKEI TO C_MAYNETWRKEI,
JUNNETWRKEI TO C_JUNNETWRKEI,
JULNETWRKEI TO C_JULNETWRKEI,
AUGNETWRKEI TO C_AUGNETWRKEI,
SEPNETWRKEI TO C_SEPNETWRKEI,
OCTNETWRKEI TO C_OCTNETWRKEI,
NOVNETWRKEI TO C_NOVNETWRKEI,
DECNETWRKEI TO C_DECNETWRKEI,
JANNETWRKEI TO C_JANNETWRKEI,
FEBNETWRKEI TO C_FEBNETWRKEI,
MARNETWRKEI TO C_MARNETWRKEI,
SUM_SEGNETWR TO C_NETWRMONKEI,
APRARARIKEI TO C_APRARARIKEI,
MAYARARIKEI TO C_MAYARARIKEI,
JUNARARIKEI TO C_JUNARARIKEI,
JULARARIKEI TO C_JULARARIKEI,
AUGARARIKEI TO C_AUGARARIKEI,
SEPARARIKEI TO C_SEPARARIKEI,
OCTARARIKEI TO C_OCTARARIKEI,
NOVARARIKEI TO C_NOVARARIKEI,
DECARARIKEI TO C_DECARARIKEI,
JANARARIKEI TO C_JANARARIKEI,
FEBARARIKEI TO C_FEBARARIKEI,
MARARARIKEI TO C_MARARARIKEI,
SUM_SEGARARI TO C_ZZARAMONKEI,
APRRITUKEI  TO C_APRRITUKEI,
MAYRITUKEI  TO C_MAYRITUKEI,
JUNRITUKEI  TO C_JUNRITUKEI,
JULRITUKEI  TO C_JULRITUKEI,
AUGRITUKEI  TO C_AUGRITUKEI,
SEPRITUKEI  TO C_SEPRITUKEI,
OCTRITUKEI  TO C_OCTRITUKEI,
NOVRITUKEI  TO C_NOVRITUKEI,
DECRITUKEI  TO C_DECRITUKEI,
JANRITUKEI  TO C_JANRITUKEI,
FEBRITUKEI  TO C_FEBRITUKEI,
MARRITUKEI  TO C_MARRITUKEI,
SUM_SEGRITU  TO C_ZZRITUMONKEI.

*----------------------------------------------------------
*   汎用モジュール CLOI_PUT_SIGN_IN_FRONTを使用
*----------------------------------------------------------
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NETWRMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARAMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZRITUMONKEI.

*----------------------------------------------------------
***  品目階層グループ計出力
*----------------------------------------------------------
WRITE: /1(03) FLGHGR CENTERED,                        "大区分
4(20) SEGTEXT1 CENTERED,
27(20) '計' CENTERED,
47(06) TEXT-065,                              "'売上計'
53(16) C_APRNETWRKEI RIGHT-JUSTIFIED,         "4月計売上
69(16) C_MAYNETWRKEI RIGHT-JUSTIFIED,         "5月計売上
85(16) C_JUNNETWRKEI RIGHT-JUSTIFIED,         "6月計売上
101(16) C_JULNETWRKEI RIGHT-JUSTIFIED,        "7月計売上
117(16) C_AUGNETWRKEI RIGHT-JUSTIFIED,        "8月売上計
133(16) C_SEPNETWRKEI RIGHT-JUSTIFIED,        "9月売上計
149(16) C_OCTNETWRKEI RIGHT-JUSTIFIED,        "10月売上計
165(16) C_NOVNETWRKEI RIGHT-JUSTIFIED,        "11月売上計
181(16) C_DECNETWRKEI RIGHT-JUSTIFIED,        "12月売上計
197(16) C_JANNETWRKEI RIGHT-JUSTIFIED,        "1月売上計
213(16) C_FEBNETWRKEI RIGHT-JUSTIFIED,        "2月売上計
229(16) C_MARNETWRKEI RIGHT-JUSTIFIED,        "3月売上計
245(16) C_NETWRMONKEI RIGHT-JUSTIFIED,       "売上総計
/47(06) TEXT-066,                             "粗利計
53(16) C_APRARARIKEI RIGHT-JUSTIFIED,         "4月粗利計
69(16) C_MAYARARIKEI RIGHT-JUSTIFIED,         "5月粗利計
85(16) C_JUNARARIKEI RIGHT-JUSTIFIED,         "6月粗利計
101(16) C_JULARARIKEI RIGHT-JUSTIFIED,        "7月粗利計
117(16) C_AUGARARIKEI RIGHT-JUSTIFIED,        "8月粗利計
133(16) C_SEPARARIKEI RIGHT-JUSTIFIED,        "9月粗利計
149(16) C_OCTARARIKEI RIGHT-JUSTIFIED,        "10月粗利計
165(16) C_NOVARARIKEI RIGHT-JUSTIFIED,        "11月粗利計
181(16) C_DECARARIKEI RIGHT-JUSTIFIED,        "12月粗利計
197(16) C_JANARARIKEI RIGHT-JUSTIFIED,        "1月粗利計
213(16) C_FEBARARIKEI RIGHT-JUSTIFIED,        "2月粗利計
229(16) C_MARARARIKEI RIGHT-JUSTIFIED,        "3月粗利計
245(16) C_ZZARAMONKEI RIGHT-JUSTIFIED,       "粗利総計
/47(06) TEXT-064,                             "粗利率
53(16) C_APRRITUKEI RIGHT-JUSTIFIED,         "4月計粗利率
69(16) C_MAYRITUKEI RIGHT-JUSTIFIED,         "5月計粗利率
85(16) C_JUNRITUKEI RIGHT-JUSTIFIED,         "6月計粗利率
101(16) C_JULRITUKEI RIGHT-JUSTIFIED,        "7月計粗利率
117(16) C_AUGRITUKEI RIGHT-JUSTIFIED,        "8月計粗利率
133(16) C_SEPRITUKEI RIGHT-JUSTIFIED,        "9月計粗利率
149(16) C_OCTRITUKEI RIGHT-JUSTIFIED,        "10月計粗利率
165(16) C_NOVRITUKEI RIGHT-JUSTIFIED,        "11月計粗利率
181(16) C_DECRITUKEI RIGHT-JUSTIFIED,        "12月計粗利率
197(16) C_JANRITUKEI RIGHT-JUSTIFIED,        "1月計粗利率
213(16) C_FEBRITUKEI RIGHT-JUSTIFIED,        "2月計粗利率
229(16) C_MARRITUKEI RIGHT-JUSTIFIED,        "3月計粗利率
245(16) C_ZZRITUMONKEI RIGHT-JUSTIFIED,      "総計粗利率
/01(262) SY-ULINE.                            "下線

*----------------------------------------------------------
***  レポート出力
*----------------------------------------------------------
IF R_DOWN = 'X'.

*　数値型を文字型へ変換
C_APRNETWRKEI = APRNETWRKEI.
C_MAYNETWRKEI = MAYNETWRKEI.
C_JUNNETWRKEI = JUNNETWRKEI.
C_JULNETWRKEI = JULNETWRKEI.
C_AUGNETWRKEI = AUGNETWRKEI.
C_SEPNETWRKEI = SEPNETWRKEI.
C_OCTNETWRKEI = OCTNETWRKEI.
C_NOVNETWRKEI = NOVNETWRKEI.
C_DECNETWRKEI = DECNETWRKEI.
C_JANNETWRKEI = JANNETWRKEI.
C_FEBNETWRKEI = FEBNETWRKEI.
C_MARNETWRKEI = MARNETWRKEI.
C_NETWRMONKEI = SUM_SEGNETWR.
C_APRARARIKEI = APRARARIKEI.
C_MAYARARIKEI = MAYARARIKEI.
C_JUNARARIKEI = JUNARARIKEI.
C_JULARARIKEI = JULARARIKEI.
C_AUGARARIKEI = AUGARARIKEI.
C_SEPARARIKEI = SEPARARIKEI.
C_OCTARARIKEI = OCTARARIKEI.
C_NOVARARIKEI = NOVARARIKEI.
C_DECARARIKEI = DECARARIKEI.
C_JANARARIKEI = JANARARIKEI.
C_FEBARARIKEI = FEBARARIKEI.
C_MARARARIKEI = MARARARIKEI.
C_ZZARAMONKEI = SUM_SEGARARI.
C_APRRITUKEI = APRRITUKEI.
C_MAYRITUKEI = MAYRITUKEI.
C_JUNRITUKEI = JUNRITUKEI.
C_JULRITUKEI = JULRITUKEI.
C_AUGRITUKEI = AUGRITUKEI.
C_SEPRITUKEI = SEPRITUKEI.
C_OCTRITUKEI = OCTRITUKEI.
C_NOVRITUKEI = NOVRITUKEI.
C_DECRITUKEI = DECRITUKEI.
C_JANRITUKEI = JANRITUKEI.
C_FEBRITUKEI = FEBRITUKEI.
C_MARRITUKEI = MARRITUKEI.
C_ZZRITUMONKEI = SUM_SEGRITU.

*　1行目(売上計行)
CONCATENATE
FLGHGR                                     "品目階層グループ
SEGTEXT1
SPACE                                         "空白
'計'
TEXT-065                                        "'売上計'
*-------------------------------------------------------------------
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*            c_aprnetwrkei                                   "4月売上計
*            c_maynetwrkei                                   "5月売上計
*            c_junnetwrkei                                   "6月売上計
*            c_julnetwrkei                                   "7月売上計
*            c_augnetwrkei                                   "8月売上計
*            c_sepnetwrkei                                   "9月売上計
*            c_octnetwrkei                                   "10月売上計
*            c_novnetwrkei                                   "11月売上計
*            c_decnetwrkei                                   "12月売上計
*            c_jannetwrkei                                   "1月売上計
*            c_febnetwrkei                                   "2月売上計
*            c_marnetwrkei                                   "3月売上計
*            c_netwrmonkei                                   "売上計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(粗利計)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-066                                      "'粗利計'
*-------------------------------------------------------------------
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprararikei                                 "4月粗利計
*              c_mayararikei                                 "5月粗利計
*              c_junararikei                                 "6月粗利計
*              c_julararikei                                 "7月粗利計
*              c_augararikei                                 "8月粗利計
*              c_separarikei                                 "9月粗利計
*              c_octararikei                                 "10月粗利計
*              c_novararikei                                 "11月粗利計
*              c_decararikei                                 "12月粗利計
*              c_janararikei                                 "1月粗利計
*              c_febararikei                                 "2月粗利計
*              c_marararikei                                 "3月粗利計
*              c_zzaramonkei                                 "粗利計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　3行目(粗利率行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-064                                      "'粗利率'
*-------------------------------------------------------------------
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 粗利率を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprritukei                                  "4月粗利率
*              c_mayritukei                                  "5月粗利率
*              c_junritukei                                  "6月粗利率
*              c_julritukei                                  "7月粗利率
*              c_augritukei                                  "8月粗利率
*              c_sepritukei                                  "9月粗利率
*              c_octritukei                                  "10月粗利率
*              c_novritukei                                  "11月粗利率
*              c_decritukei                                  "12月粗利率
*              c_janritukei                                  "1月粗利率
*              c_febritukei                                  "2月粗利率
*              c_marritukei                                  "3月粗利率
*              c_zzritumonkei                                "粗利率
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--
ENDIF.

*----------------------------------------------------------
*** 変数初期化
*----------------------------------------------------------
JANNETWRKEI = 0.
FEBNETWRKEI = 0.
MARNETWRKEI = 0.
APRNETWRKEI = 0.
MAYNETWRKEI = 0.
JUNNETWRKEI = 0.
JULNETWRKEI = 0.
AUGNETWRKEI = 0.
SEPNETWRKEI = 0.
OCTNETWRKEI = 0.
NOVNETWRKEI = 0.
DECNETWRKEI = 0.
JANARARIKEI = 0.
FEBARARIKEI = 0.
MARARARIKEI = 0.
APRARARIKEI = 0.
MAYARARIKEI = 0.
JUNARARIKEI = 0.
JULARARIKEI = 0.
AUGARARIKEI = 0.
SEPARARIKEI = 0.
OCTARARIKEI = 0.
NOVARARIKEI = 0.
DECARARIKEI = 0.
SUM_SEGNETWR = 0.
SUM_SEGARARI = 0.
SUM_SEGRITU = 0.
ENDIF.

***********************************************************
***  月別売上金額、月別粗利金額計算
*　　取得したS901のデータの年月が
*      抽出条件の年月より前、
*        実績(バージョン '000')の売上・粗利データ取得
*　　  抽出条件の年月以降
*        見直予算(バージョン '002')が存在する場合
*          見直予算(バージョン '002')の売上・粗利データ取得
*        見直予算(バージョン '002')が存在しない場合
*　　　　  期初予算(バージョン '001')の売上・粗利データ取得
***********************************************************

TUKI = GF_EXEC-SPMON+4(2).

*   抽出条件の年月より前の場合
IF ( GF_EXEC-SPMON < S_SPMON ).
IF TUKI = '04'.
IF GF_EXEC-VRSIO = '000'.
APRNETWR = APRNETWR + ( GF_EXEC-NETWR * 100 ).
APRARARI = APRARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '05'.
IF GF_EXEC-VRSIO = '000'.
MAYNETWR = MAYNETWR + ( GF_EXEC-NETWR * 100 ).
MAYARARI = MAYARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '06'.
IF GF_EXEC-VRSIO = '000'.
JUNNETWR = JUNNETWR + ( GF_EXEC-NETWR * 100 ).
JUNARARI = JUNARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '07'.
IF GF_EXEC-VRSIO = '000'.
JULNETWR = JULNETWR + ( GF_EXEC-NETWR * 100 ).
JULARARI = JULARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '08'.
IF GF_EXEC-VRSIO = '000'.
AUGNETWR = AUGNETWR + ( GF_EXEC-NETWR * 100 ).
AUGARARI = AUGARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '09'.
IF GF_EXEC-VRSIO = '000'.
SEPNETWR = SEPNETWR + ( GF_EXEC-NETWR * 100 ).
SEPARARI = SEPARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '10'.
IF GF_EXEC-VRSIO = '000'.
OCTNETWR = OCTNETWR + ( GF_EXEC-NETWR * 100 ).
OCTARARI = OCTARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '11'.
IF GF_EXEC-VRSIO = '000'.
NOVNETWR = NOVNETWR + ( GF_EXEC-NETWR * 100 ).
NOVARARI = NOVARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '12'.
IF GF_EXEC-VRSIO = '000'.
DECNETWR = DECNETWR + ( GF_EXEC-NETWR * 100 ).
DECARARI = DECARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '01'.
IF GF_EXEC-VRSIO = '000'.
JANNETWR = JANNETWR + ( GF_EXEC-NETWR * 100 ).
JANARARI = JANARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '02'.
IF GF_EXEC-VRSIO = '000'.
FEBNETWR = FEBNETWR + ( GF_EXEC-NETWR * 100 ).
FEBARARI = FEBARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ELSEIF TUKI = '03'.
IF GF_EXEC-VRSIO = '000'.
MARNETWR = MARNETWR + ( GF_EXEC-NETWR * 100 ).
MARARARI = MARARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ENDIF.
*   抽出条件の年月以降の場合
ELSE.
* Add 2004.12.27 --->
IF W_VER = '001'.
*  同一データのバージョン'002'が存在しない場合のみバージョン'001'を取得
IF GF_EXEC-VRSIO = '001'.
**　一つ前のデータのバージョンが'000'か'001'の場合
*        IF ( ver = '000' ) OR ( ver = '001' ).
* Add 2004.12.27 <---
IF TUKI = '04'.
APRNETWR = APRNETWR + ( GF_EXEC-NETWR * 100 ).
APRARARI = APRARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '05'.
MAYNETWR = MAYNETWR + ( GF_EXEC-NETWR * 100 ).
MAYARARI = MAYARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '06'.
JUNNETWR = JUNNETWR + ( GF_EXEC-NETWR * 100 ).
JUNARARI = JUNARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '07'.
JULNETWR = JULNETWR + ( GF_EXEC-NETWR * 100 ).
JULARARI = JULARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '08'.
AUGNETWR = AUGNETWR + ( GF_EXEC-NETWR * 100 ).
AUGARARI = AUGARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '09'.
SEPNETWR = SEPNETWR + ( GF_EXEC-NETWR * 100 ).
SEPARARI = SEPARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '10'.
OCTNETWR = OCTNETWR + ( GF_EXEC-NETWR * 100 ).
OCTARARI = OCTARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '11'.
NOVNETWR = NOVNETWR + ( GF_EXEC-NETWR * 100 ).
NOVARARI = NOVARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '12'.
DECNETWR = DECNETWR + ( GF_EXEC-NETWR * 100 ).
DECARARI = DECARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '01'.
JANNETWR = JANNETWR + ( GF_EXEC-NETWR * 100 ).
JANARARI = JANARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '02'.
FEBNETWR = FEBNETWR + ( GF_EXEC-NETWR * 100 ).
FEBARARI = FEBARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '03'.
MARNETWR = MARNETWR + ( GF_EXEC-NETWR * 100 ).
MARARARI = MARARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ENDIF.
* Add 2004.12.27 --->
ELSE.
IF GF_EXEC-VRSIO = '002'.
* Add 2004.12.27 <---
IF TUKI = '04'.
APRNETWR = APRNETWR + ( GF_EXEC-NETWR * 100 ).
APRARARI = APRARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '05'.
MAYNETWR = MAYNETWR + ( GF_EXEC-NETWR * 100 ).
MAYARARI = MAYARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '06'.
JUNNETWR = JUNNETWR + ( GF_EXEC-NETWR * 100 ).
JUNARARI = JUNARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '07'.
JULNETWR = JULNETWR + ( GF_EXEC-NETWR * 100 ).
JULARARI = JULARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '08'.
AUGNETWR = AUGNETWR + ( GF_EXEC-NETWR * 100 ).
AUGARARI = AUGARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '09'.
SEPNETWR = SEPNETWR + ( GF_EXEC-NETWR * 100 ).
SEPARARI = SEPARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '10'.
OCTNETWR = OCTNETWR + ( GF_EXEC-NETWR * 100 ).
OCTARARI = OCTARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '11'.
NOVNETWR = NOVNETWR + ( GF_EXEC-NETWR * 100 ).
NOVARARI = NOVARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '12'.
DECNETWR = DECNETWR + ( GF_EXEC-NETWR * 100 ).
DECARARI = DECARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '01'.
JANNETWR = JANNETWR + ( GF_EXEC-NETWR * 100 ).
JANARARI = JANARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '02'.
FEBNETWR = FEBNETWR + ( GF_EXEC-NETWR * 100 ).
FEBARARI = FEBARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ELSEIF TUKI = '03'.
MARNETWR = MARNETWR + ( GF_EXEC-NETWR * 100 ).
MARARARI = MARARARI + ( GF_EXEC-ZZARAIGAKU * 100 ).
ENDIF.
ENDIF.
ENDIF.
ENDIF.

FLGHIN = GF_EXEC-PRODH.
FLGHGR = GF_EXEC-PRODH(1).
SEGTEXT = GF_EXEC-VTEXT.
VER = GF_EXEC-VRSIO.

***********************************************************
***  ループが最後になった時
***********************************************************
AT LAST.
*----------------------------------------------------------
***  月別粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
* 1月
IF JANARARI = 0.
JANRITU = '0.0'.
ELSEIF JANNETWR = 0.
JANRITU = '-100.0'.
ELSEIF ( JANNETWR = JANARARI ).
JANRITU = '100.0'.
ELSE.
JANRITU = ( JANARARI / JANNETWR ) * 100.
ENDIF.
* 2月
IF FEBARARI = 0.
FEBRITU = '0.0'.
ELSEIF FEBNETWR = 0.
FEBRITU = '-100.0'.
ELSEIF ( FEBNETWR = FEBARARI ).
FEBRITU = '100.0'.
ELSE.
FEBRITU = ( FEBARARI / FEBNETWR ) * 100.
ENDIF.
* 3月
IF MARARARI = 0.
MARRITU = '0.0'.
ELSEIF MARNETWR = 0.
MARRITU = '-100.0'.
ELSEIF ( MARNETWR = MARARARI ).
MARRITU = '100.0'.
ELSE.
MARRITU = ( MARARARI / MARNETWR ) * 100.
ENDIF.
* 4月
IF APRARARI = 0.
APRRITU = '0.0'.
ELSEIF APRNETWR = 0.
APRRITU = '-100.0'.
ELSEIF ( APRNETWR = APRARARI ).
APRRITU = '100.0'.
ELSE.
APRRITU = ( APRARARI / APRNETWR ) * 100.
ENDIF.
* 5月
IF MAYARARI = 0.
MAYRITU = '0.0'.
ELSEIF MAYNETWR = 0.
MAYRITU = '-100.0'.
ELSEIF ( MAYNETWR = MAYARARI ).
MAYRITU = '100.0'.
ELSE.
MAYRITU = ( MAYARARI / MAYNETWR ) * 100.
ENDIF.
* 6月
IF JUNARARI = 0.
JUNRITU = '0.0'.
ELSEIF JUNNETWR = 0.
JUNRITU = '-100.0'.
ELSEIF ( JUNNETWR = JUNARARI ).
JUNRITU = '100.0'.
ELSE.
JUNRITU = ( JUNARARI / JUNNETWR ) * 100.
ENDIF.
* 7月
IF JULARARI = 0.
JULRITU = '0.0'.
ELSEIF JULNETWR = 0.
JULRITU = '-100.0'.
ELSEIF ( JULNETWR = JULARARI ).
JULRITU = '100.0'.
ELSE.
JULRITU = ( JULARARI / JULNETWR ) * 100.
ENDIF.
* 8月
IF AUGARARI = 0.
AUGRITU = '0.0'.
ELSEIF AUGNETWR = 0.
AUGRITU = '-100.0'.
ELSEIF ( AUGNETWR = AUGARARI ).
AUGRITU = '100.0'.
ELSE.
AUGRITU = ( AUGARARI / AUGNETWR ) * 100.
ENDIF.
* 9月
IF SEPARARI = 0.
SEPRITU = '0.0'.
ELSEIF SEPNETWR = 0.
SEPRITU = '-100.0'.
ELSEIF ( SEPNETWR = SEPARARI ).
SEPRITU = '100.0'.
ELSE.
SEPRITU = ( SEPARARI / SEPNETWR ) * 100.
ENDIF.
* 10月
IF OCTARARI = 0.
OCTRITU = '0.0'.
ELSEIF OCTNETWR = 0.
OCTRITU = '-100.0'.
ELSEIF ( OCTNETWR = OCTARARI ).
OCTRITU = '100.0'.
ELSE.
OCTRITU = ( OCTARARI / OCTNETWR ) * 100.
ENDIF.
* 11月
IF NOVARARI = 0.
NOVRITU = '0.0'.
ELSEIF NOVNETWR = 0.
NOVRITU = '-100.0'.
ELSEIF ( NOVNETWR = NOVARARI ).
NOVRITU = '100.0'.
ELSE.
NOVRITU = ( NOVARARI / NOVNETWR ) * 100.
ENDIF.
* 12月
IF DECARARI = 0.
DECRITU = '0.0'.
ELSEIF DECNETWR = 0.
DECRITU = '-100.0'.
ELSEIF ( DECNETWR = DECARARI ).
DECRITU = '100.0'.
ELSE.
DECRITU = ( DECARARI / DECNETWR ) * 100.
ENDIF.

*----------------------------------------------------------
***  金額表示が'千円'の場合
*　　セグメント別の売上計・実績計を単位変換された金額で計算する
*----------------------------------------------------------
IF R_SENEN = 'X'.
SUM_NETWR = APRNETWR +
MAYNETWR +
JUNNETWR +
JULNETWR +
AUGNETWR +
SEPNETWR +
OCTNETWR +
NOVNETWR +
DECNETWR +
JANNETWR +
FEBNETWR +
MARNETWR.

SUM_ARARI = APRARARI +
MAYARARI +
JUNARARI +
JULARARI +
AUGARARI +
SEPARARI +
OCTARARI +
NOVARARI +
DECARARI +
JANARARI +
FEBARARI +
MARARARI.

ENDIF.

*----------------------------------------------------------
***  総粗利率計算 ( 粗利率 = 粗利計 / 売上計 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
IF SUM_ARARI = 0.
SUM_RITU = '0.0'.
ELSEIF SUM_NETWR = 0.
SUM_RITU = '-100.0'.
ELSEIF ( SUM_ARARI = SUM_NETWR ).
SUM_RITU = '100.0'.
ELSE.
SUM_RITU = ( SUM_ARARI / SUM_NETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*** 単位変換(円→千円)
*----------------------------------------------------------
IF R_SENEN = 'X'.
APRNETWR = APRNETWR / 1000.
MAYNETWR = MAYNETWR / 1000.
JUNNETWR = JUNNETWR / 1000.
JULNETWR = JULNETWR / 1000.
AUGNETWR = AUGNETWR / 1000.
SEPNETWR = SEPNETWR / 1000.
OCTNETWR = OCTNETWR / 1000.
NOVNETWR = NOVNETWR / 1000.
DECNETWR = DECNETWR / 1000.
JANNETWR = JANNETWR / 1000.
FEBNETWR = FEBNETWR / 1000.
MARNETWR = MARNETWR / 1000.
SUM_NETWR = SUM_NETWR / 1000.
APRARARI = APRARARI / 1000.
MAYARARI = MAYARARI / 1000.
JUNARARI = JUNARARI / 1000.
JULARARI = JULARARI / 1000.
AUGARARI = AUGARARI / 1000.
SEPARARI = SEPARARI / 1000.
OCTARARI = OCTARARI / 1000.
NOVARARI = NOVARARI / 1000.
DECARARI = DECARARI / 1000.
JANARARI = JANARARI / 1000.
FEBARARI = FEBARARI / 1000.
MARARARI = MARARARI / 1000.
SUM_ARARI = SUM_ARARI / 1000.
ENDIF.

*----------------------------------------------------------
*** マイナス記号を後から前に移動する
*----------------------------------------------------------
*　数値型を文字型へ変換
*----------------------------------------------------------
WRITE:  APRNETWR TO C_APRNETWR,
MAYNETWR TO C_MAYNETWR,
JUNNETWR TO C_JUNNETWR,
JULNETWR TO C_JULNETWR,
AUGNETWR TO C_AUGNETWR,
SEPNETWR TO C_SEPNETWR,
OCTNETWR TO C_OCTNETWR,
NOVNETWR TO C_NOVNETWR,
DECNETWR TO C_DECNETWR,
JANNETWR TO C_JANNETWR,
FEBNETWR TO C_FEBNETWR,
MARNETWR TO C_MARNETWR,
SUM_NETWR TO C_NETWRKEI,
APRARARI TO C_APRARARI,
MAYARARI TO C_MAYARARI,
JUNARARI TO C_JUNARARI,
JULARARI TO C_JULARARI,
AUGARARI TO C_AUGARARI,
SEPARARI TO C_SEPARARI,
OCTARARI TO C_OCTARARI,
NOVARARI TO C_NOVARARI,
DECARARI TO C_DECARARI,
JANARARI TO C_JANARARI,
FEBARARI TO C_FEBARARI,
MARARARI TO C_MARARARI,
SUM_ARARI TO C_ZZARAGAKUKEI,
APRRITU TO C_APRRITU,
MAYRITU TO C_MAYRITU,
JUNRITU TO C_JUNRITU,
JULRITU TO C_JULRITU,
AUGRITU TO C_AUGRITU,
SEPRITU TO C_SEPRITU,
OCTRITU TO C_OCTRITU,
NOVRITU TO C_NOVRITU,
DECRITU TO C_DECRITU,
JANRITU TO C_JANRITU,
FEBRITU TO C_FEBRITU,
MARRITU TO C_MARRITU,
SUM_RITU TO C_ZZARARITUKEI.

*----------------------------------------------------------
*   汎用モジュール CLOI_PUT_SIGN_IN_FRONTを使用
*----------------------------------------------------------
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARNETWR.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARAGAKUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARRITU.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARARITUKEI.

*----------------------------------------------------------
***  品目階層別出力
*----------------------------------------------------------
*  セグメントテキストの分割
*----------------------------------------------------------
* Mod ES-UP 2012/08/31 -->
*      SEARCH segtext FOR '　'.
*      IF ( sy-subrc = 0 ) AND ( sy-fdpos <> 0 ).
*        segnum = sy-fdpos + 2.
*        WRITE: segtext(sy-fdpos) TO segtext1,
*               segtext+segnum TO segtext2.
*      ELSE.
*        WRITE: segtext TO segtext1,
*               segtext TO segtext2.
*      ENDIF.
SPLIT SEGTEXT AT '　' INTO SEGTEXT1 SEGTEXT2.
IF SEGTEXT2 IS INITIAL.
SEGTEXT2 = SEGTEXT1.
ENDIF.
* Mod ES-UP 2012/08/31 <--
WRITE: /1(03) FLGHGR CENTERED,                        "
4(20) SEGTEXT1 CENTERED,                      "大区分
24(3) FLGHIN CENTERED,
27(20) SEGTEXT2 CENTERED,                     "小区分
47(06) TEXT-062,                              "'売上'
53(16) C_APRNETWR RIGHT-JUSTIFIED,            "4月売上
69(16) C_MAYNETWR RIGHT-JUSTIFIED,            "5月売上
85(16) C_JUNNETWR RIGHT-JUSTIFIED,            "6月売上
101(16) C_JULNETWR RIGHT-JUSTIFIED,           "7月売上
117(16) C_AUGNETWR RIGHT-JUSTIFIED,           "8月売上
133(16) C_SEPNETWR RIGHT-JUSTIFIED,           "9月売上
149(16) C_OCTNETWR RIGHT-JUSTIFIED,           "10月売上
165(16) C_NOVNETWR RIGHT-JUSTIFIED,           "11月売上
181(16) C_DECNETWR RIGHT-JUSTIFIED,           "12月売上
197(16) C_JANNETWR RIGHT-JUSTIFIED,           "1月売上
213(16) C_FEBNETWR RIGHT-JUSTIFIED,           "2月売上
229(16) C_MARNETWR RIGHT-JUSTIFIED,           "3月売上
245(16) C_NETWRKEI RIGHT-JUSTIFIED,          "売上計
/47(06) TEXT-063,                             "'粗利'
53(16) C_APRARARI RIGHT-JUSTIFIED,            "4月粗利
69(16) C_MAYARARI RIGHT-JUSTIFIED,            "5月粗利
85(16) C_JUNARARI RIGHT-JUSTIFIED,            "6月粗利
101(16) C_JULARARI RIGHT-JUSTIFIED,           "7月粗利
117(16) C_AUGARARI RIGHT-JUSTIFIED,           "8月粗利
133(16) C_SEPARARI RIGHT-JUSTIFIED,           "9月粗利
149(16) C_OCTARARI RIGHT-JUSTIFIED,           "10月粗利
165(16) C_NOVARARI RIGHT-JUSTIFIED,           "11月粗利
181(16) C_DECARARI RIGHT-JUSTIFIED,           "12月粗利
197(16) C_JANARARI RIGHT-JUSTIFIED,           "1月粗利
213(16) C_FEBARARI RIGHT-JUSTIFIED,           "2月粗利
229(16) C_MARARARI RIGHT-JUSTIFIED,           "3月粗利
245(16) C_ZZARAGAKUKEI RIGHT-JUSTIFIED,      "粗利計
/47(06) TEXT-064,                             "粗利率
53(16) C_APRRITU RIGHT-JUSTIFIED,             "4月粗利率
69(16) C_MAYRITU RIGHT-JUSTIFIED,             "5月粗利率
85(16) C_JUNRITU RIGHT-JUSTIFIED,             "6月粗利率
101(16) C_JULRITU RIGHT-JUSTIFIED,            "7月粗利率
117(16) C_AUGRITU RIGHT-JUSTIFIED,            "8月粗利率
133(16) C_SEPRITU RIGHT-JUSTIFIED,            "9月粗利率
149(16) C_OCTRITU RIGHT-JUSTIFIED,            "10月粗利率
165(16) C_NOVRITU RIGHT-JUSTIFIED,            "11月粗利率
181(16) C_DECRITU RIGHT-JUSTIFIED,            "12月粗利率
197(16) C_JANRITU RIGHT-JUSTIFIED,            "1月粗利率
213(16) C_FEBRITU RIGHT-JUSTIFIED,            "2月粗利率
229(16) C_MARRITU RIGHT-JUSTIFIED,            "3月粗利率
245(16) C_ZZARARITUKEI RIGHT-JUSTIFIED,      "粗利率
/01(262) SY-ULINE.                            "下線

*----------------------------------------------------------
***  レポート出力
*----------------------------------------------------------
IF R_DOWN = 'X'.

*　1行目(売上行)
CONCATENATE
FLGHGR                                          "品目階層Gr
SEGTEXT1
FLGHIN                                          "品目階層
SEGTEXT2                                   "品目階層テキスト
TEXT-062                                        "'売上'
C_APRNETWR                                      "4月売上
C_MAYNETWR                                      "5月売上
C_JUNNETWR                                      "6月売上
C_JULNETWR                                      "7月売上
C_AUGNETWR                                      "8月売上
C_SEPNETWR                                      "9月売上
C_OCTNETWR                                      "10月売上
C_NOVNETWR                                      "11月売上
C_DECNETWR                                      "12月売上
C_JANNETWR                                      "1月売上
C_FEBNETWR                                      "2月売上
C_MARNETWR                                      "3月売上
*-------------------------------------------------------------------
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計列を入れていた処理を削除
*-------------------------------------------------------------------
*            c_netwrkei                                      "売上計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(粗利行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-063                                      "'粗利'
C_APRARARI                                    "4月粗利
C_MAYARARI                                    "5月粗利
C_JUNARARI                                    "6月粗利
C_JULARARI                                    "7月粗利
C_AUGARARI                                    "8月粗利
C_SEPARARI                                    "9月粗利
C_OCTARARI                                    "10月粗利
C_NOVARARI                                    "11月粗利
C_DECARARI                                    "12月粗利
C_JANARARI                                    "1月粗利
C_FEBARARI                                    "2月粗利
C_MARARARI                                    "3月粗利
*-------------------------------------------------------------------
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計列を入れていた処理を削除
*-------------------------------------------------------------------
*              c_zzaragakukei                                "粗利計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　3行目(粗利率)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-064                                      "'粗利率'
*-------------------------------------------------------------------
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 粗利率を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprritu                                     "4月粗利率
*              c_mayritu                                     "5月粗利率
*              c_junritu                                     "6月粗利率
*              c_julritu                                     "7月粗利率
*              c_augritu                                     "8月粗利率
*              c_sepritu                                     "9月粗利率
*             c_octritu                                      "10月粗利率
*             c_novritu                                      "11月粗利率
*             c_decritu                                      "12月粗利率
*              c_janritu                                     "1月粗利率
*              c_febritu                                     "2月粗利率
*              c_marritu                                     "3月粗利率
*              c_zzararitukei                                "粗利率
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

ENDIF.

*----------------------------------------------------------
***  品目階層グループ別売上・粗利計算
*----------------------------------------------------------
JANNETWRKEI = JANNETWRKEI + JANNETWR.
FEBNETWRKEI = FEBNETWRKEI + FEBNETWR.
MARNETWRKEI = MARNETWRKEI + MARNETWR.
APRNETWRKEI = APRNETWRKEI + APRNETWR.
MAYNETWRKEI = MAYNETWRKEI + MAYNETWR.
JUNNETWRKEI = JUNNETWRKEI + JUNNETWR.
JULNETWRKEI = JULNETWRKEI + JULNETWR.
AUGNETWRKEI = AUGNETWRKEI + AUGNETWR.
SEPNETWRKEI = SEPNETWRKEI + SEPNETWR.
OCTNETWRKEI = OCTNETWRKEI + OCTNETWR.
NOVNETWRKEI = NOVNETWRKEI + NOVNETWR.
DECNETWRKEI = DECNETWRKEI + DECNETWR.
JANARARIKEI = JANARARIKEI + JANARARI.
FEBARARIKEI = FEBARARIKEI + FEBARARI.
MARARARIKEI = MARARARIKEI + MARARARI.
APRARARIKEI = APRARARIKEI + APRARARI.
MAYARARIKEI = MAYARARIKEI + MAYARARI.
JUNARARIKEI = JUNARARIKEI + JUNARARI.
JULARARIKEI = JULARARIKEI + JULARARI.
AUGARARIKEI = AUGARARIKEI + AUGARARI.
SEPARARIKEI = SEPARARIKEI + SEPARARI.
OCTARARIKEI = OCTARARIKEI + OCTARARI.
NOVARARIKEI = NOVARARIKEI + NOVARARI.
DECARARIKEI = DECARARIKEI + DECARARI.
SUM_SEGNETWR = SUM_SEGNETWR + SUM_NETWR.
SUM_SEGARARI = SUM_SEGARARI + SUM_ARARI.

*----------------------------------------------------------
***  品目階層グループ別の粗利率計算 ( 粗利率 = 粗利計 / 売上計 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利計 / 売上計
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
* 1月
IF JANARARIKEI = 0.
JANRITUKEI = '0.0'.
ELSEIF JANNETWRKEI = 0.
JANRITUKEI = '-100.0'.
ELSEIF ( JANNETWRKEI = JANARARIKEI ).
JANRITUKEI = '100.0'.
ELSE.
JANRITUKEI = ( JANARARIKEI / JANNETWRKEI ) * 100.
ENDIF.
* 2月
IF FEBARARIKEI = 0.
FEBRITUKEI = '0.0'.
ELSEIF FEBNETWRKEI = 0.
FEBRITUKEI = '-100.0'.
ELSEIF ( FEBNETWRKEI = FEBARARIKEI ).
FEBRITUKEI = '100.0'.
ELSE.
FEBRITUKEI = ( FEBARARIKEI / FEBNETWRKEI ) * 100.
ENDIF.
* 3月
IF MARARARIKEI = 0.
MARRITUKEI = '0.0'.
ELSEIF MARNETWRKEI = 0.
MARRITUKEI = '-100.0'.
ELSEIF ( MARNETWRKEI = MARARARIKEI ).
MARRITUKEI = '100.0'.
ELSE.
MARRITUKEI = ( MARARARIKEI / MARNETWRKEI ) * 100.
ENDIF.
* 4月
IF APRARARIKEI = 0.
APRRITUKEI = '0.0'.
ELSEIF APRNETWRKEI = 0.
APRRITUKEI = '-100.0'.
ELSEIF ( APRNETWRKEI = APRARARIKEI ).
APRRITUKEI = '100.0'.
ELSE.
APRRITUKEI = ( APRARARIKEI / APRNETWRKEI ) * 100.
ENDIF.
* 5月
IF MAYARARIKEI = 0.
MAYRITUKEI = '0.0'.
ELSEIF MAYNETWRKEI = 0.
MAYRITUKEI = '-100.0'.
ELSEIF ( MAYNETWRKEI = MAYARARIKEI ).
MAYRITUKEI = '100.0'.
ELSE.
MAYRITUKEI = ( MAYARARIKEI / MAYNETWRKEI ) * 100.
ENDIF.
* 6月
IF JUNARARIKEI = 0.
JUNRITUKEI = '0.0'.
ELSEIF JUNNETWRKEI = 0.
JUNRITUKEI = '-100.0'.
ELSEIF ( JUNNETWRKEI = JUNARARIKEI ).
JUNRITUKEI = '100.0'.
ELSE.
JUNRITUKEI = ( JUNARARIKEI / JUNNETWRKEI ) * 100.
ENDIF.
* 7月
IF JULARARIKEI = 0.
JULRITUKEI = '0.0'.
ELSEIF JULNETWRKEI = 0.
JULRITUKEI = '-100.0'.
ELSEIF ( JULNETWRKEI = JULARARIKEI ).
JULRITUKEI = '100.0'.
ELSE.
JULRITUKEI = ( JULARARIKEI / JULNETWRKEI ) * 100.
ENDIF.
* 8月
IF AUGARARIKEI = 0.
AUGRITUKEI = '0.0'.
ELSEIF AUGNETWRKEI = 0.
AUGRITUKEI = '-100.0'.
ELSEIF ( AUGNETWRKEI = AUGARARIKEI ).
AUGRITUKEI = '100.0'.
ELSE.
AUGRITUKEI = ( AUGARARIKEI / AUGNETWRKEI ) * 100.
ENDIF.
* 9月
IF SEPARARIKEI = 0.
SEPRITUKEI = '0.0'.
ELSEIF SEPNETWRKEI = 0.
SEPRITUKEI = '-100.0'.
ELSEIF ( SEPNETWRKEI = SEPARARIKEI ).
SEPRITUKEI = '100.0'.
ELSE.
SEPRITUKEI = ( SEPARARIKEI / SEPNETWRKEI ) * 100.
ENDIF.
* 10月
IF OCTARARIKEI = 0.
OCTRITUKEI = '0.0'.
ELSEIF OCTNETWRKEI = 0.
OCTRITUKEI = '-100.0'.
ELSEIF ( OCTNETWRKEI = OCTARARIKEI ).
OCTRITUKEI = '100.0'.
ELSE.
OCTRITUKEI = ( OCTARARIKEI / OCTNETWRKEI ) * 100.
ENDIF.
* 11月
IF NOVARARIKEI = 0.
NOVRITUKEI = '0.0'.
ELSEIF NOVNETWRKEI = 0.
NOVRITUKEI = '-100.0'.
ELSEIF ( NOVNETWRKEI = NOVARARIKEI ).
NOVRITUKEI = '100.0'.
ELSE.
NOVRITUKEI = ( NOVARARIKEI / NOVNETWRKEI ) * 100.
ENDIF.
* 12月
IF DECARARIKEI = 0.
DECRITUKEI = '0.0'.
ELSEIF DECNETWRKEI = 0.
DECRITUKEI = '-100.0'.
ELSEIF ( DECNETWRKEI = DECARARIKEI ).
DECRITUKEI = '100.0'.
ELSE.
DECRITUKEI = ( DECARARIKEI / DECNETWRKEI ) * 100.
ENDIF.

*----------------------------------------------------------
***  金額表示が'千円'の場合
*　　セグメント別の売上計・実績計を単位変換された金額で計算する
*----------------------------------------------------------
IF R_SENEN = 'X'.
SUM_SEGNETWR = APRNETWRKEI +
MAYNETWRKEI +
JUNNETWRKEI +
JULNETWRKEI +
AUGNETWRKEI +
SEPNETWRKEI +
OCTNETWRKEI +
NOVNETWRKEI +
DECNETWRKEI +
JANNETWRKEI +
FEBNETWRKEI +
MARNETWRKEI.

SUM_SEGARARI = APRARARIKEI +
MAYARARIKEI +
JUNARARIKEI +
JULARARIKEI +
AUGARARIKEI +
SEPARARIKEI +
OCTARARIKEI +
NOVARARIKEI +
DECARARIKEI +
JANARARIKEI +
FEBARARIKEI +
MARARARIKEI.

ENDIF.

*----------------------------------------------------------
***  品目階層グループ別の総粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
IF SUM_SEGARARI = 0.
SUM_SEGRITU = '0.0'.
ELSEIF SUM_SEGNETWR = 0.
SUM_SEGRITU = '-100.0'.
ELSEIF ( SUM_SEGNETWR = SUM_SEGARARI ).
SUM_SEGRITU = '100.0'.
ELSE.
SUM_SEGRITU = ( SUM_SEGARARI / SUM_SEGNETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*** マイナス記号を後から前に移動する
*----------------------------------------------------------
*　数値型を文字型へ変換
*----------------------------------------------------------
WRITE:  APRNETWRKEI TO C_APRNETWRKEI,
MAYNETWRKEI TO C_MAYNETWRKEI,
JUNNETWRKEI TO C_JUNNETWRKEI,
JULNETWRKEI TO C_JULNETWRKEI,
AUGNETWRKEI TO C_AUGNETWRKEI,
SEPNETWRKEI TO C_SEPNETWRKEI,
OCTNETWRKEI TO C_OCTNETWRKEI,
NOVNETWRKEI TO C_NOVNETWRKEI,
DECNETWRKEI TO C_DECNETWRKEI,
JANNETWRKEI TO C_JANNETWRKEI,
FEBNETWRKEI TO C_FEBNETWRKEI,
MARNETWRKEI TO C_MARNETWRKEI,
SUM_SEGNETWR TO C_NETWRMONKEI,
APRARARIKEI TO C_APRARARIKEI,
MAYARARIKEI TO C_MAYARARIKEI,
JUNARARIKEI TO C_JUNARARIKEI,
JULARARIKEI TO C_JULARARIKEI,
AUGARARIKEI TO C_AUGARARIKEI,
SEPARARIKEI TO C_SEPARARIKEI,
OCTARARIKEI TO C_OCTARARIKEI,
NOVARARIKEI TO C_NOVARARIKEI,
DECARARIKEI TO C_DECARARIKEI,
JANARARIKEI TO C_JANARARIKEI,
FEBARARIKEI TO C_FEBARARIKEI,
MARARARIKEI TO C_MARARARIKEI,
SUM_SEGARARI TO C_ZZARAMONKEI,
APRRITUKEI TO C_APRRITUKEI,
MAYRITUKEI TO C_MAYRITUKEI,
JUNRITUKEI TO C_JUNRITUKEI,
JULRITUKEI TO C_JULRITUKEI,
AUGRITUKEI TO C_AUGRITUKEI,
SEPRITUKEI TO C_SEPRITUKEI,
OCTRITUKEI TO C_OCTRITUKEI,
NOVRITUKEI TO C_NOVRITUKEI,
DECRITUKEI TO C_DECRITUKEI,
JANRITUKEI TO C_JANRITUKEI,
FEBRITUKEI TO C_FEBRITUKEI,
MARRITUKEI TO C_MARRITUKEI,
SUM_SEGRITU TO C_ZZRITUMONKEI.

*----------------------------------------------------------
*   汎用モジュール CLOI_PUT_SIGN_IN_FRONTを使用
*----------------------------------------------------------
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_AUGARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NETWRMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZARAMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_APRRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MAYRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JUNRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JULRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_SEPRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_OCTRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_NOVRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_DECRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_JANRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_FEBRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_MARARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ZZRITUMONKEI.

*----------------------------------------------------------
***  売上総計・粗利総計計算
*----------------------------------------------------------
* 月別売上総計
ALLJANNETWRKEI = ALLJANNETWRKEI + JANNETWRKEI.
ALLFEBNETWRKEI = ALLFEBNETWRKEI + FEBNETWRKEI.
ALLMARNETWRKEI = ALLMARNETWRKEI + MARNETWRKEI.
ALLAPRNETWRKEI = ALLAPRNETWRKEI + APRNETWRKEI.
ALLMAYNETWRKEI = ALLMAYNETWRKEI + MAYNETWRKEI.
ALLJUNNETWRKEI = ALLJUNNETWRKEI + JUNNETWRKEI.
ALLJULNETWRKEI = ALLJULNETWRKEI + JULNETWRKEI.
ALLAUGNETWRKEI = ALLAUGNETWRKEI + AUGNETWRKEI.
ALLSEPNETWRKEI = ALLSEPNETWRKEI + SEPNETWRKEI.
ALLOCTNETWRKEI = ALLOCTNETWRKEI + OCTNETWRKEI.
ALLNOVNETWRKEI = ALLNOVNETWRKEI + NOVNETWRKEI.
ALLDECNETWRKEI = ALLDECNETWRKEI + DECNETWRKEI.
* 月別粗利総計
ALLJANARARIKEI = ALLJANARARIKEI + JANARARIKEI.
ALLFEBARARIKEI = ALLFEBARARIKEI + FEBARARIKEI.
ALLMARARARIKEI = ALLMARARARIKEI + MARARARIKEI.
ALLAPRARARIKEI = ALLAPRARARIKEI + APRARARIKEI.
ALLMAYARARIKEI = ALLMAYARARIKEI + MAYARARIKEI.
ALLJUNARARIKEI = ALLJUNARARIKEI + JUNARARIKEI.
ALLJULARARIKEI = ALLJULARARIKEI + JULARARIKEI.
ALLAUGARARIKEI = ALLAUGARARIKEI + AUGARARIKEI.
ALLSEPARARIKEI = ALLSEPARARIKEI + SEPARARIKEI.
ALLOCTARARIKEI = ALLOCTARARIKEI + OCTARARIKEI.
ALLNOVARARIKEI = ALLNOVARARIKEI + NOVARARIKEI.
ALLDECARARIKEI = ALLDECARARIKEI + DECARARIKEI.
* 総合計
SUM_ALLNETWR = SUM_ALLNETWR + SUM_SEGNETWR.
SUM_ALLARARI = SUM_ALLARARI + SUM_SEGARARI.

*----------------------------------------------------------
***  総粗利率の月別粗利率計算 ( 粗利率 = 粗利計 / 売上計 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利計 / 売上計
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
* 1月
IF ALLJANARARIKEI = 0.
ALLJANRITUKEI = '0.0'.
ELSEIF ALLJANNETWRKEI = 0.
ALLJANRITUKEI = '-100.0'.
ELSEIF ( ALLJANNETWRKEI = ALLJANARARIKEI ).
ALLJANRITUKEI = '100.0'.
ELSE.
ALLJANRITUKEI = ( ALLJANARARIKEI / ALLJANNETWRKEI ) * 100.
ENDIF.
* 2月
IF ALLFEBARARIKEI = 0.
ALLFEBRITUKEI = '0.0'.
ELSEIF ALLFEBNETWRKEI = 0.
ALLFEBRITUKEI = '-100.0'.
ELSEIF ( ALLFEBNETWRKEI = ALLFEBARARIKEI ).
ALLFEBRITUKEI = '100.0'.
ELSE.
ALLFEBRITUKEI = ( ALLFEBARARIKEI / ALLFEBNETWRKEI ) * 100.
ENDIF.
* 3月
IF ALLMARARARIKEI = 0.
ALLMARRITUKEI = '0.0'.
ELSEIF ALLMARNETWRKEI = 0.
ALLMARRITUKEI = '-100.0'.
ELSEIF ( ALLMARNETWRKEI = ALLMARARARIKEI ).
ALLMARRITUKEI = '100.0'.
ELSE.
ALLMARRITUKEI = ( ALLMARARARIKEI / ALLMARNETWRKEI ) * 100.
ENDIF.
* 4月
IF ALLAPRARARIKEI = 0.
ALLAPRRITUKEI = '0.0'.
ELSEIF ALLAPRNETWRKEI = 0.
ALLAPRRITUKEI = '-100.0'.
ELSEIF ( ALLAPRNETWRKEI = ALLAPRARARIKEI ).
ALLAPRRITUKEI = '100.0'.
ELSE.
ALLAPRRITUKEI = ( ALLAPRARARIKEI / ALLAPRNETWRKEI ) * 100.
ENDIF.
* 5月
IF ALLMAYARARIKEI = 0.
ALLMAYRITUKEI = '0.0'.
ELSEIF ALLMAYNETWRKEI = 0.
ALLMAYRITUKEI = '-100.0'.
ELSEIF ( ALLMAYNETWRKEI = ALLMAYARARIKEI ).
ALLMAYRITUKEI = '100.0'.
ELSE.
ALLMAYRITUKEI = ( ALLMAYARARIKEI / ALLMAYNETWRKEI ) * 100.
ENDIF.
* 6月
IF ALLJUNARARIKEI = 0.
ALLJUNRITUKEI = '0.0'.
ELSEIF ALLJUNNETWRKEI = 0.
ALLJUNRITUKEI = '-100.0'.
ELSEIF ( ALLJUNNETWRKEI = ALLJUNARARIKEI ).
ALLJUNRITUKEI = '100.0'.
ELSE.
ALLJUNRITUKEI = ( ALLJUNARARIKEI / ALLJUNNETWRKEI ) * 100.
ENDIF.
* 7月
IF ALLJULARARIKEI = 0.
ALLJULRITUKEI = '0.0'.
ELSEIF ALLJULNETWRKEI = 0.
ALLJULRITUKEI = '-100.0'.
ELSEIF ( ALLJULNETWRKEI = ALLJULARARIKEI ).
ALLJULRITUKEI = '100.0'.
ELSE.
ALLJULRITUKEI = ( ALLJULARARIKEI / ALLJULNETWRKEI ) * 100.
ENDIF.
* 8月
IF ALLAUGARARIKEI = 0.
ALLAUGRITUKEI = '0.0'.
ELSEIF ALLAUGNETWRKEI = 0.
ALLAUGRITUKEI = '-100.0'.
ELSEIF ( ALLAUGNETWRKEI = ALLAUGARARIKEI ).
ALLAUGRITUKEI = '100.0'.
ELSE.
ALLAUGRITUKEI = ( ALLAUGARARIKEI / ALLAUGNETWRKEI ) * 100.
ENDIF.
* 9月
IF ALLSEPARARIKEI = 0.
ALLSEPRITUKEI = '0.0'.
ELSEIF ALLSEPNETWRKEI = 0.
ALLSEPRITUKEI = '-100.0'.
ELSEIF ( ALLSEPNETWRKEI = ALLSEPARARIKEI ).
ALLSEPRITUKEI = '100.0'.
ELSE.
ALLSEPRITUKEI = ( ALLSEPARARIKEI / ALLSEPNETWRKEI ) * 100.
ENDIF.
* 10月
IF ALLOCTARARIKEI = 0.
ALLOCTRITUKEI = '0.0'.
ELSEIF ALLOCTNETWRKEI = 0.
ALLOCTRITUKEI = '-100.0'.
ELSEIF ( ALLOCTNETWRKEI = ALLOCTARARIKEI ).
ALLOCTRITUKEI = '100.0'.
ELSE.
ALLOCTRITUKEI = ( ALLOCTARARIKEI / ALLOCTNETWRKEI ) * 100.
ENDIF.
* 11月
IF ALLNOVARARIKEI = 0.
ALLNOVRITUKEI = '0.0'.
ELSEIF ALLNOVNETWRKEI = 0.
ALLNOVRITUKEI = '-100.0'.
ELSEIF ( ALLNOVNETWRKEI = ALLNOVARARIKEI ).
ALLNOVRITUKEI = '100.0'.
ELSE.
ALLNOVRITUKEI = ( ALLNOVARARIKEI / ALLNOVNETWRKEI ) * 100.
ENDIF.
* 12月
IF ALLDECARARIKEI = 0.
ALLDECRITUKEI = '0.0'.
ELSEIF ALLDECNETWRKEI = 0.
ALLDECRITUKEI = '-100.0'.
ELSEIF ( ALLDECNETWRKEI = ALLDECARARIKEI ).
ALLDECRITUKEI = '100.0'.
ELSE.
ALLDECRITUKEI = ( ALLDECARARIKEI / ALLDECNETWRKEI ) * 100.
ENDIF.

*----------------------------------------------------------
***  金額表示が'千円'の場合
*　　セグメント別の売上総計・実績総計を単位変換された金額で計算する
*----------------------------------------------------------
IF R_SENEN = 'X'.
SUM_ALLNETWR = ALLAPRNETWRKEI +
ALLMAYNETWRKEI +
ALLJUNNETWRKEI +
ALLJULNETWRKEI +
ALLAUGNETWRKEI +
ALLSEPNETWRKEI +
ALLOCTNETWRKEI +
ALLNOVNETWRKEI +
ALLDECNETWRKEI +
ALLJANNETWRKEI +
ALLFEBNETWRKEI +
ALLMARNETWRKEI.

SUM_ALLARARI = ALLAPRARARIKEI +
ALLMAYARARIKEI +
ALLJUNARARIKEI +
ALLJULARARIKEI +
ALLAUGARARIKEI +
ALLSEPARARIKEI +
ALLOCTARARIKEI +
ALLNOVARARIKEI +
ALLDECARARIKEI +
ALLJANARARIKEI +
ALLFEBARARIKEI +
ALLMARARARIKEI.

ENDIF.

*----------------------------------------------------------
***  総粗利率計算 ( 粗利率 = 粗利 / 売上 )
*    粗利が０の場合、粗利率 0％
*    売上が０の場合、粗利率 -100%
*    売上と粗利が同じ金額・同じ符号の場合、粗利率 100％
*　　その他の場合、粗利率 = 粗利 / 売上
*    (但し、粗利がマイナスの時は粗利率もマイナス)
*----------------------------------------------------------
IF SUM_ALLARARI = 0.
SUM_ALLRITU = '0.0'.
ELSEIF SUM_ALLNETWR = 0.
SUM_ALLRITU = '-100.0'.
ELSEIF ( SUM_ALLNETWR = SUM_ALLARARI ).
SUM_ALLRITU = '100.0'.
ELSE.
SUM_ALLRITU = ( SUM_ALLARARI / SUM_ALLNETWR ) * 100.
ENDIF.

*----------------------------------------------------------
*** マイナス記号を後から前に移動する
*----------------------------------------------------------
*　数値型を文字型へ変換
*----------------------------------------------------------
WRITE:  ALLAPRNETWRKEI TO C_ALLAPRNETWRKEI,
ALLMAYNETWRKEI TO C_ALLMAYNETWRKEI,
ALLJUNNETWRKEI TO C_ALLJUNNETWRKEI,
ALLJULNETWRKEI TO C_ALLJULNETWRKEI,
ALLAUGNETWRKEI TO C_ALLAUGNETWRKEI,
ALLSEPNETWRKEI TO C_ALLSEPNETWRKEI,
ALLOCTNETWRKEI TO C_ALLOCTNETWRKEI,
ALLNOVNETWRKEI TO C_ALLNOVNETWRKEI,
ALLDECNETWRKEI TO C_ALLDECNETWRKEI,
ALLJANNETWRKEI TO C_ALLJANNETWRKEI,
ALLFEBNETWRKEI TO C_ALLFEBNETWRKEI,
ALLMARNETWRKEI TO C_ALLMARNETWRKEI,
SUM_ALLNETWR TO C_ALLNETWRMONKEI,
ALLAPRARARIKEI TO C_ALLAPRARARIKEI,
ALLMAYARARIKEI TO C_ALLMAYARARIKEI,
ALLJUNARARIKEI TO C_ALLJUNARARIKEI,
ALLJULARARIKEI TO C_ALLJULARARIKEI,
ALLAUGARARIKEI TO C_ALLAUGARARIKEI,
ALLSEPARARIKEI TO C_ALLSEPARARIKEI,
ALLOCTARARIKEI TO C_ALLOCTARARIKEI,
ALLNOVARARIKEI TO C_ALLNOVARARIKEI,
ALLDECARARIKEI TO C_ALLDECARARIKEI,
ALLJANARARIKEI TO C_ALLJANARARIKEI,
ALLFEBARARIKEI TO C_ALLFEBARARIKEI,
ALLMARARARIKEI TO C_ALLMARARARIKEI,
SUM_ALLARARI TO C_ALLZZARAMONKEI,
ALLAPRRITUKEI TO C_ALLAPRRITUKEI,
ALLMAYRITUKEI TO C_ALLMAYRITUKEI,
ALLJUNRITUKEI TO C_ALLJUNRITUKEI,
ALLJULRITUKEI TO C_ALLJULRITUKEI,
ALLAUGRITUKEI TO C_ALLAUGRITUKEI,
ALLSEPRITUKEI TO C_ALLSEPRITUKEI,
ALLOCTRITUKEI TO C_ALLOCTRITUKEI,
ALLNOVRITUKEI TO C_ALLNOVRITUKEI,
ALLDECRITUKEI TO C_ALLDECRITUKEI,
ALLJANRITUKEI TO C_ALLJANRITUKEI,
ALLFEBRITUKEI TO C_ALLFEBRITUKEI,
ALLMARRITUKEI TO C_ALLMARRITUKEI,
SUM_ALLRITU TO C_ALLZZRITUMONKEI.

*----------------------------------------------------------
*   汎用モジュール CLOI_PUT_SIGN_IN_FRONTを使用
*----------------------------------------------------------
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLAPRNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMAYNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJUNNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJULNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLAUGNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLSEPNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLOCTNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLNOVNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLDECNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJANNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLFEBNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMARNETWRKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLAPRARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMAYARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJUNARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJULARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLAUGARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLSEPARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLOCTARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLNOVARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLDECARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJANARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLFEBARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMARARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLNETWRMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLZZARAMONKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLAPRRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMAYRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJUNRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJULRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLSEPRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLOCTRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLNOVRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLDECRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLJANRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLFEBRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMARRITUKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLMARARARIKEI.
CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
CHANGING
VALUE = C_ALLZZRITUMONKEI.

*----------------------------------------------------------
***  品目階層グループ別出力
*----------------------------------------------------------
WRITE: /1(03) FLGHGR CENTERED,                        "小区分
4(20) SEGTEXT1 CENTERED,
27(20) '計' CENTERED,
47(06) TEXT-065,                              "売上計
53(16) C_APRNETWRKEI RIGHT-JUSTIFIED,         "4月売上計
69(16) C_MAYNETWRKEI RIGHT-JUSTIFIED,         "5月売上計
85(16) C_JUNNETWRKEI RIGHT-JUSTIFIED,         "6月売上計
101(16) C_JULNETWRKEI RIGHT-JUSTIFIED,        "7月売上計
117(16) C_AUGNETWRKEI RIGHT-JUSTIFIED,        "8月売上計
133(16) C_SEPNETWRKEI RIGHT-JUSTIFIED,        "9月売上計
149(16) C_OCTNETWRKEI RIGHT-JUSTIFIED,        "10月売上計
165(16) C_NOVNETWRKEI RIGHT-JUSTIFIED,        "11月売上計
181(16) C_DECNETWRKEI RIGHT-JUSTIFIED,        "12月売上計
197(16) C_JANNETWRKEI RIGHT-JUSTIFIED,        "1月売上計
213(16) C_FEBNETWRKEI RIGHT-JUSTIFIED,        "2月売上計
229(16) C_MARNETWRKEI RIGHT-JUSTIFIED,        "3月売上計
245(16) C_NETWRMONKEI RIGHT-JUSTIFIED,        "売上計
/47(06) TEXT-066,                              "粗利計
53(16) C_APRARARIKEI RIGHT-JUSTIFIED,         "4月粗利計
69(16) C_MAYARARIKEI RIGHT-JUSTIFIED,         "5月粗利計
85(16) C_JUNARARIKEI RIGHT-JUSTIFIED,         "6月粗利計
101(16) C_JULARARIKEI RIGHT-JUSTIFIED,        "7月粗利計
117(16) C_AUGARARIKEI RIGHT-JUSTIFIED,        "8月粗利計
133(16) C_SEPARARIKEI RIGHT-JUSTIFIED,        "9月粗利計
149(16) C_OCTARARIKEI RIGHT-JUSTIFIED,        "10月粗利計
165(16) C_NOVARARIKEI RIGHT-JUSTIFIED,        "11月粗利計
181(16) C_DECARARIKEI RIGHT-JUSTIFIED,        "12月粗利計
197(16) C_JANARARIKEI RIGHT-JUSTIFIED,        "1月粗利計
213(16) C_FEBARARIKEI RIGHT-JUSTIFIED,        "2月粗利計
229(16) C_MARARARIKEI RIGHT-JUSTIFIED,        "3月粗利計
245(16) C_ZZARAMONKEI RIGHT-JUSTIFIED,        "粗利計
/47(06) TEXT-064,                              "粗利率
53(16) C_APRRITUKEI RIGHT-JUSTIFIED,          "4月粗利率
69(16) C_MAYRITUKEI RIGHT-JUSTIFIED,          "5月粗利率
85(16) C_JUNRITUKEI RIGHT-JUSTIFIED,          "6月粗利率
101(16) C_JULRITUKEI RIGHT-JUSTIFIED,         "7月粗利率
117(16) C_AUGRITUKEI RIGHT-JUSTIFIED,         "8月粗利率
133(16) C_SEPRITUKEI RIGHT-JUSTIFIED,         "9月粗利率
149(16) C_OCTRITUKEI RIGHT-JUSTIFIED,         "10月粗利率
165(16) C_NOVRITUKEI RIGHT-JUSTIFIED,         "11月粗利率
181(16) C_DECRITUKEI RIGHT-JUSTIFIED,         "12月粗利率
197(16) C_JANRITUKEI RIGHT-JUSTIFIED,         "1月粗利率
213(16) C_FEBRITUKEI RIGHT-JUSTIFIED,         "2月粗利率
229(16) C_MARRITUKEI RIGHT-JUSTIFIED,         "3月粗利率
* 2005/01/04 APPEND DMC A.MASUDA START *
*              245(16) c_zzritumonkei,                       "粗利率
245(16) C_ZZRITUMONKEI RIGHT-JUSTIFIED,       "粗利率
* 2005/01/04 APPEND DMC A.MASUDA END   *
/01(262) SY-ULINE.                             "下線

*----------------------------------------------------------
*** 総合計出力
*----------------------------------------------------------
WRITE: /1(03) SPACE,
4(20) SPACE,
27(20) '合計' CENTERED,
47(06) TEXT-065,                               "粗利計
* 2005/01/04 APPEND DMC A.MASUDA START *
54(16) ALLAPRNETWRKEI RIGHT-JUSTIFIED,        "4月売上計
70(16) ALLMAYNETWRKEI RIGHT-JUSTIFIED,        "5月売上計
86(16) ALLJUNNETWRKEI RIGHT-JUSTIFIED,        "6月売上計
102(16) ALLJULNETWRKEI RIGHT-JUSTIFIED,       "7月売上計
118(16) ALLAUGNETWRKEI RIGHT-JUSTIFIED,       "8月売上計
134(16) ALLSEPNETWRKEI RIGHT-JUSTIFIED,       "9月売上計
150(16) ALLOCTNETWRKEI RIGHT-JUSTIFIED,       "10月売上計
166(16) ALLNOVNETWRKEI RIGHT-JUSTIFIED,       "11月売上計
182(16) ALLDECNETWRKEI RIGHT-JUSTIFIED,       "12月売上計
198(16) ALLJANNETWRKEI RIGHT-JUSTIFIED,       "1月売上計
214(16) ALLFEBNETWRKEI RIGHT-JUSTIFIED,       "2月売上計
230(16) ALLMARNETWRKEI RIGHT-JUSTIFIED,       "3月売上計
246(16) SUM_ALLNETWR RIGHT-JUSTIFIED,        "売上計
/47(06) TEXT-066,                              "粗利計
54(16) ALLAPRARARIKEI RIGHT-JUSTIFIED,        "4月粗利計
70(16) ALLMAYARARIKEI RIGHT-JUSTIFIED,        "5月粗利計
86(16) ALLJUNARARIKEI RIGHT-JUSTIFIED,        "6月粗利計
102(16) ALLJULARARIKEI RIGHT-JUSTIFIED,       "7月粗利計
118(16) ALLAUGARARIKEI RIGHT-JUSTIFIED,       "8月粗利計
134(16) ALLSEPARARIKEI RIGHT-JUSTIFIED,       "9月粗利計
150(16) ALLOCTARARIKEI RIGHT-JUSTIFIED,       "10月粗利計
166(16) ALLNOVARARIKEI RIGHT-JUSTIFIED,       "11月粗利計
182(16) ALLDECARARIKEI RIGHT-JUSTIFIED,       "12月粗利計
198(16) ALLJANARARIKEI RIGHT-JUSTIFIED,       "1月粗利計
214(16) ALLFEBARARIKEI RIGHT-JUSTIFIED,       "2月粗利計
230(16) ALLMARARARIKEI RIGHT-JUSTIFIED,       "3月粗利計
246(16) SUM_ALLARARI RIGHT-JUSTIFIED,        "粗利計
/47(06) TEXT-064,                              "粗利率
54(16) ALLAPRRITUKEI RIGHT-JUSTIFIED,         "4月粗利率
70(16) ALLMAYRITUKEI RIGHT-JUSTIFIED,         "5月粗利率
86(16) ALLJUNRITUKEI RIGHT-JUSTIFIED,         "6月粗利率
102(16) ALLJULRITUKEI RIGHT-JUSTIFIED,        "7月粗利率
118(16) ALLAUGRITUKEI RIGHT-JUSTIFIED,        "8月粗利率
134(16) ALLSEPRITUKEI RIGHT-JUSTIFIED,        "9月粗利率
150(16) ALLOCTRITUKEI RIGHT-JUSTIFIED,        "10月粗利率
166(16) ALLNOVRITUKEI RIGHT-JUSTIFIED,        "11月粗利率
182(16) ALLDECRITUKEI RIGHT-JUSTIFIED,        "12月粗利率
198(16) ALLJANRITUKEI RIGHT-JUSTIFIED,        "1月粗利率
214(16) ALLFEBRITUKEI RIGHT-JUSTIFIED,        "2月粗利率
230(16) ALLMARRITUKEI RIGHT-JUSTIFIED,        "3月粗利率
246(16) SUM_ALLRITU RIGHT-JUSTIFIED,       "粗利率
*              53(16) allaprnetwrkei RIGHT-JUSTIFIED,        "4月売上計
*              69(16) allmaynetwrkei RIGHT-JUSTIFIED,        "5月売上計
*              85(16) alljunnetwrkei RIGHT-JUSTIFIED,        "6月売上計
*              101(16) alljulnetwrkei RIGHT-JUSTIFIED,       "7月売上計
*              117(16) allaugnetwrkei RIGHT-JUSTIFIED,       "8月売上計
*              133(16) allsepnetwrkei RIGHT-JUSTIFIED,       "9月売上計
*              149(16) alloctnetwrkei RIGHT-JUSTIFIED,       "10月売上計
*              165(16) allnovnetwrkei RIGHT-JUSTIFIED,       "11月売上計
*              181(16) alldecnetwrkei RIGHT-JUSTIFIED,       "12月売上計
*              197(16) alljannetwrkei RIGHT-JUSTIFIED,       "1月売上計
*              213(16) allfebnetwrkei RIGHT-JUSTIFIED,       "2月売上計
*              229(16) allmarnetwrkei RIGHT-JUSTIFIED,       "3月売上計
*              245(16) sum_allnetwr RIGHT-JUSTIFIED,        "売上計
*             /47(06) text-066,                              "粗利計
*              53(16) allaprararikei RIGHT-JUSTIFIED,        "4月粗利計
*              69(16) allmayararikei RIGHT-JUSTIFIED,        "5月粗利計
*              85(16) alljunararikei RIGHT-JUSTIFIED,        "6月粗利計
*              101(16) alljulararikei RIGHT-JUSTIFIED,       "7月粗利計
*              117(16) allaugararikei RIGHT-JUSTIFIED,       "8月粗利計
*              133(16) allsepararikei RIGHT-JUSTIFIED,       "9月粗利計
*              149(16) alloctararikei RIGHT-JUSTIFIED,       "10月粗利計
*              165(16) allnovararikei RIGHT-JUSTIFIED,       "11月粗利計
*              181(16) alldecararikei RIGHT-JUSTIFIED,       "12月粗利計
*              197(16) alljanararikei RIGHT-JUSTIFIED,       "1月粗利計
*              213(16) allfebararikei RIGHT-JUSTIFIED,       "2月粗利計
*              229(16) allmarararikei RIGHT-JUSTIFIED,       "3月粗利計
*              245(16) sum_allarari RIGHT-JUSTIFIED,        "粗利計
*             /47(06) text-064,                              "粗利率
*              53(16) allaprritukei RIGHT-JUSTIFIED,         "4月粗利率
*              69(16) allmayritukei RIGHT-JUSTIFIED,         "5月粗利率
*              85(16) alljunritukei RIGHT-JUSTIFIED,         "6月粗利率
*              101(16) alljulritukei RIGHT-JUSTIFIED,        "7月粗利率
*              117(16) allaugritukei RIGHT-JUSTIFIED,        "8月粗利率
*              133(16) allsepritukei RIGHT-JUSTIFIED,        "9月粗利率
*              149(16) alloctritukei RIGHT-JUSTIFIED,        "10月粗利率
*              165(16) allnovritukei RIGHT-JUSTIFIED,        "11月粗利率
*              181(16) alldecritukei RIGHT-JUSTIFIED,        "12月粗利率
*              197(16) alljanritukei RIGHT-JUSTIFIED,        "1月粗利率
*              213(16) allfebritukei RIGHT-JUSTIFIED,        "2月粗利率
*              229(16) allmarritukei RIGHT-JUSTIFIED,        "3月粗利率
*              245(16) sum_allritu RIGHT-JUSTIFIED,       "粗利率
* 2005/01/04 APPEND DMC A.MASUDA END   *
/01(262) SY-ULINE.                             "下線

*----------------------------------------------------------
***  レポート出力
*----------------------------------------------------------
IF R_DOWN = 'X'.

*　1行目(売上計行)
CONCATENATE
FLGHGR                                     "品目階層グループ
SEGTEXT1
SPACE
'計'
TEXT-065                                        "'売上計'
*-------------------------------------------------------------------
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*            c_aprnetwrkei                                   "4月売上計
*            c_maynetwrkei                                   "5月売上計
*            c_junnetwrkei                                   "6月売上計
*            c_julnetwrkei                                   "7月売上計
*            c_augnetwrkei                                   "8月売上計
*            c_sepnetwrkei                                   "9月売上計
*           c_octnetwrkei                                    "10月売上計
*           c_novnetwrkei                                    "11月売上計
*           c_decnetwrkei                                    "12月売上計
*            c_jannetwrkei                                   "1月売上計
*            c_febnetwrkei                                   "2月売上計
*            c_marnetwrkei                                   "3月売上計
*            c_netwrmonkei                                   "売上計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(粗利計行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-066                                      "'粗利計'
*-------------------------------------------------------------------
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprararikei                                 "4月粗利計
*              c_mayararikei                                 "5月粗利計
*              c_junararikei                                 "6月粗利計
*              c_julararikei                                 "7月粗利計
*              c_augararikei                                 "8月粗利計
*              c_separarikei                                 "9月粗利計
*             c_octararikei                                  "10月粗利計
*             c_novararikei                                  "11月粗利計
*             c_decararikei                                  "12月粗利計
*              c_janararikei                                 "1月粗利計
*              c_febararikei                                 "2月粗利計
*              c_marararikei                                 "3月粗利計
*              c_zzaramonkei                                 "粗利計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*  3行目(粗利率)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-064                                      "'粗利率'
*-------------------------------------------------------------------
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 粗利率を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprritukei                                  "4月粗利率
*              c_mayritukei                                  "5月粗利率
*              c_junritukei                                  "6月粗利率
*              c_julritukei                                  "7月粗利率
*              c_augritukei                                  "8月粗利率
*              c_sepritukei                                  "9月粗利率
*             c_octritukei                                   "10月粗利率
*             c_novritukei                                   "11月粗利率
*             c_decritukei                                   "12月粗利率
*              c_janritukei                                  "1月粗利率
*              c_febritukei                                  "2月粗利率
*              c_marritukei                                  "3月粗利率
*              c_zzritumonkei                                "粗利率
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*      ENDIF.

*-------------------------------------------------------------------
***  総合計
*-------------------------------------------------------------------
*　1行目(売上総計行)
CONCATENATE
SPACE
SPACE                                         "空白
SPACE                                         "空白
'合計'
TEXT-065                                        "'売上計'
*-------------------------------------------------------------------
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*            c_allaprnetwrkei                                "4月売上計
*            c_allmaynetwrkei                                "5月売上計
*            c_alljunnetwrkei                                "6月売上計
*            c_alljulnetwrkei                                "7月売上計
*            c_allaugnetwrkei                                "8月売上計
*            c_allsepnetwrkei                                "9月売上計
*            c_alloctnetwrkei                                "10月売上計
*            c_allnovnetwrkei                                "11月売上計
*            c_alldecnetwrkei                                "12月売上計
*            c_alljannetwrkei                                "1月売上計
*            c_allfebnetwrkei                                "2月売上計
*            c_allmarnetwrkei                                "3月売上計
*            c_allnetwrmonkei                                "売上計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*　2行目(粗利総計行)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-066                                      "'粗利計'
*-------------------------------------------------------------------
*2005/01/04 A.MASUDA
SPACE
*2005/01/04 A.MASUDA
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
SPACE
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 合計行を入れていた処理を削除
*-------------------------------------------------------------------
*              c_allaprararikei                              "4月粗利計
*              c_allmayararikei                              "5月粗利計
*              c_alljunararikei                              "6月粗利計
*              c_alljulararikei                              "7月粗利計
*              c_allaugararikei                              "8月粗利計
*              c_allsepararikei                              "9月粗利計
*              c_alloctararikei                              "10月粗利計
*              c_allnovararikei                              "11月粗利計
*              c_alldecararikei                              "12月粗利計
*              c_alljanararikei                              "1月粗利計
*              c_allfebararikei                              "2月粗利計
*              c_allmarararikei                              "3月粗利計
*              c_allzzaramonkei                              "粗利計
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

*  3行目(総計粗利率)
CONCATENATE
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
TEXT-064                                      "'粗利率'
*-------------------------------------------------------------------
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
SPACE                                         "空白
*-------------------------------------------------------------------
*  ↑ 空白をyosan_lineに入れる処理を追加
*  UPDATE 2004/06/28 ダウンロード時に粗利率を空白にするため
*  ↓ 粗利率を入れていた処理を削除
*-------------------------------------------------------------------
*              c_aprritukei                                  "4月粗利率
*              c_mayritukei                                  "5月粗利率
*              c_junritukei                                  "6月粗利率
*              c_julritukei                                  "7月粗利率
*              c_augritukei                                  "8月粗利率
*              c_sepritukei                                  "9月粗利率
*              c_octritukei                                  "10月粗利率
*              c_novritukei                                  "11月粗利率
*              c_decritukei                                  "12月粗利率
*              c_janritukei                                  "1月粗利率
*              c_febritukei                                  "2月粗利率
*              c_marritukei                                  "3月粗利率
*              c_zzritumonkei                                "粗利率
*-------------------------------------------------------------------
INTO  YOSAN_LINE
SEPARATED BY W_TAB.
* Mod ES-UP 2012/10/29 -->
CLEAR: GF_YOSANDL.
GF_YOSANDL-YOSAN_LINE = YOSAN_LINE.
*      APPEND yosan_line TO gt_yosandl.
APPEND GF_YOSANDL TO GT_YOSANDL.
* Mod ES-UP 2012/10/29 <--

ENDIF.
ENDAT.
ENDLOOP.
ENDFORM.                    " FRM_WRITE_DETAIL

***********************************************************************
***  ダウンロード処理
***********************************************************************
*---------------------------------------------------------------------*
***  Form  FRM_CHK_FILE
*    ファイル名呼び出し(保存する場所選択画面表示)
*---------------------------------------------------------------------*
FORM FRM_CHK_FILE.
* Del ES-UP 2012/08/15 -->
*  CALL FUNCTION 'WS_FILENAME_GET'
*       EXPORTING
*            mask     = '*.*,ALL Files,*.*. '
*            mode     = 'S'
*            title    = '予算実績データ一覧表'
*       IMPORTING
*            filename = p_file
*       EXCEPTIONS
*            OTHERS   = 5.
*  IF sy-subrc <> 0.
*  ENDIF.
* Del ES-UP 2012/08/15 -->

* Add ES-UP 2012/08/15 -->
DATA: L_FILENAME    TYPE STRING,
L_PATH        TYPE STRING,
L_FULLPATH    TYPE STRING,
L_USER_ACTION TYPE I.

CLEAR: L_FILENAME, L_PATH, L_FULLPATH, L_USER_ACTION.

CL_GUI_FRONTEND_SERVICES=>FILE_SAVE_DIALOG(
EXPORTING
WINDOW_TITLE         = '予算実績データ一覧表'
*      DEFAULT_EXTENSION    = DEFAULT_EXTENSION
*      DEFAULT_FILE_NAME    = L_FULLpath
*      WITH_ENCODING        = WITH_ENCODING
*      FILE_FILTER          = FILE_FILTER
*      INITIAL_DIRECTORY    = INITIAL_DIRECTORY
*      PROMPT_ON_OVERWRITE  = 'X'
CHANGING
FILENAME             = L_FILENAME
PATH                 = L_PATH
FULLPATH             = L_FULLPATH
USER_ACTION          = L_USER_ACTION
*      FILE_ENCODING        = FILE_ENCODING
EXCEPTIONS
CNTL_ERROR           = 1
ERROR_NO_GUI         = 2
NOT_SUPPORTED_BY_GUI = 3
OTHERS               = 4 ).

IF SY-SUBRC = 0 AND L_USER_ACTION = CL_GUI_FRONTEND_SERVICES=>ACTION_OK.
P_FILE = L_FULLPATH.

ENDIF.
* Add ES-UP 2012/08/15 <--


ENDFORM.                    " FRM_CHK_FILE

*---------------------------------------------------------------------*
***  Form  FRM_DATA_DL
*    ローカルサーバにファイルをダウンロード
*---------------------------------------------------------------------*
FORM FRM_DATA_DL.
* Del ES-UP 2012/08/15 -->
*  CALL FUNCTION 'WS_DOWNLOAD'
*       EXPORTING
*            filename                = p_file
*            filetype                = 'DAT'
*            mode                    = ' '
*       TABLES
*            data_tab                = gt_yosandl  "ダウンロードデータ
*       EXCEPTIONS
*            file_open_error         = 1
*            file_write_error        = 2
*            invalid_filesize        = 3
*            invalid_type            = 4
*            no_batch                = 5
*            unknown_error           = 6
*            invalid_table_width     = 7
*            gui_refuse_filetransfer = 8
*            customer_error          = 9
*            OTHERS                  = 10.
* Del ES-UP 2012/08/15 -->
DATA: L_CODEPAGE TYPE ABAP_ENCODING,
**** START ADD 2015/02/03 ISID11 ****
L_Z_OUTPUT_CP TYPE  ZTEGZZM001-Z_OUTPUT_CP,
L_SAPCODEPAGE TYPE STRING,
**** END ADD 2015/02/03 ISID11 ****
L_FILENAME TYPE STRING.

**** START ADD 2015/02/03 ISID11 ****
CALL FUNCTION 'ZEG_ZZ_GLOBAL_PGM_CONFIG_GET'
EXPORTING
IMPPGM      = SY-REPID
IMPBUKRS    = TEXT-101
IMPORTING
EXPCODEPAGE = L_Z_OUTPUT_CP.
**** END ADD 2015/02/03 ISID11 ****

*--- シフトJISのコードページを取得
****START UPD 2014/08/29 ISID18****
*  L_CODEPAGE = CL_ABAP_CODEPAGE=>SAP_CODEPAGE( 'shift_jis' ).
**** START UPD 2015/02/03 ISID11 ****
*  L_CODEPAGE = CL_ABAP_CODEPAGE=>SAP_CODEPAGE( 'UTF-8' ).
L_SAPCODEPAGE = L_Z_OUTPUT_CP.

IF L_SAPCODEPAGE IS NOT INITIAL.

L_CODEPAGE = CL_ABAP_CODEPAGE=>SAP_CODEPAGE( L_SAPCODEPAGE ).

ENDIF.
**** END UPD 2015/02/03 ISID11 ****
****END UPD 2014/08/29 ISID18****
L_FILENAME = P_FILE.

CL_GUI_FRONTEND_SERVICES=>GUI_DOWNLOAD(
EXPORTING
*    BIN_FILESIZE              = BIN_FILESIZE
FILENAME                  = L_FILENAME
FILETYPE                  = 'DAT'
*    APPEND                    = SPACE
*    WRITE_FIELD_SEPARATOR     = SPACE
*    HEADER                    = '00'
*    TRUNC_TRAILING_BLANKS     = SPACE
*    WRITE_LF                  = 'X'
*    COL_SELECT                = SPACE
*    COL_SELECT_MASK           = SPACE
*    DAT_MODE                  = SPACE
*    CONFIRM_OVERWRITE         = SPACE
*    NO_AUTH_CHECK             = SPACE
CODEPAGE                  = L_CODEPAGE
IGNORE_CERR               = ABAP_FALSE
*    REPLACEMENT               = '#'
*    WRITE_BOM                 = SPACE
*    TRUNC_TRAILING_BLANKS_EOL = 'X'
*    WK1_N_FORMAT              = SPACE
*    WK1_N_SIZE                = SPACE
*    WK1_T_FORMAT              = SPACE
*    WK1_T_SIZE                = SPACE
*    SHOW_TRANSFER_STATUS      = 'X'
*    FIELDNAMES                = FIELDNAMES
*    WRITE_LF_AFTER_LAST_LINE  = 'X'
*  IMPORTING
*    FILELENGTH                = FILELENGTH
CHANGING
DATA_TAB                  = GT_YOSANDL
EXCEPTIONS
FILE_WRITE_ERROR          = 1
NO_BATCH                  = 2
GUI_REFUSE_FILETRANSFER   = 3
INVALID_TYPE              = 4
NO_AUTHORITY              = 5
UNKNOWN_ERROR             = 6
HEADER_NOT_ALLOWED        = 7
SEPARATOR_NOT_ALLOWED     = 8
FILESIZE_NOT_ALLOWED      = 9
HEADER_TOO_LONG           = 10
DP_ERROR_CREATE           = 11
DP_ERROR_SEND             = 12
DP_ERROR_WRITE            = 13
UNKNOWN_DP_ERROR          = 14
ACCESS_DENIED             = 15
DP_OUT_OF_MEMORY          = 16
DISK_FULL                 = 17
DP_TIMEOUT                = 18
FILE_NOT_FOUND            = 19
DATAPROVIDER_EXCEPTION    = 20
CONTROL_FLUSH_ERROR       = 21
NOT_SUPPORTED_BY_GUI      = 22
ERROR_NO_GUI              = 23
OTHERS                    = 24 ).

IF SY-SUBRC = 0.
MESSAGE   S400(Z1) WITH 'ダウンロードに成功しました'.
ELSE.
MESSAGE  E400(Z1) WITH 'ダウンロードできませんでした'.
ENDIF.
ENDFORM.                    " FRM_DATA_DL

************************************************************************
* [ƒvƒƒOƒ‰ƒ€–¼]
*   ZS011000         —\’èÀÑ‹y‚Ñ—\’è•\
*
* [ˆ—ŠT—v]
*   Ew’è‚³‚ê‚½‘I‘ğğŒi‰c‹ÆŠAˆ—”NŒ“úAƒo[ƒWƒ‡ƒ“j‚ÉŠY“–‚·‚é
*     “–ŒÀÑA—İŒvÀÑA—\ZA—\’è‚ğWŒv‚µA“–ŒA—İŒvA—\’è‚Ì’ •[
*     ‚ğo—ÍB
*
* [‰ü’è—š—ğ]
*@YYYY/MM/DD   Programar         Description
*  2001/12/19   C . YAMAGUCHI     V‹KŠJ”­@
*  2002/05/27   PSD K.ARAI        ’ •[o—ÍˆÊ’u’²®
*  2002/05/29   PSD K.ARAI        ’ •[o—ÍˆÊ’uÄ’²®
*  2002/06/20   PSD T.SAITOH      ÄˆÚ‘—
*  2002/07/30   PSD T.SAITOH      •¶šC³  ÀÏ¨ÀÑ
*  2003/04/22   NDSC KURI         ‘O”N“xî•ñæ“¾ƒpƒ‰ƒ[ƒ^C³
*               Œ´ˆöF“–”N“xî•ñæ“¾‚Æ‘O”N“xî•ñƒf[ƒ^‚É‚Qdæ“¾‚ª”­¶
*  2004/10/13   DMC murata        ‘I‘ğ‰æ–Ê‚ÉÊŞ°¼Ş®İ‚ğ’Ç‰Á
************************************************************************
report  zs011000 no standard page heading            "•W€ƒwƒbƒ_[‚È‚µ
* APPEND PSD K.ARAI 2002/05/27
line-size 80
line-count 65
message-id z1.
* APPEND END
************************************************************************
*     •Ï”éŒ¾
************************************************************************
data : g_dat2                 type d.                "ˆ—Œ
data : g_mon                  type d.                "‘OŒˆ—Œ
data : g_kisyo                type d.                "Šú‰Œ
data : g_kisyo1               type d.                "‘O”N“xŠú‰Œ
data : g_year                 type d.                "‘O”N“xˆ—Œ
data : g_yosan(3)             type c.                "—\Zƒo[ƒWƒ‡ƒ“
data : g_yotei(3)             type c.                "—\’èƒo[ƒWƒ‡ƒ“
data : g_zen001(8)            type p.                "‘OŒ”„ã—\Z
data : g_zen000(8)            type p.                "‘OŒ”„ãÀÑ
data : g_zenuri000(8)         type p.                "‘OŒ”„ã‘OŠúÀÑ
data : g_rui000(8)            type p.                "—İŒv”„ã—\Z
data : g_rui001(8)            type p.                "—İŒv”„ãÀÑ
data : g_zenrui000(8)         type p.                "—İŒv”„ã‘OŠúÀÑ
data : g_dat001(8)            type p.                "“–Œ”„ã—\Z
data : g_dat901(8)            type p.                "“–Œ”„ã—\’è
data : g_zendat901(8)         type p.                "“–Œ”„ã‘OŠúÀÑ
data : g_zenara001(8)         type p.                "‘OŒ‘e—˜—\Z
data : g_zenara000(8)         type p.                "‘OŒ‘e—˜ÀÑ
data : g_zenarauri(8)         type p.                "‘OŒ‘e—˜‘OŠúÀÑ
data : g_ruiara001(8)         type p.                "—İŒv‘e—˜—\Z
data : g_ruiara000(8)         type p.                "—İŒv‘e—˜ÀÑ
data : g_zenararui(8)         type p.                "—İŒv‘e—˜‘OŠúÀÑ
data : g_datara001(8)         type p.                "“–Œ‘e—˜—\Z
data : g_datara901(8)         type p.                "“–Œ‘e—˜—\’è
data : g_zenaradat(8)         type p.                "“–Œ‘e—˜‘OŠúÀÑ
data : g_zenarariritu001(5)   type p  decimals 1.    "‘OŒ‘e—˜—¦—\Z
data : g_ruiarariritu001(5)   type p  decimals 1.    "—İŒv‘e—˜—¦—\Z
data : g_datarariritu001(5)   type p  decimals 1.    "“–Œ‘e—˜—¦—\Z
data : g_zenarariritu000(5)   type p  decimals 1.    "‘OŒ‘e—˜—¦ÀÑ
data : g_ruiarariritu000(5)   type p  decimals 1.    "—İŒv‘e—˜—¦ÀÑ
data : g_datarariritu901(5)   type p  decimals 1.    "“–Œ‘e—˜—¦—\’è
data : g_zenkiara000(5)       type p  decimals 1.    "‘OŒ‘e—˜—¦‘OŠúÀÑ
data : g_zenkiararui(5)       type p  decimals 1.    "—İŒv‘e—˜—¦‘OŠúÀÑ
data : g_zenkiara901(5)       type p  decimals 1.    "“–Œ‘e—˜—¦‘OŠúÀÑ
data : g_yosan_uri(5)         type p  decimals 1.    "—\Z’B¬—¦i”„ãj
data : g_yosan_ara(5)         type p  decimals 1.    "—\Z’B¬—¦i‘e—˜j
data : g_zen_uri(5)           type p  decimals 1.    "‘OŠú”äi”„ãj
data : g_zen_ara(5)           type p  decimals 1.    "‘OŠú”äi‘e—˜j
data : flg_sub_chek           type p.                "Ì×¸Ş’ •[Ã°ÌŞÙÁª¯¸
data : flg_g_vkb1             like s901-vkbur.       "Ì×¸Ş‰c‹ÆŠº°ÄŞ
data : g_tuki(2)              type p.                "ˆ—Œ‘ã“ü’l
data : flg_tuki(1)            type p.                "ˆ—Œ‚Ìƒtƒ‰ƒO
data : g_mon_count(2)         type p.                "ˆ—ŒŠÔ‚Ì”
data : flg_count              type p.                "ƒ‹[ƒv”ƒtƒ‰ƒO
data : g_name(8)              type c.                "—\ZE—\’è–¼
constants: cns_tvkbt(5)    type c value 'TVKBT'.     "ƒvƒƒOƒ‰ƒ€ID
************************************************************************
*     “à•”ƒe[ƒuƒ‹éŒ¾
************************************************************************
*-----LIS“à•”ƒe[ƒuƒ‹’è‹`----------------------------------------------*

types : begin of table_lis,
vrsion         like s901-vrsio,              "ƒo[ƒWƒ‡ƒ“
spmon          like s901-spmon,              "•ªÍŒ
vkbur          like s901-vkbur,              "‰c‹ÆŠƒR[ƒh
netwr          like s901-netwr,              "Ü–¡Šz
zzaraigaku     like s901-zzaraigaku,         "‘e—˜‹àŠz
end of table_lis.
data gf_lis type table_lis.                          "LIS\‘¢’è‹`@
data gt_lis type table of table_lis.                 "LIS“à•”ƒe[ƒuƒ‹

*-----‰c‹ÆŠ“à•”ƒe[ƒuƒ‹’è‹`-------------------------------------------*
types : begin of table_tvkbt,
vkbur          like tvkbt-vkbur,             "‰c‹ÆŠƒR[ƒh
bezei          like tvkbt-bezei,             "ƒeƒLƒXƒg
end of table_tvkbt.
data : gf_tvkbt type table_tvkbt.                    "‰c‹ÆŠ\‘¢’è‹`
data : gt_tvkbt type table of table_tvkbt.       "‰c‹Æ”“à•”ƒe[ƒuƒ‹’è‹`

*-----’ •[o—Í—p“à•”ƒe[ƒuƒ‹-------------------------------------------*
types : begin of table_type_a,
vkbcd        like tvkbt-vkbur,               "‰c‹ÆŠƒR[ƒh
vkbnm        like tvkbt-bezei,               "‰c‹ÆŠ–¼
rui(1)       type c ,                        "“–ŒA—İŒvA—\’è
uriyo(8)     type p ,                        "”„ã—\Z
arariyo(8)   type p ,                        "‘e—˜—\Z
arari1(15)   type p  decimals 1,             "‘e—˜—¦(—\Zj
uriji(8)     type p ,                        "”„ãÀÑE—\’è
araji(8)     type p ,                        "‘e—˜ÀÑE—\’è
arari2(15)   type p  decimals 1,             "‘e—˜—¦iÀÑj
urizen(8)    type p ,                        "”„ã‘OŠúÀÑ
arazen(8)    type p ,                        "‘e—˜‘OŠúÀÑ
arari3(15)   type p  decimals 1,
"‘e—˜—¦i‘OŠúÀÑj
end of table_type_a.
data : gf_table_1 type table_type_a.                 "’ •[1i‘OŒÀÑj
data : gf_table_2 type table_type_a.                 "’ •[2i—İŒvÀÑj
data : gf_table_3 type table_type_a.                 "’ •[3i“–Œ—\’èj
data : gf_table_a type table_type_a.                 "’ •[\‘¢
data : gf_table_b type table_type_a.
data : gt_table_a type table of table_type_a.        "’ •[“à•”ƒe[ƒuƒ‹
* 2003/04/22 NDSC KURI ADD
data : gw_date  type sy-datum,                       "ì‹Æ—Ìˆæ“ú•t
gw_spmon type s901-spmon.                     "ì‹Æ—ÌˆæŒ

************************************************************************
*      ‰æ–ÊƒŒƒCƒAƒEƒg
************************************************************************
*     ƒtƒB[ƒ‹ƒhì¬
selection-screen begin of block f_field with frame.

*      1s–Ú
selection-screen begin of line.
selection-screen comment 1(20) text-001.
parameters : r_year radiobutton group f_01.          "ƒ‰ƒWƒIƒ{ƒ^ƒ“”NŠÔ
selection-screen comment 30(10) text-002 for field r_year.
parameters : r_mon  radiobutton group f_01.          "ƒ‰ƒWƒIƒ{ƒ^ƒ“ŠúŠÔ
selection-screen comment 42(10) text-003 for field r_mon.
selection-screen end of line.

*     ‚Qs–Ú
selection-screen begin of line.
parameters : r_com radiobutton group f_02.           "ƒ‰ƒWƒIƒ{ƒ^ƒ“‘SĞ
selection-screen comment 5(10) text-004 for field r_com.
selection-screen end of line.

*     ‚Rs–Ú
selection-screen begin of line.
parameters : r_off radiobutton group f_02.           "ƒ‰ƒWƒIƒ{ƒ^ƒ“‰c‹ÆŠ
selection-screen comment 5(10) text-005 for field r_off.
select-options s_vkbur for gf_tvkbt-vkbur.
selection-screen end of line.

*     ƒtƒB[ƒ‹ƒhI—¹
selection-screen end of block f_field.

*     ƒpƒ‰ƒ[ƒ^[“ü—Í‰æ–Ê
parameters : p_datum(6) obligatory default sy-datum. "ˆ—”NŒ

* 2004/10/13 add>>
parameters : p_vrsio  like s901-vrsio obligatory.    "ÊŞ°¼Ş®İ
* 2004/10/13 add<<
**********************************************************************
*    “ü—Íƒ`ƒFƒbƒNˆ—
**********************************************************************
at selection-screen.
*    “ü—Íƒ`ƒFƒbƒN
perform  frm_dat_error.

*    ‘OŒˆ—”NŒAŠú‰Œ‚Ìİ’è
perform frm_datum_month.

*    ƒ‰ƒWƒIƒ{ƒ^ƒ“ƒ`ƒFƒbƒN
perform frm_botan_chek.

*    ƒo[ƒWƒ‡ƒ“İ’è
* 2004/10/13 mod>>  Êß×Ò°À‚ÌÊŞ°¼Ş®İ‚ğ”½‰f‚·‚é
g_yosan = p_vrsio.
*  g_yosan = '001'.                                 "—\Zƒo[ƒWƒ‡ƒ“‚Ìİ
* 2004/10/13 mod<<
g_yotei = '901'.                                 "—\’èƒo[ƒWƒ‡ƒ“‚Ìİ’è
**********************************************************************
*    ƒvƒƒOƒ‰ƒ€ƒƒCƒ“ˆ—
**********************************************************************
start-of-selection.

*    ‰c‹ÆŠ–¼’Šo
perform  frm_gt_tvkbt.

*    “–”N“xî•ñiÀÑE—\ZE—\’èjæ“¾ˆ—
perform frm_gt_lis.

*    ‘O”N“xî•ñiÀÑjæ“¾ˆ—
perform frm_gt_lis_in.

*    LISƒe[ƒuƒ‹‘ÎÛƒf[ƒ^‘¶İƒ`ƒFƒbƒN
perform frm_data_chek.

*    ƒ\[ƒgˆ—
perform frm_sort.

*    “–Šúî•ñİ’èˆ—
perform frm_touki.

*    ‘OŠúî•ñİ’èˆ—
perform frm_zennki.

*    ’ •[o—Í“à•”ƒe[ƒuƒ‹ƒ\[ƒgˆ—
perform frm_sort_gt_table_a.

*    ’ •[o—Í
perform frm_cyouhyou.

**********************************************************************
*    ’ •[ƒwƒbƒ_o—Íˆ—
**********************************************************************
top-of-page.
* APPEND PSD K.ARAI 2002/05/27
skip 2.
* APPEND END.
*    ’ •[ƒwƒbƒ_o—Í
if r_year = 'X'.                                   "”NŠÔ‚¾‚Á‚½‚ç
* MODIFY PSD K.ARAI 2002/05/29
write :  8(4)    '”NŠÔ'.
** MODIFY PSD K.ARAI 2002/05/27
*    WRITE :  4(4)    '”NŠÔ'.
**    WRITE :  2(4)    '”NŠÔ'.
** MODIFY END
* MODIFY END
elseif r_mon = 'X'.                                "ŠúŠÔ‚¾‚Á‚½‚ç
if p_datum+4(2) >= 04 and p_datum+4(2) <= 09.
* MODIFY PSD K.ARAI 2002/05/29
write :  8(4)    'ãŠú'.                      "4`9Œ‚¾‚Á‚½‚çãŠú
** MODIFY PSD K.ARAI 2002/05/27
**      WRITE :  4(4)    'ãŠú'.                     "4`9Œ‚¾‚Á‚½‚çãŠú
**      WRITE :  2(4)    'ãŠú'.                     "4`9Œ‚¾‚Á‚½‚çãŠú
** MODIFY END
* MODIFY END

else.

* MODIFY PSD K.ARAI 2002/05/29
write :  8(4)    '‰ºŠú'.                       "‚»‚êˆÈŠO‚Í‰ºŠú
** MODIFY PSD K.ARAI 2002/05/27
*      WRITE :  4(4)    '‰ºŠú'.                      "‚»‚êˆÈŠO‚Í‰ºŠú
**      WRITE :  2(4)    '‰ºŠú'.                     "‚»‚êˆÈŠO‚Í‰ºŠú
** MODIFY END
* MODIFY END

endif.
endif.

* MODIFY PSD K.ARAI 2002/05/27
write :  26(2)    p_datum+4(2),
28(2)    'Œ',
31(20)   '—\’èEÀÑ‹y‚Ñ—\’è•\',
72(8)   sy-datum+2(6) using edit mask '__/__/__'.
skip 3.
*  WRITE :  16(2)    p_datum+4(2),
*           18(2)    'Œ',
*           21(20)   '—\’èEÀÑ‹y‚Ñ—\’è•\',
*           50(8)   sy-datum+2(6) USING EDIT MASK '__/__/__'.
*  SKIP.
* MODIFY END
if r_com = 'X'.                                    "‘SĞ‚Ìê‡
write : /4(14)   '‘S@Ğ@‡@Œv'.
* MODIFY PSD K.ARAI 2002/05/27
skip.
write : /70(11)   '’PˆÊ : ç‰~'.
skip .
*    WRITE : /49(9)   '’PˆÊ:ç‰~'.
* MODIFY END
else.                                              "‰c‹ÆŠ‚Ìê‡
*   ‰c‹ÆŠ–¼o—Í
write : /4(8)    '‰c‹ÆŠ:',gf_table_a-vkbnm.
* MODIFY PSD K.ARAI 2002/05/27
skip.
write : /70(11)   '’PˆÊ : ç‰~'.
skip .
*    WRITE : /49(9)   '’PˆÊ:ç‰~'.
* MODIFY END
endif.

*&---------------------------------------------------------------------*
*&      Form  FRM_DAT_ERROR
*&---------------------------------------------------------------------*
*       “ü—Íƒ`ƒFƒbƒNˆ—
*----------------------------------------------------------------------*

form frm_dat_error.

*    ˆ—”NŒƒGƒ‰[ƒ`ƒFƒbƒN
g_dat2+4(2) = p_datum+4(2).
if not ( g_dat2+4(2) >= 01 and g_dat2+4(2) <= 12 ).
"1`12Œ‚Å‚È‚©‚Á‚½‚ç
message e009(z1) with text-007.           "MESSAGE'³‚µ‚­‚ ‚è‚Ü‚¹‚ñ
stop.
endif.
endform.                    " FRM_DAT_ERROR

*&---------------------------------------------------------------------*
*&      Form  FRM_DATUM_MONTH
*&---------------------------------------------------------------------*
*        ‘OŒˆ—ŒAŠú‰Œ‚Ìİ’è
*----------------------------------------------------------------------*

form frm_datum_month.
*    ‘OŒˆ—”NŒİ’è
if g_dat2+4(2) = 01.
g_mon(4) = p_datum(4) - 1.
g_mon+4(2) = 12.                                 "“ü—ÍŒ‚ª‚PŒ‚Ì
else.
g_mon(6) = p_datum(6).                           "“ü—ÍŒ‚ª‚PŒˆÈŠO
g_mon+4(2) = g_mon+4(2) - 1.
endif.

*    ƒ‰ƒWƒIƒ{ƒ^ƒ“”NŠÔ‘I‘ğ
if r_year = 'X'.
if
g_mon+4(2) >= 04 and g_mon+4(2) <= 12.          "04`12‚¾‚Á‚½‚ç
g_kisyo(6) = g_mon(6).
g_kisyo+4(2) = 04.                             "ˆ—”N“x‚Ì‚SŒ

elseif
g_mon+4(2) >= 01 and g_mon+4(2) <= 03.           "01`03‚¾‚Á‚½‚ç
g_kisyo(6) = g_mon(6).
g_kisyo(4) = g_kisyo(4) - 1.
g_kisyo+4(2) = 04.                              "ˆ—‘O”N“x‚Ì‚SŒ
endif.
*    ƒ‰ƒWƒIƒ{ƒ^ƒ“ŠúŠÔ‘I‘ğ
else.                                          "ƒ‰ƒWƒIƒ{ƒ^ƒ“ŠúŠÔ‘I‘ğ
if
g_mon+4(2) >= 04 and g_mon+4(2) <= 09.           "04`09‚¾‚Á‚½‚ç
g_kisyo(6) = g_mon(6).
g_kisyo+4(2) = 04.                             "ˆ—”N“x‚Ì‚SŒ

elseif
g_mon+4(2) >= 10 and g_mon+4(2) <= 12.           "10`12‚¾‚Á‚½‚ç
g_kisyo(6) = g_mon(6).
g_kisyo+4(2) = 10.                             "ˆ—”N“x‚Ì10Œ

elseif
g_mon+4(2) >= 01 and g_mon+4(2) <= 03.           "01`03‚¾‚Á‚½‚ç
g_kisyo(6) = g_mon(6).
g_kisyo(4) = g_kisyo(4) - 1.
g_kisyo+4(2) = 10.                              "ˆ—‘O”N“x‚Ì10Œ

endif.

endif.

endform.                    " FRM_DATUM_MONTH

*&---------------------------------------------------------------------*
*&      Form  FRM_BOTAN_CHEK
*&---------------------------------------------------------------------*
*       ƒ‰ƒWƒIƒ{ƒ^ƒ“ƒ`ƒFƒbƒN
*----------------------------------------------------------------------*

form frm_botan_chek.

****‘SĞ‘I‘ğ****************
if  r_com = 'X'.                       "‰c‹ÆŠƒR[ƒh‚ğƒuƒ‰ƒ“ƒN‚É‚·‚é
refresh s_vkbur.
clear   s_vkbur.
endif.

****‰c‹ÆŠ‘I‘ğ***************
if  r_off = 'X'.
*   S_VKBUR‚É’l‚ª“ü‚Á‚Ä‚¢‚È‚©‚Á‚½‚çƒGƒ‰[ƒƒbƒZ[ƒW
if s_vkbur = ' '.
message e006(z1) with text-005.      "MESSAGE'‰c‹ÆŠ‚ğ“ü—Í‚µ‚Ä‰º‚³‚¢
endif.
endif.
endform.                    " FRM_BOTAN_CHEK

*&---------------------------------------------------------------------*
*&      Form  FRM_GT_TVKBT
*&---------------------------------------------------------------------*
*       ‰c‹ÆŠ’Šo
*----------------------------------------------------------------------*

form frm_gt_tvkbt.
*   ‰c‹ÆŠ’Šo
if  r_off = 'X'.
select vkbur bezei from tvkbt
into table gt_tvkbt
where spras = 'J'
and   vkbur in s_vkbur.
case sy-subrc.                                     "ƒƒbƒZ[ƒW
when 0.
when 4.
message s600(z1) with text-005.
stop.
when others.
message a603(z1) with sy-repid cns_tvkbt sy-subrc.
stop.
endcase.
endif.
endform.                    " FRM_GT_TVKBT

*&---------------------------------------------------------------------*
*&      Form  FRM_GT_LIS
*&---------------------------------------------------------------------*
*       “–”N“xî•ñ“à•”ƒe[ƒuƒ‹‚Éæ“¾
*----------------------------------------------------------------------*

form frm_gt_lis.

select vrsio spmon vkbur netwr zzaraigaku  from s901
into table gt_lis
*    ÀÑE—\Zƒo[ƒWƒ‡ƒ“æ“¾
where spmon between g_kisyo(6) and p_datum
and    vkorg  = '1000'
and    vkbur  in s_vkbur
and  ( vrsio  = '000'
or     vrsio  = g_yosan )
*    —\’èƒo[ƒWƒ‡ƒ“æ“¾
or     spmon  = p_datum
and    vkorg  = '1000'
and    vkbur  in s_vkbur
and    vrsio  = g_yotei.
case sy-subrc.
when 0.                        "ƒf[ƒ^‚ª’Šo‚Å‚«‚½‚çˆ—‘±s
when 4.                        "ƒf[ƒ^‚ª’Šo‚Å‚«‚È‚©‚Á‚½‚çˆ—‘±s
when others.                   "ã‹LˆÈŠOƒVƒXƒeƒ€ƒGƒ‰[ƒƒbƒZ[ƒWˆ—
message a603(z1) with sy-repid cns_tvkbt sy-subrc.
endcase.
endform.                    " FRM_GT_LIS

*&---------------------------------------------------------------------*
*&      Form  FRM_GT_LIS
*&---------------------------------------------------------------------*
*       ‘O”N“xî•ñ“à•”ƒe[ƒuƒ‹‚Éæ“¾
*----------------------------------------------------------------------*

form frm_gt_lis_in.
g_kisyo1   = g_kisyo.                            "‘O”N“xŠú‰ŒZo
g_kisyo1(4)   = g_kisyo1(4) - 1.
* 2003/04/22 ADD
* ‘O”N“xî•ñ‚Ì•ªÍŠúŠÔƒpƒ‰ƒ[ƒ^•ÏXÊß×Ò°À‚æ‚è‘OŒZo
clear : gw_date , gw_spmon.
concatenate p_datum '01' into gw_date.
gw_date = gw_date - 1.
gw_date(4)  = gw_date(4) - 1.                    "‘O”N“xˆ—”NŒZo
gw_spmon   = gw_date(06).
g_year     = p_datum.
g_year(4)  = g_year(4) - 1.                      "‘O”N“xˆ—”NŒZo
* 2003/04/22 NDSC KURI ADD SQL•ªŠò 4Œ‚Ìê‡ AND ”NŠÔ‚Ìê‡
*        FTO”NŒ‚©‚ç‚P‚ğˆø‚­B
if p_datum+4(2) = '04' and r_year = 'X'.
select vrsio spmon vkbur netwr zzaraigaku  from s901
appending table gt_lis
* 2003/04/22 NDSC KURI ADD ‘O”N“xˆ—”NŒƒpƒ‰ƒ[ƒ^•ÏX
*                        WHERE SPMON BETWEEN G_KISYO1(6) AND G_YEAR(6)
where spmon between g_kisyo1(6) and gw_spmon
and    vkorg  = '1000'
and    vkbur  in s_vkbur
and    vrsio  = '000'.
else.               " ‚»‚êˆÈŠO
select vrsio spmon vkbur netwr zzaraigaku  from s901
appending table gt_lis
where spmon between g_kisyo1(6) and g_year(6)
and    vkorg  = '1000'
and    vkbur  in s_vkbur
and    vrsio  = '000'.
endif.
case sy-subrc.
when 0.                        "ƒf[ƒ^‚ª’Šo‚Å‚«‚½‚çˆ—‘±s
when 4.                        "ƒf[ƒ^‚ª’Šo‚Å‚«‚È‚©‚Á‚½‚çˆ—‘±s
when others.                   "ã‹LˆÈŠOƒVƒXƒeƒ€ƒGƒ‰[ƒƒbƒZ[ƒWˆ—
message a603(z1) with sy-repid cns_tvkbt sy-subrc.
endcase.
endform.                    " FRM_GT_LIS_IN

*&---------------------------------------------------------------------*
*&      Form  FRM_DATA_CHEK
*&---------------------------------------------------------------------*
*       ‘ÎÛƒf[ƒ^‘¶İƒ`ƒFƒbƒN
*----------------------------------------------------------------------*

form frm_data_chek.

* GT_LIS‚Éƒf[ƒ^‚ªæ“¾‚Å‚«‚È‚©‚Á‚½‚çƒƒbƒZ[ƒW
if gt_lis is initial.
message  s600(z1) with text-006.
stop.
endif.

endform.                    " FRM_DATA_CHEK

*&---------------------------------------------------------------------*
*&      Form  FRM_SORT
*&---------------------------------------------------------------------*
*       ƒ\[ƒgˆ—
*----------------------------------------------------------------------*

form frm_sort.

*       ƒ‰ƒWƒIƒ{ƒ^ƒ“‰ïĞ‚Ìê‡(ƒo[ƒWƒ‡ƒ“¨•ªÍŒ)
if  r_com = 'X'.
sort gt_lis by vrsion spmon.
elseif
*       ƒ‰ƒWƒIƒ{ƒ^ƒ“‰c‹ÆŠ‚Ìê‡(‰c‹ÆŠ¨ƒo[ƒWƒ‡ƒ“¨•ªÍŒ)
r_off = 'X'.
sort gt_lis by vkbur vrsion spmon.
endif.
endform.                    " FRM_SORT

*&---------------------------------------------------------------------*
*&      Form  FRM_MONTH-1
*&---------------------------------------------------------------------*
*       ‘OŒ‚Ì”„ãŠzWŒvˆ—
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
form frm_month-1.
if gf_lis-spmon = g_mon(6).

case gf_lis-vrsion.
*    —\Zƒo[ƒWƒ‡ƒ“i‘OŒ”„ãE‘OŒ‘e—˜Zoj
* 2004/10/13 mod>>          "Êß×Ò°À‚ÌÊŞ°¼Ş®İ‚É•ÏXiŠú‰001orŒ©’¼‚µ002j
when g_yosan.
*      when '001'.
* 2004/10/13 mod<<
g_zen001 = g_zen001 + gf_lis-netwr * 100.
g_zenara001 = g_zenara001 + gf_lis-zzaraigaku * 100.
*    ÀÑƒo[ƒWƒ‡ƒ“i‘OŒ”„ãE‘OŒ‘e—˜Zoj
when '000'.
g_zen000 = g_zen000 + gf_lis-netwr * 100.
g_zenara000 = g_zenara000 + gf_lis-zzaraigaku * 100.
endcase.
endif.

endform.                    " FRM_MONTH-1
*
*&---------------------------------------------------------------------*
*&      Form  FRM_RUIKEI
*&---------------------------------------------------------------------*
*       —İŒv”„ãŠzWŒvˆ—
*----------------------------------------------------------------------*

form frm_ruikei.
if gf_lis-spmon <> p_datum(6).
case gf_lis-vrsion.
*    —\Zƒo[ƒWƒ‡ƒ“i—İŒv”„ãE—İŒv‘e—˜Zoj
* 2004/10/13 mod>>            Êß×Ò°À‚ÌÊŞ°¼Ş®İ‚É•ÏXiŠú‰001orŒ©’¼‚µ002
when g_yosan.
*      when '001'.
* 2004/10/13 mod<<

g_rui001 = g_rui001 + gf_lis-netwr * 100.
g_ruiara001 = g_ruiara001 + gf_lis-zzaraigaku * 100.
*    ÀÑƒo[ƒWƒ‡ƒ“i—İŒv”„ãE—İŒv‘e—˜Zoj
when '000'.
g_rui000 = g_rui000 + gf_lis-netwr * 100.
g_ruiara000 = g_ruiara000 + gf_lis-zzaraigaku * 100.
endcase.
endif.
endform.                    " FRM_RUIKEI
*&---------------------------------------------------------------------*
*&      Form  FRM_MONTH
*&---------------------------------------------------------------------*
*       “–Œ”„ã—\ZWŒvˆ—
*----------------------------------------------------------------------*

form frm_month.
if gf_lis-spmon = p_datum(6).
case gf_lis-vrsion.
*    —\Zƒo[ƒWƒ‡ƒ“i“–Œ”„ãE“–Œ‘e—˜Zoj
* 2004/10/13 mod>>
when g_yosan.
*      when '001'.
* 2004/10/13 mod<<

g_dat001 = g_dat001 + gf_lis-netwr * 100.
g_datara001 = g_datara001 + gf_lis-zzaraigaku * 100.
*    —\’èƒo[ƒWƒ‡ƒ“i“–Œ”„ãE“–Œ‘e—˜Zoj
when '901'.
g_dat901 = g_dat901 + gf_lis-netwr * 100.
g_datara901 = g_datara901 + gf_lis-zzaraigaku * 100.
endcase.
endif.
endform.                    " FRM_MONTH
*&---------------------------------------------------------------------*
*&      Form  FRM_ARARIRITU
*&---------------------------------------------------------------------*
*       ‘e—˜—¦‚ÌZo
*----------------------------------------------------------------------*

form frm_arariritu.
*    ‘e—˜—¦—\Zi‘OŒE—İŒvE“–ŒjZoˆ—
if g_zen001 = 0.                                   "‘OŒ‘e—˜—\ZZo
g_zenarariritu001 = 0.
else.
g_zenarariritu001 = g_zenara001 / g_zen001 * 100.
endif.
if g_rui001 = 0.                                   "—İŒv‘e—˜—\ZZo
g_ruiarariritu001 = 0.
else.
g_ruiarariritu001 = g_ruiara001 / g_rui001 * 100.
endif.
if g_dat001 = 0.                                   "“–Œ‘e—˜—\ZZo
g_datarariritu001 = 0.
else.
g_datarariritu001 = g_datara001 / g_dat001 * 100.
endif.
*    ‘e—˜—¦ÀÑi‘OŒE—İŒvE“–ŒZojˆ—
if g_zen000 = 0.                                   "‘OŒ‘e—˜—¦ÀÑZo
g_zenarariritu000 = 0.
else.
g_zenarariritu000 = g_zenara000 /  g_zen000 * 100.
endif.
if g_rui000 = 0.                                   "—İŒv‘e—˜—¦ÀÑZo
g_ruiarariritu000 = 0.
else.
g_ruiarariritu000 = g_ruiara000 / g_rui000 * 100.
endif.
if g_dat901 = 0.
g_datarariritu901 = 0.                           "“–Œ‘e—˜—¦—\’èZo
else.
g_datarariritu901 = g_datara901 / g_dat901 * 100.
endif.
endform.                    " FRM_ARARIRITU
*&---------------------------------------------------------------------*
*&      Form  FRM_GT_TABLE_A
*&---------------------------------------------------------------------*
*       ’ •[“à•”ƒe[ƒuƒ‹ì¬
*----------------------------------------------------------------------*

form frm_gt_table_a.
*    ‘OŒÀÑƒŒƒR[ƒh
gf_table_1-vkbcd     = gf_tvkbt-vkbur.             "‰c‹ÆŠƒR[ƒh
gf_table_1-rui       = '1'.
gf_table_1-uriyo     = g_zen001.                   "‘OŒ”„ã—\Z
gf_table_1-arariyo   = g_zenara001.                "‘OŒ‘e—˜—\Z
gf_table_1-arari1    = g_zenarariritu001.          "‘OŒ‘e—˜—¦—\Z
gf_table_1-uriji     = g_zen000.                   "‘OŒ”„ãÀÑ
gf_table_1-araji     = g_zenara000.                "‘OŒ‘e—˜—\ÀÑ
gf_table_1-arari2    = g_zenarariritu000.          "‘OŒ‘e—˜—¦ÀÑ
append gf_table_1 to gt_table_a.                   "“à•”ƒe[ƒuƒ‹’Ç‰Á

*    —İŒvÀÑƒŒƒR[ƒh
gf_table_2-vkbcd     = gf_tvkbt-vkbur.             "‰c‹ÆŠƒR[ƒh
gf_table_2-rui       = '2'.
gf_table_2-uriyo     = g_rui001.                   "—İŒv”„ã—\Z
gf_table_2-arariyo   = g_ruiara001.                "—İŒv‘e—˜—\Z
gf_table_2-arari1    = g_ruiarariritu001.          "—İŒv‘e—˜—¦—\Z
gf_table_2-uriji     = g_rui000.                   "—İŒv”„ãÀÑ
gf_table_2-araji     = g_ruiara000.                "—İŒv‘e—˜ÀÑ
gf_table_2-arari2    = g_ruiarariritu000.          "—İŒv‘e—˜—¦ÀÑ
append gf_table_2 to gt_table_a.                   "“à•”ƒe[ƒuƒ‹’Ç‰Á

*    “–Œ—\’èƒŒƒR[ƒh
gf_table_3-vkbcd     = gf_tvkbt-vkbur.             "‰c‹ÆŠƒR[ƒh
gf_table_3-rui       = '3'.
gf_table_3-uriyo     = g_dat001.                   "“–Œ”„ã—\Z
gf_table_3-arariyo   = g_datara001.                "“–Œ‘e—˜—\Z
gf_table_3-arari1    = g_datarariritu001.          "“–Œ‘e—˜—¦—\Z
gf_table_3-uriji     = g_dat901.                   "“–Œ”„ã—\’è
gf_table_3-araji     = g_datara901.                "“–Œ‘e—˜—\’è
gf_table_3-arari2    = g_datarariritu901.          "“–Œ‘e—˜—¦—\’è
append gf_table_3 to gt_table_a.                   "“à•”ƒe[ƒuƒ‹’Ç‰Á

endform.                    " FRM_GT_TABLE_A
*&---------------------------------------------------------------------*
*&      Form  FRM_TOUKI
*&---------------------------------------------------------------------*
*       “–Šúî•ñİ’èˆ—
*----------------------------------------------------------------------*

form frm_touki.
*-------------------------------------------------------------------
*   ’ •[o—Í“à•”ƒe[ƒuƒ‹ì¬ˆ—i‰c‹ÆŠƒ{ƒ^ƒ“‚ª‰Ÿ‚³‚ê‚½ê‡j
*-------------------------------------------------------------------

case r_off.                                        "‰c‹ÆŠ‚Ìê‡
when 'X'.
loop at gt_lis into gf_lis where
spmon >= g_kisyo(6)
and spmon <= p_datum(6).          "Šú‰Œ`ˆ—”NŒŠÔ

*    ‰c‹ÆŠ‚ªƒuƒŒƒCƒN‚µ‚½‚ç(‰c‹ÆŠ–¼E‘e—˜—¦E’ •[ƒe[ƒuƒ‹ì¬j
if flg_g_vkb1 <> gf_lis-vkbur.

if flg_g_vkb1 is initial.
else.

*    ‘e—˜—¦‚ÌZo
perform frm_arariritu.

*    ’ •[“à•”ƒe[ƒuƒ‹ì¬
if flg_count <> 0.            "ƒf[ƒ^‚ª‘¶İ‚µ‚½‚ç“à•”ƒe[ƒuƒ‹ì¬
perform frm_gt_table_a.
endif.

*    ƒf[ƒ^ƒNƒŠƒAˆ—
perform data_clear.
endif.
endif.

*     ‘OŒ‚Ì”„ãŠzWŒvˆ—
perform frm_month-1.

*     —İŒv”„ãŠzWŒvˆ—
perform frm_ruikei.

*    “–Œ”„ã—\ZWŒvˆ—
perform frm_month.
*    ‰c‹ÆŠ–¼İ’è
read table gt_tvkbt into gf_tvkbt with key gf_lis-vkbur.

if sy-subrc = 0.           "‘ÎÛƒf[ƒ^‚ ‚è‰c‹ÆŠ–¼İ’è
gf_table_1-vkbnm  = gf_tvkbt-bezei.
gf_table_2-vkbnm  = gf_tvkbt-bezei.
gf_table_3-vkbnm  = gf_tvkbt-bezei.

else.                      "‘ÎÛƒf[ƒ^‚ª‚È‚µ‰c‹ÆŠ–¼ƒuƒ‰ƒ“ƒN
gf_table_1-vkbnm  = ' '.
gf_table_2-vkbnm  = ' '.
gf_table_3-vkbnm  = ' '.
endif.

flg_g_vkb1 = gf_lis-vkbur.                 "ƒtƒ‰ƒO¤•iƒR[ƒh
flg_count = flg_count + 1.
endloop.

*    ‘e—˜—¦‚ÌZo
perform frm_arariritu.

*    ’ •[“à•”ƒe[ƒuƒ‹ì¬
if flg_count <> 0.             "ƒf[ƒ^‚ª‘¶İ‚µ‚½‚ç“à•”ƒe[ƒuƒ‹ì¬
perform frm_gt_table_a.
endif.

*    ƒf[ƒ^ƒNƒŠƒAˆ—
perform data_clear.

clear  gf_table_1-uriyo.
clear  gf_table_1-arariyo.
clear  gf_table_1-arari1.
clear  gf_table_1-uriji.
clear  gf_table_1-araji.
clear  gf_table_1-arari2.
clear  gf_table_2-uriyo.
clear  gf_table_2-arariyo.
clear  gf_table_2-arari1.
clear  gf_table_2-uriji.
clear  gf_table_2-araji.
clear  gf_table_2-arari2.
clear  gf_table_3-uriyo.
clear  gf_table_3-arariyo.
clear  gf_table_3-arari1.
clear  gf_table_3-uriji.
clear  gf_table_3-araji.
clear  gf_table_3-arari2.
*---------------------------------------------------------------------
*     ’ •[o—Í“à•”ƒe[ƒuƒ‹ì¬ˆ—i‘SĞj
*---------------------------------------------------------------------
when ' '.                                         "‘SĞ‚Ìê‡
loop at gt_lis into gf_lis where
spmon >= g_kisyo(6)
and spmon <= p_datum(6).         "Šú‰Œ`ˆ—”NŒŠÔ

*     ‘OŒ‚Ì”„ãŠzWŒvˆ—
perform frm_month-1.

*     —İŒv”„ãŠzWŒvˆ—
perform frm_ruikei.

*    “–Œ”„ã—\ZWŒvˆ—
perform frm_month.
flg_count = flg_count + 1.
endloop.
*    ‘e—˜—¦‚ÌZo
perform frm_arariritu.

*    ’ •[“à•”ƒe[ƒuƒ‹ì¬
if flg_count <> 0.         "ƒf[ƒ^‚ª‘¶İ‚µ‚½‚ç’ •[“à•”ƒe[ƒuƒ‹ì¬
perform frm_gt_table_a.
endif.
endcase.

endform.                    " FRM_TOUKI
*&---------------------------------------------------------------------*
*&      Form  FRM_ZENNKI
*&---------------------------------------------------------------------*
*       ‘OŠúî•ñİ’èˆ—
*----------------------------------------------------------------------*

form frm_zennki.
*    ‘O”N“xŠú‰ŒEˆ—Œİ’è
*-------------------------------------------------------------------
*    ‘O”N“x’ •[o—Í“à•”ƒe[ƒuƒ‹ì¬ˆ—i‰c‹ÆŠƒ{ƒ^ƒ“‚ª‰Ÿ‚³‚ê‚½ê‡j
*-------------------------------------------------------------------
clear flg_g_vkb1.                              "Ì×¸Ş‰c‹ÆŠº°ÄŞ‰Šú‰»
g_mon(4) = g_mon(4) - 1.                       "‘O”N“x‘OŒˆ—ŒZo
p_datum(4) = p_datum(4) - 1.                   "‘O”N“xˆ—ŒZo

case r_off.                                    "‰c‹ÆŠ‚Ìê‡
when 'X'.

loop at gt_lis into gf_lis where vrsion = '000'
and spmon between g_kisyo1(6) and g_year(6).
"Šú‰Œ-1`ˆ—”NŒ-1ŠÔ

if flg_g_vkb1 <> gf_lis-vkbur.         "‰c‹ÆŠƒR[ƒhƒuƒŒƒCƒN
if flg_g_vkb1 is initial.
else.

*    ‘e—˜—¦ÀÑi‘OŒE—İŒvE“–ŒjZoˆ—
perform frm_zenkiarariritu.

*    ‘OŠú’ •[“à•”ƒe[ƒuƒ‹ì¬
perform frm_zenkigt_table_a.

*    ƒf[ƒ^ƒNƒŠƒAˆ—
perform data_clear.
endif.
endif.

*    ”„ã‘OŠúÀÑi‘OŒA—İŒvA“–ŒjZoˆ—
perform frm_zenki000.

*    ’ •[o—ÍƒŒƒR[ƒh‘¶İƒ`ƒFƒbƒN
read table gt_table_a into gf_table_a
with key vkbcd = gf_lis-vkbur.
flg_sub_chek  = sy-subrc. "’ •[“à•”ƒe[ƒuƒ‹ƒ`ƒFƒbƒNƒtƒ‰ƒO

if r_off = 'X'.         "‚©‚Â‰c‹ÆŠƒ{ƒ^ƒ“‚ª‰Ÿ‚³‚ê‚Ä‚éê‡

*    ‰c‹ÆŠ–¼İ’èˆ—
read table gt_tvkbt into gf_tvkbt with key gf_lis-vkbur.

if sy-subrc = 0.    "‘ÎÛƒf[ƒ^‚ ‚èi‰c‹ÆŠ–¼İ’èj
gf_table_1-vkbnm  = gf_tvkbt-bezei.
gf_table_2-vkbnm  = gf_tvkbt-bezei.
gf_table_3-vkbnm  = gf_tvkbt-bezei.

else.                "‰c‹ÆŠ–¼‚È‚µiƒuƒ‰ƒ“ƒNjİ’è
gf_table_1-vkbnm  = ' '.
gf_table_2-vkbnm  = ' '.
gf_table_3-vkbnm  = ' '.
endif.
endif.
flg_g_vkb1 = gf_lis-vkbur.                "‘O”N“xƒtƒ‰ƒO
endloop.

*    ‘e—˜—¦ÀÑi‘OŒE—İŒvE“–ŒjZoˆ—
perform frm_zenkiarariritu.

*    ‘OŠú’ •[“à•”ƒe[ƒuƒ‹ì¬
perform frm_zenkigt_table_a.

*    ƒf[ƒ^ƒNƒŠƒAˆ—
perform data_clear.

*---------------------------------------------------------------------
*     ‘O”N“x’ •[o—Í“à•”ƒe[ƒuƒ‹ì¬ˆ—i‘SĞj
*---------------------------------------------------------------------
when ' '.                                       "‘SĞ‚Ìê‡
*    ’ •[o—ÍƒŒƒR[ƒh‘¶İƒ`ƒFƒbƒN
if gt_table_a is initial.
flg_sub_chek  =  4.
else.
flg_sub_chek =  0.
endif.

loop at gt_lis into gf_lis where vrsion = '000'
and  spmon >= g_kisyo1(6)
and  spmon <= g_year(6).             "Šú‰Œ-1`ˆ—”NŒ-1

*    ‘O”N“x”„ã‘OŠúÀÑi‘OŒA—İŒvA“–ŒjZoˆ—
perform frm_zenki000.
endloop.
*    ‘O”N“x‘e—˜—¦ÀÑi‘OŒE—İŒvE“–ŒjZoˆ—
perform frm_zenkiarariritu.
*    ‘O”N“x‘OŠú’ •[“à•”ƒe[ƒuƒ‹ì¬
perform frm_zenkigt_table_a.
endcase.
endform.                    " FRM_ZENNKI
*&---------------------------------------------------------------------*
*&      Form  ZENKI000
*&---------------------------------------------------------------------*
*      ”„ã‘OŠúÀÑi‘OŒA—İŒvA“–Œj
*----------------------------------------------------------------------*

form frm_zenki000.
*    ”„ã‘OŠúÀÑi‘OŒjZoˆ—

if gf_lis-spmon = g_mon(6).
case gf_lis-vrsion.
*    ÀÑƒo[ƒWƒ‡ƒ“i‘OŒ”„ãE‘OŒ‘e—˜jZoˆ—
when '000'.
g_zenuri000 = g_zenuri000 + gf_lis-netwr * 100.
g_zenarauri = g_zenarauri + gf_lis-zzaraigaku * 100.
endcase.
endif.

*     ”„ã‘OŠúÀÑi—İŒvjZoˆ—
if gf_lis-spmon <> p_datum(6).
case gf_lis-vrsion.
*    ÀÑƒo[ƒWƒ‡ƒ“i—İŒv”„ãE—İŒv‘e—˜jZoˆ—
when '000'.
g_zenrui000 = g_zenrui000 + gf_lis-netwr * 100.
g_zenararui = g_zenararui + gf_lis-zzaraigaku * 100.
endcase.
endif.

*    ”„ã‘OŠú—\’èi“–ŒjZoˆ—
if gf_lis-spmon = p_datum(6).
case gf_lis-vrsion.
*    —\’èƒo[ƒWƒ‡ƒ“i“–Œ”„ãE“–Œ‘e—˜jZoˆ—
when '000'.
g_zendat901 = g_zendat901 + gf_lis-netwr * 100.
g_zenaradat = g_zenaradat + gf_lis-zzaraigaku * 100.
endcase.
endif.

endform.                                                    " ZENKI000
*&---------------------------------------------------------------------*
*&      Form  FRM_ZENKIARARIRITU
*&---------------------------------------------------------------------*
*       ‘e—˜—¦ÀÑi‘OŒE—İŒvE“–Œjˆ—
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
form frm_zenkiarariritu.
*    ‘O”N“x‘OŠú‘e—˜—¦ÀÑi‘OŒE—İŒvE“–ŒjZoˆ—
if g_zenuri000 = 0.                              "‘OŒ‘e—˜—¦ÀÑZo
g_zenkiara000 = 0.
else.
g_zenkiara000 = g_zenarauri /  g_zenuri000 * 100.
endif.
if g_zenrui000 = 0.                              "—İŒv‘e—˜—¦ÀÑZo
g_zenkiararui = 0.
else.
g_zenkiararui = g_zenararui / g_zenrui000 * 100.
endif.
if g_zendat901 = 0.
g_zenkiara901 = 0.                             "“–Œ‘e—˜—¦—\’èZo
else.
g_zenkiara901 = g_zenaradat / g_zendat901 * 100.
endif.
endform.                    " FRM_ZENKIARARIRITU
*&---------------------------------------------------------------------*
*&      Form  FRM_ZENKIGT_TABLE_A
*&---------------------------------------------------------------------*
*       ‘OŠúÀÑ“à•”ƒe[ƒuƒ‹ì¬
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
form frm_zenkigt_table_a.
*    ‘OŒÀÑƒŒƒR[ƒh
gf_table_1-vkbcd    = gf_tvkbt-vkbur.            "‰c‹ÆŠƒR[ƒh
gf_table_1-vkbnm    = gf_tvkbt-bezei.            "‰c‹ÆŠ–¼
gf_table_1-rui      = '1'.
gf_table_1-urizen   = g_zenuri000.               "‘O”N“x‘OŠú”„ãÀÑ
gf_table_1-arazen   = g_zenarauri.               "‘O”N“x‘OŠú‘e—˜ÀÑ
gf_table_1-arari3   = g_zenkiara000.             "‘O”N“x‘OŠú‘e—˜—¦ÀÑ
*  ‚·‚Å‚É’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚½ê‡XVˆ—
if flg_sub_chek = 0.
modify gt_table_a from gf_table_1
transporting urizen arazen arari3
where  vkbcd  = gf_table_1-vkbcd
and    vkbnm  = gf_table_1-vkbnm
and    rui    = gf_table_1-rui.
*  ’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚È‚¢ê‡’Ç‰Áˆ—
else.
append gf_table_1 to gt_table_a.
endif.

*    —İŒvÀÑƒŒƒR[ƒh
gf_table_2-vkbcd    = gf_tvkbt-vkbur.            "‰c‹ÆŠƒR[ƒh
gf_table_2-vkbnm    = gf_tvkbt-bezei.            "‰c‹ÆŠ–¼
gf_table_2-rui      = '2'.
gf_table_2-urizen   = g_zenrui000.               "‘O”N“x‘OŠú”„ã—İŒv
gf_table_2-arazen   = g_zenararui.               "‘O”N“x‘OŠú‘e—˜—İŒv
gf_table_2-arari3   = g_zenkiararui.             "‘O”N“x‘OŠú‘e—˜—¦—İŒv
*  ‚·‚Å‚É’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚½ê‡XVˆ—
if flg_sub_chek = 0.
modify gt_table_a from gf_table_2
transporting urizen arazen arari3
where  vkbcd  = gf_table_2-vkbcd
and    vkbnm  = gf_table_2-vkbnm
and    rui    = gf_table_2-rui.
*  ’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚È‚¢ê‡’Ç‰Áˆ—
else.
append gf_table_2 to gt_table_a.
endif.

*    “–Œ—\’èƒŒƒR[ƒh
gf_table_3-vkbcd    = gf_tvkbt-vkbur.            "‰c‹ÆŠƒR[ƒh
gf_table_3-vkbnm    = gf_tvkbt-bezei.            "‰c‹ÆŠ–¼
gf_table_3-rui      = '3'.
gf_table_3-urizen   = g_zendat901.               "‘O”N“x‘OŠú”„ã“–Œ
gf_table_3-arazen   = g_zenaradat.               "‘O”N“x‘OŠú‘e—˜“–Œ
gf_table_3-arari3   = g_zenkiara901.             "‘O”N“x‘OŠú‘e—˜—¦“–Œ
*  ‚·‚Å‚É’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚½ê‡XVˆ—
if flg_sub_chek = 0.
modify gt_table_a from gf_table_3
transporting urizen arazen arari3
where  vkbcd  = gf_table_3-vkbcd
and    vkbnm  = gf_table_3-vkbnm
and    rui    = gf_table_3-rui.
*  ’ •[“à•”ƒe[ƒuƒ‹‚ª‘¶İ‚µ‚Ä‚¢‚È‚¢ê‡’Ç‰Áˆ—
else.
append gf_table_3 to gt_table_a.
endif.

endform.                    " FRM_ZENKIGT_TABLE_A
*&---------------------------------------------------------------------*
*&      Form  FRM_SORT_GT_TABLE_A
*&---------------------------------------------------------------------*
*       ’ •[o—Í“à•”ƒe[ƒuƒ‹ƒ\[ƒgˆ—
*----------------------------------------------------------------------*
*       ‰c‹ÆŠƒR[ƒh¨“–ŒE—İŒvE—\’è
*----------------------------------------------------------------------*
form frm_sort_gt_table_a.

sort gt_table_a by vkbcd rui.

endform.                    " FRM_SORT_GT_TABLE_A
*&---------------------------------------------------------------------*
*&      Form  FORM_WRITE
*&---------------------------------------------------------------------*
*       ’ •[o—Í
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*      ’ •[o—Í
form form_write using    gf_table_a-g_vkbcd           "‰c‹ÆŠƒR[ƒh
gf_table_a-g_vkbnm           "‰c‹ÆŠ–¼
gf_table_a-g_rui             "“–ŒE—İŒvE—\’è
gf_table_a-g_uriyo           "”„ã—\Z
gf_table_a-g_arariyo         "‘e—˜—\Z
gf_table_a-g_arari1          "‘e—˜—¦—\Z
gf_table_a-g_uriji           "”„ãÀÑ
gf_table_a-g_araji           "‘e—˜ÀÑ
gf_table_a-g_arari2          "‘e—˜—¦ÀÑ
gf_table_a-g_urizen          "”„ã‘OŠúÀÑ
gf_table_a-g_arazen          "‘e—˜‘OŠúÀÑ
gf_table_a-g_arari3          "‘e—˜—¦‘OŠúÀÑ
g_yosan_uri                  "”„ã—\Z’B¬—¦
g_yosan_ara                  "‘e—˜—\Z’B¬—¦
g_zen_uri                    "”„ã‘OŠú”ä
g_zen_ara .                  "‘e—˜‘OŠú”ä

* MODIFY PSD K.ARAI 2002/05/29
* MODIFY PSD K.ARAI 2002/05/27
write : /32(8)    '”„    ã',
49(8)    '‘e    —˜',
63(8)    '‘e —˜ —¦'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : /26(8)    '”„    ã',
*           43(8)    '‘e    —˜',
*           57(8)    '‘e —˜ —¦'.
**  WRITE : /19(8)    '”„    ã',
**           36(8)    '‘e    —˜',
**           50(8)    '‘e —˜ —¦'.
** MODIFY END.
* MODIFY END

* APPEND PSD K.ARAI 2002/05/27
skip.
* APPEND END.

* MODIFY PSD K.ARAI 2002/05/29
write : /15(8)     '—\@@Z',
28(12)   gf_table_a-g_uriyo,
45(12)   gf_table_a-g_arariyo,
62(7)    gf_table_a-g_arari1,   69(1) '%'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : /9(8)     '—\@@Z',
*         22(12)   GF_TABLE_A-G_URIYO,
*         39(12)   GF_TABLE_A-G_ARARIYO,
*         56(7)    GF_TABLE_A-G_ARARI1,   63(1) '%'.
**  WRITE : /4(8)     '—\@@Z',
**         16(12)   GF_TABLE_A-G_URIYO,
**         33(12)   GF_TABLE_A-G_ARARIYO,
**         50(7)    GF_TABLE_A-G_ARARI1,   57(1) '%'.
** MODIFY END.
* MODIFY END

skip .

* MODIFY PSD K.ARAI 2002/05/29
write :15(8)     g_name,
28(12)   gf_table_a-g_uriji,
45(12)   gf_table_a-g_araji,
62(7)    gf_table_a-g_arari2,   69(1) '%'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : 9(8)     G_NAME,
*         22(12)   GF_TABLE_A-G_URIJI,
*         39(12)   GF_TABLE_A-G_ARAJI,
*         56(7)    GF_TABLE_A-G_ARARI2,   63(1) '%'.
**  WRITE :  4(8)     G_NAME,
**         16(12)   GF_TABLE_A-G_URIJI,
**         33(12)   GF_TABLE_A-G_ARAJI,
**         50(7)    GF_TABLE_A-G_ARARI2,   57(1) '%'.
** MODIFY END.
* MODIFY END

skip.
* MODIFY PSD K.ARAI 2002/05/29
write :15(11)    '‘O ”N À Ñ',
28(12)   gf_table_a-g_urizen,
45(12)   gf_table_a-g_arazen,
62(7)    gf_table_a-g_arari3,   69(1) '%'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : 9(11)    '‘O ”N À Ñ',
*         22(12)   GF_TABLE_A-G_URIZEN,
*         39(12)   GF_TABLE_A-G_ARAZEN,
*         56(7)    GF_TABLE_A-G_ARARI3,   63(1) '%'.
**  WRITE :  4(11)    '‘O ”N À Ñ',
**         16(12)   GF_TABLE_A-G_URIZEN,
**         33(12)   GF_TABLE_A-G_ARAZEN,
**         50(7)    GF_TABLE_A-G_ARARI3,   57(1) '%'.
** MODIFY END.
* MODIFY END
skip.

* MODIFY PSD K.ARAI 2002/05/29
write :15(10)    '—\Z’B¬—¦',
28(11)    g_yosan_uri,    39(1) '%',
45(11)    g_yosan_ara,    56(1) '%'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : 9(10)    '—\Z’B¬—¦',
*         22(11)    G_YOSAN_URI,    33(1) '%',
*         39(11)    G_YOSAN_ARA,    50(1) '%'.
**  WRITE :  4(10)    '—\Z’B¬—¦',
**         16(11)    G_YOSAN_URI,    27(1) '%',
**         33(11)    G_YOSAN_ARA,    44(1) '%'.
** MODIFY END.
* MODIFY END

skip.

* MODIFY PSD K.ARAI 2002/05/29
write :15(10)    '‘O@Šú@”ä',
28(11)    g_zen_uri,  39(1) '%',
45(11)    g_zen_ara,  56(1) '%'.
** MODIFY PSD K.ARAI 2002/05/27
*  WRITE : 9(10)    '‘O@Šú@”ä',
*         22(11)    G_ZEN_URI,  33(1) '%',
*         39(11)    G_ZEN_ARA,  50(1) '%'.
**  WRITE :  4(10)    '‘O@Šú@”ä',
**         16(11)    G_ZEN_URI,  27(1) '%',
**         33(11)    G_ZEN_ARA,  44(1) '%'.
** MODIFY END.
* MODIFY END

* MODIFY PSD K.ARAI 2002/05/27
skip 3 .
*  SKIP.
* MODIFY END
endform.                    " FORM_WRITE

*&---------------------------------------------------------------------*
*&      Form  FRM_CYOUHYOU
*&---------------------------------------------------------------------*
*       ’ •[o—Íˆ—
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
form frm_cyouhyou.

*     Šú‰Œ`‘OŒˆ—ŒŠÔZo
g_mon_count = 1.
flg_tuki = 1.
g_tuki   = g_kisyo+4(2).
while g_tuki <> g_mon+4(2).                "‘OŒˆ—‚É‚È‚é‚Ü‚ÅŒJ‚è•Ô‚·
g_tuki = flg_tuki + g_tuki.
if g_tuki > 12.                          "12‚É‚È‚Á‚½‚ç1‚ğ‘ã“ü
g_tuki = 1.
endif.
g_mon_count = g_mon_count + 1.           "ƒ‹[ƒv” = ˆ—ŠÔ
endwhile.

************************************************************************
*     ’ •[“à•”ƒe[ƒuƒ‹ƒ‹[ƒvˆ—
***********************************************************************

loop at gt_table_a into gf_table_a.

*     —\Z’B¬—¦i”„ãE‘e—˜jZo
if gf_table_a-uriyo = 0.
g_yosan_uri = 0.
else.
g_yosan_uri = gf_table_a-uriji / gf_table_a-uriyo * 100.
endif.
if gf_table_a-arariyo = 0.
g_yosan_ara = 0.
else.
g_yosan_ara = gf_table_a-araji / gf_table_a-arariyo * 100.
endif.

*     ‘OŠú”äi”„ãE‘e—˜jZo
if gf_table_a-urizen = 0.
g_zen_uri = 0.
else.
g_zen_uri = gf_table_a-uriji / gf_table_a-urizen * 100.
endif.
if gf_table_a-arazen = 0.
g_zen_ara = 0.
else.
g_zen_ara = gf_table_a-araji / gf_table_a-arazen * 100.
endif.

*     ç‰~’PˆÊZo
gf_table_a-uriyo   = gf_table_a-uriyo   / 1000. "”„ã—\Z
gf_table_a-arariyo = gf_table_a-arariyo / 1000. "‘e—˜—\Z
gf_table_a-uriji   = gf_table_a-uriji   / 1000. "”„ãÀÑ
gf_table_a-araji   = gf_table_a-araji   / 1000. "‘e—˜ÀÑ
gf_table_a-urizen  = gf_table_a-urizen  / 1000. "”„ã‘OŠúÀÑ
gf_table_a-arazen  = gf_table_a-arazen  / 1000. "‘e—˜‘OŠúÀÑ

case gf_table_a-rui.                         "“–ŒE—İŒvE—\’è€–Ú
*** ‚Pi“–Œ)ˆ— ***
when '1'.
g_name = 'À    Ñ'.
*    ‘OŒo—Í
* MODIFY PSD K.ARAI 2002/05/29
write : /9(2)    'y',
13(2)    g_mon+4(2),
16(2)    'Œ',
19(4)    'ÀÑ',
25(2)   'z'.
** MODIFY PSD K.ARAI 2002/05/27
*        WRITE : /3(2)    'y',
*                 7(2)    G_MON+4(2),
*                10(2)    'Œ',
*                13(4)    'ÀÑ',
*                19(2)   'z'.
**        WRITE : /0(2)    'y',
**                 4(2)    G_MON+4(2),
**                 6(2)    'Œ',
**                 9(4)    'ÀÑ',
**                 14(2)   'z'.
** MODIFY END
* MODIFY END

* APPEND PSD K.ARAI 2002/05/27
skip 2.
* APPEND END.
*     ‘OŒ’ •[o—Í
perform form_write using  gf_table_a-vkbcd
gf_table_a-vkbnm
gf_table_a-rui
gf_table_a-uriyo
gf_table_a-arariyo
gf_table_a-arari1
gf_table_a-uriji
gf_table_a-araji
gf_table_a-arari2
gf_table_a-urizen
gf_table_a-arazen
gf_table_a-arari3
g_yosan_uri
g_yosan_ara
g_zen_uri
g_zen_ara .
*** ‚Qi—İŒvjˆ—***
when '2'.
g_name = 'À    Ñ'.
*    —İŒvo—Í
* MODIFY PSD K.ARAI 2002/05/29
write : /9(2)    'y',
13(2)    g_kisyo+4(2),
16(2)    'Œ',
19(2)    '`',
22(2)   g_mon+4(2),
24(2)   'Œ',
26(4)   'ÀÑ',
32(2)   g_mon_count,
34(4)   'ƒ–Œ',
39(2)   'z'.
** MODIFY PSD K.ARAI 2002/05/27
*        WRITE : /3(2)    'y',
*                 7(2)    G_KISYO+4(2),
*                 10(2)    'Œ',
*                 13(2)    '`',
*                 16(2)   G_MON+4(2),
*                 18(2)   'Œ',
*                 21(4)   'ÀÑ',
*                 26(2)   G_MON_COUNT,
*                 28(4)   'ƒ–Œ',
*                 33(2)   'z'.
**        WRITE : /0(2)    'y',
**                 4(2)    G_KISYO+4(2),
**                 6(2)    'Œ',
**                 9(2)    '`',
**                 12(2)   G_MON+4(2),
**                 14(2)   'Œ',
**                 17(4)   'ÀÑ',
**                 22(2)   G_MON_COUNT,
**                 24(4)   'ƒ–Œ',
**                 29(2)   'z'.
** MODIFY END
* MODIFY END

* APPEND PSD K.ARAI 2002/05/27
skip 2.
* APPEND END.
*     —İŒv’ •[o—Í
perform form_write using  gf_table_a-vkbcd
gf_table_a-vkbnm
gf_table_a-rui
gf_table_a-uriyo
gf_table_a-arariyo
gf_table_a-arari1
gf_table_a-uriji
gf_table_a-araji
gf_table_a-arari2
gf_table_a-urizen
gf_table_a-arazen
gf_table_a-arari3
g_yosan_uri
g_yosan_ara
g_zen_uri
g_zen_ara .
*** ‚Ri—\’èjˆ—***
when '3'.
g_name = '—\@@’è'.
*    “–Œo—Í
* MODIFY PSD K.ARAI
write : /9(2)    'y',
13(2)    p_datum+4(2),
16(2)    'Œ',
19(4)    '—\’è',
25(2)   'z'.
** MODIFY PSD K.ARAI 2002/05/27
*        WRITE : /3(2)    'y',
*                 7(2)    P_DATUM+4(2),
*                 10(2)    'Œ',
*                 13(4)    '—\’è',
*                 19(2)   'z'.
**        WRITE : /0(2)    'y',
**                 4(2)    P_DATUM+4(2),
**                 6(2)    'Œ',
**                 9(4)    '—\’è',
**                 14(2)   'z'.
** MODIFY END
* MODIFY END

* APPEND PSD K.ARAI 2002/05/27
skip 2.
* APPEND END.
*     “–Œ’ •[o—Í
perform form_write using  gf_table_a-vkbcd
gf_table_a-vkbnm
gf_table_a-rui
gf_table_a-uriyo
gf_table_a-arariyo
gf_table_a-arari1
gf_table_a-uriji
gf_table_a-araji
gf_table_a-arari2
gf_table_a-urizen
gf_table_a-arazen
gf_table_a-arari3
g_yosan_uri
g_yosan_ara
g_zen_uri
g_zen_ara .
*    ‰üƒy[ƒWˆ—
new-page.
endcase.
endloop.
endform.                    " FRM_CYOUHYOU
*&---------------------------------------------------------------------*
*&      Form  DATA_CLEAR
*&---------------------------------------------------------------------*
*       €–Ú‰Šú‰»ˆ—
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
form data_clear.
clear g_zen001.                                    "‘OŒ”„ã—\Z
clear g_zen000.                                    "‘OŒ”„ãÀÑ
clear g_zenuri000.                                 "‘OŒ”„ã‘OŠúÀÑ
clear g_rui000.                                    "—İŒv”„ã—\Z
clear g_rui001.                                    "—İŒv”„ãÀÑ
clear g_zenrui000.                                 "—İŒv”„ã‘OŠúÀÑ
clear g_dat001.                                    "“–Œ”„ã—\Z
clear g_dat901.                                    "“–Œ”„ã—\’è
clear g_zendat901.                                 "“–Œ”„ã‘OŠúÀÑ
clear g_zenara001.                                 "‘OŒ‘e—˜—\Z
clear g_zenara000.                                 "‘OŒ‘e—˜ÀÑ
clear g_zenarauri.                                 "‘OŒ‘e—˜‘OŠúÀÑ
clear g_ruiara001.                                 "—İŒv‘e—˜—\Z
clear g_ruiara000.                                 "—İŒv‘e—˜ÀÑ
clear g_zenararui.                                 "—İŒv‘e—˜‘OŠúÀÑ
clear g_datara001.                                 "“–Œ‘e—˜—\Z
clear g_datara901.                                 "“–Œ‘e—˜—\’è
clear g_zenaradat.                                 "“–Œ‘e—˜‘OŠúÀÑ
clear g_zenarariritu001.                           "‘OŒ‘e—˜—¦—\Z
clear g_ruiarariritu001.                           "—İŒv‘e—˜—¦—\Z
clear g_datarariritu001.                           "“–Œ‘e—˜—¦—\Z
clear g_zenarariritu000.                           "‘OŒ‘e—˜—¦ÀÑ
clear g_ruiarariritu000.                           "—İŒv‘e—˜—¦ÀÑ
clear g_datarariritu901.                           "“–Œ‘e—˜—¦—\’è
clear g_zenkiara000.                               "‘OŒ‘e—˜—¦‘OŠúÀÑ
clear g_zenkiararui.                               "—İŒv‘e—˜—¦‘OŠúÀÑ
clear g_zenkiara901.                               "“–Œ‘e—˜—¦‘OŠúÀÑ
clear g_yosan_uri.                                 "—\Z’B¬—¦i”„ãj
clear g_yosan_ara.                                 "—\Z’B¬—¦i‘e—˜j
clear g_zen_uri.                                   "‘OŠú”äi”„ãj
clear g_zen_ara.                                   "‘OŠú”äi‘e—˜j
endform.                    " DATA_CLEAR
